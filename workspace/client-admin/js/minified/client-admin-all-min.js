Ext.namespace("sitools.env");var i18n={map:[],load:function(a,c){var b=this;Ext.Ajax.request({method:"GET",url:a,success:function(d,e){ann(d.responseText,"no response is sent");b.map=b.transformsPropertiesToMap(d.responseText);c()},failure:function(d,e){Ext.Msg.alert("Error! Can't read i18n file with url :"+a)}})},transformsPropertiesToMap:function(g){var k=g.split("\n");var f=[];for(var d=0;d<k.length;d++){var a=k[d];var c=a.indexOf("=");if(c>=1){var b=a.substring(0,c).replace("\r","");var e=a.substring(c+1).replace("\r","");f[b]=e}}return f},get:function(a){return !Ext.isEmpty(this.map[a])?this.map[a]:a}};var sql2ext={map:[],load:function(a){var b=this;Ext.Ajax.request({method:"GET",url:a,success:function(c,d){ann(c.responseText,"no response is sent");b.map=b.transformsPropertiesToMap(c.responseText)},failure:function(c,d){alert("Error! Can't read i18n file with url :"+a)}})},transformsPropertiesToMap:function(g){var k=g.split("\n");var f=[];var d;for(d=0;d<k.length;d++){var a=k[d];var c=a.indexOf("=");if(c>=1){var b=a.substring(0,c).replace("\r","");var e=a.substring(c+1).replace("\r","");f[b]=e}}return f},get:function(a){return !Ext.isEmpty(this.map[a])?this.map[a]:"auto"}};var componentManager={loadedComponents:[],load:function(a){}};var data={ret:null,get:function(b,a){Ext.Ajax.request({method:"GET",url:b,success:function(c,d){a(Ext.decode(c.responseText))},failure:function(c,d){Ext.Msg.alert("Warning","Error! Can't get data with url :"+b)}});return this.ret}};Ext.applyIf(Array.prototype,{clone:function(){return[].concat(this)}});Ext.namespace("sitools.siteMap");var loadUrl={map:[],load:function(a,d,b){var c=this;c.transformsPropertiesToMap(a,d,b)},transformsPropertiesToMap:function(b,e,c){var a=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:b,restful:true}),reader:new Ext.data.XmlReader({record:"url"},[{name:"name",mapping:"name"},{name:"loc",mapping:"loc"}])});var d=this.map;a.load({scope:c,callback:function(m,k,p){var l=0;while(l!=undefined){var n=m[l];if(n!=undefined){var g=n.data.loc;var f=n.data.name;d[f]=g;l++}else{l=undefined}}e.call(this)}})},get:function(a){return !Ext.isEmpty(this.map[a])?this.map[a]:a}};var componentManager={loadedComponents:[],load:function(a){}};var data={ret:null,get:function(b,a){Ext.Ajax.request({method:"GET",url:b,success:function(c,d){a(Ext.decode(c.responseText))},failure:function(c,d){Ext.Msg.alert("Warning","Error! Can't get data with url :"+b)}});return this.ret}};Ext.applyIf(Array.prototype,{clone:function(){return[].concat(this)}});var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(c){var a="";var m,k,f,l,g,e,d;var b=0;c=Base64._utf8_encode(c);while(b<c.length){m=c.charCodeAt(b++);k=c.charCodeAt(b++);f=c.charCodeAt(b++);l=m>>2;g=((m&3)<<4)|(k>>4);e=((k&15)<<2)|(f>>6);d=f&63;if(isNaN(k)){e=d=64}else{if(isNaN(f)){d=64}}a=a+this._keyStr.charAt(l)+this._keyStr.charAt(g)+this._keyStr.charAt(e)+this._keyStr.charAt(d)}return a},decode:function(c){var a="";var m,k,f;var l,g,e,d;var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(b<c.length){l=this._keyStr.indexOf(c.charAt(b++));g=this._keyStr.indexOf(c.charAt(b++));e=this._keyStr.indexOf(c.charAt(b++));d=this._keyStr.indexOf(c.charAt(b++));m=(l<<2)|(g>>4);k=((g&15)<<4)|(e>>2);f=((e&3)<<6)|d;a=a+String.fromCharCode(m);if(e!=64){a=a+String.fromCharCode(k)}if(d!=64){a=a+String.fromCharCode(f)}}a=Base64._utf8_decode(a);return a},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a},_utf8_decode:function(a){var b="";var d=0;var e=c1=c2=0;while(d<a.length){e=a.charCodeAt(d);if(e<128){b+=String.fromCharCode(e);d++}else{if((e>191)&&(e<224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}};function array(a){for(i=0;i<a;i++){this[i]=0}this.length=a}function integer(a){return a%(4294967295+1)}function shr(d,c){d=integer(d);c=integer(c);if(d-2147483648>=0){d=d%2147483648;d>>=c;d+=1073741824>>(c-1)}else{d>>=c}return d}function shl1(b){b=b%2147483648;if(b&1073741824==1073741824){b-=1073741824;b*=2;b+=2147483648}else{b*=2}return b}function shl(d,c){d=integer(d);c=integer(c);for(var e=0;e<c;e++){d=shl1(d)}return d}function and(d,c){d=integer(d);c=integer(c);var f=(d-2147483648);var e=(c-2147483648);if(f>=0){if(e>=0){return((f&e)+2147483648)}else{return(f&c)}}else{if(e>=0){return(d&e)}else{return(d&c)}}}function or(d,c){d=integer(d);c=integer(c);var f=(d-2147483648);var e=(c-2147483648);if(f>=0){if(e>=0){return((f|e)+2147483648)}else{return((f|c)+2147483648)}}else{if(e>=0){return((d|e)+2147483648)}else{return(d|c)}}}function xor(d,c){d=integer(d);c=integer(c);var f=(d-2147483648);var e=(c-2147483648);if(f>=0){if(e>=0){return(f^e)}else{return((f^c)+2147483648)}}else{if(e>=0){return((d^e)+2147483648)}else{return(d^c)}}}function not(b){b=integer(b);return(4294967295-b)}var state=new array(4);var count=new array(2);count[0]=0;count[1]=0;var buffer=new array(64);var transformBuffer=new array(16);var digestBits=new array(16);var S11=7;var S12=12;var S13=17;var S14=22;var S21=5;var S22=9;var S23=14;var S24=20;var S31=4;var S32=11;var S33=16;var S34=23;var S41=6;var S42=10;var S43=15;var S44=21;function F(a,c,b){return or(and(a,c),and(not(a),b))}function G(a,c,b){return or(and(a,b),and(c,not(b)))}function H(a,c,b){return xor(xor(a,c),b)}function I(a,c,b){return xor(c,or(a,not(b)))}function rotateLeft(b,c){return or(shl(b,c),(shr(b,(32-c))))}function FF(g,f,n,m,e,k,l){g=g+F(f,n,m)+e+l;g=rotateLeft(g,k);g=g+f;return g}function GG(g,f,n,m,e,k,l){g=g+G(f,n,m)+e+l;g=rotateLeft(g,k);g=g+f;return g}function HH(g,f,n,m,e,k,l){g=g+H(f,n,m)+e+l;g=rotateLeft(g,k);g=g+f;return g}function II(g,f,n,m,e,k,l){g=g+I(f,n,m)+e+l;g=rotateLeft(g,k);g=g+f;return g}function transform(k,m){var g=0,f=0,n=0,l=0;var e=transformBuffer;g=state[0];f=state[1];n=state[2];l=state[3];for(i=0;i<16;i++){e[i]=and(k[i*4+m],255);for(j=1;j<4;j++){e[i]+=shl(and(k[i*4+j+m],255),j*8)}}g=FF(g,f,n,l,e[0],S11,3614090360);l=FF(l,g,f,n,e[1],S12,3905402710);n=FF(n,l,g,f,e[2],S13,606105819);f=FF(f,n,l,g,e[3],S14,3250441966);g=FF(g,f,n,l,e[4],S11,4118548399);l=FF(l,g,f,n,e[5],S12,1200080426);n=FF(n,l,g,f,e[6],S13,2821735955);f=FF(f,n,l,g,e[7],S14,4249261313);g=FF(g,f,n,l,e[8],S11,1770035416);l=FF(l,g,f,n,e[9],S12,2336552879);n=FF(n,l,g,f,e[10],S13,4294925233);f=FF(f,n,l,g,e[11],S14,2304563134);g=FF(g,f,n,l,e[12],S11,1804603682);l=FF(l,g,f,n,e[13],S12,4254626195);n=FF(n,l,g,f,e[14],S13,2792965006);f=FF(f,n,l,g,e[15],S14,1236535329);g=GG(g,f,n,l,e[1],S21,4129170786);l=GG(l,g,f,n,e[6],S22,3225465664);n=GG(n,l,g,f,e[11],S23,643717713);f=GG(f,n,l,g,e[0],S24,3921069994);g=GG(g,f,n,l,e[5],S21,3593408605);l=GG(l,g,f,n,e[10],S22,38016083);n=GG(n,l,g,f,e[15],S23,3634488961);f=GG(f,n,l,g,e[4],S24,3889429448);g=GG(g,f,n,l,e[9],S21,568446438);l=GG(l,g,f,n,e[14],S22,3275163606);n=GG(n,l,g,f,e[3],S23,4107603335);f=GG(f,n,l,g,e[8],S24,1163531501);g=GG(g,f,n,l,e[13],S21,2850285829);l=GG(l,g,f,n,e[2],S22,4243563512);n=GG(n,l,g,f,e[7],S23,1735328473);f=GG(f,n,l,g,e[12],S24,2368359562);g=HH(g,f,n,l,e[5],S31,4294588738);l=HH(l,g,f,n,e[8],S32,2272392833);n=HH(n,l,g,f,e[11],S33,1839030562);f=HH(f,n,l,g,e[14],S34,4259657740);g=HH(g,f,n,l,e[1],S31,2763975236);l=HH(l,g,f,n,e[4],S32,1272893353);n=HH(n,l,g,f,e[7],S33,4139469664);f=HH(f,n,l,g,e[10],S34,3200236656);g=HH(g,f,n,l,e[13],S31,681279174);l=HH(l,g,f,n,e[0],S32,3936430074);n=HH(n,l,g,f,e[3],S33,3572445317);f=HH(f,n,l,g,e[6],S34,76029189);g=HH(g,f,n,l,e[9],S31,3654602809);l=HH(l,g,f,n,e[12],S32,3873151461);n=HH(n,l,g,f,e[15],S33,530742520);f=HH(f,n,l,g,e[2],S34,3299628645);g=II(g,f,n,l,e[0],S41,4096336452);l=II(l,g,f,n,e[7],S42,1126891415);n=II(n,l,g,f,e[14],S43,2878612391);f=II(f,n,l,g,e[5],S44,4237533241);g=II(g,f,n,l,e[12],S41,1700485571);l=II(l,g,f,n,e[3],S42,2399980690);n=II(n,l,g,f,e[10],S43,4293915773);f=II(f,n,l,g,e[1],S44,2240044497);g=II(g,f,n,l,e[8],S41,1873313359);l=II(l,g,f,n,e[15],S42,4264355552);n=II(n,l,g,f,e[6],S43,2734768916);f=II(f,n,l,g,e[13],S44,1309151649);g=II(g,f,n,l,e[4],S41,4149444226);l=II(l,g,f,n,e[11],S42,3174756917);n=II(n,l,g,f,e[2],S43,718787259);f=II(f,n,l,g,e[9],S44,3951481745);state[0]+=g;state[1]+=f;state[2]+=n;state[3]+=l}function init(){count[0]=count[1]=0;state[0]=1732584193;state[1]=4023233417;state[2]=2562383102;state[3]=271733878;for(i=0;i<digestBits.length;i++){digestBits[i]=0}}function update(a){var c,d;c=and(shr(count[0],3),63);if(count[0]<4294967295-7){count[0]+=8}else{count[1]++;count[0]-=4294967295+1;count[0]+=8}buffer[c]=and(a,255);if(c>=63){transform(buffer,0)}}function finish(){var d=new array(8);var e;var c=0,b=0,a=0;for(c=0;c<4;c++){d[c]=and(shr(count[0],(c*8)),255)}for(c=0;c<4;c++){d[c+4]=and(shr(count[1],(c*8)),255)}b=and(shr(count[0],3),63);a=(b<56)?(56-b):(120-b);e=new array(64);e[0]=128;for(c=0;c<a;c++){update(e[c])}for(c=0;c<8;c++){update(d[c])}for(c=0;c<4;c++){for(j=0;j<4;j++){digestBits[c*4+j]=and(shr(state[c],(j*8)),255)}}}function hexa(d){var c="0123456789abcdef";var a="";var b=d;for(hexa_i=0;hexa_i<8;hexa_i++){a=c.charAt(Math.abs(b)%16)+a;b=Math.floor(b/16)}return a}var ascii="01234567890123456789012345678901 !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";function MD5(m){var a,f,b,g,e,d,c;init();for(b=0;b<m.length;b++){a=m.charAt(b);update(ascii.lastIndexOf(a))}finish();g=e=d=c=0;for(i=0;i<4;i++){g+=shl(digestBits[15-i],(i*8))}for(i=4;i<8;i++){e+=shl(digestBits[15-i],((i-4)*8))}for(i=8;i<12;i++){d+=shl(digestBits[15-i],((i-8)*8))}for(i=12;i<16;i++){c+=shl(digestBits[15-i],((i-12)*8))}f=hexa(c)+hexa(d)+hexa(e)+hexa(g);return f}function Digest(a){this.url=a.url;this.usr=a.usr;this.pwd=a.pwd;this.realm=a.realm;this.algorithm=a.algorithm;this.nonce=a.nonce;this.method=a.method;this.mode=a.mode;this.A1=a.A1;this.getDigestAuth=function(){this.resetHeaders();return this.buildAuthenticationRequest()};this.getA1=function(){this.resetHeaders();return this.digest(this.usr+":"+this.realm+":"+this.pwd)};this.resetHeaders=function(){if(typeof(this.headers)!="undefined"){delete this.headers}this.headers={uri:this.url,username:this.usr,algorithm:this.algorithm,realm:this.realm,nonce:this.nonce}};this.digest=function(b){if(typeof(window[this.headers.algorithm])!="function"){if(typeof(window.MD5)!="function"){alert("Votre navigateur ne supporte pas l'authentification HTTP Digest !");return false}else{return MD5(b)}}return window[this.headers.algorithm](b)};this.buildResponseHash=function(){if(this.headers.salt){auth.secret=auth.secret+":"+auth.headers.salt;delete auth.headers.salt}if(this.headers.migrate){auth.secret=this.digest(auth.secret)}var c;if(Ext.isEmpty(this.A1)){c=this.getA1()}else{c=this.A1}var b=this.digest(this.method+":"+this.headers.uri);if(this.mode=="digest"){return this.digest(c+":"+this.headers.nonce+":"+b)}return null};this.buildAuthenticationRequest=function(){var d="Digest";var b=" ";for(name in this.headers){d+=b+name+'="'+this.headers[name]+'"';b=","}if(typeof(this.headers.algorithm)=="undefined"){return d}var c=this.buildResponseHash();if(c){d+=', response="'+c+'"';return d}return false}}function ann(b,a){if(b===true||b===false){return}if(b===undefined){cerr("Object is undefined - "+a);ctrace();return}if(b===null){cerr("Object is null - "+a);ctrace();return}if(b===""){cerr("String seems empty - "+a);ctrace();return}if(b==NaN){cerr("Object equals NaN - "+a);ctrace();return}}function assert(b,a){if(!b){cerr("Condition is not valid : "+a);ctrace();return}}function clog(a){if(isFirebugConsoleIsActive()){console.log(a)}}function cerr(a){if(isFirebugConsoleIsActive()){console.trace()}}function ctrace(){if(isFirebugConsoleIsActive()){console.trace()}}function cdir(a){if(isFirebugConsoleIsActive()){console.dir(a)}}function isFirebugConsoleIsActive(){try{if(console!==null&&console!==undefined){return true}else{return false}}catch(a){return false}}Ext.ns("sitools.common.utils");sitools.common.utils.Utils={arrayProperties2Object:function(b){var a={};Ext.each(b,function(c){if(!Ext.isEmpty(c.name)&&!Ext.isEmpty(c.value)){a[c.name]=c.value}});return a},syntaxHighlight:function(a){a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return a.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(c){var b="number";if(/^"/.test(c)){if(/:$/.test(c)){b="key"}else{b="string"}}else{if(/true|false/.test(c)){b="boolean"}else{if(/null/.test(c)){b="null"}}}return'<span class="'+b+'">'+c+"</span>"})}};sitoolsUtils=sitools.common.utils.Utils;Ext.ns("sitools.common.utils");sitools.common.utils.Date={regToday:new RegExp("^{\\$TODAY} *(\\+ *[0-9]*|\\- *[0-9]*)?$"),timeInterval:Date.DAY,stringWithTodayToDate:function(d){if(Ext.isDate(d)){return d}if(!this.regToday.test(d)){return null}var c=new RegExp("[0-9]+","g");var b=new RegExp("[+]|[-]");var f=parseFloat(c.exec(d));var e=b.exec(d);var a=new Date();if(Ext.isEmpty(f)&&!Ext.isEmpty(e)){return null}if(!Ext.isEmpty(f)&&!Ext.isEmpty(e)){if(e=="-"){f=f*-1}a=a.add(this.timeInterval,f)}return a},isValidDate:function(a){if(Object.prototype.toString.call(a)!=="[object Date]"){return false}return !isNaN(a.getTime())}};function Reference(url){if(url.length==0){eval('throw "Invalid URL ['+url+"];")}this.url=url;this.port=-1;this.query=(this.url.indexOf("?")>=0)?this.url.substring(this.url.indexOf("?")+1):"";if(this.query.indexOf("#")>=0){this.query=this.query.substring(0,this.query.indexOf("#"))}this.protocol="";this.host="";var protocolSepIndex=this.url.indexOf("://");if(protocolSepIndex>=0){this.protocol=this.url.substring(0,protocolSepIndex).toLowerCase();this.host=this.url.substring(protocolSepIndex+3);if(this.host.indexOf("/")>=0){this.host=this.host.substring(0,this.host.indexOf("/"))}var atIndex=this.host.indexOf("@");if(atIndex>=0){var credentials=this.host.substring(0,atIndex);var colonIndex=credentials.indexOf(":");if(colonIndex>=0){this.username=credentials.substring(0,colonIndex);this.password=credentials.substring(colonIndex)}else{this.username=credentials}this.host=this.host.substring(atIndex+1)}var portColonIndex=this.host.indexOf(":");if(portColonIndex>=0){this.port=this.host.substring(portColonIndex+1);this.host=this.host.substring(0,portColonIndex)}this.file=this.url.substring(protocolSepIndex+3);this.file=this.file.substring(this.file.indexOf("/"))}else{this.file=this.url}if(this.file.indexOf("?")>=0){this.file=this.file.substring(0,this.file.indexOf("?"))}var refSepIndex=url.indexOf("#");if(refSepIndex>=0){this.file=this.file.substring(0,refSepIndex);this.reference=this.url.substring(this.url.indexOf("#"))}else{this.reference=""}this.path=this.file;if(this.query.length>0){this.file+="?"+this.query}if(this.reference.length>0){this.file+="#"+this.reference}this.getPort=getPort;this.getQuery=getQuery;this.getProtocol=getProtocol;this.getHost=getHost;this.getUserName=getUserName;this.getPassword=getPassword;this.getFile=getFile;this.getReference=getReference;this.getPath=getPath;this.getArgumentValue=getArgumentValue;this.getArgumentValues=getArgumentValues;this.toString=toString;function getPort(){return this.port}function getQuery(){return this.query}function getProtocol(){return this.protocol}function getHost(){return this.host}function getUserName(){return this.username}function getPassword(){return this.password}function getFile(){return this.file}function getReference(){return this.reference}function getPath(){return this.path}function getArgumentValue(key){var a=this.getArgumentValues();if(a.length<1){return""}for(var i=0;i<a.length;i++){if(a[i][0]==key){return a[i][1]}}return""}function getArgumentValues(){var a=new Array();var b=this.query.split("&amp;");var c="";if(b.length<1){return a}for(var i=0;i<b.length;i++){c=b[i].split("=");a[i]=new Array(c[0],((c.length==1)?c[0]:c[1]))}return a}function toString(){return this.url}}Ext.ux.StatusBar=Ext.extend(Ext.Toolbar,{cls:"x-statusbar",busyIconCls:"x-status-busy",busyText:"Loading...",autoClear:5000,emptyText:"&nbsp;",activeThreadId:0,initComponent:function(){if(this.statusAlign=="right"){this.cls+=" x-status-right"}Ext.ux.StatusBar.superclass.initComponent.call(this)},afterRender:function(){Ext.ux.StatusBar.superclass.afterRender.call(this);var a=this.statusAlign=="right";this.currIconCls=this.iconCls||this.defaultIconCls;this.statusEl=new Ext.Toolbar.TextItem({cls:"x-status-text "+(this.currIconCls||""),text:this.text||this.defaultText||""});if(a){this.add("->");this.add(this.statusEl)}else{this.insert(0,this.statusEl);this.insert(1,"->")}this.doLayout()},setStatus:function(d){d=d||{};if(typeof d=="string"){d={text:d}}if(d.text!==undefined){this.setText(d.text)}if(d.iconCls!==undefined){this.setIcon(d.iconCls)}if(d.clear){var e=d.clear,b=this.autoClear,a={useDefaults:true,anim:true};if(typeof e=="object"){e=Ext.applyIf(e,a);if(e.wait){b=e.wait}}else{if(typeof e=="number"){b=e;e=a}else{if(typeof e=="boolean"){e=a}}}e.threadId=this.activeThreadId;this.clearStatus.defer(b,this,[e])}return this},clearStatus:function(c){c=c||{};if(c.threadId&&c.threadId!==this.activeThreadId){return this}var b=c.useDefaults?this.defaultText:this.emptyText,a=c.useDefaults?(this.defaultIconCls?this.defaultIconCls:""):"";if(c.anim){this.statusEl.el.fadeOut({remove:false,useDisplay:true,scope:this,callback:function(){this.setStatus({text:b,iconCls:a});this.statusEl.el.show()}})}else{this.statusEl.hide();this.setStatus({text:b,iconCls:a});this.statusEl.show()}return this},setText:function(a){this.activeThreadId++;this.text=a||"";if(this.rendered){this.statusEl.setText(this.text)}return this},getText:function(){return this.text},setIcon:function(a){this.activeThreadId++;a=a||"";if(this.rendered){if(this.currIconCls){this.statusEl.removeClass(this.currIconCls);this.currIconCls=null}if(a.length>0){this.statusEl.addClass(a);this.currIconCls=a}}else{this.currIconCls=a}return this},showBusy:function(a){if(typeof a=="string"){a={text:a}}a=Ext.applyIf(a||{},{text:this.busyText,iconCls:this.busyIconCls});return this.setStatus(a)}});Ext.reg("statusbar",Ext.ux.StatusBar);Ext.namespace("Ext.ux.plugins");Ext.ux.plugins.SliderRange=function(a){Ext.apply(this,a)};Ext.extend(Ext.ux.plugins.SliderRange,Ext.util.Observable,{init:function(a){Ext.apply(a,{onResize:a.onResize.createSequence(function(f,b){this.el.addClass("ux-sliderrange-slider");if(a.range){a.range.remove()}a.range=a.el.createChild({cls:"ux-sliderrange"});var d=a.translateValue(a.minValue);var g=a.translateValue((a.minValue+a.increment));var k=g-d;var c;c=0;for(var e=a.minValue;e<=a.maxValue;e=e+a.increment){a.range.createChild({html:""+e,cls:"ux-sliderrange-val",style:"left: "+(d+(k*c))+"px;"});c++}})})}});Ext.namespace("sitools.userProfile");sitools.userProfile.LoginUtils={connect:function(b){var a=loadUrl.get("APP_URL")+"/login-details";Ext.Ajax.request({method:"GET",url:a,success:function(e){var d=Ext.decode(e.responseText);if(d.success){var f=d.data;var c=false;var g=null;Ext.each(f,function(k){if(k.name==="Starter.SECURITY.DELEGATE_LOGIN"){c=(k.value==="true")}if(k.name==="Starter.SECURITY.DELEGATE_LOGIN_URL"){g=k.value}});if(c){if(Ext.isEmpty(g)){Ext.Msg.alert(i18n.get("label.warning"),"No Logout url defined");return}sitools.userProfile.LoginUtils.delegateLoginLogout(g)}else{sitools.userProfile.LoginUtils.sitoolsLogin(b)}}else{sitools.userProfile.LoginUtils.sitoolsLogin(b)}},failure:function(){sitools.userProfile.LoginUtils.sitoolsLogin(b)}})},logout:function(){var a=loadUrl.get("APP_URL")+"/login-details";Ext.Ajax.request({method:"GET",url:a,success:function(e){var d=Ext.decode(e.responseText);if(d.success){var f=d.data;var c=false;var b=null;Ext.each(f,function(g){if(g.name==="Starter.SECURITY.DELEGATE_LOGOUT"){c=(g.value==="true")}if(g.name==="Starter.SECURITY.DELEGATE_LOGOUT_URL"){b=g.value}});utils_logout(!c);if(c){if(Ext.isEmpty(b)){Ext.Msg.alert(i18n.get("label.warning"),"No Logout url defined");return}sitools.userProfile.LoginUtils.delegateLoginLogout(b)}}else{utils_logout(true)}},failure:function(){utils_logout(true)}})},editProfile:function(b){var a=loadUrl.get("APP_URL")+"/login-details";Ext.Ajax.request({method:"GET",url:a,success:function(e){var c=Ext.decode(e.responseText);if(c.success){var g=c.data;var d=false;var f=null;Ext.each(g,function(k){if(k.name==="Starter.SECURITY.DELEGATE_USER_MANAGMENT"){d=(k.value==="true")}if(k.name==="Starter.SECURITY.DELEGATE_USER_MANAGMENT_URL"){f=k.value}});if(d){if(Ext.isEmpty(f)){Ext.Msg.alert(i18n.get("label.warning"),"No user managment url defined");return}sitools.userProfile.LoginUtils.delegateLoginLogout(f)}else{b.call()}}else{b.call()}},failure:function(){b.call()}})},sitoolsLogin:function(a){new sitools.userProfile.Login(a).show()},delegateLoginLogout:function(b){var a=b.replace("{goto}",document.URL);window.open(a,"_self")},};Ext.namespace("sitools.userProfile");sitools.userProfile.Login=Ext.extend(Ext.Window,{id:"winLogin",layout:"hbox",width:392,height:220,resizable:false,closable:false,modal:true,initComponent:function(){this.title=i18n.get("label.login");this.bbar=new Ext.ux.StatusBar({text:i18n.get("label.ready"),id:"sbWinLogin",iconCls:"x-status-valid",items:[{text:i18n.get("label.passwordLost"),hidden:!this.reset,scope:this,icon:loadUrl.get("APP_URL")+"/common/res/images/icons/wadl.gif",iconAlign:"right",handler:function(){Ext.getCmp("winLogin").close();var a=new sitools.userProfile.resetPassword({closable:this.closable,url:this.reset,handler:this.handler});a.show()}}]});this.combo=new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",forceSelection:true,allowBlank:false,lazyRender:true,mode:"local",store:new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],data:[[1,i18n.get("label.userPortal")],[2,i18n.get("label.administration")]]}),valueField:"myId",displayField:"displayText",anchor:"80%",value:1,fieldLabel:i18n.get("label.target"),hideLabel:true});if(this.chooseLocation){this.combo.setVisible(true);this.combo.hideLabel=false}else{this.combo.setVisible(false);this.setSize(392,175)}this.items=[{xtype:"form",frame:true,border:false,buttonAlign:"center",id:"frmLogin",width:392,labelWidth:100,padding:"10px 10px 0px 60px",bodyStyle:"background-image: url("+loadUrl.get("APP_URL")+"/common/res/images/ux/login-big.gif);background-position: top left;background-repeat: no-repeat;",items:[{xtype:"textfield",fieldLabel:i18n.get("label.login"),name:"login",id:"logId",allowBlank:false,anchor:"80%",listeners:{afterrender:function(a){a.focus(false,100)}}},{xtype:"textfield",fieldLabel:i18n.get("label.password"),name:"password",id:"pwdId",allowBlank:false,inputType:"password",anchor:"80%",listeners:{scope:this,specialkey:function(b,a){if(a.getKey()==a.ENTER){this.getAuth()}}}},this.combo],buttons:[{text:i18n.get("label.login"),handler:this.getAuth,scope:this},{text:i18n.get("label.reset"),handler:function(){Ext.getCmp("frmLogin").getForm().reset();Ext.getCmp("sbWinLogin").setStatus({text:i18n.get("label.ready"),iconCls:"x-status-valid"})}},{text:i18n.get("label.cancel"),hidden:!this.defurl,scope:this,handler:function(){window.location.href=this.defurl}},{text:i18n.get("label.register"),hidden:!this.register,scope:this,icon:loadUrl.get("APP_URL")+"/common/res/images/icons/refresh.png",handler:function(){Ext.getCmp("winLogin").close();var a=new sitools.userProfile.Register({closable:this.closable,url:this.register,login:this.url,handler:this.handler});a.show()}}]}];sitools.userProfile.Login.superclass.initComponent.call(this)},getAuth:function(){Ext.util.Cookies.set("A1","");Ext.util.Cookies.set("userLogin","");Ext.util.Cookies.set("scheme","");Ext.util.Cookies.set("algorithm","");Ext.util.Cookies.set("realm","");Ext.util.Cookies.set("nonce","");Ext.util.Cookies.set("hashCode","");Ext.apply(Ext.Ajax.defaultHeaders,{Authorization:""});Ext.Ajax.request({url:this.url,method:"GET",scope:this,success:function(f,a){var e=Ext.decode(f.responseText);var c=new Date();if(!Ext.isEmpty(e.data)){if(e.data.scheme=="HTTP_Digest"){var b=new Digest({usr:Ext.getCmp("logId").getValue(),pwd:Ext.getCmp("pwdId").getValue(),realm:e.data.realm});var d=b.getA1();Ext.util.Cookies.set("A1",d);Ext.util.Cookies.set("userLogin",b.usr,c.add(Date.MINUTE,1));Ext.util.Cookies.set("scheme",e.data.scheme);Ext.util.Cookies.set("algorithm",e.data.algorithm);Ext.util.Cookies.set("realm",b.realm);Ext.util.Cookies.set("nonce",e.data.nonce)}else{if(e.data.scheme=="HTTP_Basic"){var k=Ext.getCmp("logId").getValue();var l=Ext.getCmp("pwdId").getValue();var m=k+":"+l;var g=Base64.encode(m);var b="Basic "+g;Ext.util.Cookies.set("userLogin",k,c.add(Date.MINUTE,1));Ext.util.Cookies.set("scheme",e.data.scheme);Ext.util.Cookies.set("hashCode",b,c.add(Date.MINUTE,1))}}}this.login()},failure:alertFailure})},login:function(){if(!Ext.getCmp("frmLogin").getForm().isValid()){Ext.getCmp("sbWinLogin").setStatus({text:i18n.get("warning.checkForm"),iconCls:"x-status-error"});return}Ext.getCmp("winLogin").body.mask();Ext.getCmp("sbWinLogin").showBusy();Ext.Ajax.request({url:this.url,method:"GET",scope:this,success:function(c,e){try{var b=Ext.decode(c.responseText);if(b.success){Ext.apply(Ext.Ajax.defaultHeaders,{Authorization:Ext.util.Cookies.get("hashCode")});Ext.getCmp("winLogin").close();if(this.chooseLocation){if(this.combo.getValue()==1){window.location.href=loadUrl.get("APP_URL")+"/login-redirect?kwd=/client-user/index.html"}else{Ext.Ajax.request({url:loadUrl.get("APP_URL")+"/login-redirect?kwd=/client-admin",method:"GET",success:function(f){Ext.Msg.alert("error login.js redirect with authorization")}})}}else{window.location.reload()}}else{Ext.util.Cookies.set("userLogin","",new Date().add(Date.MINUTE,COOKIE_DURATION*-1));Ext.util.Cookies.set("scheme","",new Date().add(Date.MINUTE,COOKIE_DURATION*-1));Ext.util.Cookies.set("hashCode","",new Date().add(Date.MINUTE,COOKIE_DURATION*-1));var a=i18n.get("warning.serverError")+": "+b.message;Ext.getCmp("winLogin").body.unmask();Ext.getCmp("sbWinLogin").setStatus({text:a,iconCls:"x-status-error"})}}catch(d){Ext.Msg.alert(i18n.get("label.error"),d)}},failure:function(b,d){Ext.util.Cookies.set("userLogin","",new Date().add(Date.MINUTE,COOKIE_DURATION*-1));Ext.util.Cookies.set("scheme","",new Date().add(Date.MINUTE,COOKIE_DURATION*-1));Ext.util.Cookies.set("hashCode","",new Date().add(Date.MINUTE,COOKIE_DURATION*-1));var a;if(b.status==200){var c=Ext.decode(b.responseText).error;a=i18n.get("msg.error")+": "+c}else{a=i18n.get("warning.serverError")+": "+b.statusText}Ext.getCmp("winLogin").body.unmask();Ext.getCmp("sbWinLogin").setStatus({text:a,iconCls:"x-status-error"})}})}});Ext.reg("s-login",sitools.userProfile.Login);Ext.namespace("sitools.widget");sitools.widget.ActionLink=Ext.extend(Ext.BoxComponent,{text:undefined,initComponent:function(){Ext.apply(this,{autoEl:{tag:"div",html:'<a class="small-link">'+this.text+"</a>"}});sitools.widget.ActionLink.superclass.initComponent.apply(this,arguments)},onRender:function(){sitools.widget.ActionLink.superclass.onRender.apply(this,arguments);Ext.get(this.id).child("a").on("click",this._bubbleClick);Ext.get(this.id).child("a").on("mouseover",this._bubbleOver);Ext.get(this.id).child("a").on("mouseout",this._bubbleOut)},_bubbleClick:function(){var a=Ext.getCmp(this.parent().id);a.onClick()},_bubbleOver:function(){var a=Ext.getCmp(this.parent().id);a.onMouseOver()},_bubbleOut:function(){var a=Ext.getCmp(this.parent().id);a.onMouseOut()},onClick:function(){clog("actionLink "+this+" onClick() function is not yet implemented !")},onMouseOver:function(){},onMouseOut:function(){},toString:function(){return"ActionLink "+this.text}});Ext.reg("s-actionlink",sitools.widget.ActionLink);Ext.namespace("sitools.widget");sitools.widget.HighlightText=Ext.extend(Ext.BoxComponent,{text:undefined,initComponent:function(){Ext.apply(this,{autoEl:{html:this.text}});sitools.widget.HighlightText.superclass.initComponent.apply(this,arguments)},onRender:function(){sitools.widget.HighlightText.superclass.onRender.apply(this,arguments)},highlight:function(a){clog("try highlight");if(a==null){a="yellow"}this.getEl().applyStyles("background-color:"+a)},stopHighlight:function(){this.getEl().applyStyles("background-color:")},updateHtml:function(a){this.getEl().update(a)}});Ext.reg("s-lighttext",sitools.widget.HighlightText);Ext.ns("Ext.ux.grid");Ext.ux.grid.CheckColumn=function(a){Ext.apply(this,a);if(!this.id){this.id=Ext.id()}this.renderer=this.renderer.createDelegate(this)};Ext.ux.grid.CheckColumn=Ext.extend(Ext.Component,{enabled:true,init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this)},this)},onMouseDown:function(f,c){if(Ext.fly(c).hasClass(this.createId())&&Ext.fly(c).hasClass("x-grid3-check-col-enabled")){f.stopEvent();var b=this.grid.getView().findRowIndex(c);var a=this.grid.store.getAt(b);var d;d=!a.data[this.dataIndex];a.set(this.dataIndex,!a.data[this.dataIndex]);this.fireEvent("change",this,d)}},renderer:function(b,d,a){d.css+=" x-grid3-check-col-td";var c=Ext.getCmp(this.id);if(c.enabled){return String.format('<div id="{2}" class="x-grid3-check-col{0} x-grid3-check-col-enabled {1}">&#160;</div>',b?"-on":"",c.createId(),this.id)}else{return String.format('<div id="{2}" class="x-grid3-check-disabled-col{0} {1}">&#160;</div>',b?"-on":"",c.createId(),this.id)}},createId:function(){return"x-grid3-cc-"+this.id},getEnabled:function(){return this.enabled},setEnabled:function(a){this.enabled=a}});Ext.preg("checkcolumn",Ext.ux.grid.CheckColumn);Ext.grid.CheckColumn=Ext.ux.grid.CheckColumn;
/*!
 * managediframe version 2.1.5
 * url : https://code.google.com/p/managediframe/
 */
/*!
 * ux.ManagedIFrame for ExtJS Library 3.1+
 * Copyright(c) 2008-2009 Active Group, Inc.
 * licensing@theactivegroup.com
 * http://licensing.theactivegroup.com
 */
Ext.namespace("Ext.ux.plugin");Ext.onReady(function(){var a=Ext.util.CSS;if(a){a.getRule(".x-hide-nosize")||a.createStyleSheet(".x-hide-nosize{height:0px!important;width:0px!important;border:none!important;zoom:1;}.x-hide-nosize * {height:0px!important;width:0px!important;border:none!important;zoom:1;}");a.refreshCache()}});(function(){var g=Ext.Element,b=Ext.lib.Anim,a=g.prototype;var f="visibility",d="display",c="hidden",k="none";var e={};e.El={setDisplayed:function(m){var l=this;l.visibilityCls?(l[m!==false?"removeClass":"addClass"](l.visibilityCls)):a.setDisplayed.call(l,m);return l},isDisplayed:function(){return !(this.hasClass(this.visibilityCls)||this.isStyle(d,k))},fixDisplay:function(){var l=this;a.fixDisplay.call(l);l.visibilityCls&&l.removeClass(l.visibilityCls)},isVisible:function(m){var n=this.visible||(!this.isStyle(f,c)&&(this.visibilityCls?!this.hasClass(this.visibilityCls):!this.isStyle(d,k)));if(m!==true||!n){return n}var q=this.dom.parentNode,l=/^body/i;while(q&&!l.test(q.tagName)){if(!Ext.fly(q,"_isVisible").isVisible()){return false}q=q.parentNode}return true},isStyle:a.isStyle||function(l,m){return this.getStyle(l)==m}};Ext.override(g.Flyweight,e.El);Ext.ux.plugin.VisibilityMode=function(m){Ext.apply(this,m||{});var l=Ext.util.CSS;if(l&&!Ext.isIE&&this.fixMaximizedWindow!==false&&!Ext.ux.plugin.VisibilityMode.MaxWinFixed){l.updateRule(".x-window-maximized-ct","overflow","");Ext.ux.plugin.VisibilityMode.MaxWinFixed=true}};Ext.extend(Ext.ux.plugin.VisibilityMode,Object,{bubble:true,fixMaximizedWindow:true,elements:null,visibilityCls:"x-hide-nosize",hideMode:"nosize",ptype:"uxvismode",init:function(q){var m=this.hideMode||q.hideMode,p=this,l=Ext.Container.prototype.bubble,n=function(){var s=[this.collapseEl,this.actionMode].concat(p.elements||[]);Ext.each(s,function(t){p.extend(this[t]||t)},this);var r={visFixed:true,animCollapse:false,animFloat:false,hideMode:m,defaults:this.defaults||{}};r.defaults.hideMode=m;Ext.apply(this,r);Ext.apply(this.initialConfig||{},r)};q.on("render",function(){if(p.bubble!==false&&this.ownerCt){l.call(this.ownerCt,function(){this.visFixed||this.on("afterlayout",n,this,{single:true})})}n.call(this)},q,{single:true})},extend:function(l,m){l&&Ext.each([].concat(l),function(n){if(n&&n.dom){if("visibilityCls" in n){return}Ext.apply(n,e.El);n.visibilityCls=m||this.visibilityCls}},this);return this}});Ext.preg&&Ext.preg("uxvismode",Ext.ux.plugin.VisibilityMode);Ext.provide&&Ext.provide("uxvismode")})();(function(){var P=Ext.Element,q,z=Ext.lib.Dom,ar=Ext.lib.Anim,p=Ext.EventManager,ap=Ext.lib.Event,au=document,v=function(){},aw=Object.prototype,aG=aw.toString,D=/^body/i,s="[object HTMLDocument]";if(!Ext.elCache||parseInt(Ext.version.replace(/\./g,""),10)<311){alert("Ext Release "+Ext.version+" is not supported")}Ext._documents={};Ext._documents[Ext.id(document,"_doc")]=Ext.elCache;var Z=z.resolveDocumentCache=function(E,aL){Ext._documents[Ext.id(document,"_doc")]=Ext.elCache;var aK=e(E),aM=Ext.isDocument(aK)?Ext.id(aK):aL,A=Ext._documents[aM]||null;return A||(aM?Ext._documents[aM]={}:null)},aJ=z.clearDocumentCache=function(A){delete Ext._documents[A]};P.addMethods||(P.addMethods=function(A){Ext.apply(P.prototype,A||{})});Ext.removeNode=function(aN){var aM=aN?aN.dom||aN:null,aK,aL,A=Z(aM),E;if(aM&&(aL=A[aM.id])&&(aK=aL.el)){if(aK.dom){Ext.enableNestedListenerRemoval?p.purgeElement(aK.dom,true):p.removeAll(aK.dom)}delete A[aM.id];delete aK.dom;delete aK._context;aK=null}if(aM&&!aM.navigator&&!Ext.isDocument(aM)&&!D.test(aM.tagName)){(E=aM.parentElement||aM.parentNode)&&E.removeChild(aM)}aM=E=null};var f=function(aO,aM){var aN=typeof aO==="function"?aO:function aL(){};var aK=aN._ovl;if(!aK){aK={base:aN};aK[aN.length||0]=aN;aN=function aL(){var aR=arguments.callee._ovl;var aQ=aR[arguments.length]||aR.base;return aQ&&aQ!=arguments.callee?aQ.apply(this,arguments):undefined}}var aP=[].concat(aM);for(var E=0,A=aP.length;E<A;++E){aK[aP[E].length]=aP[E]}aN._ovl=aK;var aL=null;return aN};Ext.applyIf(Ext,{overload:f(f,[function(A){return f(null,A)},function(aK,E,A){return aK[E]=f(aK[E],A)}]),isArray:function(A){return !!A&&aG.apply(A)=="[object Array]"},isObject:function(A){return !!A&&typeof A=="object"},isDocument:function(E,A){var aM=E?E.dom||E:null;var aL=aM&&((aG.apply(aM)==s)||(aM&&aM.nodeType==9));if(aL&&A){try{aL=!!aM.location}catch(aK){return false}}return aL},isWindow:function(A){var E=A?A.dom||A:null;return E?!!E.navigator||aG.apply(E)=="[object Window]":false},isIterable:function(A){if(Ext.isArray(A)||A.callee){return true}if(/NodeList|HTMLCollection/.test(aG.call(A))){return true}return((typeof A.nextNode!="undefined"||A.item)&&Ext.isNumber(A.length))},isElement:function(A){return A&&Ext.type(A)=="element"},isEvent:function(A){return aG.apply(A)=="[object Event]"||(Ext.isObject(A)&&!Ext.type(o.constructor)&&(window.event&&A.clientX&&A.clientX==window.event.clientX))},isFunction:function(A){return !!A&&typeof A=="function"},isEventSupported:function(aL,aM){var aK={select:"input",change:"input",submit:"form",reset:"form",load:"img",error:"img",abort:"img"},A={},aN=/^on/i,E=function(aQ,aP){var aO=Ext.getDom(aP);return(aO?(Ext.isElement(aO)||Ext.isDocument(aO)?aO.nodeName.toLowerCase():aP.self?"#window":aP||"#object"):aP||"div")+":"+aQ};return function(aS,aU){aS=(aS||"").replace(aN,"");var aT,aR=false;var aP="on"+aS;var aO=(aU?aU:aK[aS])||"div";var aQ=E(aS,aO);if(aQ in A){return A[aQ]}aT=Ext.isString(aO)?au.createElement(aO):aU;aR=(!!aT&&(aP in aT));aR||(aR=window.Event&&!!(String(aS).toUpperCase() in window.Event));if(!aR&&aT){aT.setAttribute&&aT.setAttribute(aP,"return;");aR=Ext.isFunction(aT[aP])}A[aQ]=aR;aT=null;return aR}}()});var av=function(A){return P;return P[(A.tagName||"-").toUpperCase()]||P};var N;function ao(A,E){if(!N){N=new Ext.Element.Flyweight()}N.dom=Ext.getDom(A,null,E);return N}Ext.apply(Ext,{get:P.get=function(aL,aQ){if(!aL){return null}var aP=Ext.isDocument(aL);Ext.isDocument(aQ)||(aQ=au);var aO,aN,E,A=Z(aQ);if(typeof aL=="string"){aN=Ext.getDom(aL,null,aQ);if(!aN){return null}if(A[aL]&&A[aL].el){aO=A[aL].el;aO.dom=aN}else{aO=P.addToCache(new (av(aN))(aN,null,aQ))}return aO}else{if(aP){if(!Ext.isDocument(aL,true)){return false}A=Z(aL);if(A[Ext.id(aL)]&&A[aL.id].el){return A[aL.id].el}var aM=function(){};aM.prototype=P.prototype;var aK=new aM();aK.dom=aL;aK.id=Ext.id(aL,"_doc");aK._isDoc=true;P.addToCache(aK,null,A);return aK}else{if(aL instanceof P){if(aL.dom){aL.id=Ext.id(aL.dom)}else{aL.dom=aL.id?Ext.getDom(aL.id,true):null}if(aL.dom){A=Z(aL);(A[aL.id]||(A[aL.id]={data:{},events:{}})).el=aL}return aL}else{if(aL.tagName||Ext.isWindow(aL)){A=Z(aL);E=Ext.id(aL);if(A[E]&&(aO=A[E].el)){aO.dom=aL}else{aO=P.addToCache(new (av(aL))(aL,null,aQ),null,A)}return aO}else{if(aL.isComposite){return aL}else{if(Ext.isArray(aL)){return Ext.get(aQ,aQ).select(aL)}}}}}}return null},getDom:function(E,A,aM){var aL=aM||au;if(!E||!aL){return null}if(E.dom){return E.dom}else{if(Ext.isString(E)){var aK=aL.getElementById(E);if(aK&&Ext.isIE&&A){if(E==aK.getAttribute("id")){return aK}else{return null}}return aK}else{return E}}},getBody:function(E){var A=z.getDocument(E)||au;return Ext.get(A.body||A.documentElement)},getDoc:Ext.overload([Ext.getDoc,function(A){return Ext.get(A,A)}])});P.data=function(E,A,aK){E=P.get(E);if(!E){return null}var aL=Z(E)[E.id].data;if(arguments.length==2){return aL[A]}else{return(aL[A]=aK)}};P.addToCache=function(E,aM,A){aM=aM||Ext.id(E);var aL=A||Z(E);aL[aM]={el:E.dom?E:Ext.get(E),data:{},events:{}};var aK=aL[aM].el.dom;(aK.getElementById||aK.navigator)&&(aL[aM].skipGC=true);return aL[aM].el};P.removeFromCache=function(E,A){if(E&&E.id){var aK=A||Z(E);delete aK[E.id]}};P.OFFSETS=3;P.ASCLASS=4;P.visibilityCls="x-hide-nosize";var ay={},R=/(-[a-z])/gi,M=function(A,E){return E.charAt(1).toUpperCase()},k=/alpha\(opacity=(.*)\)/i,n=/^\s+|\s+$/g,aE=/marginRight/,J=Ext.isIE?"styleFloat":"cssFloat",az=au.defaultView,ai="visibilityMode",aB="asclass",S="originalDisplay",aj="padding",W="margin",aC="border",c="-left",l="-right",r="-top",aA="-bottom",V="-width",aF=Math,ae="opacity",ad="visibility",Q="display",am="offsets",C="nosize",aB="asclass",ak="hidden",af="none",ac="isVisible",B="isClipped",d="overflow",Y="overflow-x",X="overflow-y",K="originalClip",U="x-masked",L="x-masked-relative",an={l:aC+c+V,r:aC+l+V,t:aC+r+V,b:aC+aA+V},at={l:aj+c,r:aj+l,t:aj+r,b:aj+aA},t={l:W+c,r:W+l,t:W+r,b:W+aA},O=P.data,aH=Ext.getDom,u=Ext.get,al=Ext.DomHelper,ag=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,aI=Ext.util.CSS,aq=function(E){var A=O(E,S);if(A===undefined){O(E,S,A="")}return A},m=function(E){var A=O(E,ai);if(A===undefined){O(E,ai,A=P.prototype.visibilityMode)}return A};function ax(A){return ay[A]||(ay[A]=A=="float"?J:A.replace(R,M))}P.addMethods({getDocument:function(){return this._context||(this._context=e(this))},remove:function(E,A){var aK=this.dom;if(aK){Ext.removeNode(aK);delete this._context;delete this.dom}},appendChild:function(A,E){return u(A,E||this.getDocument()).appendTo(this)},appendTo:function(A,E){aH(A,false,E||this.getDocument()).appendChild(this.dom);return this},insertBefore:function(A,E){(A=aH(A,false,E||this.getDocument())).parentNode.insertBefore(this.dom,A);return this},insertAfter:function(A,E){(A=aH(A,false,E||this.getDocument())).parentNode.insertBefore(this.dom,A.nextSibling);return this},insertFirst:function(E,A){E=E||{};if(E.nodeType||E.dom||typeof E=="string"){E=aH(E);this.dom.insertBefore(E,this.dom.firstChild);return !A?u(E):E}else{return this.createChild(E,this.dom.firstChild,A)}},replace:function(A,E){A=u(A,E||this.getDocument());this.insertBefore(A);A.remove();return this},replaceWith:function(A,aK){var E=this;if(A.nodeType||A.dom||typeof A=="string"){A=aH(A,false,aK||E.getDocument());E.dom.parentNode.insertBefore(A,E.dom)}else{A=al.insertBefore(E.dom,A)}var aL=Z(E);Ext.removeNode(E.dom);E.id=Ext.id(E.dom=A);P.addToCache(E.isFlyweight?new (av(E.dom))(E.dom,null,aL):E);return E},insertHtml:function(E,aK,A){var aL=al.insertHtml(E,this.dom,aK);return A?Ext.get(aL,e(aL)):aL},isVisible:function(A){var E=this,aM=E.dom,aK=aM.parentNode,aL=O(aM,ac);if(typeof aL!="boolean"){aL=!E.hasClass(E.visibilityCls||P.visibilityCls)&&!E.isStyle(ad,ak)&&!E.isStyle(Q,af);O(aM,ac,aL)}if(A!==true||!aL){return aL}while(aK&&!D.test(aK.tagName)){if(!Ext.fly(aK,"_isVisible").isVisible()){return false}aK=aK.parentNode}return true},setVisible:function(aM,A){var aK=this,aL=aK.dom,E=m(aL);if(typeof A=="string"){switch(A){case Q:E=P.DISPLAY;break;case ad:E=P.VISIBILITY;break;case am:E=P.OFFSETS;break;case C:case aB:E=P.ASCLASS;break}aK.setVisibilityMode(E);A=false}if(!A||!aK.anim){if(E==P.ASCLASS){aK[aM?"removeClass":"addClass"](aK.visibilityCls||P.visibilityCls)}else{if(E==P.DISPLAY){return aK.setDisplayed(aM)}else{if(E==P.OFFSETS){if(!aM){aK.hideModeStyles={position:aK.getStyle("position"),top:aK.getStyle("top"),left:aK.getStyle("left")};aK.applyStyles({position:"absolute",top:"-10000px",left:"-10000px"})}else{aK.applyStyles(aK.hideModeStyles||{position:"",top:"",left:""});delete aK.hideModeStyles}}else{aK.fixDisplay();aL.style.visibility=aM?"visible":ak}}}}else{if(aM){aK.setOpacity(0.01);aK.setVisible(true)}aK.anim({opacity:{to:(aM?1:0)}},aK.preanim(arguments,1),null,0.35,"easeIn",function(){aM||aK.setVisible(false).setOpacity(1)})}O(aL,ac,aM);return aK},hasMetrics:function(){var A=this;return A.isVisible()||(m(A.dom)==P.VISIBILITY)},setDisplayed:function(E){var aK=this.dom,A=m(aK);if(typeof E=="boolean"){if(A==P.ASCLASS){return this.setVisible(E)}O(this.dom,ac,E);E=E?aq(aK):af}this.setStyle(Q,E);return this},enableDisplayMode:function(A){this.setVisibilityMode(P.DISPLAY);if(!Ext.isEmpty(A)){O(this.dom,S,A)}return this},scrollIntoView:function(aK,aN){var aS=this.getDocument(),aT=Ext.getDom(aK,null,aS)||Ext.getBody(aS).dom,aM=this.dom,aL=this.getOffsetsTo(aT),aP=aL[0]+aT.scrollLeft,aW=aL[1]+aT.scrollTop,aU=aW+aM.offsetHeight,E=aP+aM.offsetWidth,A=aT.clientHeight,aQ=parseInt(aT.scrollTop,10),aV=parseInt(aT.scrollLeft,10),aO=aQ+A,aR=aV+aT.clientWidth;if(aM.offsetHeight>A||aW<aQ){aT.scrollTop=aW}else{if(aU>aO){aT.scrollTop=aU-A}}aT.scrollTop=aT.scrollTop;if(aN!==false){if(aM.offsetWidth>aT.clientWidth||aP<aV){aT.scrollLeft=aP}else{if(E>aR){aT.scrollLeft=E-aT.clientWidth}}aT.scrollLeft=aT.scrollLeft}return this},contains:function(A){try{return !A?false:z.isAncestor(this.dom,A.dom?A.dom:A)}catch(E){return false}},getScroll:function(){var aO=this.dom,aN=this.getDocument(),A=aN.body,aK=aN.documentElement,E,aM,aL;if(Ext.isDocument(aO)||aO==A){if(Ext.isIE&&z.docIsStrict(aN)){E=aK.scrollLeft;aM=aK.scrollTop}else{E=window.pageXOffset;aM=window.pageYOffset}aL={left:E||(A?A.scrollLeft:0),top:aM||(A?A.scrollTop:0)}}else{aL={left:aO.scrollLeft,top:aO.scrollTop}}return aL},getStyle:function(){var A=az&&az.getComputedStyle?function E(aR){var aO=!this._isDoc?this.dom:null,aK,aN,aL,aP,aQ=Ext.isWebKit,aP,aM;if(!aO||!aO.style){return null}aM=aO.style;aR=ax(aR);aN=az.getComputedStyle(aO,null);aL=(aN)?aN[aR]:null;if(aQ){if(aL&&aE.test(aR)&&aM.position!="absolute"&&aL!="0px"){aP=aM.display;aM.display="inline-block";aL=az.getComputedStyle(aO,null)[aR];aM.display=aP}else{if(aL=="rgba(0, 0, 0, 0)"){aL="transparent"}}}return aL||aM[aR]}:function E(aP){var aN=!this._isDoc?this.dom:null,aK,aM,aL;if(!aN||!aN.style){return null}aL=aN.style;if(aP==ae){if(aL.filter.match){if(aK=aL.filter.match(k)){var aO=parseFloat(aK[1]);if(!isNaN(aO)){return aO?aO/100:0}}}return 1}aP=ax(aP);return((aM=aN.currentStyle)?aM[aP]:null)||aN.style[aP]};var E=null;return A}(),setStyle:function(aL,aK){if(this._isDoc||Ext.isDocument(this.dom)){return this}var A,E;if(typeof aL!="object"){A={};A[aL]=aK;aL=A}for(E in aL){if(aL.hasOwnProperty(E)){aK=aL[E];E==ae?this.setOpacity(aK):this.dom.style[ax(E)]=aK}}return this},center:function(A){return this.alignTo(A||this.getDocument(),"c-c")},mask:function(E,aN){var aP=this,aL=aP.dom,aO=Ext.DomHelper,aM="ext-el-mask-msg",A,aQ;if(aP.getStyle("position")=="static"){aP.addClass(L)}if((A=O(aL,"maskMsg"))){A.remove()}if((A=O(aL,"mask"))){A.remove()}aQ=aO.append(aL,{cls:"ext-el-mask"},true);O(aL,"mask",aQ);aP.addClass(U);aQ.setDisplayed(true);if(typeof E=="string"){var aK=aO.append(aL,{cls:aM,cn:{tag:"div"}},true);O(aL,"maskMsg",aK);aK.dom.className=aN?aM+" "+aN:aM;aK.dom.firstChild.innerHTML=E;aK.setDisplayed(true);aK.center(aP)}if(Ext.isIE&&!(Ext.isIE7&&Ext.isStrict)&&aP.getStyle("height")=="auto"){aQ.setSize(undefined,aP.getHeight())}return aQ},unmask:function(){var aK=this,aL=aK.dom,A=O(aL,"mask"),E=O(aL,"maskMsg");if(A){if(E){E.remove();O(aL,"maskMsg",undefined)}A.remove();O(aL,"mask",undefined)}aK.removeClass([U,L])},isMasked:function(){var A=O(this.dom,"mask");return A&&A.isVisible()},getCenterXY:function(){return this.getAlignToXY(this.getDocument(),"c-c")},getAnchorXY:function(aM,aR,aW){aM=(aM||"tl").toLowerCase();aW=aW||{};var aQ=this,aT=this.getDocument(),E=aQ.dom==aT.body||aQ.dom==aT,aU=aW.width||E?z.getViewWidth(false,aT):aQ.getWidth(),aO=aW.height||E?z.getViewHeight(false,aT):aQ.getHeight(),aV,A=Math.round,aK=aQ.getXY(),aS=aQ.getScroll(),aP=E?aS.left:!aR?aK[0]:0,aN=E?aS.top:!aR?aK[1]:0,aL={c:[A(aU*0.5),A(aO*0.5)],t:[A(aU*0.5),0],l:[0,A(aO*0.5)],r:[aU,A(aO*0.5)],b:[A(aU*0.5),aO],tl:[0,0],bl:[0,aO],br:[aU,aO],tr:[aU,0]};aV=aL[aM];return[aV[0]+aP,aV[1]+aN]},anchorTo:function(E,aN,aK,A,aP,aQ){var aO=this,aM=aO.dom;function aL(){ao(aM).alignTo(E,aN,aK,A);Ext.callback(aQ,ao(aM))}Ext.EventManager.onWindowResize(aL,aO);if(!Ext.isEmpty(aP)){Ext.EventManager.on(window,"scroll",aL,aO,{buffer:!isNaN(aP)?aP:50})}aL.call(aO);return aO},getScroll:function(){var aO=this.dom,aN=this.getDocument(),A=aN.body,aK=aN.documentElement,E,aM,aL;if(aO==aN||aO==A){if(Ext.isIE&&z.docIsStrict(aN)){E=aK.scrollLeft;aM=aK.scrollTop}else{E=window.pageXOffset;aM=window.pageYOffset}aL={left:E||(A?A.scrollLeft:0),top:aM||(A?A.scrollTop:0)}}else{aL={left:aO.scrollLeft,top:aO.scrollTop}}return aL},getAlignToXY:function(aL,aX,aY){var bc;aL=Ext.get(aL,bc=this.getDocument());if(!aL||!aL.dom){throw"Element.getAlignToXY with an element that doesn't exist"}aY=aY||[0,0];aX=(aX=="?"?"tl-bl?":(!/-/.test(aX)&&aX!=""?"tl-"+aX:aX||"tl-bl")).toLowerCase();var a9=this,a6=a9.dom,bb,ba,aQ,aP,aS,a4,aV,aT=z.getViewWidth(false,bc)-10,a5=z.getViewHeight(false,bc)-10,E,aM,aN,aO,aU,aW,a8=bc.documentElement,aR=bc.body,a3=(a8.scrollLeft||aR.scrollLeft||0)+5,a0=(a8.scrollTop||aR.scrollTop||0)+5,a7=false,aK="",A="",aZ=aX.match(/^([a-z]+)-([a-z]+)(\?)?$/);if(!aZ){throw"Element.getAlignToXY with an invalid alignment "+aX}aK=aZ[1];A=aZ[2];a7=!!aZ[3];bb=a9.getAnchorXY(aK,true);ba=aL.getAnchorXY(A,false);aQ=ba[0]-bb[0]+aY[0];aP=ba[1]-bb[1]+aY[1];if(a7){aS=a9.getWidth();a4=a9.getHeight();aV=aL.getRegion();E=aK.charAt(0);aM=aK.charAt(aK.length-1);aN=A.charAt(0);aO=A.charAt(A.length-1);aU=((E=="t"&&aN=="b")||(E=="b"&&aN=="t"));aW=((aM=="r"&&aO=="l")||(aM=="l"&&aO=="r"));if(aQ+aS>aT+a3){aQ=aW?aV.left-aS:aT+a3-aS}if(aQ<a3){aQ=aW?aV.right:a3}if(aP+a4>a5+a0){aP=aU?aV.top-a4:a5+a0-a4}if(aP<a0){aP=aU?aV.bottom:a0}}return[aQ,aP]},adjustForConstraints:function(aK,A,E){return this.getConstrainToXY(A||this.getDocument(),false,E,aK)||aK},getConstrainToXY:function(E,A,aK,aM){var aL={top:0,left:0,bottom:0,right:0};return function(aO,aW,aP,aN){var aY=this.getDocument();aO=Ext.get(aO,aY);aP=aP?Ext.applyIf(aP,aL):aL;var aX,aQ,aV=0,aT=0;if(aO.dom==aY.body||aO.dom==aY){aX=z.getViewWidth(false,aY);aQ=z.getViewHeight(false,aY)}else{aX=aO.dom.clientWidth;aQ=aO.dom.clientHeight;if(!aW){var aR=aO.getXY();aV=aR[0];aT=aR[1]}}var a1=aO.getScroll();aV+=aP.left+a1.left;aT+=aP.top+a1.top;aX-=aP.right;aQ-=aP.bottom;var a0=aV+aX,aS=aT+aQ,aZ=aN||(!aW?this.getXY():[this.getLeft(true),this.getTop(true)]);x=aZ[0],y=aZ[1],offset=this.getConstrainOffset(),w=this.dom.offsetWidth+offset,h=this.dom.offsetHeight+offset;var aU=false;if((x+w)>a0){x=a0-w;aU=true}if((y+h)>aS){y=aS-h;aU=true}if(x<aV){x=aV;aU=true}if(y<aT){y=aT;aU=true}return aU?[x,y]:false}}(),getConstrainOffset:function(){return 0},getCenterXY:function(){return this.getAlignToXY(Ext.getBody(this.getDocument()),"c-c")},center:function(A){return this.alignTo(A||Ext.getBody(this.getDocument()),"c-c")},findParent:function(aP,aO,E){var aM=this.dom,aL=this.getDocument(),A=aL.body,aN=0,aK;if(Ext.isGecko&&aG.call(aM)=="[object XULElement]"){return null}aO=aO||50;if(isNaN(aO)){aK=Ext.getDom(aO,null,aL);aO=Number.MAX_VALUE}while(aM&&aM.nodeType==1&&aN<aO&&aM!=A&&aM!=aK){if(Ext.DomQuery.is(aM,aP)){return E?Ext.get(aM,aL):aM}aN++;aM=aM.parentNode}return null},clip:function(){var A=this,E=A.dom;if(!O(E,B)){O(E,B,true);O(E,K,{o:A.getStyle(d),x:A.getStyle(Y),y:A.getStyle(X)});A.setStyle(d,ak);A.setStyle(Y,ak);A.setStyle(X,ak)}return A},unclip:function(){var A=this,aK=A.dom;if(O(aK,B)){O(aK,B,false);var E=O(aK,K);if(E.o){A.setStyle(d,E.o)}if(E.x){A.setStyle(Y,E.x)}if(E.y){A.setStyle(X,E.y)}}return A},getViewSize:function(){var aK=this.getDocument(),aL=this.dom,A=(aL==aK||aL==aK.body);if(A){var E=Ext.lib.Dom;return{width:E.getViewWidth(),height:E.getViewHeight()}}else{return{width:aL.clientWidth,height:aL.clientHeight}}},getStyleSize:function(){var aM=this,A,aL,aO=this.getDocument(),aP=this.dom,E=(aP==aO||aP==aO.body),aK=aP.style;if(E){var aN=Ext.lib.Dom;return{width:aN.getViewWidth(),height:aN.getViewHeight()}}if(aK.width&&aK.width!="auto"){A=parseFloat(aK.width);if(aM.isBorderBox()){A-=aM.getFrameWidth("lr")}}if(aK.height&&aK.height!="auto"){aL=parseFloat(aK.height);if(aM.isBorderBox()){aL-=aM.getFrameWidth("tb")}}return{width:A||aM.getWidth(true),height:aL||aM.getHeight(true)}}});Ext.apply(z,{getDocument:function(aK,aL){var aM=null;try{aM=Ext.getDom(aK,null,null)}catch(E){}var A=Ext.isDocument(aM);if(A){if(aL){return Ext.isDocument(aM,aL)?aM:null}return aM}return aM?aM.ownerDocument||aM.document:null},docIsStrict:function(A){return(Ext.isDocument(A)?A:this.getDocument(A)).compatMode=="CSS1Compat"},getViewWidth:Ext.overload([z.getViewWidth||function(A){},function(){return this.getViewWidth(false)},function(A,E){return A?this.getDocumentWidth(E):this.getViewportWidth(E)}]),getViewHeight:Ext.overload([z.getViewHeight||function(A){},function(){return this.getViewHeight(false)},function(A,E){return A?this.getDocumentHeight(E):this.getViewportHeight(E)}]),getDocumentHeight:Ext.overload([z.getDocumentHeight||v,function(A){if(A=this.getDocument(A)){return Math.max(!this.docIsStrict(A)?A.body.scrollHeight:A.documentElement.scrollHeight,this.getViewportHeight(A))}return undefined}]),getDocumentWidth:Ext.overload([z.getDocumentWidth||v,function(A){if(A=this.getDocument(A)){return Math.max(!this.docIsStrict(A)?A.body.scrollWidth:A.documentElement.scrollWidth,this.getViewportWidth(A))}return undefined}]),getViewportHeight:Ext.overload([z.getViewportHeight||v,function(A){if(A=this.getDocument(A)){if(Ext.isIE){return this.docIsStrict(A)?A.documentElement.clientHeight:A.body.clientHeight}else{return A.defaultView.innerHeight}}return undefined}]),getViewportWidth:Ext.overload([z.getViewportWidth||v,function(A){if(A=this.getDocument(A)){return !this.docIsStrict(A)&&!Ext.isOpera?A.body.clientWidth:Ext.isIE?A.documentElement.clientWidth:A.defaultView.innerWidth}return undefined}]),getXY:Ext.overload([z.getXY||v,function(A,aL){if(typeof A=="string"){A=Ext.getDom(A,null,aL);var aK=this.getDocument(A),E=aK?(aK.body||aK.documentElement):null;if(!A||!E||A==E){return[0,0]}}return this.getXY(A)}])});var e=z.getDocument,T=P._flyweights;Ext.fly=P.fly=function(aK,A,aL){var E=null;A=A||"_global";if(aK=Ext.getDom(aK,null,aL)){(E=T[A]=(T[A]||new P.Flyweight())).dom=aK;Ext.isDocument(aK)&&(E._isDoc=true)}return E};var aD=function(){};aD.prototype=P.prototype;P.Flyweight=function(A){this.dom=A};P.Flyweight.prototype=new aD();P.Flyweight.prototype.isFlyweight=true;function b(aL,aN,aQ,aM,aK,aS){aL=Ext.getDom(aL);if(!aL){return}var E=Ext.id(aL),A=Z(aL);A[E]||P.addToCache(aL,E,A);var aR=A[E].events||{},aO;aO=ap.on(aL,aN,aK);aR[aN]=aR[aN]||[];aR[aN].push([aQ,aK,aS,aO,aM]);if(aL.addEventListener&&aN=="mousewheel"){var aP=["DOMMouseScroll",aK,false];aL.addEventListener.apply(aL,aP);Ext.EventManager.addListener(window,"beforeunload",function(){aL.removeEventListener.apply(aL,aP)})}if(aN=="mousedown"&&au==aL){Ext.EventManager.stoppedMouseDownEvent.addListener(aK)}}function g(A,E){return function(){var aK=Ext.toArray(arguments);if(E.target==Ext.EventObject.setEvent(aK[0]).target){A.apply(this,aK)}}}function ah(E,aK,A){return function(aL){A.delay(aK.buffer,E,null,[new Ext.EventObjectImpl(aL)])}}function ab(aM,aL,A,aK,E){return function(aN){Ext.EventManager.removeListener(aL,A,aK,E);aM(aN)}}function a(E,aK,A){return function(aM){var aL=new Ext.util.DelayedTask(E);(A.tasks||(A.tasks=[])).push(aL);aL.delay(aK.delay||10,E,null,[new Ext.EventObjectImpl(aM)])}}function aa(aN,aM,A,aP,aQ){var E=!Ext.isObject(A)?{}:A,aK=Ext.getDom(aN),aL;aP=aP||E.fn;aQ=aQ||E.scope;if(!aK){throw'Error listening for "'+aM+'". Element "'+aN+"\" doesn't exist."}function aO(aS){if(!window.Ext){return}aS=Ext.EventObject.setEvent(aS);var aR;if(E.delegate){if(!(aR=aS.getTarget(E.delegate,aK))){return}}else{aR=aS.target}if(E.stopEvent){aS.stopEvent()}if(E.preventDefault){aS.preventDefault()}if(E.stopPropagation){aS.stopPropagation()}if(E.normalized){aS=aS.browserEvent}aP.call(aQ||aK,aS,aR,E)}if(E.target){aO=g(aO,E)}if(E.delay){aO=a(aO,E,aP)}if(E.single){aO=ab(aO,aK,aM,aP,aQ)}if(E.buffer){aL=new Ext.util.DelayedTask(aO);aO=ah(aO,E,aL)}b(aK,aM,aP,aL,aO,aQ);return aO}Ext.apply(p,{addListener:p.on=function(aK,A,aM,aL,E){if(typeof A=="object"){var aP=A,aN,aO;for(aN in aP){if(!aP.hasOwnProperty(aN)){continue}aO=aP[aN];if(!ag.test(aN)){if(Ext.isFunction(aO)){aa(aK,aN,aP,aO,aP.scope)}else{aa(aK,aN,aO)}}}}else{aa(aK,A,E,aM,aL)}},removeListener:p.un=function(aN,aO,aS,aV){var E=Ext.getDom(aN);E&&Ext.get(E);var aT=E?Z(E):{},aQ=E&&((aT[E.id]||{events:{}}).events)[aO]||[],A,aM,aK,aL,aP,aR,aU;for(aM=0,aP=aQ.length;aM<aP;aM++){if(Ext.isArray(aR=aQ[aM])&&aR[0]==aS&&(!aV||aR[2]==aV)){aR[4]&&aR[4].cancel();aL=aS.tasks&&aS.tasks.length;if(aL){while(aL--){aS.tasks[aL].cancel()}delete aS.tasks}A=aR[1];ap.un(E,aO,ap.extAdapter?aR[3]:A);if(A&&aO=="mousewheel"&&E.addEventListener){E.removeEventListener("DOMMouseScroll",A,false)}if(A&&aO=="mousedown"&&au==E){Ext.EventManager.stoppedMouseDownEvent.removeListener(A)}aQ.splice(aM,1);if(aQ.length===0){delete aT[E.id].events[aO]}aU=aT[E.id].events;for(aL in aU){if(aU.hasOwnProperty(aL)){return false}}aT[E.id].events={};return false}}},removeAll:function(aK){if(!(aK=Ext.getDom(aK))){return}var E=aK.id,aS=Z(aK)||{},aT=aS[E]||{},aR=aT.events||{},aO,aN,aP,aL,aQ,aM,A;for(aL in aR){if(aR.hasOwnProperty(aL)){aO=aR[aL];for(aN=0,aP=aO.length;aN<aP;aN++){aQ=aO[aN];aQ[4]&&aQ[4].cancel();if(aQ[0]&&aQ[0].tasks&&(aM=aQ[0].tasks.length)){while(aM--){aQ[0].tasks[aM].cancel()}delete aQ.tasks}A=aQ[1];ap.un(aK,aL,ap.extAdapter?aQ[3]:A);if(A&&aK.addEventListener&&aL=="mousewheel"){aK.removeEventListener("DOMMouseScroll",A,false)}if(A&&(au==aK)&&aL=="mousedown"){Ext.EventManager.stoppedMouseDownEvent.removeListener(A)}}}}aS[E]&&(aS[E].events={})},getListeners:function(aK,E){aK=Ext.getDom(aK);if(!aK){return}var aM=(Ext.get(aK)||{}).id,A=Z(aK),aL=(A[aM]||{}).events||{};return aL[E]||null},purgeElement:function(aK,A,aM){aK=Ext.getDom(aK);var E=Ext.id(aK),aP=Z(aK),aQ=(aP[E]||{}).events||{},aL,aO,aN;if(aM){if(aQ.hasOwnProperty(aM)){aO=aQ[aM];for(aL=0,aN=aO.length;aL<aN;aL++){p.removeListener(aK,aM,aO[aL][0])}}}else{p.removeAll(aK)}if(A&&aK&&aK.childNodes){for(aL=0,aN=aK.childNodes.length;aL<aN;aL++){p.purgeElement(aK.childNodes[aL],A,aM)}}}});ap.getListeners=function(E,A){return Ext.EventManager.getListeners(E,A)};Ext.provide&&Ext.provide("multidom")})();(function(){var El=Ext.Element,ElFrame,ELD=Ext.lib.Dom,EMPTYFN=function(){},OP=Object.prototype,addListener=function(){var handler;if(window.addEventListener){handler=function F(el,eventName,fn,capture){el.addEventListener(eventName,fn,!!capture)}}else{if(window.attachEvent){handler=function F(el,eventName,fn,capture){el.attachEvent("on"+eventName,fn)}}else{handler=function F(){}}}var F=null;return handler}(),removeListener=function(){var handler;if(window.removeEventListener){handler=function F(el,eventName,fn,capture){el.removeEventListener(eventName,fn,(capture))}}else{if(window.detachEvent){handler=function F(el,eventName,fn){el.detachEvent("on"+eventName,fn)}}else{handler=function F(){}}}var F=null;return handler}();if(typeof ELD.getDocument!="function"){alert("MIF 2.1.4 requires multidom support")}if(!Ext.elCache||parseInt(Ext.version.replace(/\./g,""),10)<311){alert("Ext Release "+Ext.version+" is not supported")}Ext.ns("Ext.ux.ManagedIFrame","Ext.ux.plugin");var MIM,MIF=Ext.ux.ManagedIFrame,MIFC;var frameEvents=["documentloaded","domready","focus","blur","resize","scroll","unload","scroll","exception","message","reset"];var reSynthEvents=new RegExp("^("+frameEvents.join("|")+")","i");Ext.ux.ManagedIFrame.Element=Ext.extend(Ext.Element,{constructor:function(element,forceNew,doc){var d=doc||document,elCache=ELD.resolveDocumentCache(d),dom=Ext.getDom(element,false,d);if(!dom||!(/^(iframe|frame)/i).test(dom.tagName)){return null}var id=Ext.id(dom);this.dom=dom;this.id=id;(elCache[id]||(elCache[id]={el:this,events:{},data:{}})).el=this;this.dom.name||(this.dom.name=this.id);if(Ext.isIE){document.frames&&(document.frames[this.dom.name]||(document.frames[this.dom.name]=this.dom))}this.dom.ownerCt=this;MIM.register(this);if(!this._observable){(this._observable=new Ext.util.Observable()).addEvents("documentloaded","domready","exception","resize","message","blur","focus","unload","scroll","reset");this._observable.addEvents("_docready","_docload")}this.on(Ext.isIE?"readystatechange":"load",this.loadHandler,this,Ext.isOpera?{buffer:this.operaLoadBuffer||2000}:null);this.on("error",this.loadHandler,this)},destructor:function(){MIM.deRegister(this);this.removeAllListeners();Ext.destroy(this.frameShim,this.DDM);this.hideMask(true);delete this.loadMask;this.reset();this.manager=null;this.dom.ownerCt=null},cleanse:function(forceReclean,deep){if(this.isCleansed&&forceReclean!==true){return this}var d=this.dom,n=d.firstChild,nx;while(d&&n){nx=n.nextSibling;deep&&Ext.fly(n).cleanse(forceReclean,deep);Ext.removeNode(n);n=nx}this.isCleansed=true;return this},src:null,CSS:null,manager:null,operaLoadBuffer:2000,disableMessaging:true,domReadyRetries:7500,focusOnLoad:Ext.isIE,eventsFollowFrameLinks:true,remove:function(){this.destructor.apply(this,arguments);ElFrame.superclass.remove.apply(this,arguments)},getDocument:function(){return this.dom?this.dom.ownerDocument:document},submitAsTarget:function(submitCfg){var opt=submitCfg||{},D=this.getDocument(),form=Ext.getDom(opt.form?opt.form.form||opt.form:null,false,D)||Ext.DomHelper.append(D.body,{tag:"form",cls:"x-hidden x-mif-form",encoding:"multipart/form-data"}),formFly=Ext.fly(form,"_dynaForm"),formState={target:form.target||"",method:form.method||"",encoding:form.encoding||"",enctype:form.enctype||"",action:form.action||""},encoding=opt.encoding||form.encoding,method=opt.method||form.method||"POST";formFly.set({target:this.dom.name,method:method,encoding:encoding,action:opt.url||opt.action||form.action});if(method=="POST"||!!opt.enctype){formFly.set({enctype:opt.enctype||form.enctype||encoding})}var hiddens,hd,ps;if(opt.params&&(ps=Ext.isFunction(opt.params)?opt.params():opt.params)){hiddens=[];Ext.iterate(ps=typeof ps=="string"?Ext.urlDecode(ps,false):ps,function(n,v){Ext.fly(hd=D.createElement("input")).set({type:"hidden",name:n,value:v});form.appendChild(hd);hiddens.push(hd)})}opt.callback&&this._observable.addListener("_docready",opt.callback,opt.scope,{single:true});this._frameAction=true;this._targetURI=location.href;this.showMask();(function(){form.submit();hiddens&&Ext.each(hiddens,Ext.removeNode,Ext);if(formFly.hasClass("x-mif-form")){formFly.remove()}else{formFly.set(formState)}delete El._flyweights._dynaForm;formFly=null;this.hideMask(true)}).defer(100,this);return this},resetUrl:(function(){return Ext.isIE&&Ext.isSecure?Ext.SSL_SECURE_URL:"about:blank"})(),setSrc:function(url,discardUrl,callback,scope){var src=url||this.src||this.resetUrl;var O=this._observable;this._unHook();Ext.isFunction(callback)&&O.addListener("_docload",callback,scope||this,{single:true});this.showMask();(discardUrl!==true)&&(this.src=src);var s=this._targetURI=(Ext.isFunction(src)?src()||"":src);try{this._frameAction=true;this.dom.src=s;this.checkDOM()}catch(ex){O.fireEvent.call(O,"exception",this,ex)}return this},setLocation:function(url,discardUrl,callback,scope){var src=url||this.src||this.resetUrl;var O=this._observable;this._unHook();Ext.isFunction(callback)&&O.addListener("_docload",callback,scope||this,{single:true});this.showMask();var s=this._targetURI=(Ext.isFunction(src)?src()||"":src);if(discardUrl!==true){this.src=src}try{this._frameAction=true;this.getWindow().location.replace(s);this.checkDOM()}catch(ex){O.fireEvent.call(O,"exception",this,ex)}return this},reset:function(src,callback,scope){this._unHook();var loadMaskOff=false,s=src,win=this.getWindow(),O=this._observable;if(this.loadMask){loadMaskOff=this.loadMask.disabled;this.loadMask.disabled=false}this.hideMask(true);if(win){this.isReset=true;var cb=callback;O.addListener("_docload",function(frame){if(this.loadMask){this.loadMask.disabled=loadMaskOff}Ext.isFunction(cb)&&(cb=cb.apply(scope||this,arguments));O.fireEvent("reset",this)},this,{single:true});Ext.isFunction(s)&&(s=src());s=this._targetURI=Ext.isEmpty(s,true)?this.resetUrl:s;win.location?(win.location.href=s):O.fireEvent("_docload",this)}return this},scriptRE:/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/gi,update:function(content,loadScripts,callback,scope){loadScripts=loadScripts||this.getUpdater().loadScripts||false;content=Ext.DomHelper.markup(content||"");content=loadScripts===true?content:content.replace(this.scriptRE,"");var doc;if((doc=this.getFrameDocument())&&!!content.length){this._unHook();this.src=null;this.showMask();Ext.isFunction(callback)&&this._observable.addListener("_docload",callback,scope||this,{single:true});this._targetURI=location.href;doc.open();this._frameAction=true;doc.write(content);doc.close();this.checkDOM()}else{this.hideMask(true);Ext.isFunction(callback)&&callback.call(scope,this)}return this},execCommand:function(command,userInterface,value,validate){var doc,assert;if((doc=this.getFrameDocument())&&!!command){try{Ext.isIE&&this.getWindow().focus();assert=validate&&Ext.isFunction(doc.queryCommandEnabled)?doc.queryCommandEnabled(command):true;return assert&&doc.execCommand(command,!!userInterface,value)}catch(eex){return false}}return false},setDesignMode:function(active){var doc;(doc=this.getFrameDocument())&&(doc.designMode=(/on|true/i).test(String(active))?"on":"off")},getUpdater:function(){return this.updateManager||(this.updateManager=new MIF.Updater(this))},getHistory:function(){var h=null;try{h=this.getWindow().history}catch(eh){}return h},get:function(el){var doc=this.getFrameDocument();return doc?Ext.get(el,doc):doc=null},fly:function(el,named){var doc=this.getFrameDocument();return doc?Ext.fly(el,named,doc):null},getDom:function(el){var d;if(!el||!(d=this.getFrameDocument())){return(d=null)}return Ext.getDom(el,d)},select:function(selector,unique){var d;return(d=this.getFrameDocument())?Ext.Element.select(selector,unique,d):d=null},query:function(selector){var d;return(d=this.getFrameDocument())?Ext.DomQuery.select(selector,d):null},removeNode:Ext.removeNode,_renderHook:function(){this._windowContext=null;this.CSS=this.CSS?this.CSS.destroy():null;this._hooked=false;try{if(this.writeScript('(function(){(window.hostMIF = parent.document.getElementById("'+this.id+'").ownerCt)._windowContext='+(Ext.isIE?"window":'{eval:function(s){return new Function("return ("+s+")")();}}')+";})()")){var w,p=this._frameProxy,D=this.getFrameDocument();if(w=this.getWindow()){p||(p=this._frameProxy=this._eventProxy.createDelegate(this));addListener(w,"focus",p);addListener(w,"blur",p);addListener(w,"resize",p);addListener(w,"unload",p);D&&addListener(Ext.isIE?w:D,"scroll",p)}D&&(this.CSS=new Ext.ux.ManagedIFrame.CSS(D))}}catch(ex){}return this.domWritable()},_unHook:function(){if(this._hooked){this._windowContext&&(this._windowContext.hostMIF=null);this._windowContext=null;var w,p=this._frameProxy;if(p&&this.domWritable()&&(w=this.getWindow())){removeListener(w,"focus",p);removeListener(w,"blur",p);removeListener(w,"resize",p);removeListener(w,"unload",p);removeListener(Ext.isIE?w:this.getFrameDocument(),"scroll",p)}}ELD.clearDocumentCache&&ELD.clearDocumentCache(this.id);this.CSS=this.CSS?this.CSS.destroy():null;this.domFired=this._frameAction=this.domReady=this._hooked=false},_windowContext:null,getFrameDocument:function(){var win=this.getWindow(),doc=null;try{doc=(Ext.isIE&&win?win.document:null)||this.dom.contentDocument||window.frames[this.dom.name].document||null}catch(gdEx){ELD.clearDocumentCache&&ELD.clearDocumentCache(this.id);return false}doc=(doc&&Ext.isFunction(ELD.getDocument))?ELD.getDocument(doc,true):doc;return doc},getDoc:function(){var D=this.getFrameDocument();return Ext.get(D,D)},getBody:function(){var d;return(d=this.getFrameDocument())?this.get(d.body||d.documentElement):null},getDocumentURI:function(){var URI,d;try{URI=this.src&&(d=this.getFrameDocument())?d.location.href:null}catch(ex){}return URI||(Ext.isFunction(this.src)?this.src():this.src)},getWindowURI:function(){var URI,w;try{URI=(w=this.getWindow())?w.location.href:null}catch(ex){}return URI||(Ext.isFunction(this.src)?this.src():this.src)},getWindow:function(){var dom=this.dom,win=null;try{win=dom.contentWindow||window.frames[dom.name]||null}catch(gwEx){}return win},scrollChildIntoView:function(child,container,hscroll){this.fly(child,"_scrollChildIntoView").scrollIntoView(this.getDom(container)||this.getBody().dom,hscroll);return this},print:function(){try{var win;if(win=this.getWindow()){Ext.isIE&&win.focus();win.print()}}catch(ex){throw new MIF.Error("printexception",ex.description||ex.message||ex)}return this},domWritable:function(){return !!Ext.isDocument(this.getFrameDocument(),true)&&!!this._windowContext},execScript:function(block,useDOM){try{if(this.domWritable()){if(useDOM){this.writeScript(block)}else{return this._windowContext.eval(block)}}else{throw new MIF.Error("execscript-secure-context")}}catch(ex){this._observable.fireEvent.call(this._observable,"exception",this,ex);return false}return true},writeScript:function(block,attributes){attributes=Ext.apply({},attributes||{},{type:"text/javascript",text:block});try{var head,script,doc=this.getFrameDocument();if(doc&&typeof doc.getElementsByTagName!="undefined"){if(!(head=doc.getElementsByTagName("head")[0])){head=doc.createElement("head");doc.getElementsByTagName("html")[0].appendChild(head)}if(head&&(script=doc.createElement("script"))){for(var attrib in attributes){if(attributes.hasOwnProperty(attrib)&&attrib in script){script[attrib]=attributes[attrib]}}return !!head.appendChild(script)}}}catch(ex){this._observable.fireEvent.call(this._observable,"exception",this,ex)}finally{script=head=null}return false},loadFunction:function(fn,useDOM,invokeIt){var name=fn.name||fn;var fnSrc=fn.fn||window[fn];name&&fnSrc&&this.execScript(name+"="+fnSrc,useDOM);invokeIt&&this.execScript(name+"()")},loadHandler:function(e,target){var rstatus=(this.dom||{}).readyState||(e||{}).type;if(this.eventsFollowFrameLinks||this._frameAction||this.isReset){switch(rstatus){case"domready":case"DOMFrameContentLoaded":case"domfail":this._onDocReady(rstatus);break;case"load":case"complete":var frame=this;this._frameAction&&setTimeout(function(){frame._onDocLoaded(rstatus)},0.01);this._frameAction=false;break;case"error":this._observable.fireEvent.apply(this._observable,["exception",this].concat(arguments));break;default:}this.frameState=rstatus}},_onDocReady:function(eventName){var w,obv=this._observable,D;try{if(!this.isReset&&this.focusOnLoad&&(w=this.getWindow())){w.focus()}(D=this.getDoc())&&(D.isReady=true)}catch(ex){}obv.fireEvent("_docready",this);if(!this.domFired&&(this._hooked=this._renderHook())){this.domFired=true;this.isReset||obv.fireEvent.call(obv,"domready",this)}this.domReady=true;this.hideMask()},_onDocLoaded:function(eventName){var obv=this._observable,w;this.domReady||this._onDocReady("domready");obv.fireEvent("_docload",this);this.isReset||obv.fireEvent("documentloaded",this);this.hideMask(true);this._frameAction=this.isReset=false},checkDOM:function(win){if(Ext.isGecko){return}var n=0,frame=this,domReady=false,b,l,d,max=this.domReadyRetries||2500,polling=false,startLocation=(this.getFrameDocument()||{location:{}}).location.href;(function(){d=frame.getFrameDocument()||{location:{}};polling=(d.location.href!==startLocation||d.location.href===frame._targetURI);if(frame.domReady){return}domReady=polling&&((b=frame.getBody())&&!!(b.dom.innerHTML||"").length)||false;if(d.location.href&&!domReady&&(++n<max)){setTimeout(arguments.callee,2);return}frame.loadHandler({type:domReady?"domready":"domfail"})})()},filterEventOptionsRe:/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,addListener:function(eventName,fn,scope,options){if(typeof eventName=="object"){var o=eventName;for(var e in o){if(this.filterEventOptionsRe.test(e)){continue}if(typeof o[e]=="function"){this.addListener(e,o[e],o.scope,o)}else{this.addListener(e,o[e].fn,o[e].scope,o[e])}}return}if(reSynthEvents.test(eventName)){var O=this._observable;if(O){O.events[eventName]||(O.addEvents(eventName));O.addListener.call(O,eventName,fn,scope||this,options)}}else{ElFrame.superclass.addListener.call(this,eventName,fn,scope||this,options)}return this},removeListener:function(eventName,fn,scope){var O=this._observable;if(reSynthEvents.test(eventName)){O&&O.removeListener.call(O,eventName,fn,scope||this,options)}else{ElFrame.superclass.removeListener.call(this,eventName,fn,scope||this)}return this},removeAllListeners:function(){Ext.EventManager.removeAll(this.dom);var O=this._observable;O&&O.purgeListeners.call(this._observable);return this},showMask:function(msg,msgCls,maskCls){var lmask=this.loadMask;if(lmask&&!lmask.disabled){this.mask(msg||lmask.msg,msgCls||lmask.msgCls,maskCls||lmask.maskCls,lmask.maskEl)}},hideMask:function(forced){var tlm=this.loadMask||{};if(forced||(tlm.hideOnReady&&this.domReady)){this.unmask()}},mask:function(msg,msgCls,maskCls,maskEl){this._mask&&this.unmask();var p=Ext.get(maskEl)||this.parent(".ux-mif-mask-target")||this.parent();if(p.getStyle("position")=="static"&&!p.select("iframe,frame,object,embed").elements.length){p.addClass("x-masked-relative")}p.addClass("x-masked");this._mask=Ext.DomHelper.append(p,{cls:maskCls||"ux-mif-el-mask"},true);this._mask.setDisplayed(true);this._mask._agent=p;if(typeof msg=="string"){this._maskMsg=Ext.DomHelper.append(p,{cls:msgCls||"ux-mif-el-mask-msg",style:{visibility:"hidden"},cn:{tag:"div",html:msg}},true);this._maskMsg.setVisibilityMode(Ext.Element.VISIBILITY).center(p).setVisible(true)}if(Ext.isIE&&!(Ext.isIE7&&Ext.isStrict)&&this.getStyle("height")=="auto"){this._mask.setSize(undefined,this._mask.getHeight())}return this._mask},unmask:function(){var a;if(this._mask){(a=this._mask._agent)&&a.removeClass(["x-masked-relative","x-masked"]);if(this._maskMsg){this._maskMsg.remove();delete this._maskMsg}this._mask.remove();delete this._mask}},createFrameShim:function(imgUrl,shimCls){this.shimCls=shimCls||this.shimCls||"ux-mif-shim";this.frameShim||(this.frameShim=this.next("."+this.shimCls)||Ext.DomHelper.append(this.dom.parentNode,{tag:"img",src:imgUrl||Ext.BLANK_IMAGE_URL,cls:this.shimCls,galleryimg:"no"},true));this.frameShim&&(this.frameShim.autoBoxAdjust=false);return this.frameShim},toggleShim:function(show){var shim=this.frameShim||this.createFrameShim();var cls=this.shimCls+"-on";!show&&shim.removeClass(cls);show&&!shim.hasClass(cls)&&shim.addClass(cls)},load:function(loadCfg){var um;if(um=this.getUpdater()){if(loadCfg&&loadCfg.renderer){um.setRenderer(loadCfg.renderer);delete loadCfg.renderer}um.update.apply(um,arguments)}return this},_eventProxy:function(e){if(!e){return}e=Ext.EventObject.setEvent(e);var be=e.browserEvent||e,er,args=[e.type,this];if(!be.eventPhase||(be.eventPhase==(be.AT_TARGET||2))){if(e.type=="resize"){var doc=this.getFrameDocument();doc&&(args.push({height:ELD.getDocumentHeight(doc),width:ELD.getDocumentWidth(doc)},{height:ELD.getViewportHeight(doc),width:ELD.getViewportWidth(doc)},{height:ELD.getViewHeight(false,doc),width:ELD.getViewWidth(false,doc)}))}er=this._observable?this._observable.fireEvent.apply(this._observable,args.concat(Array.prototype.slice.call(arguments,0))):null;(e.type=="unload")&&this._unHook()}return er},sendMessage:function(message,tag,origin){},postMessage:function(message,origin){}});ElFrame=Ext.Element.IFRAME=Ext.Element.FRAME=Ext.ux.ManagedIFrame.Element;var fp=ElFrame.prototype;Ext.override(ElFrame,{on:fp.addListener,un:fp.removeListener,getUpdateManager:fp.getUpdater});Ext.ux.ManagedIFrame.ComponentAdapter=function(){};Ext.ux.ManagedIFrame.ComponentAdapter.prototype={version:2.14,defaultSrc:null,unsupportedText:"Inline frames are NOT enabled/supported by your browser.",hideMode:!Ext.isIE&&!!Ext.ux.plugin.VisibilityMode?"nosize":"display",animCollapse:Ext.isIE,animFloat:Ext.isIE,disableMessaging:true,eventsFollowFrameLinks:true,frameConfig:null,focusOnLoad:Ext.isIE,frameEl:null,useShim:false,autoScroll:true,autoLoad:null,getId:function(){return this.id||(this.id="mif-comp-"+(++Ext.Component.AUTO_ID))},stateEvents:["documentloaded"],stateful:false,setAutoScroll:function(auto){var scroll=Ext.value(auto,this.autoScroll===true);this.rendered&&this.getFrame()&&this.frameEl.setOverflow((this.autoScroll=scroll)?"auto":"hidden");return this},getContentTarget:function(){return this.getFrame()},getFrame:function(){if(this.rendered){if(this.frameEl){return this.frameEl}var f=this.items&&this.items.first?this.items.first():null;f&&(this.frameEl=f.frameEl);return this.frameEl}return null},getFrameWindow:function(){return this.getFrame()?this.frameEl.getWindow():null},getFrameDocument:function(){return this.getFrame()?this.frameEl.getFrameDocument():null},getFrameDoc:function(){return this.getFrame()?this.frameEl.getDoc():null},getFrameBody:function(){return this.getFrame()?this.frameEl.getBody():null},resetFrame:function(){this.getFrame()&&this.frameEl.reset.apply(this.frameEl,arguments);return this},submitAsTarget:function(submitCfg){this.getFrame()&&this.frameEl.submitAsTarget.apply(this.frameEl,arguments);return this},load:function(loadCfg){if(loadCfg&&this.getFrame()){var args=arguments;this.resetFrame(null,function(){loadCfg.submitAsTarget?this.submitAsTarget.apply(this,args):this.frameEl.load.apply(this.frameEl,args)},this)}this.autoLoad=loadCfg;return this},doAutoLoad:function(){this.autoLoad&&this.load(typeof this.autoLoad=="object"?this.autoLoad:{url:this.autoLoad})},getUpdater:function(){return this.getFrame()?this.frameEl.getUpdater():null},setSrc:function(url,discardUrl,callback,scope){this.getFrame()&&this.frameEl.setSrc.apply(this.frameEl,arguments);return this},setLocation:function(url,discardUrl,callback,scope){this.getFrame()&&this.frameEl.setLocation.apply(this.frameEl,arguments);return this},getState:function(){var URI=this.getFrame()?this.frameEl.getDocumentURI()||null:null;var state=this.supr().getState.call(this);state=Ext.apply(state||{},{defaultSrc:Ext.isFunction(URI)?URI():URI,autoLoad:this.autoLoad});return state},setMIFEvents:function(){this.addEvents("documentloaded","domready","exception","message","blur","focus","scroll","resize","unload","reset")},sendMessage:function(message,tag,origin){},onAdd:function(C){C.relayTarget&&this.suspendEvents(true)},initRef:function(){if(this.ref){var t=this,levels=this.ref.split("/"),l=levels.length,i;for(i=0;i<l;i++){if(t.ownerCt){t=t.ownerCt}}this.refName=levels[--i];t[this.refName]||(t[this.refName]=this);this.refOwner=t}}};Ext.ux.ManagedIFrame.Component=Ext.extend(Ext.BoxComponent,{ctype:"Ext.ux.ManagedIFrame.Component",initComponent:function(){var C={monitorResize:this.monitorResize||(this.monitorResize=!!this.fitToParent),plugins:(this.plugins||[]).concat(this.hideMode==="nosize"&&Ext.ux.plugin.VisibilityMode?[new Ext.ux.plugin.VisibilityMode({hideMode:"nosize",elements:["bwrap"]})]:[])};MIF.Component.superclass.initComponent.call(Ext.apply(this,Ext.apply(this.initialConfig,C)));this.setMIFEvents()},onRender:function(ct,position){var frCfg=this.frameCfg||this.frameConfig||(this.relayTarget?{name:this.relayTarget.id}:{})||{};var frDOM=frCfg.autoCreate||frCfg;frDOM=Ext.apply({tag:"iframe",id:Ext.id()},frDOM);var el=Ext.getDom(this.el);(el&&el.tagName=="iframe")||(this.autoEl=Ext.apply({name:frDOM.id,frameborder:0},frDOM));MIF.Component.superclass.onRender.apply(this,arguments);if(this.unsupportedText){ct.child("noframes")||ct.createChild({tag:"noframes",html:this.unsupportedText||null})}var frame=this.el;var F;if(F=this.frameEl=(this.el?new MIF.Element(this.el.dom,true):null)){Ext.apply(F,{ownerCt:this.relayTarget||this,disableMessaging:Ext.value(this.disableMessaging,true),focusOnLoad:Ext.value(this.focusOnLoad,Ext.isIE),eventsFollowFrameLinks:Ext.value(this.eventsFollowFrameLinks,true)});F.ownerCt.frameEl=F;F.addClass("ux-mif");if(this.loadMask){var mEl=this.loadMask.maskEl;F.loadMask=Ext.apply({disabled:false,hideOnReady:false,msgCls:"ext-el-mask-msg x-mask-loading",maskCls:"ext-el-mask"},{maskEl:F.ownerCt[String(mEl)]||F.parent("."+String(mEl))||F.parent(".ux-mif-mask-target")||mEl},Ext.isString(this.loadMask)?{msg:this.loadMask}:this.loadMask);Ext.get(F.loadMask.maskEl)&&Ext.get(F.loadMask.maskEl).addClass("ux-mif-mask-target")}F._observable&&(this.relayTarget||this).relayEvents(F._observable,frameEvents.concat(this._msgTagHandlers||[]));delete this.contentEl}},afterRender:function(container){MIF.Component.superclass.afterRender.apply(this,arguments);if(this.fitToParent&&!this.ownerCt){var pos=this.getPosition(),size=(Ext.get(this.fitToParent)||this.getEl().parent()).getViewSize();this.setSize(size.width-pos[0],size.height-pos[1])}this.getEl().setOverflow("hidden");this.setAutoScroll();var F;if(F=this.frameEl){var ownerCt=this.ownerCt;while(ownerCt){ownerCt.on("afterlayout",function(container,layout){Ext.each(["north","south","east","west"],function(region){var reg;if((reg=layout[region])&&reg.split&&reg.split.dd&&!reg._splitTrapped){reg.split.dd.endDrag=reg.split.dd.endDrag.createSequence(MIM.hideShims,MIM);reg.split.on("beforeresize",MIM.showShims,MIM);reg._splitTrapped=MIM._splitTrapped=true}},this)},this,{single:true});ownerCt=ownerCt.ownerCt}if(!!this.ownerCt||this.useShim){this.frameShim=F.createFrameShim()}this.getUpdater().showLoadIndicator=this.showLoadIndicator||false;var resumeEvents=this.relayTarget&&this.ownerCt?this.ownerCt.resumeEvents.createDelegate(this.ownerCt):null;if(this.autoload){this.doAutoLoad()}else{if(this.tpl&&(this.frameData||this.data)){F.update(this.tpl.apply(this.frameData||this.data),true,resumeEvents);delete this.frameData;delete this.data;return}else{if(this.frameMarkup||this.html){F.update(this.frameMarkup||this.html,true,resumeEvents);delete this.html;delete this.frameMarkup;return}else{if(this.defaultSrc){F.setSrc(this.defaultSrc,false)}else{F.reset(null,resumeEvents);return}}}}resumeEvents&&resumeEvents()}},beforeDestroy:function(){var F;if(F=this.getFrame()){F.remove();this.frameEl=this.frameShim=null}this.relayTarget&&(this.relayTarget.frameEl=null);MIF.Component.superclass.beforeDestroy.call(this)}});Ext.override(MIF.Component,MIF.ComponentAdapter.prototype);Ext.reg("mif",MIF.Component);function embed_MIF(config){config||(config={});config.layout="fit";config.items={xtype:"mif",ref:"mifChild",useShim:true,tpl:Ext.value(config.tpl,this.tpl),autoScroll:Ext.value(config.autoScroll,this.autoScroll),defaultSrc:Ext.value(config.defaultSrc,this.defaultSrc),frameMarkup:Ext.value(config.html,this.html),frameData:Ext.value(config.data,this.data),loadMask:Ext.value(config.loadMask,this.loadMask),disableMessaging:Ext.value(config.disableMessaging,this.disableMessaging),eventsFollowFrameLinks:Ext.value(config.eventsFollowFrameLinks,this.eventsFollowFrameLinks),focusOnLoad:Ext.value(config.focusOnLoad,this.focusOnLoad),frameConfig:Ext.value(config.frameConfig||config.frameCfg,this.frameConfig),relayTarget:this};delete config.html;delete config.data;this.setMIFEvents();return config}Ext.ux.ManagedIFrame.Panel=Ext.extend(Ext.Panel,{ctype:"Ext.ux.ManagedIFrame.Panel",bodyCssClass:"ux-mif-mask-target",constructor:function(config){MIF.Panel.superclass.constructor.call(this,embed_MIF.call(this,config))}});Ext.override(MIF.Panel,MIF.ComponentAdapter.prototype);Ext.reg("iframepanel",MIF.Panel);Ext.ux.ManagedIFrame.Portlet=Ext.extend(Ext.ux.ManagedIFrame.Panel,{ctype:"Ext.ux.ManagedIFrame.Portlet",anchor:"100%",frame:true,collapseEl:"bwrap",collapsible:true,draggable:true,cls:"x-portlet"});Ext.reg("iframeportlet",MIF.Portlet);Ext.ux.ManagedIFrame.Window=Ext.extend(Ext.Window,{ctype:"Ext.ux.ManagedIFrame.Window",bodyCssClass:"ux-mif-mask-target",constructor:function(config){MIF.Window.superclass.constructor.call(this,embed_MIF.call(this,config))}});Ext.override(MIF.Window,MIF.ComponentAdapter.prototype);Ext.reg("iframewindow",MIF.Window);Ext.ux.ManagedIFrame.Updater=Ext.extend(Ext.Updater,{showLoading:function(){this.showLoadIndicator&&this.el&&this.el.mask(this.indicatorText)},hideLoading:function(){this.showLoadIndicator&&this.el&&this.el.unmask()},updateComplete:function(response){MIF.Updater.superclass.updateComplete.apply(this,arguments);this.hideLoading()},processFailure:function(response){MIF.Updater.superclass.processFailure.apply(this,arguments);this.hideLoading()}});var styleCamelRe=/(-[a-z])/gi;var styleCamelFn=function(m,a){return a.charAt(1).toUpperCase()};Ext.ux.ManagedIFrame.CSS=function(hostDocument){var doc;if(hostDocument){doc=hostDocument;return{rules:null,destroy:function(){return doc=null},createStyleSheet:function(cssText,id){var ss;if(!doc){return}var head=doc.getElementsByTagName("head")[0];var rules=doc.createElement("style");rules.setAttribute("type","text/css");Ext.isString(id)&&rules.setAttribute("id",id);if(Ext.isIE){head.appendChild(rules);ss=rules.styleSheet;ss.cssText=cssText}else{try{rules.appendChild(doc.createTextNode(cssText))}catch(e){rules.cssText=cssText}head.appendChild(rules);ss=rules.styleSheet?rules.styleSheet:(rules.sheet||doc.styleSheets[doc.styleSheets.length-1])}this.cacheStyleSheet(ss);return ss},removeStyleSheet:function(id){if(!doc||!id){return}var existing=doc.getElementById(id);if(existing){existing.parentNode.removeChild(existing)}},swapStyleSheet:function(id,url){if(!doc){return}this.removeStyleSheet(id);var ss=doc.createElement("link");ss.setAttribute("rel","stylesheet");ss.setAttribute("type","text/css");Ext.isString(id)&&ss.setAttribute("id",id);ss.setAttribute("href",url);doc.getElementsByTagName("head")[0].appendChild(ss)},refreshCache:function(){return this.getRules(true)},cacheStyleSheet:function(ss,media){this.rules||(this.rules={});try{Ext.each(ss.cssRules||ss.rules||[],function(rule){this.hashRule(rule,ss,media)},this);Ext.each(ss.imports||[],function(sheet){sheet&&this.cacheStyleSheet(sheet,this.resolveMedia([sheet,sheet.parentStyleSheet]))},this)}catch(e){}},hashRule:function(rule,sheet,mediaOverride){var mediaSelector=mediaOverride||this.resolveMedia(rule);if(rule.cssRules||rule.rules){this.cacheStyleSheet(rule,this.resolveMedia([rule,rule.parentRule]))}if(rule.styleSheet){this.cacheStyleSheet(rule.styleSheet,this.resolveMedia([rule,rule.ownerRule,rule.parentStyleSheet]))}rule.selectorText&&Ext.each((mediaSelector||"").split(","),function(media){this.rules[((media?media.trim()+":":"")+rule.selectorText).toLowerCase()]=rule},this)},resolveMedia:function(rule){var media;Ext.each([].concat(rule),function(r){if(r&&r.media&&r.media.length){media=r.media;return false}});return media?(Ext.isIE?String(media):media.mediaText):""},getRules:function(refreshCache){if(!this.rules||refreshCache){this.rules={};if(doc){var ds=doc.styleSheets;for(var i=0,len=ds.length;i<len;i++){try{this.cacheStyleSheet(ds[i])}catch(e){}}}}return this.rules},getRule:function(selector,refreshCache,mediaSelector){var rs=this.getRules(refreshCache);if(Ext.type(mediaSelector)=="string"){mediaSelector=mediaSelector.trim()+":"}else{mediaSelector=""}if(!Ext.isArray(selector)){return rs[(mediaSelector+selector).toLowerCase()]}var select;for(var i=0;i<selector.length;i++){select=(mediaSelector+selector[i]).toLowerCase();if(rs[select]){return rs[select]}}return null},updateRule:function(selector,property,value,mediaSelector){Ext.each((mediaSelector||"").split(","),function(mediaSelect){if(!Ext.isArray(selector)){var rule=this.getRule(selector,false,mediaSelect);if(rule){rule.style[property.replace(camelRe,camelFn)]=value;return true}}else{for(var i=0;i<selector.length;i++){if(this.updateRule(selector[i],property,value,mediaSelect)){return true}}}return false},this)}}}};Ext.ux.ManagedIFrame.Manager=function(){var frames={};var implementation={_DOMFrameReadyHandler:function(e){try{var $frame;if($frame=e.target.ownerCt){$frame.loadHandler.call($frame,e)}}catch(rhEx){}},shimCls:"ux-mif-shim",register:function(frame){frame.manager=this;frames[frame.id]=frames[frame.name]={ref:frame};return frame},deRegister:function(frame){delete frames[frame.id];delete frames[frame.name]},hideShims:function(){var mm=MIF.Manager;mm.shimsApplied&&Ext.select("."+mm.shimCls,true).removeClass(mm.shimCls+"-on");mm.shimsApplied=false},showShims:function(){var mm=MIF.Manager;!mm.shimsApplied&&Ext.select("."+mm.shimCls,true).addClass(mm.shimCls+"-on");mm.shimsApplied=true},getFrameById:function(id){return typeof id=="string"?(frames[id]?frames[id].ref||null:null):null},getFrameByName:function(name){return this.getFrameById(name)},getFrameHash:function(frame){return frames[frame.id]||frames[frame.id]||null},destroy:function(){if(document.addEventListener&&!Ext.isOpera){window.removeEventListener("DOMFrameContentLoaded",this._DOMFrameReadyHandler,false)}}};document.addEventListener&&!Ext.isOpera&&window.addEventListener("DOMFrameContentLoaded",implementation._DOMFrameReadyHandler,false);Ext.EventManager.on(window,"beforeunload",implementation.destroy,implementation);return implementation}();MIM=MIF.Manager;MIM.showDragMask=MIM.showShims;MIM.hideDragMask=MIM.hideShims;var winDD=Ext.Window.DD;Ext.override(winDD,{startDrag:winDD.prototype.startDrag.createInterceptor(MIM.showShims),endDrag:winDD.prototype.endDrag.createInterceptor(MIM.hideShims)});Ext.ux.ManagedIFramePanel=MIF.Panel;Ext.ux.ManagedIFramePortlet=MIF.Portlet;Ext.ux.ManagedIframe=function(el,opt){var args=Array.prototype.slice.call(arguments,0),el=Ext.get(args[0]),config=args[0];if(el&&el.dom&&el.dom.tagName=="IFRAME"){config=args[1]||{}}else{config=args[0]||args[1]||{};el=config.autoCreate?Ext.get(Ext.DomHelper.append(config.autoCreate.parent||Ext.getBody(),Ext.apply({tag:"iframe",frameborder:0,cls:"x-mif",src:(Ext.isIE&&Ext.isSecure)?Ext.SSL_SECURE_URL:"about:blank"},config.autoCreate))):null;if(el&&config.unsupportedText){Ext.DomHelper.append(el.dom.parentNode,{tag:"noframes",html:config.unsupportedText})}}var mif=new MIF.Element(el,true);if(mif){Ext.apply(mif,{disableMessaging:Ext.value(config.disableMessaging,true),focusOnLoad:Ext.value(config.focusOnLoad,Ext.isIE),eventsFollowFrameLinks:Ext.value(config.eventsFollowFrameLinks,true),loadMask:!!config.loadMask?Ext.apply({msg:"Loading..",msgCls:"x-mask-loading",maskEl:null,hideOnReady:false,disabled:false},config.loadMask):false,_windowContext:null});config.listeners&&mif.on(config.listeners);if(!!config.html){mif.update(config.html)}else{!!config.src&&mif.setSrc(config.src)}}return mif};Ext.ux.ManagedIFrame.Error=Ext.extend(Ext.Error,{constructor:function(message,arg){this.arg=arg;Ext.Error.call(this,message)},name:"Ext.ux.ManagedIFrame"});Ext.apply(Ext.ux.ManagedIFrame.Error.prototype,{lang:{"documentcontext-remove":"An attempt was made to remove an Element from the wrong document context.","execscript-secure-context":"An attempt was made at script execution within a document context with limited access permissions.",printexception:"An Error was encountered attempting the print the frame contents (document access is likely restricted)."}});Ext.onReady(function(){var CSS=new Ext.ux.ManagedIFrame.CSS(document),rules=[];CSS.getRule(".ux-mif-fill")||(rules.push(".ux-mif-fill{height:100%;width:100%;}"));CSS.getRule(".ux-mif-mask-target")||(rules.push(".ux-mif-mask-target{position:relative;zoom:1;}"));CSS.getRule(".ux-mif-el-mask")||(rules.push(".ux-mif-el-mask {z-index: 100;position: absolute;top:0;left:0;-moz-opacity: 0.5;opacity: .50;*filter: alpha(opacity=50);width: 100%;height: 100%;zoom: 1;} ",".ux-mif-el-mask-msg {z-index: 1;position: absolute;top: 0;left: 0;border:1px solid;background:repeat-x 0 -16px;padding:2px;} ",".ux-mif-el-mask-msg div {padding:5px 10px 5px 10px;border:1px solid;cursor:wait;} "));if(!CSS.getRule(".ux-mif-shim")){rules.push(".ux-mif-shim {z-index:8500;position:absolute;top:0px;left:0px;background:transparent!important;overflow:hidden;display:none;}");rules.push(".ux-mif-shim-on{width:100%;height:100%;display:block;zoom:1;}");rules.push(".ext-ie6 .ux-mif-shim{margin-left:5px;margin-top:3px;}")}if(!CSS.getRule(".x-hide-nosize")){rules.push(".x-hide-nosize{height:0px!important;width:0px!important;visibility:hidden!important;border:none!important;zoom:1;}.x-hide-nosize * {height:0px!important;width:0px!important;visibility:hidden!important;border:none!important;zoom:1;}")}!!rules.length&&CSS.createStyleSheet(rules.join(" "),"mifCSS")});Ext.provide&&Ext.provide("mif")})();Ext.namespace("sitools.widget");sitools.widget.TextFilter=Ext.extend(Ext.form.TriggerField,{ctCls:"s-textfilter",cls:"s-textfilter-text",triggerConfig:{tag:"div",cls:"x-form-trigger s-textfilter-trigger"},enableKeyEvents:true,listeners:{keyup:{fn:function(c,b){c.trigger.setVisible((c.getValue()!==""))}},render:{fn:function(a){a.trigger.hide()}}},queryDelay:500,queryAction:"find",enumAction:"enum",queryParam:"query",localFilter:false,localFilterField:"",pageSize:"",constructor:function(a){sitools.widget.TextFilter.superclass.constructor.call(this,a);if(this.store&&!this.localFilter){this.mon(this.store,"beforeload",this.onBeforeLoad,this)}if(this.localFilter===true){this.mon(this.store,"load",this.reset,this)}},initEvents:function(){sitools.widget.TextFilter.superclass.initEvents.call(this);this.mon(this.el,"keyup",this.filter,this,{buffer:this.queryDelay})},setPageSize:function(a){this.pageSize=a},onBeforeLoad:function(e,d){var f=this.getValue();if(f){d.params[this.queryParam]=f;d.params.action=this.queryAction}else{d.params.action=this.enumAction}return true},filter:function(){var c=this.getValue();var d={};if(!this.store){return}if(this.localFilter===true){if(c){this.store.filter(this.localFilterField,c,true)}else{this.store.clearFilter(false)}return}if(!Ext.isEmpty(this.pageSize)){d={start:0,limit:this.pageSize}}if(c){d.action=this.queryAction;d[this.queryParam]=c;this.store.load({params:d})}else{d.action=this.enumAction;this.store.load({params:d})}},reset:function(){sitools.widget.TextFilter.superclass.reset.call(this);if(this.localFilterField===false&&this.store){this.store.clearFilter(false)}},onTriggerClick:function(){if(this.getValue()){this.setValue("");this.trigger.hide();this.filter()}}});Ext.reg("s-filter",sitools.widget.TextFilter);Ext.ux.Spinner=Ext.extend(Ext.util.Observable,{incrementValue:1,alternateIncrementValue:5,triggerClass:"x-form-spinner-trigger",splitterClass:"x-form-spinner-splitter",alternateKey:Ext.EventObject.shiftKey,defaultValue:0,accelerate:false,constructor:function(a){Ext.ux.Spinner.superclass.constructor.call(this,a);Ext.apply(this,a);this.mimicing=false},init:function(a){this.field=a;a.afterMethod("onRender",this.doRender,this);a.afterMethod("onEnable",this.doEnable,this);a.afterMethod("onDisable",this.doDisable,this);a.afterMethod("afterRender",this.doAfterRender,this);a.afterMethod("onResize",this.doResize,this);a.afterMethod("onFocus",this.doFocus,this);a.beforeMethod("onDestroy",this.doDestroy,this)},doRender:function(b,a){var c=this.el=this.field.getEl();var d=this.field;if(!d.wrap){d.wrap=this.wrap=c.wrap({cls:"x-form-field-wrap"})}else{this.wrap=d.wrap.addClass("x-form-field-wrap")}this.trigger=this.wrap.createChild({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.triggerClass});if(!d.width){this.wrap.setWidth(c.getWidth()+this.trigger.getWidth())}this.splitter=this.wrap.createChild({tag:"div",cls:this.splitterClass,style:"width:13px; height:2px;"});this.splitter.setRight((Ext.isIE)?1:2).setTop(10).show();this.proxy=this.trigger.createProxy("",this.splitter,true);this.proxy.addClass("x-form-spinner-proxy");this.proxy.setStyle("left","0px");this.proxy.setSize(14,1);this.proxy.hide();this.dd=new Ext.dd.DDProxy(this.splitter.dom.id,"SpinnerDrag",{dragElId:this.proxy.id});this.initTrigger();this.initSpinner()},doAfterRender:function(){var a;if(Ext.isIE&&this.el.getY()!=(a=this.trigger.getY())){this.el.position();this.el.setY(a)}},doEnable:function(){if(this.wrap){this.wrap.removeClass(this.field.disabledClass)}},doDisable:function(){if(this.wrap){this.wrap.addClass(this.field.disabledClass);this.el.removeClass(this.field.disabledClass)}},doResize:function(a,b){if(typeof a=="number"){this.el.setWidth(a-this.trigger.getWidth())}this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth())},doFocus:function(){if(!this.mimicing){this.wrap.addClass("x-trigger-wrap-focus");this.mimicing=true;Ext.get(Ext.isIE?document.body:document).on("mousedown",this.mimicBlur,this,{delay:10});this.el.on("keydown",this.checkTab,this)}},checkTab:function(a){if(a.getKey()==a.TAB){this.triggerBlur()}},mimicBlur:function(a){if(!this.wrap.contains(a.target)&&this.field.validateBlur(a)){this.triggerBlur()}},triggerBlur:function(){this.mimicing=false;Ext.get(Ext.isIE?document.body:document).un("mousedown",this.mimicBlur,this);this.el.un("keydown",this.checkTab,this);this.field.beforeBlur();this.wrap.removeClass("x-trigger-wrap-focus");this.field.onBlur.call(this.field)},initTrigger:function(){this.trigger.addClassOnOver("x-form-trigger-over");this.trigger.addClassOnClick("x-form-trigger-click")},initSpinner:function(){this.field.addEvents({spin:true,spinup:true,spindown:true});this.keyNav=new Ext.KeyNav(this.el,{up:function(a){a.preventDefault();this.onSpinUp()},down:function(a){a.preventDefault();this.onSpinDown()},pageUp:function(a){a.preventDefault();this.onSpinUpAlternate()},pageDown:function(a){a.preventDefault();this.onSpinDownAlternate()},scope:this});this.repeater=new Ext.util.ClickRepeater(this.trigger,{accelerate:this.accelerate});this.field.mon(this.repeater,"click",this.onTriggerClick,this,{preventDefault:true});this.field.mon(this.trigger,{mouseover:this.onMouseOver,mouseout:this.onMouseOut,mousemove:this.onMouseMove,mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,preventDefault:true});this.field.mon(this.wrap,"mousewheel",this.handleMouseWheel,this);this.dd.setXConstraint(0,0,10);this.dd.setYConstraint(1500,1500,10);this.dd.endDrag=this.endDrag.createDelegate(this);this.dd.startDrag=this.startDrag.createDelegate(this);this.dd.onDrag=this.onDrag.createDelegate(this)},onMouseOver:function(){if(this.disabled){return}var a=this.getMiddle();this.tmpHoverClass=(Ext.EventObject.getPageY()<a)?"x-form-spinner-overup":"x-form-spinner-overdown";this.trigger.addClass(this.tmpHoverClass)},onMouseOut:function(){this.trigger.removeClass(this.tmpHoverClass)},onMouseMove:function(){if(this.disabled){return}var a=this.getMiddle();if(((Ext.EventObject.getPageY()>a)&&this.tmpHoverClass=="x-form-spinner-overup")||((Ext.EventObject.getPageY()<a)&&this.tmpHoverClass=="x-form-spinner-overdown")){}},onMouseDown:function(){if(this.disabled){return}var a=this.getMiddle();this.tmpClickClass=(Ext.EventObject.getPageY()<a)?"x-form-spinner-clickup":"x-form-spinner-clickdown";this.trigger.addClass(this.tmpClickClass)},onMouseUp:function(){this.trigger.removeClass(this.tmpClickClass)},onTriggerClick:function(){if(this.disabled||this.el.dom.readOnly){return}var b=this.getMiddle();var a=(Ext.EventObject.getPageY()<b)?"Up":"Down";this["onSpin"+a]()},getMiddle:function(){var b=this.trigger.getTop();var c=this.trigger.getHeight();var a=b+(c/2);return a},isSpinnable:function(){if(this.disabled||this.el.dom.readOnly){Ext.EventObject.preventDefault();return false}return true},handleMouseWheel:function(a){if(this.wrap.hasClass("x-trigger-wrap-focus")==false){return}var b=a.getWheelDelta();if(b>0){this.onSpinUp();a.stopEvent()}else{if(b<0){this.onSpinDown();a.stopEvent()}}},startDrag:function(){this.proxy.show();this._previousY=Ext.fly(this.dd.getDragEl()).getTop()},endDrag:function(){this.proxy.hide()},onDrag:function(){if(this.disabled){return}var b=Ext.fly(this.dd.getDragEl()).getTop();var a="";if(this._previousY>b){a="Up"}if(this._previousY<b){a="Down"}if(a!=""){this["onSpin"+a]()}this._previousY=b},onSpinUp:function(){if(this.isSpinnable()==false){return}if(Ext.EventObject.shiftKey==true){this.onSpinUpAlternate();return}else{this.spin(false,false)}this.field.fireEvent("spin",this);this.field.fireEvent("spinup",this)},onSpinDown:function(){if(this.isSpinnable()==false){return}if(Ext.EventObject.shiftKey==true){this.onSpinDownAlternate();return}else{this.spin(true,false)}this.field.fireEvent("spin",this);this.field.fireEvent("spindown",this)},onSpinUpAlternate:function(){if(this.isSpinnable()==false){return}this.spin(false,true);this.field.fireEvent("spin",this);this.field.fireEvent("spinup",this)},onSpinDownAlternate:function(){if(this.isSpinnable()==false){return}this.spin(true,true);this.field.fireEvent("spin",this);this.field.fireEvent("spindown",this)},spin:function(d,b){var a=parseFloat(this.field.getValue());var c=(b==true)?this.alternateIncrementValue:this.incrementValue;(d==true)?a-=c:a+=c;a=(isNaN(a))?this.defaultValue:a;a=this.fixBoundries(a);this.field.setRawValue(a)},fixBoundries:function(b){var a=b;if(this.field.minValue!=undefined&&a<this.field.minValue){a=this.field.minValue}if(this.field.maxValue!=undefined&&a>this.field.maxValue){a=this.field.maxValue}return this.fixPrecision(a)},fixPrecision:function(b){var a=isNaN(b);if(!this.field.allowDecimals||this.field.decimalPrecision==-1||a||!b){return a?"":b}return parseFloat(parseFloat(b).toFixed(this.field.decimalPrecision))},doDestroy:function(){if(this.trigger){this.trigger.remove()}if(this.wrap){this.wrap.remove();delete this.field.wrap}if(this.splitter){this.splitter.remove()}if(this.dd){this.dd.unreg();this.dd=null}if(this.proxy){this.proxy.remove()}if(this.repeater){this.repeater.purgeListeners()}}});Ext.form.Spinner=Ext.ux.Spinner;Ext.ns("Ext.ux.form");Ext.ux.form.SpinnerField=Ext.extend(Ext.form.NumberField,{actionMode:"wrap",deferHeight:true,autoSize:Ext.emptyFn,onBlur:Ext.emptyFn,adjustSize:Ext.BoxComponent.prototype.adjustSize,constructor:function(c){var b=Ext.copyTo({},c,"incrementValue,alternateIncrementValue,accelerate,defaultValue,triggerClass,splitterClass");var d=this.spinner=new Ext.ux.Spinner(b);var a=c.plugins?(Ext.isArray(c.plugins)?c.plugins.push(d):[c.plugins,d]):d;Ext.ux.form.SpinnerField.superclass.constructor.call(this,Ext.apply(c,{plugins:a}))},getResizeEl:function(){return this.wrap},getPositionEl:function(){return this.wrap},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])}},validateBlur:function(){return true}});Ext.reg("spinnerfield",Ext.ux.form.SpinnerField);Ext.form.SpinnerField=Ext.ux.form.SpinnerField;Ext.namespace("sitools.component.datasets");sitools.component.datasets.selectItems=function(a){Ext.apply(this,a);var b=new Ext.Panel({layout:"vbox",layoutConfig:{align:"center",pack:"center",defaultMargins:{top:10,right:0,bottom:0,left:0}},flex:0.06,defaults:{scope:this},items:[{xtype:"button",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/simple-arrow-right.png",handler:this._onAdd},{xtype:"button",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/double-arrow-right.png",handler:this._onAddAll},{xtype:"button",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/simple-arrow-left.png",handler:this._onRemove},{xtype:"button",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/double-arrow-left.png",handler:this._onRemoveAll}]});Ext.applyIf(this.grid1,{flex:this.defaultFlexGrid});Ext.applyIf(this.grid2,{flex:this.defaultFlexGrid});sitools.component.datasets.selectItems.superclass.constructor.call(this,Ext.apply({layout:"hbox",layoutConfig:{flex:"ratio",align:"stretch"},items:[this.grid1,b,this.grid2]}))};Ext.extend(sitools.component.datasets.selectItems,Ext.Panel,{grid1:null,grid2:null,defaultRecord:null,defaultFlexGrid:0.47,_onAdd:function(){var a=this.grid2.getStore();var d=[];if(this.grid1 instanceof Ext.grid.GridPanel){d=this.grid1.getSelectionModel().getSelections()}if(this.grid1 instanceof Ext.tree.TreePanel){var c=this.grid1.getSelectionModel().getSelectedNodes();var b=a.recordType;Ext.each(c,function(g){var f=Ext.apply(g.attributes,{columnAlias:g.attributes.name.toLowerCase(),dataIndex:this.buildDataIndex(g),sqlColumnType:g.attributes.type,tableName:this.grid1.getRootNode().attributes.collection});d.push(new b(g.attributes))},this)}if(d.length===0){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"));return}var e;Ext.each(d,function(f){e=f.copy();e.id=Ext.data.Record.id(e);Ext.each(this.defaultRecord,function(g){if(!e.get(g.name)){e.set(g.name,g.value)}},this);a.add(e)},this);this.grid2.getView().refresh()},_onAddAll:function(){var a=this.grid2.getStore();var e=[];if(this.grid1 instanceof Ext.grid.GridPanel){var b=this.grid1.getStore();e=b.data.items}if(this.grid1 instanceof Ext.tree.TreePanel){var d=this.grid1.getRootNode().childNodes;var c=a.recordType;Ext.each(d,function(k){var g=Ext.apply(k.attributes,{columnAlias:k.attributes.name.toLowerCase(),dataIndex:this.buildDataIndex(k),sqlColumnType:k.attributes.type,tableName:k.ownerTree.getRootNode().attributes.collection});e.push(new c(k.attributes))},this)}var f;Ext.each(e,function(g){f=g.copy();f.id=Ext.data.Record.id(f);Ext.each(this.defaultRecord,function(k){if(!f.get(k.name)){f.set(k.name,k.value)}},this);a.add(f)},this)},_onRemove:function(){var a=this.grid2.getStore();var b=this.grid2.getSelectionModel().getSelections();if(b.length===0){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"));return}Ext.each(b,function(c){a.remove(c)});this.grid2.getView().refresh()},_onRemoveAll:function(){var a=this.grid2.getStore();a.each(function(b){a.remove(b)})},setFirstGrid:function(a){this.remove(this.grid1);Ext.applyIf(a,{flex:this.defaultFlexGrid});this.grid1=a;this.insert(0,this.grid1);this.doLayout()},getFirstGrid:function(){return this.grid1},getSecondGrid:function(){return this.grid2},buildDataIndex:function(b,a){if(Ext.isEmpty(a)){a=b.attributes.name}while(b.parentNode&&!b.parentNode.isRoot){b=b.parentNode;a=b.attributes.name+"."+a;this.buildDataIndex(b,a)}return a}});Ext.namespace("sitools.widget");sitools.widget.GridUp=Ext.extend(Ext.Button,{initComponent:function(){this.icon=loadUrl.get("APP_URL")+"/common/res/images/icons/simple-arrow-up.png";sitools.widget.GridUp.superclass.initComponent.call(this)},handler:function(){if(Ext.isEmpty(this.gridId)){var c=this.findByType("grid")[0]}else{var c=Ext.getCmp(this.gridId)}if(!c){var c=this}var d=c.getSelectionModel().getSelected();if(!d){return}var a=c.getStore();if(!a){return}var b=a.data.items.indexOf(d);if(b>0){a.remove(d);a.insert(b-1,d);c.getSelectionModel().selectRow(b-1)}c.getView().refresh()}});sitools.widget.GridDown=Ext.extend(Ext.Button,{initComponent:function(){this.icon=loadUrl.get("APP_URL")+"/common/res/images/icons/simple-arrow-down.png";sitools.widget.GridDown.superclass.initComponent.call(this)},handler:function(){if(Ext.isEmpty(this.gridId)){var c=this.findByType("grid")[0]}else{var c=Ext.getCmp(this.gridId)}if(!c){var c=this}var d=c.getSelectionModel().getSelected();if(!d){return}var a=c.getStore();if(!a){return}var b=a.data.items.indexOf(d);if(b<a.getCount()-1){a.remove(d);a.insert(b+1,d);c.getSelectionModel().selectRow(b+1)}c.getView().refresh()}});sitools.widget.GridTop=Ext.extend(Ext.Button,{initComponent:function(){this.icon=loadUrl.get("APP_URL")+"/common/res/images/icons/double-arrow-up.png";sitools.widget.GridTop.superclass.initComponent.call(this)},handler:function(){if(Ext.isEmpty(this.gridId)){var b=this.findByType("grid")[0]}else{var b=Ext.getCmp(this.gridId)}if(!b){var b=this}var c=b.getSelectionModel().getSelected();if(!c){return}var a=b.getStore();if(!a){return}a.remove(c);a.insert(0,c);b.getSelectionModel().selectRow(0);b.getView().refresh()}});sitools.widget.GridBottom=Ext.extend(Ext.Button,{initComponent:function(){this.icon=loadUrl.get("APP_URL")+"/common/res/images/icons/double-arrow-down.png";sitools.widget.GridBottom.superclass.initComponent.call(this)},handler:function(){if(Ext.isEmpty(this.gridId)){var c=this.findByType("grid")[0]}else{var c=Ext.getCmp(this.gridId)}if(!c){var c=this}var d=c.getSelectionModel().getSelected();if(!d){return}var a=c.getStore();if(!a){return}var b=a.data.items.indexOf(d);a.remove(d);a.insert(a.getCount(),d);c.getSelectionModel().selectRow(a.getCount()-1);c.getView().refresh()}});Ext.namespace("Ext.ux");Ext.namespace("Ext.ux.Plugin");Ext.ux.Plugin.LiteRemoteComponent=function(a){var c=a.xtype||"panel";var b=function(d){this.container.add(Ext.ComponentMgr.create(Ext.decode(d.responseText),c)).show();this.container.doLayout()};return{init:function(d){this.container=d;Ext.Ajax.request(Ext.apply(a,{success:b,scope:this}))}}};Ext.ux.Plugin.RemoteComponent=function(a){var d=a.xtype||"panel";Ext.applyIf(a,{purgeSubscribers:true});this.initialConfig=a;Ext.apply(this,a);this.addEvents({beforeload:true,beforecreate:true,beforeadd:true,beforecomponshow:true,beforecontainshow:true,success:true});Ext.ux.Plugin.RemoteComponent.superclass.constructor.call(this,a);if(a.breakOn){this.on(a.breakOn,function(){return false})}var b=function(f){if(this.fireEvent("beforeadd",f,this)){var e=this.container.add(f);e.fireEvent("bodyResize",this);if(this.fireEvent("beforecomponshow",e,this)){return e}}}.createDelegate(this);var c=function(f){var g=Ext.decode(f.responseText);if(this.fireEvent("beforecreate",g,this)){var e=null;if(g instanceof Array){Ext.each(g,function(k,l){e=b(k).show()})}else{e=b(g).show()}if(this.fireEvent("beforecontainshow",e,this)){this.container.ownerCt.doLayout();this.fireEvent("success",e,this)}}if(this.purgeSubscribers){this.purgeListeners()}}.createDelegate(this);this.load=function(){if(this.fireEvent("beforeload",a,this)){if(a.mask){var e=new Ext.LoadMask(Ext.getDom(a.mask),Ext.apply({msg:"loading components..."},a.maskConfig||{}));e.show();this.on("success",e.hide,e)}Ext.Ajax.request(Ext.apply(a,{success:c,scope:this}))}};this.init=function(e){e.on("beforedestroy",function(){this.purgeListeners()},this);this.container=e;if(a.loadOn){if(a.loadOn instanceof Array){Ext.each(a.loadOn,function(k,m,g){var f=k.event||k.loadOn;var n=function(){this.load();Ext.each(g,function(l){(l.scope||e).un(f,n,this)}.createDelegate(this))}.createDelegate(this);(k.scope||e).on(f,n,this)}.createDelegate(this))}else{(a.loadOn.scope||e).on((a.loadOn.event||a.loadOn),this.load,this,{single:true})}}else{this.load()}}};Ext.extend(Ext.ux.Plugin.RemoteComponent,Ext.util.Observable);Ext.ns("Ext.ux.grid");Ext.ux.grid.LockingGridPanel=Ext.extend(Ext.grid.GridPanel,{initComponent:function(){if(!this.cm&&!this.colModel&&Ext.isArray(this.columns)){this.colModel=new Ext.ux.grid.LockingColumnModel(this.columns);delete this.columns}Ext.ux.grid.LockingGridPanel.superclass.initComponent.call(this)},getView:function(){if(!this.view){this.view=new Ext.ux.grid.LockingGridView(this.viewConfig)}return this.view}});Ext.ux.grid.LockingEditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{initComponent:function(){if(!this.cm&&!this.colModel&&Ext.isArray(this.columns)){this.colModel=new Ext.ux.grid.LockingColumnModel(this.columns);delete this.columns}Ext.ux.grid.LockingEditorGridPanel.superclass.initComponent.call(this)},getView:function(){if(!this.view){this.view=new Ext.ux.grid.LockingGridView(this.viewConfig)}return this.view}});Ext.applyIf(Ext.grid.GridView.prototype,{getScrollOffset:function(){return Ext.isDefined(this.scrollOffset)?this.scrollOffset:Ext.getScrollBarWidth()}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.grid");Ext.ux.grid.LockingGridView=Ext.extend(Ext.grid.GridView,{lockText:"Lock",unlockText:"Unlock",rowBorderWidth:1,lockedBorderWidth:1,syncHeights:false,initTemplates:function(){var a=this.templates||{};if(!a.masterTpl){a.masterTpl=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-locked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{lstyle}">{lockedHeader}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{lstyle}">{lockedBody}</div><div class="x-grid3-scroll-spacer"></div></div>',"</div>",'<div class="x-grid3-viewport x-grid3-unlocked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>")}this.templates=a;Ext.ux.grid.LockingGridView.superclass.initTemplates.call(this)},getEditorParent:function(a){return this.el.dom},initElements:function(){var e=Ext.get(this.grid.getGridEl().dom.firstChild),g=e.child("div.x-grid3-locked"),c=g.child("div.x-grid3-header"),b=g.child("div.x-grid3-scroller"),f=e.child("div.x-grid3-viewport"),d=f.child("div.x-grid3-header"),a=f.child("div.x-grid3-scroller");if(this.grid.hideHeaders){c.setDisplayed(false);d.setDisplayed(false)}if(this.forceFit){a.setStyle("overflow-x","hidden")}Ext.apply(this,{el:e,mainWrap:f,mainHd:d,innerHd:d.dom.firstChild,scroller:a,mainBody:a.child("div.x-grid3-body"),focusEl:a.child("a"),resizeMarker:e.child("div.x-grid3-resize-marker"),resizeProxy:e.child("div.x-grid3-resize-proxy"),lockedWrap:g,lockedHd:c,lockedScroller:b,lockedBody:b.child("div.x-grid3-body"),lockedInnerHd:c.child("div.x-grid3-header-inner",true)});this.focusEl.swallowEvent("click",true)},getLockedRows:function(){return this.hasRows()?this.lockedBody.dom.childNodes:[]},getLockedRow:function(a){return this.getLockedRows()[a]},getCell:function(c,a){var b=this.cm.getLockedCount();if(a<b){return this.getLockedRow(c).getElementsByTagName("td")[a]}return Ext.ux.grid.LockingGridView.superclass.getCell.call(this,c,a-b)},getHeaderCell:function(a){var b=this.cm.getLockedCount();if(a<b){return this.lockedHd.dom.getElementsByTagName("td")[a]}return Ext.ux.grid.LockingGridView.superclass.getHeaderCell.call(this,a-b)},addRowClass:function(c,a){var b=this.getLockedRow(c);if(b){this.fly(b).addClass(a)}Ext.ux.grid.LockingGridView.superclass.addRowClass.call(this,c,a)},removeRowClass:function(c,a){var b=this.getLockedRow(c);if(b){this.fly(b).removeClass(a)}Ext.ux.grid.LockingGridView.superclass.removeRowClass.call(this,c,a)},removeRow:function(a){Ext.removeNode(this.getLockedRow(a));Ext.ux.grid.LockingGridView.superclass.removeRow.call(this,a)},removeRows:function(c,b){var a=this.lockedBody.dom,d=c;for(;d<=b;d++){Ext.removeNode(a.childNodes[c])}Ext.ux.grid.LockingGridView.superclass.removeRows.call(this,c,b)},syncScroll:function(a){this.lockedScroller.dom.scrollTop=this.scroller.dom.scrollTop;Ext.ux.grid.LockingGridView.superclass.syncScroll.call(this,a)},updateSortIcon:function(d,c){var a=this.sortClasses,e=this.lockedHd.select("td").removeClass(a),g=this.mainHd.select("td").removeClass(a),f=this.cm.getLockedCount(),b=a[c=="DESC"?1:0];if(d<f){e.item(d).addClass(b)}else{g.item(d-f).addClass(b)}},updateAllColumnWidths:function(){var g=this.getTotalWidth(),p=this.cm.getColumnCount(),b=this.getLockedWidth(),d=this.cm.getLockedCount(),l=[],k,e;this.updateLockedWidth();for(e=0;e<p;e++){l[e]=this.getColumnWidth(e);var f=this.getHeaderCell(e);f.style.width=l[e]}var a=this.getLockedRows(),n=this.getRows(),q,m,c;for(e=0,k=n.length;e<k;e++){q=a[e];q.style.width=b;if(q.firstChild){q.firstChild.style.width=b;m=q.firstChild.rows[0];for(c=0;c<d;c++){m.childNodes[c].style.width=l[c]}}q=n[e];q.style.width=g;if(q.firstChild){q.firstChild.style.width=g;m=q.firstChild.rows[0];for(c=d;c<p;c++){m.childNodes[c-d].style.width=l[c]}}}this.onAllColumnWidthsUpdated(l,g);this.syncHeaderHeight()},updateColumnWidth:function(d,a){var n=this.getColumnWidth(d),e=this.cm.getLockedCount(),m,b,l,p;this.updateLockedWidth();if(d<e){m=this.getLockedRows();b=this.getLockedWidth();l=d}else{m=this.getRows();b=this.getTotalWidth();l=d-e}var g=this.getHeaderCell(d);g.style.width=n;for(var f=0,k=m.length;f<k;f++){p=m[f];p.style.width=b;if(p.firstChild){p.firstChild.style.width=b;p.firstChild.rows[0].childNodes[l].style.width=n}}this.onColumnWidthUpdated(d,n,this.getTotalWidth());this.syncHeaderHeight()},updateColumnHidden:function(b,g){var d=this.cm.getLockedCount(),n,a,m,p,l=g?"none":"";this.updateLockedWidth();if(b<d){n=this.getLockedRows();a=this.getLockedWidth();m=b}else{n=this.getRows();a=this.getTotalWidth();m=b-d}var f=this.getHeaderCell(b);f.style.display=l;for(var e=0,k=n.length;e<k;e++){p=n[e];p.style.width=a;if(p.firstChild){p.firstChild.style.width=a;p.firstChild.rows[0].childNodes[m].style.display=l}}this.onColumnHiddenUpdated(b,g,this.getTotalWidth());delete this.lastViewWidth;this.layout()},doRender:function(g,m,v,a,u,C){var d=this.templates,f=d.cell,k=d.row,q=u-1,e="width:"+this.getTotalWidth()+";",b="width:"+this.getLockedWidth()+";",J=[],M=[],A,l,K,z={},n={},t;for(var B=0,E=m.length;B<E;B++){t=m[B];A=[];l=[];var s=(B+a);for(var D=0;D<u;D++){K=g[D];z.id=K.id;z.css=(D===0?"x-grid3-cell-first ":(D==q?"x-grid3-cell-last ":""))+(this.cm.config[D].cellCls?" "+this.cm.config[D].cellCls:"");z.attr=z.cellAttr="";z.value=K.renderer(t.data[K.name],z,t,s,D,v);z.style=K.style;if(Ext.isEmpty(z.value)){z.value="&#160;"}if(this.markDirty&&t.dirty&&Ext.isDefined(t.modified[K.name])){z.css+=" x-grid3-dirty-cell"}if(K.locked){l[l.length]=f.apply(z)}else{A[A.length]=f.apply(z)}}var L=[];if(C&&((s+1)%2===0)){L[0]="x-grid3-row-alt"}if(t.dirty){L[1]=" x-grid3-dirty-row"}n.cols=u;if(this.getRowClass){L[2]=this.getRowClass(t,s,n,v)}n.alt=L.join(" ");n.cells=A.join("");n.tstyle=e;J[J.length]=k.apply(n);n.cells=l.join("");n.tstyle=b;M[M.length]=k.apply(n)}return[J.join(""),M.join("")]},processRows:function(b,k){if(!this.ds||this.ds.getCount()<1){return}var f=this.getRows(),e=this.getLockedRows(),g,d;k=k||!this.grid.stripeRows;b=b||0;for(var c=0,a=f.length;c<a;++c){g=f[c];d=e[c];g.rowIndex=c;d.rowIndex=c;if(!k){g.className=g.className.replace(this.rowClsRe," ");d.className=d.className.replace(this.rowClsRe," ");if((c+1)%2===0){g.className+=" x-grid3-row-alt";d.className+=" x-grid3-row-alt"}}this.syncRowHeights(g,d)}if(b===0){Ext.fly(f[0]).addClass(this.firstRowCls);Ext.fly(e[0]).addClass(this.firstRowCls)}Ext.fly(f[f.length-1]).addClass(this.lastRowCls);Ext.fly(e[e.length-1]).addClass(this.lastRowCls)},syncRowHeights:function(f,e){if(this.syncHeights){var d=Ext.get(f),b=Ext.get(e),c=d.getHeight(),a=b.getHeight();if(c>a){b.setHeight(c)}else{if(a>c){d.setHeight(a)}}}},afterRender:function(){if(!this.ds||!this.cm){return}var a=this.renderRows()||["&#160;","&#160;"];this.mainBody.dom.innerHTML=a[0];this.lockedBody.dom.innerHTML=a[1];this.processRows(0,true);if(this.deferEmptyText!==true){this.applyEmptyText()}this.grid.fireEvent("viewready",this.grid)},renderUI:function(){var b=this.templates,c=this.renderHeaders(),a=b.body.apply({rows:"&#160;"});return b.masterTpl.apply({body:a,header:c[0],ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";",lockedBody:a,lockedHeader:c[1],lstyle:"width:"+this.getLockedWidth()+";"})},afterRenderUI:function(){var a=this.grid;this.initElements();Ext.fly(this.innerHd).on("click",this.handleHdDown,this);Ext.fly(this.lockedInnerHd).on("click",this.handleHdDown,this);this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.lockedHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.scroller.on("scroll",this.syncScroll,this);if(a.enableColumnResize!==false){this.splitZone=new Ext.grid.GridView.SplitDragZone(a,this.mainHd.dom);this.splitZone.setOuterHandleElId(Ext.id(this.lockedHd.dom));this.splitZone.setOuterHandleElId(Ext.id(this.mainHd.dom))}if(a.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(a,this.innerHd);this.columnDrag.setOuterHandleElId(Ext.id(this.lockedInnerHd));this.columnDrag.setOuterHandleElId(Ext.id(this.innerHd));this.columnDrop=new Ext.grid.HeaderDropZone(a,this.mainHd.dom)}if(a.enableHdMenu!==false){this.hmenu=new Ext.menu.Menu({id:a.id+"-hctx"});this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});if(this.grid.enableColLock!==false){this.hmenu.add("-",{itemId:"lock",text:this.lockText,cls:"xg-hmenu-lock"},{itemId:"unlock",text:this.unlockText,cls:"xg-hmenu-unlock"})}this.hmenu.add("-",{itemId:"help",text:"help",cls:"xg-hmenu-help"});if(a.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:a.id+"-hcols-menu"});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});this.hmenu.add("-",{itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})}this.hmenu.on("itemclick",this.handleHdMenuClick,this)}if(a.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut});this.lockedBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})}if(a.enableDragDrop||a.enableDrag){this.dragZone=new Ext.grid.GridDragZone(a,{ddGroup:a.ddGroup||"GridDD"})}this.updateHeaderSortState()},layout:function(){if(!this.mainBody){return}var d=this.grid;var k=d.getGridEl();var a=k.getSize(true);var b=a.width;if(!d.hideHeaders&&(b<20||a.height<20)){return}this.syncHeaderHeight();if(d.autoHeight){this.scroller.dom.style.overflow="visible";this.lockedScroller.dom.style.overflow="visible";if(Ext.isWebKit){this.scroller.dom.style.position="static";this.lockedScroller.dom.style.position="static"}}else{this.el.setSize(a.width,a.height);var f=this.mainHd.getHeight();var e=a.height-(f)}this.updateLockedWidth();if(this.forceFit){if(this.lastViewWidth!=b){this.fitColumns(false,false);this.lastViewWidth=b}}else{this.autoExpand();this.syncHeaderScroll()}this.onLayout(b,e)},getOffsetWidth:function(){return(this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+this.getScrollOffset())+"px"},renderHeaders:function(){var k=this.cm,f=this.templates,d=f.hcell,b=[],g=[],a={},e=k.getColumnCount(),l=e-1;for(var c=0;c<e;c++){a.id=k.getColumnId(c);a.value=k.getColumnHeader(c)||"";a.style=this.getColumnStyle(c,true);a.tooltip=this.getColumnTooltip(c);a.css=(c===0?"x-grid3-cell-first ":(c==l?"x-grid3-cell-last ":""))+(k.config[c].headerCls?" "+k.config[c].headerCls:"");if(k.config[c].align=="right"){a.istyle="padding-right:16px"}else{delete a.istyle}if(k.isLocked(c)){g[g.length]=d.apply(a)}else{b[b.length]=d.apply(a)}}return[f.header.apply({cells:b.join(""),tstyle:"width:"+this.getTotalWidth()+";"}),f.header.apply({cells:g.join(""),tstyle:"width:"+this.getLockedWidth()+";"})]},updateHeaders:function(){var b=this.renderHeaders();this.innerHd.firstChild.innerHTML=b[0];this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth();this.lockedInnerHd.firstChild.innerHTML=b[1];var a=this.getLockedWidth();this.lockedInnerHd.firstChild.style.width=a;this.lockedInnerHd.firstChild.firstChild.style.width=a},getResolvedXY:function(a){if(!a){return null}var d=a.cell,b=a.row;return d?Ext.fly(d).getXY():[this.scroller.getX(),Ext.fly(b).getY()]},syncFocusEl:function(c,a,b){Ext.ux.grid.LockingGridView.superclass.syncFocusEl.call(this,c,a,a<this.cm.getLockedCount()?false:b)},ensureVisible:function(c,a,b){return Ext.ux.grid.LockingGridView.superclass.ensureVisible.call(this,c,a,a<this.cm.getLockedCount()?false:b)},insertRows:function(a,g,d,f){var c=a.getCount()-1;if(!f&&g===0&&d>=c){this.refresh()}else{if(!f){this.fireEvent("beforerowsinserted",this,g,d)}var b=this.renderRows(g,d),e=this.getRow(g);if(e){if(g===0){this.removeRowClass(0,this.firstRowCls)}Ext.DomHelper.insertHtml("beforeBegin",e,b[0]);e=this.getLockedRow(g);Ext.DomHelper.insertHtml("beforeBegin",e,b[1])}else{this.removeRowClass(c-1,this.lastRowCls);Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,b[0]);Ext.DomHelper.insertHtml("beforeEnd",this.lockedBody.dom,b[1])}if(!f){this.fireEvent("rowsinserted",this,g,d);this.processRows(g)}else{if(g===0||g>=c){this.addRowClass(g,g===0?this.firstRowCls:this.lastRowCls)}}}this.syncFocusEl(g)},getColumnStyle:function(a,c){var b=!c?this.cm.config[a].cellStyle||this.cm.config[a].css||"":this.cm.config[a].headerStyle||"";b+="width:"+this.getColumnWidth(a)+";";if(this.cm.isHidden(a)){b+="display:none;"}var d=this.cm.config[a].align;if(d){b+="text-align:"+d+";"}return b},getLockedWidth:function(){return this.cm.getTotalLockedWidth()+"px"},getTotalWidth:function(){return(this.cm.getTotalWidth()-this.cm.getTotalLockedWidth())+"px"},getColumnData:function(){var d=[],a=this.cm,e=a.getColumnCount();for(var c=0;c<e;c++){var b=a.getDataIndex(c);d[c]={name:(!Ext.isDefined(b)?this.ds.fields.get(c).name:b),renderer:a.getRenderer(c),scope:a.getRendererScope(c),id:a.getColumnId(c),style:this.getColumnStyle(c),locked:a.isLocked(c)}}return d},renderBody:function(){var a=this.renderRows()||["&#160;","&#160;"];return[this.templates.body.apply({rows:a[0]}),this.templates.body.apply({rows:a[1]})]},refreshRow:function(c){var g=this.ds,u=this.cm.getColumnCount(),b=this.getColumnData(),n=u-1,a=["x-grid3-row"],m={tstyle:String.format("width: {0};",this.getTotalWidth())},l={tstyle:String.format("width: {0};",this.getLockedWidth())},f=[],e=[],r=this.templates.cell,q,k,p,d,t,s,v;if(Ext.isNumber(c)){q=c;c=g.getAt(q)}else{q=g.indexOf(c)}if(!c||q<0){return}for(v=0;v<u;v++){d=b[v];if(v==0){s="x-grid3-cell-first"}else{s=(v==n)?"x-grid3-cell-last ":""}t={id:d.id,style:d.style,css:s,attr:"",cellAttr:""};t.value=d.renderer.call(d.scope,c.data[d.name],t,c,q,v,g);if(Ext.isEmpty(t.value)){t.value=" "}if(this.markDirty&&c.dirty&&typeof c.modified[d.name]!="undefined"){t.css+=" x-grid3-dirty-cell"}if(d.locked){e[v]=r.apply(t)}else{f[v]=r.apply(t)}}k=this.getRow(q);k.className="";p=this.getLockedRow(q);p.className="";if(this.grid.stripeRows&&((q+1)%2===0)){a.push("x-grid3-row-alt")}if(this.getRowClass){m.cols=u;a.push(this.getRowClass(c,q,m,g))}this.fly(k).addClass(a).setStyle(m.tstyle);m.cells=f.join("");k.innerHTML=this.templates.rowInner.apply(m);this.fly(p).addClass(a).setStyle(l.tstyle);l.cells=e.join("");p.innerHTML=this.templates.rowInner.apply(l);p.rowIndex=q;this.syncRowHeights(k,p);this.fireEvent("rowupdated",this,q,c)},refresh:function(b){this.fireEvent("beforerefresh",this);this.grid.stopEditing(true);var a=this.renderBody();this.mainBody.update(a[0]).setWidth(this.getTotalWidth());this.lockedBody.update(a[1]).setWidth(this.getLockedWidth());if(b===true){this.updateHeaders();this.updateHeaderSortState()}this.processRows(0,true);this.layout();this.applyEmptyText();this.fireEvent("refresh",this)},onDenyColumnLock:function(){},initData:function(b,a){if(this.cm){this.cm.un("columnlockchange",this.onColumnLock,this)}Ext.ux.grid.LockingGridView.superclass.initData.call(this,b,a);if(this.cm){this.cm.on("columnlockchange",this.onColumnLock,this)}},onColumnLock:function(){this.refresh(true)},handleHdMenuClick:function(d){var b=this.hdCtxIndex,a=this.cm,e=d.getItemId(),c=a.getLockedCount();switch(e){case"lock":if(a.getColumnCount(true)<=c+1){this.onDenyColumnLock();return undefined}a.setLocked(b,true,c!=b);if(c!=b){a.moveColumn(b,c);this.grid.fireEvent("columnmove",b,c)}break;case"unlock":if(c-1!=b){a.setLocked(b,false,true);a.moveColumn(b,c-1);this.grid.fireEvent("columnmove",b,c-1)}else{a.setLocked(b,false)}break;case"help":a.showHelp(b);break;default:return Ext.ux.grid.LockingGridView.superclass.handleHdMenuClick.call(this,d)}return true},handleHdDown:function(g,d){Ext.ux.grid.LockingGridView.superclass.handleHdDown.call(this,g,d);if(this.grid.enableColLock!==false){if(Ext.fly(d).hasClass("x-grid3-hd-btn")){var f=this.findHeaderCell(d),c=this.getCellIndex(f),b=this.hmenu.items,a=this.cm;b.get("lock").setDisabled(a.isLocked(c));b.get("unlock").setDisabled(!a.isLocked(c));b.get("help").setDisabled(a.isHelp(c))}}},syncHeaderHeight:function(){var d=Ext.fly(this.innerHd).child("tr",true),b=Ext.fly(this.lockedInnerHd).child("tr",true);d.style.height="auto";b.style.height="auto";var e=d.offsetHeight,c=b.offsetHeight,a=Math.max(c,e)+"px";d.style.height=a;b.style.height=a},updateLockedWidth:function(){var g=this.cm.getTotalLockedWidth(),a=this.cm.getTotalWidth()-g,c=this.grid.getGridEl().getSize(true),b=Ext.isBorderBox?0:this.lockedBorderWidth,d=Ext.isBorderBox?0:this.rowBorderWidth,e=Math.max(c.width-g-b-d,0)+"px",f=this.getScrollOffset();if(!this.grid.autoHeight){var k=Math.max(c.height-this.mainHd.getHeight(),0)+"px";this.lockedScroller.dom.style.height=k;this.scroller.dom.style.height=k}this.lockedWrap.dom.style.width=(g+d)+"px";this.scroller.dom.style.width=e;this.mainWrap.dom.style.left=(g+b+d)+"px";if(this.innerHd){this.lockedInnerHd.firstChild.style.width=g+"px";this.lockedInnerHd.firstChild.firstChild.style.width=g+"px";this.innerHd.style.width=e;this.innerHd.firstChild.style.width=(a+d+f)+"px";this.innerHd.firstChild.firstChild.style.width=a+"px"}if(this.mainBody){this.lockedBody.dom.style.width=(g+d)+"px";this.mainBody.dom.style.width=(a+d)+"px"}},getLockedBody:function(){return this.lockedBody}});Ext.ux.grid.LockingColumnModel=Ext.extend(Ext.grid.ColumnModel,{isHelp:function(a){return Ext.isEmpty(this.config[a].helpUrl)},showHelp:function(a){showHelp(this.config[a].helpUrl)},isLocked:function(a){return this.config[a].locked===true},setLocked:function(b,c,a){if(this.isLocked(b)==c){return}this.config[b].locked=c;if(!a){this.fireEvent("columnlockchange",this,b,c)}},getTotalLockedWidth:function(){var b=0;for(var c=0,a=this.config.length;c<a;c++){if(this.isLocked(c)&&!this.isHidden(c)){b+=this.getColumnWidth(c)}}return b},getLockedCount:function(){var a=this.config.length;for(var b=0;b<a;b++){if(!this.isLocked(b)){return b}}return a},moveColumn:function(d,c){var a=this.isLocked(d),b=this.isLocked(c);if(d<c&&a&&!b){this.setLocked(d,false,true)}else{if(d>c&&!a&&b){this.setLocked(d,true,true)}}Ext.ux.grid.LockingColumnModel.superclass.moveColumn.apply(this,arguments)}});Ext.namespace("Ext.ux");Ext.ux.NotificationMgr={positions:[]};Ext.ux.Notification=Ext.extend(Ext.Window,{initComponent:function(){Ext.apply(this,{iconCls:this.iconCls||"x-icon-information",cls:"x-notification",width:200,autoHeight:true,plain:false,draggable:false,shadow:false,bodyStyle:"text-align:center"});if(this.autoDestroy){this.task=new Ext.util.DelayedTask(this.hide,this)}else{this.closable=true}Ext.ux.Notification.superclass.initComponent.apply(this)},setMessage:function(a){this.body.update(a)},setTitle:function(b,a){Ext.ux.Notification.superclass.setTitle.call(this,b,a||this.iconCls)},onDestroy:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);Ext.ux.Notification.superclass.onDestroy.call(this)},cancelHiding:function(){this.addClass("fixed");if(this.autoDestroy){this.task.cancel()}},afterShow:function(){Ext.ux.Notification.superclass.afterShow.call(this);Ext.fly(this.body.dom).on("click",this.cancelHiding,this);if(this.autoDestroy){this.task.delay(this.hideDelay||5000)}},animShow:function(){this.pos=0;while(Ext.ux.NotificationMgr.positions.indexOf(this.pos)>-1){this.pos++}Ext.ux.NotificationMgr.positions.push(this.pos);this.setSize(200,100);this.el.alignTo(document,"br-br",[-20,-140-((this.getSize().height+10)*this.pos)]);this.el.slideIn("b",{duration:1,callback:this.afterShow,scope:this})},animHide:function(){this.el.ghost("b",{duration:1,remove:false,callback:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);this.destroy()}.createDelegate(this)})},focus:Ext.emptyFn});Ext.ns("Ext.ux.form");Ext.ux.form.MultiSelect=Ext.extend(Ext.form.Field,{ddReorder:false,appendOnly:false,width:100,height:100,displayField:0,valueField:1,allowBlank:true,minSelections:0,maxSelections:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minSelectionsText:"Minimum {0} item(s) required",maxSelectionsText:"Maximum {0} item(s) allowed",delimiter:",",defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.form.MultiSelect.superclass.initComponent.call(this);if(Ext.isArray(this.store)){if(Ext.isArray(this.store[0])){this.store=new Ext.data.ArrayStore({fields:["value","text"],data:this.store});this.valueField="value"}else{this.store=new Ext.data.ArrayStore({fields:["text"],data:this.store,expandData:true});this.valueField="text"}this.displayField="text"}else{this.store=Ext.StoreMgr.lookup(this.store);this.displayField=this.store.displayField;this.valueField=this.store.valueField}this.addEvents({dblclick:true,click:true,change:true,drop:true})},onRender:function(c,b){Ext.ux.form.MultiSelect.superclass.onRender.call(this,c,b);var a=this.fs=new Ext.form.FieldSet({renderTo:this.el,title:this.legend,height:this.height-20,width:this.width,style:"padding:0;",tbar:this.tbar});a.body.addClass("ux-mselect");this.view=new Ext.ListView({multiSelect:true,store:this.store,columns:[{header:"Value",width:1,dataIndex:this.displayField}],hideHeaders:true});a.add(this.view);this.view.on("click",this.onViewClick,this);this.view.on("beforeclick",this.onViewBeforeClick,this);this.view.on("dblclick",this.onViewDblClick,this);this.hiddenName=this.name||Ext.id();var d={tag:"input",type:"hidden",value:"",name:this.hiddenName};this.hiddenField=this.el.createChild(d);this.hiddenField.dom.disabled=this.hiddenName!=this.name;a.doLayout()},afterRender:function(){Ext.ux.form.MultiSelect.superclass.afterRender.call(this);if(this.ddReorder&&!this.dragGroup&&!this.dropGroup){this.dragGroup=this.dropGroup="MultiselectDD-"+Ext.id()}if(this.draggable||this.dragGroup){this.dragZone=new Ext.ux.form.MultiSelect.DragZone(this,{ddGroup:this.dragGroup})}if(this.droppable||this.dropGroup){this.dropZone=new Ext.ux.form.MultiSelect.DropZone(this,{ddGroup:this.dropGroup})}if(this.values){this.setValue(this.values)}},onViewClick:function(c,a,b,d){this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);this.hiddenField.dom.value=this.getValue();this.fireEvent("click",this,d);this.validate()},onViewBeforeClick:function(c,a,b,d){if(this.disabled||this.readOnly){return false}},onViewDblClick:function(c,a,b,d){return this.fireEvent("dblclick",c,a,b,d)},getValue:function(a){var e=[];var d=this.view.getSelectedIndexes();if(d.length==0){return""}for(var b=0;b<d.length;b++){var c=this.store.getAt(d[b]).get((a!=null)?a:this.valueField);if(Ext.isString(c)){c=c}e.push(c)}return e.join(this.delimiter)},setValue:function(a){var b;var d=[];this.view.clearSelections();this.hiddenField.dom.value="";if(!a||(a=="")){return}if(!Ext.isArray(a)){a=a.split(this.delimiter)}for(var c=0;c<a.length;c++){b=this.view.store.indexOf(this.view.store.query(this.valueField,new RegExp("^"+a[c]+"$","i")).itemAt(0));d.push(b)}this.view.select(d);this.hiddenField.dom.value=this.getValue();this.validate()},reset:function(){this.setValue("")},getRawValue:function(a){var b=this.getValue(a);if(b.length){b=b.split(this.delimiter)}else{b=[]}return b},setRawValue:function(a){setValue(a)},validateValue:function(a){if(a.length<1){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(a.length<this.minSelections){this.markInvalid(String.format(this.minSelectionsText,this.minSelections));return false}if(a.length>this.maxSelections){this.markInvalid(String.format(this.maxSelectionsText,this.maxSelections));return false}return true},disable:function(){this.disabled=true;if(!Ext.isEmpty(this.hiddenField)){this.hiddenField.dom.disabled=true}if(!Ext.isEmpty(this.fs)){this.fs.disable()}},enable:function(){this.disabled=false;this.hiddenField.dom.disabled=false;this.fs.enable()},destroy:function(){Ext.destroy(this.fs,this.dragZone,this.dropZone);Ext.ux.form.MultiSelect.superclass.destroy.call(this)}});Ext.reg("multiselect",Ext.ux.form.MultiSelect);Ext.ux.Multiselect=Ext.ux.form.MultiSelect;Ext.ux.form.MultiSelect.DragZone=function(d,c){this.ms=d;this.view=d.view;var b=c.ddGroup||"MultiselectDD";var a;if(Ext.isArray(b)){a=b.shift()}else{a=b;b=null}Ext.ux.form.MultiSelect.DragZone.superclass.constructor.call(this,this.ms.fs.body,{containerScroll:true,ddGroup:a});this.setDraggable(b)};Ext.extend(Ext.ux.form.MultiSelect.DragZone,Ext.dd.DragZone,{onInitDrag:function(a,c){var b=Ext.get(this.dragData.ddel.cloneNode(true));this.proxy.update(b.dom);b.setWidth(b.child("em").getWidth());this.onStartDrag(a,c);return true},collectSelection:function(b){b.repairXY=Ext.fly(this.view.getSelectedNodes()[0]).getXY();var a=0;this.view.store.each(function(d){if(this.view.isSelected(a)){var e=this.view.getNode(a);var c=e.cloneNode(true);c.id=Ext.id();b.ddel.appendChild(c);b.records.push(this.view.store.getAt(a));b.viewNodes.push(e)}a++},this)},onEndDrag:function(a,b){var c=Ext.get(this.dragData.ddel);if(c&&c.hasClass("multi-proxy")){c.remove()}},getDragData:function(d){var c=this.view.findItemFromChild(d.getTarget());if(c){if(!this.view.isSelected(c)&&!d.ctrlKey&&!d.shiftKey){this.view.select(c);this.ms.setValue(this.ms.getValue())}if(this.view.getSelectionCount()==0||d.ctrlKey||d.shiftKey){return false}var b={sourceView:this.view,viewNodes:[],records:[]};if(this.view.getSelectionCount()==1){var a=this.view.getSelectedIndexes()[0];var f=this.view.getNode(a);b.viewNodes.push(b.ddel=f);b.records.push(this.view.store.getAt(a));b.repairXY=Ext.fly(f).getXY()}else{b.ddel=document.createElement("div");b.ddel.className="multi-proxy";this.collectSelection(b)}return b}return false},getRepairXY:function(a){return this.dragData.repairXY},setDraggable:function(a){if(!a){return}if(Ext.isArray(a)){Ext.each(a,this.setDraggable,this);return}this.addToGroup(a)}});Ext.ux.form.MultiSelect.DropZone=function(d,c){this.ms=d;this.view=d.view;var b=c.ddGroup||"MultiselectDD";var a;if(Ext.isArray(b)){a=b.shift()}else{a=b;b=null}Ext.ux.form.MultiSelect.DropZone.superclass.constructor.call(this,this.ms.fs.body,{containerScroll:true,ddGroup:a});this.setDroppable(b)};Ext.extend(Ext.ux.form.MultiSelect.DropZone,Ext.dd.DropZone,{getTargetFromEvent:function(b){var a=b.getTarget();return a},getDropPoint:function(g,m,d){if(m==this.ms.fs.body.dom){return"below"}var f=Ext.lib.Dom.getY(m),a=f+m.offsetHeight;var l=f+(a-f)/2;var k=Ext.lib.Event.getPageY(g);if(k<=l){return"above"}else{return"below"}},isValidDropPoint:function(b,e,a){if(!a.viewNodes||(a.viewNodes.length!=1)){return true}var c=a.viewNodes[0];if(c==e){return false}if((b=="below")&&(e.nextSibling==c)){return false}if((b=="above")&&(e.previousSibling==c)){return false}return true},onNodeEnter:function(d,a,c,b){return false},onNodeOver:function(k,a,g,d){var b=this.dropNotAllowed;var f=this.getDropPoint(g,k,a);if(this.isValidDropPoint(f,k,d)){if(this.ms.appendOnly){return"x-tree-drop-ok-below"}if(f){var c;if(f=="above"){b=k.previousSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-above";c="x-view-drag-insert-above"}else{b=k.nextSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-below";c="x-view-drag-insert-below"}if(this.lastInsertClass!=c){Ext.fly(k).replaceClass(this.lastInsertClass,c);this.lastInsertClass=c}}}return b},onNodeOut:function(d,a,c,b){this.removeDropIndicators(d)},onNodeDrop:function(b,l,k,f){if(this.ms.fireEvent("drop",this,b,l,k,f)===false){return false}var m=this.getDropPoint(k,b,l);if(b!=this.ms.fs.body.dom){b=this.view.findItemFromChild(b)}if(this.ms.appendOnly){insertAt=this.view.store.getCount()}else{insertAt=b==this.ms.fs.body.dom?this.view.store.getCount()-1:this.view.indexOf(b);if(m=="below"){insertAt++}}var c=false;if(f.sourceView==this.view){if(m=="below"){if(f.viewNodes[0]==b){f.viewNodes.shift()}}else{if(f.viewNodes[f.viewNodes.length-1]==b){f.viewNodes.pop()}}if(!f.viewNodes.length){return false}if(insertAt>this.view.store.indexOf(f.records[0])){c="down";insertAt--}}for(var g=0;g<f.records.length;g++){var a=f.records[g];if(f.sourceView){f.sourceView.store.remove(a)}this.view.store.insert(c=="down"?insertAt:insertAt++,a);var d=this.view.store.sortInfo;if(d){this.view.store.sort(d.field,d.direction)}}return true},removeDropIndicators:function(a){if(a){Ext.fly(a).removeClass(["x-view-drag-insert-above","x-view-drag-insert-left","x-view-drag-insert-right","x-view-drag-insert-below"]);this.lastInsertClass="_noclass"}},setDroppable:function(a){if(!a){return}if(Ext.isArray(a)){Ext.each(a,this.setDroppable,this);return}this.addToGroup(a)}});Ext.ns("sitools.common.forms");sitools.common.forms.formParameterToComponent=function(parameter,dataUrl,formId,datasetCm,context,form){var valuesToSelect=null;this.component=null;var value,values,items,i,component,defaultValues,existsWidgetForParameterCode,selectedValue,minValue,maxValue,disabledDates;var constructor=eval(parameter.jsUserObject);component=new constructor({parameterId:parameter.id,values:Ext.isArray(parameter.values)?parameter.values:[],code:parameter.code,type:parameter.type,label:parameter.label,height:parameter.height,widthBox:parameter.width,valueSelection:parameter.valueSelection,parentParam:parameter.parentParam,dataUrl:dataUrl,autoComplete:parameter.autoComplete,formId:formId,dimensionId:parameter.dimensionId,unit:parameter.unit,css:parameter.css,defaultValues:parameter.defaultValues,extraParams:parameter.extraParams,datasetCm:datasetCm,context:context,form:form,});return{parameter:parameter,component:component}};Ext.namespace("sitools.common.forms");sitools.common.forms.DatasetContext=function(){this.context="dataset";this.getRefUnit=function(b){var c=b.code[0];if(Ext.isEmpty(b.datasetCm)){return}var a;Ext.each(b.datasetCm,function(d){if(d.columnAlias==c){a=d.unit}});return a}};Ext.namespace("sitools.common.forms");sitools.common.forms.ProjectContext=function(){this.context="project";this.getRefUnit=function(a){return a.unit}};Ext.namespace("sitools.common.forms");sitools.common.forms.ComponentFactory=function(a){if(a=="dataset"){return new sitools.common.forms.DatasetContext()}if(a=="project"){return new sitools.common.forms.ProjectContext()}};Ext.ns("sitools.common.forms");sitools.common.forms.AbstractWithUnit=Ext.extend(Ext.Container,{dimensionId:null,userUnit:null,userDimension:null,initComponent:function(){this.userDimension=this.dimensionId;this.userUnit=this.unit;this.storeUnits=new Ext.data.JsonStore({id:"storeUnitSelect",root:"dimension.units",idProperty:"id",fields:[{name:"unitName",type:"string"},{name:"label",type:"string"}]});sitools.common.forms.AbstractWithUnit.superclass.initComponent.call(this)},loadUnits:function(a){if(!this.unitsLoaded){this.storeUnits.removeAll();Ext.Ajax.request({method:"GET",url:loadUrl.get("APP_URL")+loadUrl.get("APP_DIMENSIONS_ADMIN_URL")+"/dimension/"+this.dimensionId,scope:this,success:function(d){var b=Ext.decode(d.responseText);if(!b.success){Ext.Msg.alert(i18n.get("label.warning"),b.message);return}var c=b.dimension.sitoolsUnits;this.dimensionName=b.dimension.name;for(var e=0;e<c.length;e++){this.storeUnits.add(new Ext.data.Record(c[e]))}},failure:alertFailure,callback:function(){this.unitsLoaded=true;this.showWinUnits(a)}})}else{this.showWinUnits(a)}},showWinUnits:function(c){var b=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.name"),dataIndex:"label",width:100}],defaults:{sortable:true,width:100}});var d=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridUnits=new Ext.grid.GridPanel({autoScroll:true,store:this.storeUnits,cm:b,sm:d,layout:"fit",listeners:{scope:this,rowClick:function(e,f){this.onValidateUnits()}}});var a=new Ext.Window({layout:"fit",width:200,title:i18n.get("title.unitList"),modal:true,height:300,items:[this.gridUnits],buttons:[{text:i18n.get("label.ok"),handler:this.onValidateUnits,scope:this},{text:i18n.get("label.cancel"),scope:a,handler:function(){this.ownerCt.ownerCt.close()}}]});a.show();a.setPosition(c.getXY()[0],c.getXY()[1])},onValidateUnits:function(){var b=this.gridUnits.getSelectionModel().getSelected();if(Ext.isEmpty(b)){Ext.Msg.alert(i18n.get("label.error"),i18n.get("label.noSelection"));return}this.userUnit=b.data;this.userDimension=this.dimensionName;var a=this.getEl().query("button")[0];if(!Ext.isEmpty(a)){this.getEl().query("button")[0].update(b.get("label"))}this.gridUnits.ownerCt.close()},getUnitComponent:function(){var b=this.context.getRefUnit(this);if(!Ext.isEmpty(this.dimensionId)){var a=new Ext.Button({scope:this,text:Ext.isEmpty(b)?"    ":b.label,width:90,handler:function(c,d){this.loadUnits(d)}});unit=new Ext.Container({layout:"hbox",layoutConfig:{pack:"center",align:"middle"},margins:{top:0,right:0,bottom:0,left:10},width:100,items:[a]})}else{if(!Ext.isEmpty(b)){unit=new Ext.Container({html:b.label,margins:{top:0,right:0,bottom:0,left:10},flex:1})}else{unit=null}}return unit}});Ext.ns("Ext.ux.grid");Ext.ux.grid.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:true,header:"",width:20,sortable:false,fixed:true,hideable:false,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,constructor:function(a){Ext.apply(this,a);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.ux.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.state={};this.bodyContent={}},getRowClass:function(a,e,d,c){d.cols=d.cols-1;var b=this.bodyContent[a.id];if(!b&&!this.lazyRender){b=this.getBodyContent(a,e)}if(b){d.body=b}return this.state[a.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on("render",this.onRender,this);b.on("destroy",this.onDestroy,this)},onRender:function(){var a=this.grid;var b=a.getView().mainBody;b.on("mousedown",this.onMouseDown,this,{delegate:".x-grid3-row-expander"});if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{enter:this.onEnter,scope:this})}if(this.expandOnDblClick){a.on("rowdblclick",this.onRowDblClick,this)}},onDestroy:function(){if(this.keyNav){this.keyNav.disable();delete this.keyNav}var a=this.grid.getView().mainBody;if(a){a.un("mousedown",this.onMouseDown,this)}},onRowDblClick:function(a,b,c){this.toggleRow(b)},onEnter:function(k){var f=this.grid;var l=f.getSelectionModel();var b=l.getSelections();for(var c=0,a=b.length;c<a;c++){var d=f.getStore().indexOf(b[c]);this.toggleRow(d)}},getBodyContent:function(a,b){if(!this.enableCaching){return this.tpl.apply(a.data)}var c=this.bodyContent[a.id];if(!c){c=this.tpl.apply(a.data);this.bodyContent[a.id]=c}return c},onMouseDown:function(b,a){b.stopEvent();var c=b.getTarget(".x-grid3-row");this.toggleRow(c)},renderer:function(b,c,a){c.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>'},beforeExpand:function(b,a,c){if(this.fireEvent("beforeexpand",this,b,a,c)!==false){if(this.tpl&&this.lazyRender){a.innerHTML=this.getBodyContent(b,c)}return true}else{return false}},toggleRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a)}this[Ext.fly(a).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](a)},expandRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",c);if(this.beforeExpand(b,a,c.rowIndex)){this.state[b.id]=true;Ext.fly(c).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,b,a,c.rowIndex)}},collapseRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.fly(c).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforecollapse",this,b,a,c.rowIndex)!==false){this.state[b.id]=false;Ext.fly(c).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,b,a,c.rowIndex)}}});Ext.preg("rowexpander",Ext.ux.grid.RowExpander);Ext.grid.RowExpander=Ext.ux.grid.RowExpander;Ext.namespace("sitools.widget");sitools.widget.Box=Ext.extend(Ext.Panel,{width:"98%",frame:true,baseCls:"x-box",cls:"x-box-blue module-root centering",_title:"",constructor:function(a){sitools.widget.Box.superclass.constructor.call(this,Ext.apply({_title:a.label,_idItem:a.idItem},a))},initComponent:function(){this.items.unshift({xtype:"component",html:this._title,cls:"subtitle icon-"+this.idItem});sitools.widget.Box.superclass.initComponent.call(this)}});Ext.reg("s-box",sitools.widget.Box);sitools.widget.JsonStore=Ext.extend(Ext.data.JsonStore,{dirty:false,_setDirty:function(a){this.dirty=a},_getDirty:function(){return this.dirty},add:function(a){this.dirty=true;sitools.widget.JsonStore.superclass.add.call(this,a)},remove:function(a){this.dirty=true;sitools.widget.JsonStore.superclass.remove.call(this,a)}});sitools.widget.menuButton=Ext.extend(Ext.Button,{constructor:function(a){a=Ext.apply({iconCls:"menu-button"},a);sitools.widget.menuButton.superclass.constructor.call(this,a)}});Ext.reg("s-menuButton",sitools.widget.menuButton);sitools.widget.templateTreeNode=function(a){var c;if(a.tpl===undefined){c=new Ext.Template("<div >{text}<b>{nbRecords} records</b><img src='{urlImage}'></img><a style='text-align:right' href='{urlReadme}'>readme</a></div>")}else{c=a.tpl}a.text=c.apply(a);a.leaf=false;var b=Ext.apply({children:[]},a);sitools.widget.templateTreeNode.superclass.constructor.call(this,b)};Ext.extend(sitools.widget.templateTreeNode,Ext.tree.AsyncTreeNode,{});Ext.tree.TreePanel.nodeTypes.templateTreeNode=sitools.widget.templateTreeNode;sitools.widget.GridSorterToolbar=Ext.extend(Ext.Toolbar,{initComponent:function(){sitools.widget.GridSorterToolbar.superclass.initComponent.call(this);this.add("->",new sitools.widget.GridTop({gridId:this.gridId}),new sitools.widget.GridUp({gridId:this.gridId}),new sitools.widget.GridDown({gridId:this.gridId}),new sitools.widget.GridBottom({gridId:this.gridId}))}});Ext.reg("sitools.widget.GridSorterToolbar",sitools.widget.GridSorterToolbar);sitools.widget.ViolationRowExpander=Ext.extend(Ext.ux.grid.RowExpander,{getRowClass:function(b,e,f,d){var a=sitools.widget.ViolationRowExpander.superclass.getRowClass.call(this,b,e,f,d);var c=b.get("violation");if(!Ext.isEmpty(c)){if(c.level=="CRITICAL"){a+=" red-row"}else{if(c.level=="WARNING"){a+=" orange-row"}}}return a}});Ext.reg("sitools.widget.ViolationRowExpander",sitools.widget.ViolationRowExpander);sitools.widget.colorField=Ext.extend(Ext.form.TriggerField,{onTriggerClick:function(b){var a=new Ext.menu.ColorMenu({scope:this,handler:function(c,d){this.setValue("#"+d);this.setFontColor("#"+d);this.fireEvent("select",this,d)}});a.showAt(b.getXY())},setFontColor:function(b){var a=function(e){return parseInt(e,16)};var c=[a(b.slice(1,3)),a(b.slice(3,5)),a(b.slice(5))];var d=(c[0]+c[1]+c[2])/3;this.el.setStyle({color:(d>128)?"#000":"#FFF","background-color":b,"background-image":"none"})},listeners:{afterrender:function(a){a.setFontColor(a.getValue())}}});sitools.widget.DateFieldWithToday=Ext.extend(Ext.form.DateField,{regToday:new RegExp("^{\\$TODAY}"),invalidTextWithToday:"Impossible to make a date with {0}. A valid example is {$TODAY} + 1",parseDate:function(f){if(!f||Ext.isDate(f)){return f}if(this.regToday.test(f)){return f}var b=this.safeParse(f,this.format),c=this.altFormats,e=this.altFormatsArray;if(!b&&c){e=e||c.split("|");for(var d=0,a=e.length;d<a&&!b;d++){b=this.safeParse(f,e[d])}}return b},getErrors:function(f){var k=Ext.form.DateField.superclass.getErrors.apply(this,arguments);f=this.formatDate(f||this.processValue(this.getRawValue()));if(f.length<1){return k}var c=f;var g=false;if(this.regToday.test(f)){try{f=sitools.common.utils.Date.stringWithTodayToDate(f);if(!sitools.common.utils.Date.isValidDate(f)){throw""}}catch(e){k.push(String.format(this.invalidTextWithToday,c));return k}}else{f=this.parseDate(f)}if(!f){k.push(String.format(this.invalidText,c,this.format));return k}g=f.getTime();if(this.minValue&&g<this.minValue.clearTime().getTime()){k.push(String.format(this.minText,this.formatDate(this.minValue)))}if(this.maxValue&&g>this.maxValue.clearTime().getTime()){k.push(String.format(this.maxText,this.formatDate(this.maxValue)))}if(this.disabledDays){var a=f.getDay();for(var b=0;b<this.disabledDays.length;b++){if(a===this.disabledDays[b]){k.push(this.disabledDaysText);break}}}var d=this.formatDate(f);if(this.disabledDatesRE&&this.disabledDatesRE.test(d)){k.push(String.format(this.disabledDatesText,d))}return k},setValue:function(a){if(this.regToday.test(a)){return Ext.form.DateField.superclass.setValue.call(this,a)}else{return Ext.form.DateField.superclass.setValue.call(this,this.formatDate(this.parseDate(a)))}}});sitools.widget.rootTreeLoader=Ext.extend(Ext.tree.TreeLoader,{createNode:function(a){if(Ext.isEmpty(a.children)){a.leaf=true}return Ext.tree.TreeLoader.prototype.createNode.call(this,a)},processResponse:function(c,b,l,m){var n=c.responseText,a,k,d=0,f;try{if(!(a=c.responseData)){a=Ext.decode(n);if(this.root){if(!this.getRoot){this.getRoot=Ext.data.JsonReader.prototype.createAccessor(this.root)}a=this.getRoot(a)}}b.beginUpdate();for(f=a.length;d<f;d++){k=this.createNode(a[d]);if(k){b.appendChild(k)}}b.endUpdate();this.runCallback(l,m||b,[b])}catch(g){this.handleFailure(c)}},setUrl:function(a){this.url=a}});function utils_logout(a){if(Ext.isEmpty(a)){a=true}Ext.util.Cookies.set("userLogin","");Ext.util.Cookies.clear("userLogin");Ext.util.Cookies.set("hashCode","");Ext.Ajax.defaultHeaders.Authorization="";if(a){window.location.reload()}}var ImageChooser=function(a){this.config=a};ImageChooser.prototype={lookup:{},show:function(c,f){if(!this.win){this.initTemplates();this.store=new Ext.data.JsonStore({url:this.config.url,root:"items",fields:["name","url",{name:"size",type:"float"},{name:"lastmod",type:"date",dateFormat:"timestamp"}],listeners:{scope:this,load:function(k,g,l){Ext.each(g,function(m){var n=new Reference(m.get("url"));var p=n.getFile();m.set("url",p)});this.view.select(0)}}});if(!Ext.isEmpty(this.config.urlToUpload)&&this.config.isDatastorage==true){this.store.addListener("exception",function(g){Ext.Ajax.request({url:this.config.urlToUpload,method:"PUT",success:function(k){},failure:alertFailure})},this)}this.store.load();var d=function(g){if(g.size<1024){return g.size+" bytes"}else{return(Math.round(((g.size*10)/1024))/10)+" KB"}};var e=function(g){g.shortName=g.name.ellipse(15);g.sizeString=d(g);g.dateString=new Date(g.lastmod).format("d/m/Y g:i a");this.lookup[g.name]=g;return g};this.view=new Ext.DataView({tpl:this.thumbTemplate,id:"imageChooserDataViewId",singleSelect:true,overClass:"x-view-over",itemSelector:"div.thumb-wrap",emptyText:'<div style="padding:10px;">No images match the specified filter</div>',store:this.store,listeners:{selectionchange:{fn:this.showDetails,scope:this,buffer:100},dblclick:{fn:this.doCallback,scope:this},loadexception:{fn:this.onLoadException,scope:this},beforeselect:{fn:function(g){return g.store.getRange().length>0}}},prepareData:e.createDelegate(this)});if(!Ext.isEmpty(b)){b.destroy()}var b=new Ext.FormPanel({fileUpload:true,frame:true,formId:"formUploadId",autoHeight:true,bodyStyle:"padding: 10px 10px 0 10px;",labelWidth:50,defaults:{anchor:"95%",allowBlank:false,msgTarget:"side"},items:[{xtype:"fileuploadfield",id:"form-file",fieldLabel:"Photo",name:"image",buttonText:"",buttonCfg:{iconCls:"upload-icon"}}],buttons:[{text:i18n.get("label.uploadFile"),scope:this,handler:function(){if(b.getForm().isValid()){var g;if(!Ext.isEmpty(this.config.urlToUpload)){g=this.config.urlToUpload}else{g=loadUrl.get("APP_URL")+"/upload/"}Ext.Ajax.request({url:g,form:"formUploadId",isUpload:true,waitMsg:"wait...",method:"POST",scope:this,success:function(k){new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.imageUploaded"),autoDestroy:true,hideDelay:1000,listeners:{scope:this,destroy:function(l){this.bringToFront(this.win)},show:function(l){this.bringToFront(this.win)}}}).show(document);Ext.getCmp("imageChooserDataViewId").refresh()},failure:function(k){Ext.Msg.alert(i18n.get("label.error"))},callback:function(){Ext.getCmp("imageChooserDataViewId").getStore().load();Ext.getCmp("imageChooserDataViewId").refresh()}})}}}]});var a={title:i18n.get("label.chooseImage"),id:"img-chooser-dlg",layout:"border",minWidth:500,minHeight:450,modal:true,border:false,items:[{id:"img-chooser-view",region:"center",autoScroll:true,items:this.view,tbar:[{text:i18n.get("label.filter")},{xtype:"textfield",id:"filter",selectOnFocus:true,width:100,listeners:{render:{fn:function(){Ext.getCmp("filter").getEl().on("keyup",function(){this.filter()},this,{buffer:500})},scope:this}}}," ","-",{text:i18n.get("label.sortBy")},{id:"sortSelect",xtype:"combo",typeAhead:true,triggerAction:"all",width:100,editable:false,mode:"local",displayField:"desc",valueField:"name",lazyInit:false,value:"name",store:new Ext.data.ArrayStore({fields:["name","desc"],data:[["name","Name"],["size","File Size"],["lastmod","Last Modified"]]}),listeners:{select:{fn:this.sortImages,scope:this}}}]},{id:"img-detail-panel",region:"east",split:true,width:150,minWidth:150,maxWidth:250},{id:"img-upload-panel",title:i18n.get("label.uploadFile"),region:"south",collapsible:true,autoHeight:true,items:[b]}],buttons:[{id:"ok-btn",text:"OK",handler:this.doCallback,scope:this},{text:"Cancel",handler:function(){this.win.close()},scope:this}],keys:{key:27,handler:function(){this.win.close()},scope:this},listeners:{scope:this,activate:function(g){this.bringToFront(g)},show:function(g){this.bringToFront(g)}}};Ext.apply(a,this.config);this.win=new Ext.Window(a)}this.reset();this.win.show(c);this.callback=f;this.animateTarget=c},initTemplates:function(){this.thumbTemplate=new Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap" id="{name}">','<div class="thumb"><img src="{[this.formatUrl(values.url)]}" height="96" width="96" title="{name}"></div>',"<span>{shortName}</span></div>","</tpl>",{formatUrl:function(a){var a=new Reference(a);return a.getFile()}});this.thumbTemplate.compile();this.detailsTemplate=new Ext.XTemplate('<div class="details">','<tpl for=".">','<img height="96" width="96" src="{url}"><div class="details-info">',"<b>Image Name:</b>","<span>{name}</span>","<b>Size:</b>","<span>{sizeString}</span>","<b>Last Modified:</b>","<span>{dateString}</span></div>","</tpl>","</div>");this.detailsTemplate.compile()},showDetails:function(){var b=this.view.getSelectedNodes();var c=Ext.getCmp("img-detail-panel").body;if(b&&b.length>0){b=b[0];Ext.getCmp("ok-btn").enable();var a=this.lookup[b.id];c.hide();this.detailsTemplate.overwrite(c,a);c.slideIn("l",{stopFx:true,duration:0.2})}else{Ext.getCmp("ok-btn").disable();c.update("")}},filter:function(){var a=Ext.getCmp("filter");this.view.store.filter("name",a.getValue());this.view.select(0)},sortImages:function(){var a=Ext.getCmp("sortSelect").getValue();this.view.store.sort(a,a=="name"?"asc":"desc");this.view.select(0)},reset:function(){if(this.win.rendered){Ext.getCmp("filter").reset();this.view.getEl().dom.scrollTop=0}this.view.store.clearFilter();this.view.select(0)},doCallback:function(){var c=this.view.getSelectedNodes()[0];var e=this.callback;var d=this.lookup;var a=this.config;if(c&&e){var b=d[c.id];e(b,a)}this.win.close()},onLoadException:function(a,b){this.view.getEl().update('<div style="padding:10px;">Error loading images.</div>')},bringToFront:function(a){if(a&&!Ext.isEmpty(a.zindex)&&a.isVisible()){a.focus();a.setZIndex(a.zindex)}}};String.prototype.ellipse=function(a){if(this.length>a){return this.substr(0,a-3)+"..."}return this};Ext.ns("Ext.ux.form");Ext.ux.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:"Browse...",buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Ext.ux.form.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected")},onRender:function(c,a){Ext.ux.form.FileUploadField.superclass.onRender.call(this,c,a);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.createFileInput();var b=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(b,{renderTo:this.wrap,cls:"x-form-file-btn"+(b.iconCls?" x-btn-icon":"")}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth())}this.bindListeners();this.resizeEl=this.positionEl=this.wrap},bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.button.addClass(["x-btn-over","x-btn-focus"])},mouseleave:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},mousedown:function(){this.button.addClass("x-btn-click")},mouseup:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},change:function(){var a=this.fileInput.dom.value;this.setValue(a);this.fireEvent("fileselected",this,a)}})},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1})},reset:function(){this.fileInput.remove();this.createFileInput();this.bindListeners();Ext.ux.form.FileUploadField.superclass.reset.call(this)},getFileInputId:function(){return this.id+"-file"},onResize:function(a,b){Ext.ux.form.FileUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);if(!this.buttonOnly){var a=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(a)}},onDestroy:function(){Ext.ux.form.FileUploadField.superclass.onDestroy.call(this);Ext.destroy(this.fileInput,this.button,this.wrap)},onDisable:function(){Ext.ux.form.FileUploadField.superclass.onDisable.call(this);this.doDisable(true)},onEnable:function(){Ext.ux.form.FileUploadField.superclass.onEnable.call(this);this.doDisable(false)},doDisable:function(a){this.fileInput.dom.disabled=a;this.button.setDisabled(a)},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])}});Ext.reg("fileuploadfield",Ext.ux.form.FileUploadField);Ext.form.FileUploadField=Ext.ux.form.FileUploadField;Ext.form.SitoolsSelectImage=Ext.extend(Ext.form.TriggerField,{onTriggerClick:function(){if(!this.disabled){function b(d,c){c.fieldUrl.setValue(d.url);c.fieldUrl.fireEvent("change",this,d.url,c.fieldUrl.startValue)}var a=new ImageChooser({url:loadUrl.get("APP_URL")+"/upload/?media=json",width:515,height:450,fieldUrl:this});a.show(document,b)}}});Ext.reg("sitoolsSelectImage",Ext.form.SitoolsSelectImage);var loginErrLength="Login minimum 4 character !";var loginErrUnique="Login already in use !";var loginSuccess="Login avaliable";var emailErrFormat="Email not valid !";var emailErrUnique="Email already in use !";var emailSuccess="Email valid & avaliable";Ext.apply(Ext.form.VTypes,{uniqueloginMask:/[a-z0-9_\.\-@\+]/i,uniquelogin:function(a){if(a.length<4){Ext.apply(Ext.form.VTypes,{uniqueloginText:loginErrLength});return false}else{return true}},uniqueloginText:loginErrUnique,uniqueemailMask:/[a-z0-9_\.\-@\+]/i,uniqueemail:function(b){var a=/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/;if(a.test(b)){return true}else{return false}},uniqueemailText:emailErrFormat,password:function(c,b){if(b.initialPassField){var a=Ext.getCmp(b.initialPassField);return(c==a.getValue())}return true},passwordText:"Passwords do not match",passwordlength:function(a){if(a.length<6||a.length>40){return false}else{return true}},passwordlengthText:"Invalid Password Length. It must be between 6 and 40"});function resetLoginValidator(a){Ext.apply(Ext.form.VTypes,{uniquelogin:function(b){if(b.length<4){Ext.apply(Ext.form.VTypes,{uniqueloginText:loginErrLength});return false}else{return true}}})}function resetEmailValidator(a){Ext.apply(Ext.form.VTypes,{uniqueemail:function(c){var b=/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/;if(b.test(c)){return true}else{return false}return(a)}})}Ext.namespace("sitools.component.version");sitools.component.version.sitoolsVersion=Ext.extend(Ext.Panel,{layout:"fit",initComponent:function(){this.versionUrl=loadUrl.get("APP_URL")+"/version";var e=new Ext.form.Label({html:"<h2>SITools2</h2><br/>"});var d=new Ext.form.Label({html:"<img src="+loadUrl.get("APP_URL")+"/res/images/logo_02_tailleMoyenne.png>"});this.credits=new Ext.form.Label({});var a=new Ext.form.Label({html:'<a href="http://www.sitools2.sourceforge.net">sitools2.sourceforge.net</>'});this.versionLabel=new Ext.form.Label({});this.buildDateLabel=new Ext.form.Label({});var b=new Ext.Panel({title:i18n.get("label.version"),layout:"fit",padding:10});var c=new Ext.ux.ManagedIFrame.Panel({title:i18n.get("label.licence"),layout:"fit",defaultSrc:loadUrl.get("APP_URL")+"/res/licences/gpl-3.0.txt"});b.add([d,e,this.versionLabel,this.buildDateLabel,this.credits,a]);this.tabs=new Ext.TabPanel({activeTab:0,items:[b,c]});this.items=[this.tabs];this.listeners={scope:this,resize:function(g){var f=g.body.getSize();this.tabs.setSize(f)}};sitools.component.version.sitoolsVersion.superclass.initComponent.call(this)},afterRender:function(){sitools.component.version.sitoolsVersion.superclass.afterRender.apply(this,arguments);Ext.Ajax.request({url:this.versionUrl,method:"GET",scope:this,success:function(c){var e=Ext.decode(c.responseText);if(!e.success){Ext.Msg.alert(i18n.get("label.warning"),e.message);return false}var f=e.info;var b=f.version;var g=f.buildDate;var d=f.copyright;this.versionLabel.setText("<h3>Version : "+b+"</h3>",false);this.buildDateLabel.setText("<h3>Build date : "+g+"</h3>",false);this.credits.setText(String.format("<p>{0}</p><br>",d),false)},failure:alertFailure});var a=this.ownerCt.body.getSize();this.tabs.setSize(a)}});function showVersion(){var a=Ext.getCmp("winVersionId");if(!a){var b=new sitools.component.version.sitoolsVersion();a=new Ext.Window({title:i18n.get("label.version"),id:"winVersionId",items:[b],modal:false,width:700,height:480,resizable:false,modal:true,buttons:[{text:i18n.get("label.close"),handler:function(){this.ownerCt.ownerCt.close()}}]});a.show()}else{a.show()}}Ext.SitoolsDatePicker=Ext.extend(Ext.BoxComponent,{todayText:"Today",okText:"&#160;OK&#160;",cancelText:"Cancel",todayTip:"{0} (Spacebar)",minText:"This date is before the minimum date",maxText:"This date is after the maximum date",format:"m/d/y",disabledDaysText:"Disabled",disabledDatesText:"Disabled",monthNames:Date.monthNames,dayNames:Date.dayNames,nextText:"Next Month (Control+Right)",prevText:"Previous Month (Control+Left)",monthYearText:"Choose a month (Control+Up/Down to move years)",startDay:0,showToday:true,showTime:false,focusOnSelect:true,initHour:12,initComponent:function(){Ext.SitoolsDatePicker.superclass.initComponent.call(this);this.value=this.value?this.value.clearTime(true):new Date().clearTime();this.hourValue=this.value?this.value.getHours():new Date().getHours();this.minuteValue=this.value?this.value.getMinutes():new Date().getMinutes();this.secondValue=this.value?this.value.getSeconds():new Date().getSeconds();this.addEvents("select");if(this.handler){this.on("select",this.handler,this.scope||this)}this.initDisabledDays()},initDisabledDays:function(){if(!this.disabledDatesRE&&this.disabledDates){var b=this.disabledDates,a=b.length-1,c="(?:";Ext.each(b,function(f,e){c+=Ext.isDate(f)?"^"+Ext.escapeRe(f.dateFormat(this.format))+"$":b[e];if(e!=a){c+="|"}},this);this.disabledDatesRE=new RegExp(c+")")}},setDisabledDates:function(a){if(Ext.isArray(a)){this.disabledDates=a;this.disabledDatesRE=null}else{this.disabledDatesRE=a}this.initDisabledDays();this.update(this.value,true)},setDisabledDays:function(a){this.disabledDays=a;this.update(this.value,true)},setMinDate:function(a){this.minDate=a;this.update(this.value,true)},setMaxDate:function(a){this.maxDate=a;this.update(this.value,true)},setValue:function(a){this.value=a;this.update(this.value)},getValue:function(){return this.value},focus:function(){this.update(this.activeDate);if(this.showTime){this.updateTime(this.activeDate)}},updateTime:function(a){this.hourField.setValue(a.getHours());this.minuteField.setValue(a.getMinutes());this.secondField.setValue(a.getSeconds())},onEnable:function(a){Ext.SitoolsDatePicker.superclass.onEnable.call(this);this.doDisabled(false);this.update(a?this.value:this.activeDate);if(Ext.isIE){this.el.repaint()}},onDisable:function(){Ext.SitoolsDatePicker.superclass.onDisable.call(this);this.doDisabled(true);if(Ext.isIE&&!Ext.isIE8){Ext.each([].concat(this.textNodes,this.el.query("th span")),function(a){Ext.fly(a).repaint()})}},doDisabled:function(a){this.keyNav.setDisabled(a);this.prevRepeater.setDisabled(a);this.nextRepeater.setDisabled(a);if(this.showToday){this.todayKeyListener.setDisabled(a);this.todayBtn.setDisabled(a)}},onRender:function(a,g){var c=['<table cellspacing="0">','<tr><td class="x-date-left"><a href="#" title="',this.prevText,'">&#160;</a></td><td class="x-date-middle" align="center"></td><td class="x-date-right"><a href="#" title="',this.nextText,'">&#160;</a></td></tr>','<tr><td colspan="3"><table class="x-date-inner" cellspacing="0"><thead><tr>'],f=this.dayNames,e;for(e=0;e<7;e++){var k=this.startDay+e;if(k>6){k=k-7}c.push("<th><span>",f[k].substr(0,1),"</span></th>")}c[c.length]="</tr></thead><tbody><tr>";for(e=0;e<42;e++){if(e%7===0&&e!==0){c[c.length]="</tr><tr>"}c[c.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span></span></em></a></td>'}c.push("</tr></tbody></table></td></tr>",this.showTime?'<tr><td colspan="3" class="x-date-time" align="center"></td></tr>':"",this.showToday?'<tr><td colspan="3" class="x-date-bottom" align="center"></td></tr>':"",'</table><div class="x-date-mp"></div>');var b=document.createElement("div");b.className="x-date-picker";b.innerHTML=c.join("");a.dom.insertBefore(b,g);this.el=Ext.get(b);this.eventEl=Ext.get(b.firstChild);this.prevRepeater=new Ext.util.ClickRepeater(this.el.child("td.x-date-left a"),{handler:this.showPrevMonth,scope:this,preventDefault:true,stopDefault:true});this.nextRepeater=new Ext.util.ClickRepeater(this.el.child("td.x-date-right a"),{handler:this.showNextMonth,scope:this,preventDefault:true,stopDefault:true});this.monthPicker=this.el.down("div.x-date-mp");this.monthPicker.enableDisplayMode("block");this.keyNav=new Ext.KeyNav(this.eventEl,{left:function(d){if(d.ctrlKey){this.showPrevMonth()}else{this.update(this.activeDate.add("d",-1))}},right:function(d){if(d.ctrlKey){this.showNextMonth()}else{this.update(this.activeDate.add("d",1))}},up:function(d){if(d.ctrlKey){this.showNextYear()}else{this.update(this.activeDate.add("d",-7))}},down:function(d){if(d.ctrlKey){this.showPrevYear()}else{this.update(this.activeDate.add("d",7))}},pageUp:function(d){this.showNextMonth()},pageDown:function(d){this.showPrevMonth()},enter:function(d){d.stopPropagation();return true},scope:this});this.cells=this.el.select("table.x-date-inner tbody td");this.textNodes=this.el.query("table.x-date-inner tbody span");this.mbtn=new Ext.Button({text:"&#160;",tooltip:this.monthYearText,renderTo:this.el.child("td.x-date-middle",true)});this.mbtn.el.child("em").addClass("x-btn-arrow");if(this.showToday){this.todayKeyListener=this.eventEl.addKeyListener(Ext.EventObject.SPACE,this.selectToday,this);var l=(new Date()).dateFormat(this.format);this.todayBtn=new Ext.Button({renderTo:this.el.child("td.x-date-bottom",true),text:String.format(this.todayText,l),tooltip:String.format(this.todayTip,l),handler:this.selectToday,scope:this})}if(this.showTime){this.hourField=new Ext.form.TextField({value:this.hourValue,width:"25",listeners:{scope:this,specialkey:function(m,d){if(d.getKey()==d.TAB){if(d.shiftKey){this.secondField.focus()}else{this.minuteField.focus()}}}},maxLength:2,maskRe:/[0-9]/,disabled:false,validationEvent:"blur",validator:function(m){var d=parseInt(m);if(!Ext.isEmpty(d)&&d<=23&&d>=0){if(m.length==1){this.setValue("0"+m)}return true}else{return"incorrect Value"}}});this.minuteField=new Ext.form.TextField({value:this.minuteValue,width:"25",listeners:{scope:this,specialkey:function(m,d){if(d.getKey()==d.TAB){if(d.shiftKey){this.hourField.focus()}else{this.secondField.focus()}}}},maxLength:2,maskRe:/[0-9]/,validationEvent:"blur",validator:function(m){var d=parseInt(m);if(!Ext.isEmpty(d)&&d<=59&&d>=0){if(m.length==1){this.setValue("0"+m)}return true}else{return"incorrect Value"}}});this.secondField=new Ext.form.TextField({value:this.minuteValue,width:"25",listeners:{scope:this,specialkey:function(m,d){if(d.getKey()==d.TAB){if(d.shiftKey){this.minuteField.focus()}else{this.hourField.focus()}}}},maxLength:2,maskRe:/[0-9]/,validationEvent:"blur",validator:function(m){var d=parseInt(m);if(!Ext.isEmpty(d)&&d<=59&&d>=0){if(m.length==1){this.setValue("0"+m)}return true}else{return"incorrect Value"}}});var p=new Ext.form.DisplayField({value:":"});var n=new Ext.form.DisplayField({value:":"});this.timeForm=new Ext.form.FormPanel({labelWidth:1,itemsCls:"sitools-no-margin",items:[{xtype:"compositefield",width:135,style:{padding:"3px"},items:[this.hourField,p,this.minuteField,n,this.secondField]}],renderTo:this.el.child("td.x-date-time",true)})}this.mon(this.eventEl,"mousewheel",this.handleMouseWheel,this);this.mon(this.eventEl,"click",this.handleDateClick,this,{delegate:"a.x-date-date"});this.mon(this.mbtn,"click",this.showMonthPicker,this);this.onEnable(true)},createMonthPicker:function(){if(!this.monthPicker.dom.firstChild){var a=['<table border="0" cellspacing="0">'];for(var b=0;b<6;b++){a.push('<tr><td class="x-date-mp-month"><a href="#">',Date.getShortMonthName(b),"</a></td>",'<td class="x-date-mp-month x-date-mp-sep"><a href="#">',Date.getShortMonthName(b+6),"</a></td>",b===0?'<td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-prev"></a></td><td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-next"></a></td></tr>':'<td class="x-date-mp-year"><a href="#"></a></td><td class="x-date-mp-year"><a href="#"></a></td></tr>')}a.push('<tr class="x-date-mp-btns"><td colspan="4"><button type="button" class="x-date-mp-ok">',this.okText,'</button><button type="button" class="x-date-mp-cancel">',this.cancelText,"</button></td></tr>","</table>");this.monthPicker.update(a.join(""));this.mon(this.monthPicker,"click",this.onMonthClick,this);this.mon(this.monthPicker,"dblclick",this.onMonthDblClick,this);this.mpMonths=this.monthPicker.select("td.x-date-mp-month");this.mpYears=this.monthPicker.select("td.x-date-mp-year");this.mpMonths.each(function(c,d,e){e+=1;if((e%2)===0){c.dom.xmonth=5+Math.round(e*0.5)}else{c.dom.xmonth=Math.round((e-1)*0.5)}})}},showMonthPicker:function(){if(!this.disabled){this.createMonthPicker();var a=this.el.getSize();this.monthPicker.setSize(a);this.monthPicker.child("table").setSize(a);this.mpSelMonth=(this.activeDate||this.value).getMonth();this.updateMPMonth(this.mpSelMonth);this.mpSelYear=(this.activeDate||this.value).getFullYear();this.updateMPYear(this.mpSelYear);this.monthPicker.slideIn("t",{duration:0.2})}},updateMPYear:function(e){this.mpyear=e;var c=this.mpYears.elements;for(var b=1;b<=10;b++){var d=c[b-1],a;if((b%2)===0){a=e+Math.round(b*0.5);d.firstChild.innerHTML=a;d.xyear=a}else{a=e-(5-Math.round(b*0.5));d.firstChild.innerHTML=a;d.xyear=a}this.mpYears.item(b-1)[a==this.mpSelYear?"addClass":"removeClass"]("x-date-mp-sel")}},updateMPMonth:function(a){this.mpMonths.each(function(b,c,d){b[b.dom.xmonth==a?"addClass":"removeClass"]("x-date-mp-sel")})},selectMPMonth:function(a){},onMonthClick:function(f,b){f.stopEvent();var c=new Ext.Element(b),a;if(c.is("button.x-date-mp-cancel")){this.hideMonthPicker()}else{if(c.is("button.x-date-mp-ok")){var g=new Date(this.mpSelYear,this.mpSelMonth,(this.activeDate||this.value).getDate());if(g.getMonth()!=this.mpSelMonth){g=new Date(this.mpSelYear,this.mpSelMonth,1).getLastDateOfMonth()}this.update(g);this.hideMonthPicker()}else{if((a=c.up("td.x-date-mp-month",2))){this.mpMonths.removeClass("x-date-mp-sel");a.addClass("x-date-mp-sel");this.mpSelMonth=a.dom.xmonth}else{if((a=c.up("td.x-date-mp-year",2))){this.mpYears.removeClass("x-date-mp-sel");a.addClass("x-date-mp-sel");this.mpSelYear=a.dom.xyear}else{if(c.is("a.x-date-mp-prev")){this.updateMPYear(this.mpyear-10)}else{if(c.is("a.x-date-mp-next")){this.updateMPYear(this.mpyear+10)}}}}}}},onMonthDblClick:function(d,b){d.stopEvent();var c=new Ext.Element(b),a;if((a=c.up("td.x-date-mp-month",2))){this.update(new Date(this.mpSelYear,a.dom.xmonth,(this.activeDate||this.value).getDate()));this.hideMonthPicker()}else{if((a=c.up("td.x-date-mp-year",2))){this.update(new Date(a.dom.xyear,this.mpSelMonth,(this.activeDate||this.value).getDate()));this.hideMonthPicker()}}},hideMonthPicker:function(a){if(this.monthPicker){if(a===true){this.monthPicker.hide()}else{this.monthPicker.slideOut("t",{duration:0.2})}}},showPrevMonth:function(a){this.update(this.activeDate.add("mo",-1))},showNextMonth:function(a){this.update(this.activeDate.add("mo",1))},showPrevYear:function(){this.update(this.activeDate.add("y",-1))},showNextYear:function(){this.update(this.activeDate.add("y",1))},handleMouseWheel:function(a){a.stopEvent();if(!this.disabled){var b=a.getWheelDelta();if(b>0){this.showPrevMonth()}else{if(b<0){this.showNextMonth()}}}},handleDateClick:function(c,b){c.stopEvent();if(!this.disabled&&b.dateValue&&!Ext.fly(b.parentNode).hasClass("x-date-disabled")){this.cancelFocus=this.focusOnSelect===false;var a=new Date(b.dateValue);if(this.showTime){a=a.add(Date.HOUR,this.hourField.getValue());a=a.add(Date.MINUTE,this.minuteField.getValue());a=a.add(Date.SECOND,this.secondField.getValue());if(!this.hourField.isValid()||!this.minuteField.isValid()||!this.secondField.isValid()){return}}this.setValue(a);delete this.cancelFocus;this.fireEvent("select",this,this.value)}},selectToday:function(){if(this.todayBtn&&!this.todayBtn.disabled){var a=new Date();this.setValue(a);if(this.showTime){this.hourField.setValue(a.getHours());this.minuteField.setValue(a.getMinutes());this.secondField.setValue(a.getSeconds())}this.fireEvent("select",this,this.value)}},update:function(D,A){if(this.rendered){if(!Ext.isDate(D)){D=new Date()}var a=this.activeDate,s=this.isVisible();var p=new Date(D.getTime());p.setHours(0);p.setMinutes(0);p.setMilliseconds(0);p.setSeconds(0);this.activeDate=D;if(!A&&a&&this.el){var r=p.getTime();if(a.getMonth()==p.getMonth()&&a.getFullYear()==p.getFullYear()){this.cells.removeClass("x-date-selected");this.cells.each(function(d){if(d.dom.firstChild.dateValue==r){d.addClass("x-date-selected");if(s&&!this.cancelFocus){Ext.fly(d.dom.firstChild).focus(50)}return false}},this);return}}var l=D.getDaysInMonth(),u=D.getFirstDateOfMonth(),f=u.getDay()-this.startDay;if(f<0){f+=7}l+=f;var B=D.add("mo",-1),g=B.getDaysInMonth()-f,e=this.cells.elements,v=this.textNodes,C=(new Date(B.getFullYear(),B.getMonth(),g,this.initHour));C.setHours(B.getHours());C.setMinutes(B.getMinutes());C.setSeconds(B.getSeconds());today=new Date().getTime(),sel=D.clearTime(true).getTime(),min=this.minDate?this.minDate.clearTime(true):Number.NEGATIVE_INFINITY,max=this.maxDate?this.maxDate.clearTime(true):Number.POSITIVE_INFINITY,ddMatch=this.disabledDatesRE,ddText=this.disabledDatesText,ddays=this.disabledDays?this.disabledDays.join(""):false,ddaysText=this.disabledDaysText,format=this.format;if(this.showToday){var n=new Date().clearTime(),c=(n<min||n>max||(ddMatch&&format&&ddMatch.test(n.dateFormat(format)))||(ddays&&ddays.indexOf(n.getDay())!=-1));if(!this.disabled){this.todayBtn.setDisabled(c);this.todayKeyListener[c?"disable":"enable"]()}}var m=function(L,d){d.title="";var J=C.clearTime(true).getTime();d.firstChild.dateValue=J;if(J==today){d.className+=" x-date-today";d.title=L.todayText}if(J==sel){d.className+=" x-date-selected";if(s){Ext.fly(d.firstChild).focus(50)}}if(J<min){d.className=" x-date-disabled";d.title=L.minText;return}if(J>max){d.className=" x-date-disabled";d.title=L.maxText;return}if(ddays){if(ddays.indexOf(C.getDay())!=-1){d.title=ddaysText;d.className=" x-date-disabled"}}if(ddMatch&&format){var K=C.dateFormat(format);if(ddMatch.test(K)){d.title=ddText.replace("%0",K);d.className=" x-date-disabled"}}};var z=0;for(;z<f;z++){v[z].innerHTML=(++g);C.setDate(C.getDate()+1);e[z].className="x-date-prevday";m(this,e[z])}for(;z<l;z++){var b=z-f+1;v[z].innerHTML=(b);C.setDate(C.getDate()+1);e[z].className="x-date-active";m(this,e[z])}var E=0;for(;z<42;z++){v[z].innerHTML=(++E);C.setDate(C.getDate()+1);e[z].className="x-date-nextday";m(this,e[z])}this.mbtn.setText(this.monthNames[D.getMonth()]+" "+D.getFullYear());if(!this.internalRender){var k=this.el.dom.firstChild,q=k.offsetWidth;this.el.setWidth(q+this.el.getBorderWidth("lr"));Ext.fly(k).setWidth(q);this.internalRender=true;if(Ext.isOpera&&!this.secondPass){k.rows[0].cells[1].style.width=(q-(k.rows[0].cells[0].offsetWidth+k.rows[0].cells[2].offsetWidth))+"px";this.secondPass=true;this.update.defer(10,this,[D])}}}},beforeDestroy:function(){if(this.rendered){Ext.destroy(this.keyNav,this.monthPicker,this.eventEl,this.mbtn,this.nextRepeater,this.prevRepeater,this.cells.el,this.todayBtn);delete this.textNodes;delete this.cells.elements}}});Ext.reg("datepicker",Ext.SitoolsDatePicker);var DEFAULT_NATIVEJSON=false;var DEFAULT_TIMEOUT=30000;var DEFAULT_TIMEBUF=10;var DEFAULT_NBRETRY=0;var LOCALE="en";var DEFAULT_HELP_WIDTH=600;var DEFAULT_HELP_HEIGHT=400;var ADMIN_PANEL_HEIGHT=300;var ADMIN_PANEL_NB_ELEMENTS=10;var SHOW_HELP=true;var COOKIE_DURATION=20;var SITOOLS_DATE_FORMAT="Y-m-d\\TH:i:s.u";var SITOOLS_DEFAULT_IHM_DATE_FORMAT="Y-m-d H:i:s.u";var JAVA_TYPES=[{name:"String"},{name:"Date"},{name:"Double"},{name:"Float"},{name:"Integer"},{name:"Boolean"},{name:"BasicDBObject"},{name:"BasicDBList"}];Ext.Ajax.defaultHeaders={Accept:"application/json","X-User-Agent":"Sitools"};var onBeforeRequest=function(g,d){var c=new Date();if(!Ext.isEmpty(Ext.util.Cookies.get("scheme"))){if(Ext.util.Cookies.get("scheme")=="HTTP_Digest"){var e=null;var k="GET";if(!Ext.isEmpty(d.method)){k=d.method}var b=d.url;if(Ext.isEmpty(d.url)&&!Ext.isEmpty(d.scope)){if(!Ext.isEmpty(d.scope.url)){b=d.scope.url}}var a=Ext.util.Cookies.get("A1");var f=new Digest({usr:Ext.util.Cookies.get("userLogin"),algorithm:Ext.util.Cookies.get("algorithm"),realm:Ext.util.Cookies.get("realm"),url:b,nonce:Ext.util.Cookies.get("nonce"),method:k,mode:"digest",A1:a});Ext.apply(Ext.Ajax.defaultHeaders,{Authorization:f.getDigestAuth()})}else{if(!Ext.isEmpty(Ext.util.Cookies.get("hashCode"))){Ext.util.Cookies.set("hashCode",Ext.util.Cookies.get("hashCode"),c.add(Date.MINUTE,COOKIE_DURATION));Ext.apply(Ext.Ajax.defaultHeaders,{Authorization:Ext.util.Cookies.get("hashCode")})}}}if(!Ext.isEmpty(Ext.util.Cookies.get("userLogin"))){Ext.util.Cookies.set("userLogin",Ext.util.Cookies.get("userLogin"),c.add(Date.MINUTE,20))}};Ext.Ajax.on("beforerequest",onBeforeRequest,this);var onRequestException=function(c,a,b){if(!b.doNotHandleRequestexception){if((a.status==403)&&!Ext.isEmpty(Ext.util.Cookies.get("hashCode"))){Ext.MessageBox.minWidth=360;Ext.MessageBox.alert(i18n.get("label.session.expired"),a.responseText)}else{Ext.MessageBox.minWidth=360;Ext.MessageBox.alert(i18n.get("label.error"),a.responseText)}}};Ext.Ajax.on("requestexception",onRequestException,this);var helpUrl;Ext.BLANK_IMAGE_URL="/sitools/cots/extjs/resources/images/default/s.gif";Ext.USE_NATIVE_JSON=DEFAULT_NATIVEJSON;Ext.Ajax.timeout=DEFAULT_TIMEOUT;var treePanel,mainPanel,helpPanel;var SERVER_OK=200;var predicatOperators={operators:[["EQ","="],["GT",">"],["GTE",">="],["LT","<"],["LTE","<="],["LIKE","like"],["NE","!="]],getOperatorValueForServer:function(a){var b=null;Ext.each(this.operators,function(c){if(c[1]==a){b=c[0];return false}},this);return b},getOperatorValueForClient:function(a){var b=null;Ext.each(this.operators,function(c){if(c[0]==a){b=c[1];return false}},this);return b}};function alertFailure(b,d){var a;if(b.status==SERVER_OK){var c=Ext.decode(b.responseText).message;a=i18n.get("msg.error")+": "+i18n.get(c)}else{a=i18n.get("warning.serverError")+": "+i18n.get(b.statusText)}Ext.Msg.alert(i18n.get("label.warning"),a)}function showResponse(b){try{var a=Ext.decode(b.responseText);if(!a.success){Ext.Msg.alert(i18n.get("label.warning"),i18n.get(a.message));return false}var c=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get(a.message),autoDestroy:true,hideDelay:1000}).show(document);return true}catch(d){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.javascriptError")+" : "+d);return false}}Ext.apply(Ext.form.VTypes,{name:function(){var a=new RegExp("^.*[!\"#$%&'()*+,:;<=>?@\\`{}|~/]+.*$");return function(b){return !a.test(b)}}(),nameText:"Invalid caracters : should not contain . * [ ! \" # $ % & ' ( ) * + , : ; < = > ? @  ` { } | ~ / ] + . * $",image:function(){var a=new RegExp("^[http://]+[/:a-zA-Z0-9-_]+.*(jpg|gif|png|bmp|ico)$");return function(b){return a.test(b)}}(),imageText:"Invalid image URL : should start with http and finish with a image extension",attachment:function(){var c=new RegExp("^/.*$");var b=new RegExp("^.*//.*$");var a=new RegExp("^.*[!\"#$%&'()*+,:;<=>?@\\`{}|~]+.*$");return function(d){return(c.test(d)&&!b.test(d)&&!a.test(d))}}(),attachmentText:"invalid Attachment : should not contain ! \" # $ % & ' ( ) * + , : ; < = > ? @  ` { } | ~ ] + . * and must begin with /",nameWithoutSpace:function(){var a=new RegExp("^.*[!\"#$%&'()*+,:;<=>?@\\`{}|~ ]+.*$");return function(b){return !a.test(b)}}(),nameWithoutSpaceText:i18n.get("label.invalidCharacters"),withoutSpace:function(){var a=new RegExp("^.*[ ]+.*$");return function(b){return !a.test(b)}}(),withoutSpaceText:i18n.get("label.invalidCharacters"),uri:function(){var b=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;var a=new RegExp("^.*[ ]+$");return function(c){return b.test(c)&&!a.test(c)}}(),uriText:"The format of the URL is invalid, should start with http, ftp or https and finish without space"});Ext.override(Ext.grid.GridPanel,{stripeRows:true});Ext.override(Ext.ux.Spinner,{spin:function(d,b){var a=parseFloat(this.field.getValue());var c=(b===true)?this.alternateIncrementValue:this.incrementValue;if(d===true){a-=c}else{a+=c}a=(isNaN(a))?this.defaultValue:a;a=this.fixBoundries(a);this.field.setValue(a)}});Ext.override(Ext.form.Field,{tooltip:null,listeners:{render:function(){Ext.form.Field.superclass.render.apply(this,arguments);if(!Ext.isEmpty(this.tooltip)){var a={};if(Ext.isString(this.tooltip)){a={html:this.tooltip,width:200,dismissDelay:5000}}else{if(Ext.isObject(this.tooltip)){a=this.tooltip}else{return}}Ext.apply(a,{target:this.el});this.tTip=new Ext.ToolTip(a)}}}});function onClickOption(b){var d=b+"?method=options&media=text/html";var c=Ext.Ajax.defaultHeaders.Authorization;Ext.Ajax.defaultHeaders.Authorization="";var a=Ext.util.Cookies.get("scheme");var e=Ext.util.Cookies.get("hashCode");Ext.util.Cookies.set("scheme",null);Ext.util.Cookies.set("hashCode",null);Ext.Ajax.un("requestexception",onRequestException,this);Ext.Ajax.request({url:d,headers:{Authorization:"none"},method:"GET",success:function(g){if(g.status==200){var f=window.open(d)}Ext.Ajax.defaultHeaders.Authorization=c;Ext.util.Cookies.set("scheme",a);Ext.util.Cookies.set("hashCode",e);Ext.Ajax.on("requestexception",onRequestException,this)},callback:function(){Ext.util.Cookies.set("scheme",a);Ext.util.Cookies.set("hashCode",e);Ext.Ajax.on("requestexception",onRequestException,this)},failure:function(f){Ext.Ajax.defaultHeaders.Authorization=c;Ext.util.Cookies.set("scheme",a);Ext.util.Cookies.set("hashCode",e);if(f.status==403){Ext.Ajax.request({url:b+"?media=text/html",method:"OPTIONS",success:function(k){var g=window.open("",b);g.document.write(k.responseText);g.document.close()},failure:function(g){},scope:this})}Ext.Ajax.on("requestexception",onRequestException,this)},scope:this})}function includeJs(e){if(Ext.isEmpty(e)){return}var d=false;var k="script";var c="src";var a=document.getElementsByTagName(k);var b;for(var g=a.length;g>0;g--){b=a[g-1];if(b&&b.getAttribute(c)!==null&&b.getAttribute(c).indexOf(e)!=-1){d=true}}if(!d){var f=document.getElementsByTagName("head")[0];b=document.createElement("script");b.setAttribute("src",e);b.setAttribute("type","text/javascript");f.appendChild(b)}}function includeJsForceOrder(a,d,m,p){if(d<a.length){var b=a[d].url;var k=false;var n="script";var q="src";var e=document.getElementsByTagName(n);var l;for(var f=e.length;f>0;f--){l=e[f-1];if(l&&l.getAttribute(q)!==null&&l.getAttribute(q).indexOf(b)!=-1){k=true}}if(!k){var g=document.createElement("script");g.type="text/javascript";g.onload=includeJsForceOrder.createDelegate(this,[a,d+1,m,p]);g.onreadystatechange=includeJsForceOrder.createDelegate(this,[a,d+1,m,p]);g.onerror=includeJsForceOrder.createDelegate(this,[a,d+1,m,p]);g.src=b;var c=document.getElementsByTagName("head")[0];c.appendChild(g)}else{includeJsForceOrder(a,d+1,m,p)}}else{if(!Ext.isEmpty(m)){if(Ext.isEmpty(p)){m.call()}else{m.call(p)}}}}Ext.override(Ext.PagingToolbar,{initComponent:function(){var a=Ext.Toolbar;var c=[this.first=new a.Button({tooltip:this.firstText,overflowText:this.firstText,iconCls:"x-tbar-page-first",disabled:true,handler:this.moveFirst,scope:this}),this.prev=new a.Button({tooltip:this.prevText,overflowText:this.prevText,iconCls:"x-tbar-page-prev",disabled:true,handler:this.movePrevious,scope:this}),"-",this.beforePageText,this.inputItem=new Ext.form.NumberField({cls:"x-tbar-page-number",allowDecimals:false,allowNegative:false,enableKeyEvents:true,selectOnFocus:true,submitValue:false,listeners:{scope:this,keydown:this.onPagingKeyDown,blur:this.onPagingBlur}}),this.afterTextItem=new a.TextItem({text:String.format(this.afterPageText,1)}),"-",this.next=new a.Button({tooltip:this.nextText,overflowText:this.nextText,iconCls:"x-tbar-page-next",disabled:true,handler:this.moveNext,scope:this}),this.last=new a.Button({tooltip:this.lastText,overflowText:this.lastText,iconCls:"x-tbar-page-last",disabled:true,handler:this.moveLast,scope:this}),"-"];var b=this.items||this.buttons||[];if(this.prependButtons){this.items=b.concat(c)}else{this.items=c.concat(b)}delete this.buttons;if(this.displayInfo){this.items.push("->");this.items.push(this.displayItem=new a.TextItem({}))}Ext.PagingToolbar.superclass.initComponent.call(this);this.addEvents("change","beforechange");this.on("afterlayout",this.onFirstLayout,this,{single:true});this.cursor=0;this.bindStore(this.store,true)},onFirstLayout:function(){this.refresh=new Ext.Toolbar.Button({tooltip:i18n.get("label.refreshText"),overflowText:i18n.get("label.refreshText"),iconCls:"x-tbar-loading",handler:this.doRefresh,scope:this});this.insert(10,this.refresh);if(this.dsLoaded){this.onLoad.apply(this,this.dsLoaded)}}});Ext.override(Ext.menu.DateMenu,{initComponent:function(){this.on("beforeshow",this.onBeforeShow,this);if(this.strict==(Ext.isIE7&&Ext.isStrict)){this.on("show",this.onShow,this,{single:true,delay:20})}Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new Ext.SitoolsDatePicker(Ext.applyIf({internalRender:this.strict||!Ext.isIE,ctCls:"x-menu-date-item",id:this.pickerId},this.initialConfig))});this.picker.purgeListeners();Ext.menu.DateMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,["select"]);this.on("show",this.picker.focus,this.picker);this.on("select",this.menuHide,this);if(this.handler){this.on("select",this.handler,this.scope||this)}}});Ext.override(Ext.form.DateField,{showTime:false,onTriggerClick:function(){if(this.disabled){return}if(Ext.isEmpty(this.menu)){this.menu=new Ext.menu.DateMenu({hideOnClick:false,showTime:this.showTime,focusOnSelect:false})}this.onFocus();Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});this.menu.picker.setValue(this.getValue()||new Date());this.menu.show(this.el,"tl-bl?");this.menuEvents("on")}});Ext.override(Ext.slider.SingleSlider,{listeners:{afterrender:function(a){a.syncThumb()}},doSnap:function(b){if(!(this.increment&&b)){return b}var d=b,c=this.increment,a=b%c;if(a!==0){d-=a;if(a*2>=c){d+=c}else{if(a*2<-c){d-=c}}}if(Ext.isString(d)){d=parseFloat(d)}return d.constrain(this.minValue,this.maxValue)}});var ID={PANEL:{MENU:"menuPanelId",TREE:"treePanelId",MAIN:"mainPanelId",HELP:"helpPanelId",DATAVIEW:"dataviewPanelId",QUICKSTART:"quickStartId"},CMP:{TOOLBAR:"toolbarId",MENU:"menuId"},WIN:{LOGIN:"loginWinId",HELP:"helpWinId"},BOX:{REG:"regBoxId",USER:"userBoxId",GROUP:"groupBoxId",ROLE:"roleBoxId",FIREWALL:"firewallBoxId",PROJECTS:"projectsBoxId",DATASETS:"datasetsBoxId",DICTIONARY:"dictionaryBoxId",TEMPLATE:"templateBoxId",DATABASE:"databaseBoxId",FORMS:"formsBoxId",APPLICATION:"applicationsBoxId",USERSTORAGE:"userStorageBoxId",GRAPHS:"graphsBoxId",CONVERTERS:"convertersBoxId",RSSPROJECTS:"rssProjectsId",STORAGES:"storagesBoxId",PROJECTPLUGIN:"projectPluginBoxId",UNITS:"unitsBoxId",DATASETVIEW:"datasetViewBoxId",PROJECTMODULE:"projectModuleBoxId",PROJECTMODULECONFIG:"projectModuleConfigBoxId",FILEEDITORFTL:"fileEditorFtlBoxId",FILEEDITORCSS:"fileEditorCssBoxId",FILEEDITORLICENCE:"fileEditorLicenceBoxId",COLLECTIONS:"collectionBoxId",MULTIDS:"multiDsBoxId",APPLICATIONPLUGIN:"applicationPluginBoxId",GUISERVICES:"guiServicesBoxId"},PROP:{DATASETVIEW:"datasetViewPropId",PROJECTMODULE:"projectModulePropId",FILEEDITORPROP:"fileEditorBoxId",MULTIDSPROP:"multiDsPropId",GUISERVICES:"guiServicesPropId"},COMPONENT_SETUP:{DATABASE:"cmpSetupDatabaseId",PROJECT:"cmpSetupProjectId",OPENSEARCH:"cmpOpenSearchId",COLLECTIONS:"cmpCollectionsId",MULTIDS:"cmpMultiDsId"},ITEM:{OKBUTTON:"okButtonId",CANCELBUTTON:"cancelButtonId"}};var user=null;var viewport=null;var treePanel=null;var dataViewMenu=null;var seeAlsoMenu=null;var dataViewWin=null;var mainPanel=null;var seeAlsoPanel=null;var helpUrl=null;var componentsPanel=null;SHOW_HELP=true;function onMenuSelect(a){if(Ext.isEmpty(a.getItemId())){return}if(a.getItemId()=="menu_logout"){utils_logout()}else{Ext.Msg.alert("Click on Menu: ",a.getItemId())}}function showHelp(a){if(Ext.isEmpty(a)){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("label.noHelpUrl"));return}var b=Ext.getCmp(ID.WIN.HELP);if(!b){var c=new Ext.ux.ManagedIFrame.Panel({id:ID.WIN.HELP,layout:"fit",defaultSrc:a,defaults:{padding:10}});b=new Ext.Window({title:i18n.get("label.help"),width:DEFAULT_HELP_WIDTH,autoScroll:true,modal:true,id:"winHelpId",height:DEFAULT_HELP_HEIGHT,items:[c],buttons:[{text:"close",handler:function(){this.ownerCt.ownerCt.close()}}],listeners:{resize:function(f,e,d){this.findById(ID.WIN.HELP).setHeight(d-65)}}});b.show();b.doLayout(false,true);c.setHeight(b.getHeight()-65)}else{b.show()}}var clientAdmin={initGuiServices:function(a){Ext.Ajax.request({url:loadUrl.get("APP_URL")+loadUrl.get("APP_GUI_SERVICES_URL"),params:{sort:"priority",dir:"DESC"},method:"GET",scope:this,success:function(b){var c=Ext.decode(b.responseText);if(!c.success){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noProjectName"));return false}else{var d=c.data;Ext.each(d,function(e){includeJsForceOrder(e.dependencies.js,0)})}},callback:function(){this.initDatasetViews(a)}})},initDatasetViews:function(a){Ext.Ajax.request({url:loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_VIEWS_URL"),params:{sort:"priority",dir:"DESC"},method:"GET",scope:this,success:function(b){var c=Ext.decode(b.responseText);if(!c.success){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noProjectName"));return false}else{var d=c.data;Ext.each(d,function(e){includeJsForceOrder(e.dependencies.js,0)})}},callback:function(){this.initProjectsModules(a)}})},initProjectsModules:function(a){Ext.Ajax.request({url:loadUrl.get("APP_URL")+loadUrl.get("APP_PROJECTS_MODULES_URL"),params:{sort:"priority",dir:"DESC"},method:"GET",scope:this,success:function(b){var c=Ext.decode(b.responseText);if(!c.success){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noProjectName"));return false}else{var d=c.data;Ext.each(d,function(e){if(!Ext.isEmpty(e.dependencies.js)){includeJsForceOrder(e.dependencies.js,0)}})}},callback:function(){a.call(this)}})},initGui:function(){var e={xtype:"tbbutton",tooltip:i18n.get("label.logout"),itemId:"menu_logout",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/logout.png",handler:function(){sitools.userProfile.LoginUtils.logout()}};var k={xtype:"toolbar",id:ID.CMP.TOOLBAR,items:[{xtype:"label",html:"<img src=res/images/cnes.png width=92 height=28>"},{xtype:"label",style:"text-shadow: 1px 1px #D5D5D5;font-size: 12px;color: #15428B;font-weight: bold;",text:i18n.get("label.title")},"->",{xtype:"label",html:i18n.get("label.welcome")+" <b>"+Ext.util.Cookies.get("userLogin")+"</b>"},"-",{id:"quickStart",tooltip:"Quick Start",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/quick_start.png",style:"padding:2px",handler:function(){mainPanel.removeAll();var m=new sitools.admin.quickStart.qs({id:ID.PANEL.QUICKSTART,width:"100%",flex:1});var n=new Ext.Panel({name:"containerPanel",width:"100%",layout:"fit",bodyCssClass:"admin-bg",flex:1});mainPanel.add(n);mainPanel.add(m);mainPanel.doLayout()}},{id:"versionButtonId",tooltip:"Version",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/version.png",style:"padding:2px",handler:function(){showVersion()}},{tooltip:"Show Help",enableToggle:true,style:"padding:2px",toggleHandler:function(p,n){var m=Ext.getCmp(ID.PANEL.HELP);SHOW_HELP=n;if(m==undefined){return}if(!n){m.toggleCollapse(n)}else{m.toggleCollapse(n)}mainPanel.doLayout()},pressed:true,icon:loadUrl.get("APP_URL")+"/common/res/images/icons/help.png"},{tooltip:"Advanced Mode",id:"switchModeId",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/maintenance.png",enableToggle:true,pressed:true,style:"padding:2px",toggleHandler:function(q,p){var n=Ext.getCmp(ID.PANEL.MAIN);var m=Ext.getCmp(ID.PANEL.TREE);if(p){m.show();n.getTopToolbar().hide();n.doLayout();dataViewWin.hide()}else{m.hide();if(Ext.isEmpty(dataViewWin)){seeAlsoMenu=new sitools.admin.menu.seeAlso();seeAlsoPanel=new Ext.Panel({id:"seeAlsoId",flex:1,autoScroll:true,width:265,html:'<div class="title-seeAlso"></div>',cls:"background-seeAlso",height:Ext.getBody().getSize().height-110,items:[seeAlsoMenu]});seeAlsoMenu.getStore().loadData({links:[]});dataViewMenu=new sitools.admin.menu.dataView();var s=new Ext.Panel({id:"panDataview",flex:2,items:[dataViewMenu],listeners:{resize:function(t){var u=t.body.getSize();dataViewMenu.setSize({height:u.height-5,width:u.width-5});seeAlsoPanel.setSize(t.body.getSize())}}});dataViewWin=new Ext.Window({border:false,id:ID.PANEL.DATAVIEW,layout:"hbox",resizable:false,layoutConfig:{align:"stretch",pack:"start"},closable:false,draggable:false,items:[seeAlsoPanel,s],height:Ext.getBody().getSize().height-82,width:Ext.getBody().getSize().width,y:82,allButtons:[],tbar:{cls:"root-toolbar",id:"idToolbarView"}})}dataViewWin.show();n.getTopToolbar().show();var r=dataViewWin.getEl();r.fadeIn({endOpacity:0.95,easing:"easeOut",duration:0.5})}viewport.doLayout()}},"-",e]};var f=new Ext.Panel({id:ID.PANEL.MENU,region:"north",layout:"fit",height:30,items:[k]});treePanel=new Ext.Panel({id:ID.PANEL.TREE,region:"west",title:i18n.get("label.menu"),split:true,autoScroll:true,width:250,layout:"fit",defaults:{padding:10}});var b=new sitools.admin.menu.dataView();var a=[];if(Ext.util.Cookies.get("showQuickStart")=="true"){var c=new sitools.admin.quickStart.qs({id:ID.PANEL.QUICKSTART,width:"100%",flex:1});var g=new Ext.Panel({name:"containerPanel",autoLoad:"res/html/"+LOCALE+"/welcome.html",width:"100%",layout:"fit",bodyCssClass:"admin-bg",flex:1});a.push(g);a.push(c)}else{var l=new Ext.Panel({xtype:"panel",layout:"fit",height:1200,autoLoad:"res/html/"+LOCALE+"/welcome.html"});a.push(l)}mainPanel=new Ext.Panel({bodyCssClass:"admin-bg",layout:"vbox",layoutConfig:{align:"stretch",pack:"start"},xtype:"panel",id:ID.PANEL.MAIN,tbar:{cls:"root-toolbar",id:"idConfig"},title:i18n.get("label.main"),items:a,region:"center"});viewport=new Ext.Viewport({layout:"border",items:[f,treePanel,mainPanel],listeners:{scope:this,resize:function(){if(dataViewWin){dataViewWin.setSize({height:Ext.getBody().getSize().height-87,width:Ext.getBody().getSize().width-5});dataViewWin.setPosition(0,82);dataViewWin.doLayout()}}}});var d=new sitools.admin.menu.TreeMenu("res/json/menu.json");treePanel.add(d);treePanel.doLayout()}};function initAppli(){if(Ext.isEmpty(Ext.util.Cookies.get("showQuickStart"))){Ext.util.Cookies.set("showQuickStart",true)}Ext.Ajax.request({url:loadUrl.get("APP_URL")+loadUrl.get("APP_FORMCOMPONENTS_URL"),params:{sort:"priority",dir:"DESC"},method:"GET",scope:this,success:function(a){var b=Ext.decode(a.responseText);if(!b.success){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noProjectName"));return false}else{var c=b.data;Ext.each(c,function(d){includeJs(d.fileUrlAdmin);includeJs(d.fileUrlUser)})}},callback:function(){sql2ext.load(loadUrl.get("APP_URL")+"/conf/sql2ext.properties");var a=function(){clientAdmin.initGui()};clientAdmin.initGuiServices(a)}})}function getI(a){return a.getId()}function getCmp(a){return Ext.getCmp(a)}function getMenu(){return Ext.getCmp(ID.CMP.MENU)}function getMenuRoot(){return getMenu().getRootNode()}function getMenuNode(a){return getMenu().getNodeById(a)}Ext.namespace("sitools.admin.menu");sitools.admin.menu.dataView=Ext.extend(Ext.DataView,{id:"nodes",itemSelector:"div.nodes",overClass:"nodes-hover",singleSelect:true,multiSelect:false,autoScroll:true,initComponent:function(){var a=new Ext.XTemplate('<div id="adminMenu">','<div class="title">Choose a Task...</div>','<div class="float columns">','<tpl for=".">','<tpl if="(this.round(xcount /2) - xindex) < 0"></div>',"<div>","</tpl>",'<div id="{nodeName}" class="nodes">','<img class="float"','<tpl if="this.isNotEmpty(children)">','ext:qtip="','<tpl for="children">',"{textChildren}<br>","</tpl>",'" ',"</tpl>",'width="96" height="96" src="','<tpl if="this.isNotEmpty(iconMenu)">',"{iconMenu}","</tpl>",'<tpl if="this.isEmpty(iconMenu)">',"/sitools/common/res/images/icons/menu/collections.png","</tpl>",'" />',"<span>{name}</span>","</div>","</tpl>","</div>",'<img class="icon-sitools" src="/sitools/common/res/images/icons/menu/logoSitools.png" />',"</div>",{compiled:true,isNotEmpty:function(b){return !Ext.isEmpty(b)},isEmpty:function(b){return Ext.isEmpty(b)},round:function(b){return Math.round(b)}});this.tpl=a;this.height=Ext.getBody().getSize().height-100;this.listeners={dblclick:function(b,d,c,f){var k=c.id;var g=c.childNodes[1].textContent;this.openSubCategory(b,g,f,k)},click:function(b,d,c,f){var g=dataViewMenu.getStore().getAt(d);seeAlsoMenu.getStore().loadData(g.data)},afterrender:function(b){Ext.Ajax.request({url:"res/json/menu.json",method:"GET",success:function(c){b.allData=Ext.decode(c.responseText);mainPanel.toolbars[0].addText("Path : / Menu");mainPanel.toolbars[0].addSeparator();b.openSubCategory(b,"root")},failure:function(){Ext.Msg.alert("Error","Cannot load nodes from menu.json")},scope:b})}};this.store=new Ext.data.JsonStore({root:"",restful:true,remoteSort:false,fields:[{name:"name",mapping:"text"},{name:"nodeName"},{name:"id"},{name:"parentNode"},{name:"children"},{name:"iconMenu"},{name:"category"},{name:"links"},{name:"label"},{name:"path"}]});this.allButtons=[];sitools.admin.menu.dataView.superclass.initComponent.call(this)},openSubCategory:function(c,f,d,g){var a=this.populateStore(c,f);if(a){var b={xtype:"button",overCls:"nodes-hover",labelStyle:"font-weight:bold !important;",text:f,id:f+"Id",nodeName:g,scope:c,handler:function(k,m){this.populateStore(this,k.getText());this.deleteItemsFromToolbar(mainPanel.toolbars[0],k.getText());dataViewWin.show();mainPanel.getTopToolbar().show();var l=dataViewWin.getEl();l.fadeIn({endOpacity:0.95,easing:"easeOut",duration:0.5})}};this.allButtons.push(b);mainPanel.toolbars[0].addButton(b);mainPanel.toolbars[0].add(["-"]);mainPanel.doLayout()}else{this.treeAction(f,g)}},deleteItemsFromToolbar:function(d,e){var c=[];var b=d.items.items[0].text;d.removeAll();d.addText(b);d.addSeparator();for(var a=0;a<this.allButtons.length;a++){d.addButton(this.allButtons[a]);d.addSeparator();c[a]=this.allButtons[a];if(this.allButtons[a].text==e){break}}this.allButtons=c;mainPanel.doLayout()},populateStore:function(b,c){var a=b.getChildrenByParentNode(b.allData,c);if(!Ext.isEmpty(a)){b.store.removeAll();Ext.each(a,function(d){d.text=i18n.get("label."+d.nodeName);Ext.each(d.children,function(e){e.textChildren=i18n.get("label."+e.nodeName)})});b.store.loadData(a);return true}else{return false}},getChildrenByParentNode:function(d,a){if(Ext.isEmpty(d)){return null}if(a=="root"){return d}else{for(var c=0;c<d.length;c++){if(d[c].text==a){return d[c].children}else{var b=this.getChildrenByParentNode(d[c].children,a);if(!Ext.isEmpty(b)){return b}}}}},treeAction:function(e,f){var d=e+"id";if(!Ext.isDefined(f)){Ext.Msg.alert("warning","Undefined");return}var c=this.getSelectedRecords()[0];if(!Ext.ComponentMgr.isRegistered("s-"+f)){Ext.Msg.alert("warning","label.component 's-"+f+"' msg.undefined");return}var a=new sitools.admin.menu.dataView();mainPanel.removeAll();mainPanel.add({width:"100%",items:[{xtype:"s-box",label:i18n.get("label."+f),items:[{xtype:"s-"+f,sitoolsType:"mainAdminPanel"}],idItem:c.get("id")}],listeners:{resize:function(k,m,g){var l=k.items.items[0].body.getSize();var n=k.items.items[0].items.items[0].getEl();l={height:l.height-(n.getHeight()+n.getMargins("t")+n.getMargins("b")),width:l.width-8};var p=k.find("sitoolsType","mainAdminPanel");p[0].setSize(l)}}});var b=new Ext.ux.ManagedIFrame.Panel({id:ID.PANEL.HELP,width:"100%",flex:1,defaultSrc:loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/"+f+".html",defaults:{padding:10}});mainPanel.add(b);mainPanel.doLayout();b.setVisible(SHOW_HELP);helpUrl=loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/"+f+".html";mainPanel.getTopToolbar().show();dataViewWin.hide()}});Ext.namespace("sitools.admin.menu");sitools.admin.menu.seeAlso=Ext.extend(Ext.DataView,{id:"links",itemSelector:"div.links",overClass:"links-hover",singleSelect:true,multiSelect:false,autoScroll:false,initComponent:function(){var a=new Ext.XTemplate('<div class="title-seeAlso">See Also...</div>','<tpl for=".">','<tpl if="this.isNotEmpty(links)">','<tpl for="links">','<div id="{nodeName}" name="{text}" class="links">','<img class="icon-seeAlso" width="16" height="16" src="{iconMenu}" />','<span id="{nodeName}">{label}</span>',"</div>","</tpl>","</tpl>","</tpl>",{compiled:true,isNotEmpty:function(b){return !Ext.isEmpty(b)},isEmpty:function(b){return Ext.isEmpty(b)}});this.tpl=a;this.height=Ext.getBody().getSize().height-220;this.listeners={click:function(b,d,c,g){var m=c.id;var l=c.attributes[1].textContent;var k=seeAlsoMenu.getStore().getAt(0);var f=this.getPath(k,l);this.openSubCategory(b,l,g,m,f)}};this.store=new Ext.data.JsonStore({root:"",restful:true,remoteSort:false,fields:[{name:"nodeName"},{name:"id"},{name:"parentNode"},{name:"children"},{name:"iconMenu"},{name:"category"},{name:"links"},{name:"label"},{name:"path"}]});this.allButtons=[];sitools.admin.menu.seeAlso.superclass.initComponent.call(this)},getPath:function(e,d){var c=new RegExp("/");for(var b=0;b<e.data.links.length;b++){if(e.data.links[b].text==d){var a=e.data.links[b].path.split(c);return a}}},openSubCategory:function(m,g,d,f,n){dataViewMenu.allButtons=[];var a=this.populateStore(m,g);var k=mainPanel.toolbars[0];var l=k.items.items[0].text;k.removeAll();k.addText(l);k.addSeparator();this.addRootButton();for(var b=0;b<n.length;b++){var c={xtype:"button",text:n[b],id:n[b]+"Id",scope:m,path:n,handler:function(p,r){this.populateStore(this,p.getText());dataViewMenu.deleteItemsFromToolbar(mainPanel.toolbars[0],p.getText(),n);dataViewWin.show();mainPanel.getTopToolbar().show();var q=dataViewWin.getEl();q.fadeIn({endOpacity:0.95,easing:"easeOut",duration:0.5})}};this.addButton(c,k)}mainPanel.doLayout();if(!a){this.treeAction(g,f)}},addButton:function(a,b){b.add(a);b.addSeparator();dataViewMenu.allButtons.push(a)},addRootButton:function(){var a={xtype:"button",text:"root",id:"rootId",scope:this,handler:function(b,d){this.populateStore(this,b.getText());dataViewMenu.deleteItemsFromToolbar(mainPanel.toolbars[0],b.getText());dataViewWin.show();mainPanel.getTopToolbar().show();var c=dataViewWin.getEl();c.fadeIn({endOpacity:0.95,easing:"easeOut",duration:0.5})}};this.addButton(a,mainPanel.toolbars[0]);mainPanel.doLayout()},populateStore:function(b,c){var a=b.getChildrenByParentNode(dataViewMenu.allData,c);if(!Ext.isEmpty(a)){b.store.removeAll();dataViewMenu.store.removeAll();dataViewMenu.store.loadData(a);return true}else{return false}},getChildrenByParentNode:function(d,a){if(Ext.isEmpty(d)){return null}if(a=="root"){return d}else{for(var c=0;c<d.length;c++){if(d[c].text==a){return d[c].children}else{var b=this.getChildrenByParentNode(d[c].children,a);if(!Ext.isEmpty(b)){return b}}}}},treeAction:function(e,f){var d=e+"id";if(!Ext.isDefined(f)){Ext.Msg.alert("warning","Undefined");return}var c=this.getSelectedRecords()[0];if(!Ext.ComponentMgr.isRegistered("s-"+f)){Ext.Msg.alert("warning","label.component 's-"+f+"' msg.undefined");return}var a=new sitools.admin.menu.dataView();mainPanel.removeAll();mainPanel.add({width:"100%",items:[{xtype:"s-box",label:i18n.get("label."+f),items:[{xtype:"s-"+f,sitoolsType:"mainAdminPanel"}],idItem:d}],listeners:{resize:function(k,m,g){var l=k.items.items[0].body.getSize();var n=k.items.items[0].items.items[0].getEl();l={height:l.height-(n.getHeight()+n.getMargins("t")+n.getMargins("b")),width:l.width-8};var p=k.find("sitoolsType","mainAdminPanel");p[0].setSize(l)}}});var b=new Ext.ux.ManagedIFrame.Panel({id:ID.PANEL.HELP,width:"100%",flex:1,defaultSrc:loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/"+f+".html",defaults:{padding:10}});mainPanel.add(b);mainPanel.doLayout();b.setVisible(SHOW_HELP);helpUrl=loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/"+f+".html";mainPanel.getTopToolbar().show();dataViewWin.hide()}});Ext.namespace("sitools.admin.quickStart");sitools.admin.quickStart.qs=Ext.extend(Ext.Panel,{layout:"border",bodyCssClass:"quickStart",initComponent:function(){this.stepsBtn=[{id:"qsStart",value:"qsStart",icon:"/sitools/common/res/images/icons/logo_fav_icone.png",scope:this,enableToogle:true,toggleGroup:"steps",toggleHandler:this.manageSteps,allowDepress:false,scale:"medium",cls:"services-toolbar-btn",pressed:true,listeners:{afterrender:function(a){new Ext.ToolTip({target:"qsStart",anchor:"top",showDelay:0,hideDelay:0,html:"Start"})}}},{id:"qsProject",value:"qsProject",icon:"/sitools/common/res/images/icons/tree_projects.png",scope:this,enableToogle:true,toggleGroup:"steps",toggleHandler:this.manageSteps,allowDepress:false,scale:"medium",cls:"services-toolbar-btn",listeners:{afterrender:function(a){new Ext.ToolTip({target:"qsProject",anchor:"top",showDelay:0,hideDelay:0,html:"Project"})}}},{value:"qsDatasource",id:"qsDatasource",icon:"/sitools/common/res/images/icons/tree_databases.png",scope:this,enableToogle:true,toggleGroup:"steps",toggleHandler:this.manageSteps,allowDepress:false,scale:"medium",cls:"services-toolbar-btn",listeners:{afterrender:function(a){new Ext.ToolTip({target:"qsDatasource",anchor:"top",showDelay:0,hideDelay:0,html:"Datasource"})}}},{id:"qsDataset",value:"qsDataset",icon:"/sitools/common/res/images/icons/tree_datasets.png",scope:this,enableToogle:true,toggleGroup:"steps",toggleHandler:this.manageSteps,allowDepress:false,scale:"medium",cls:"services-toolbar-btn",listeners:{afterrender:function(a){new Ext.ToolTip({target:"qsDataset",anchor:"top",showDelay:0,hideDelay:0,html:"Dataset"})}}},{id:"qsForm",value:"qsForm",icon:"/sitools/common/res/images/icons/tree_forms.png",scope:this,enableToogle:true,toggleGroup:"steps",toggleHandler:this.manageSteps,allowDepress:false,scale:"medium",cls:"services-toolbar-btn",listeners:{afterrender:function(a){new Ext.ToolTip({target:"qsForm",anchor:"top",showDelay:0,hideDelay:0,html:"Form"})}}},{id:"qsSecurity",value:"qsSecurity",icon:"/sitools/common/res/images/icons/tree_userman.png",scope:this,enableToogle:true,toggleGroup:"steps",toggleHandler:this.manageSteps,allowDepress:false,scale:"medium",cls:"services-toolbar-btn",listeners:{afterrender:function(a){new Ext.ToolTip({target:"qsSecurity",anchor:"top",showDelay:0,hideDelay:0,html:"Security"})}}},"->",{xtype:"label",html:"<i>Show QuickStart on startup<i>"},{xtype:"checkbox",listeners:{check:function(b,a){Ext.util.Cookies.set("showQuickStart",a)},afterrender:function(a){a.setValue(Ext.util.Cookies.get("showQuickStart"))}}}];this.currentPanel=new sitools.admin.quickStart.qsStart({qs:this});this.welcomePanel=new Ext.Panel({region:"center",id:"startPanel",layout:"fit",bodyCssClass:"quickStart",items:[this.currentPanel]});this.stepsPanel=new Ext.Panel({region:"south",bodyCssClass:"quickStart",buttonAlign:"center",height:0,buttons:[this.stepsBtn]});this.items=[this.welcomePanel,this.stepsPanel];sitools.admin.quickStart.qs.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.quickStart.qs.superclass.afterRender.apply(this,arguments)},manageSteps:function(btn,pressed){if(pressed){var xtype="sitools.admin.quickStart."+btn.value;var step=eval(xtype);this.currentPanel=new step();this.currentPanel.qs=this;this.welcomePanel.removeAll();this.welcomePanel.add(this.currentPanel);this.welcomePanel.doLayout()}},openFeature:function(d){var c=mainPanel.find("name","containerPanel")[0];var a=treePanel.items.items[0];var b=a.getNodeById(d);a.getSelectionModel().select(b);c.removeAll();c.add({width:"100%",bodyCssClass:"admin-bg",icon:b.attributes.icon,items:[{xtype:"s-box",label:i18n.get("label."+b.attributes.nodeName),items:[{xtype:"s-"+b.attributes.nodeName,sitoolsType:"mainAdminPanel"}],idItem:b.attributes.id}],listeners:{resize:function(f,k,e){var g=f.items.items[0].body.getSize();var l=f.items.items[0].items.items[0].getEl();g={height:g.height-(l.getHeight()+l.getMargins("t")+l.getMargins("b")),width:g.width-8};var m=f.find("sitoolsType","mainAdminPanel");m[0].setSize(g)}}});c.doLayout()}});Ext.namespace("sitools.admin.quickStart");sitools.admin.quickStart.qsStart=Ext.extend(Ext.Panel,{forceLayout:true,layout:"vbox",border:false,bodyCssClass:"quickStart",layoutConfig:{align:"center",pack:"start"},initComponent:function(){var c=new Ext.form.Label({cls:"qs-h1",html:i18n.get("label.qsStartTitle"),listeners:{render:function(d){d.getEl().fadeIn({easing:"easeIn",duration:1})}}});var b=new Ext.form.Label({cls:"qs-div",id:"start-desc",html:i18n.get("label.qsStartDesc"),listeners:{render:function(d){d.getEl().fadeIn({easing:"easeIn",duration:1})}}});var a=new Ext.form.Label({html:'<img id="qs-logo" class="bouton_action" src="/sitools/client-admin/res/html/quickStart/icons/quick_start_logo.png"/>',listeners:{render:function(d){d.getEl().fadeIn({endOpacity:1,easing:"easeIn",duration:1.5,useDisplay:true})},afterrender:function(d){Ext.get("qs-logo").on("load",function(){d.getEl().on("mouseleave",function(g,f,k){f.src="/sitools/client-admin/res/html/quickStart/icons/quick_start_logo.png"});d.getEl().on("mouseenter",function(g,f,k){f.src="/sitools/client-admin/res/html/quickStart/icons/quick_start_logo_hover.png"});d.getEl().on("click",function(k,g,l){var f=this.ownerCt.qs.stepsPanel.buttons[1];f.toggle(true)},this);new Ext.ToolTip({target:"qs-logo",anchor:"right",autoShow:true,showDelay:0,floating:true,html:"<b>Begin</b>"});d.getEl().alignTo("start-desc","tr-br")},this)}}});this.items=[c,b,a];sitools.admin.quickStart.qsStart.superclass.initComponent.call(this)}});Ext.namespace("sitools.admin.quickStart");sitools.admin.quickStart.qsProject=Ext.extend(Ext.Panel,{forceLayout:true,layout:"vbox",border:false,layoutConfig:{align:"center",pack:"start"},bodyCssClass:"quickStart",initComponent:function(){var c=new Ext.form.Label({cls:"qs-h1",html:i18n.get("label.qsProjectTitle"),listeners:{render:function(d){d.getEl().fadeIn({easing:"easeIn",duration:1})}}});var b=new Ext.form.Label({cls:"qs-div",id:"start-desc",html:i18n.get("label.qsProjectDesc"),listeners:{render:function(d){d.getEl().fadeIn({easing:"easeIn",duration:1})}}});var a=new Ext.form.Label({html:'<img id="qs-projet" class="qs-image" src="/sitools/client-admin/res/html/quickStart/screenshots/projects.png"/>',listeners:{scope:this,afterrender:function(d){Ext.get("qs-projet").on("load",function(){d.getEl().fadeIn({endOpacity:1,easing:"easeIn",duration:1,useDisplay:true});d.getEl().alignTo("start-desc","tl-bl");var e=new Ext.form.Label({html:'<img id="qs-projet-logo" class="bouton_action" src="/sitools/client-admin/res/html/quickStart/icons/project-logo.png"/>',tooltip:new Ext.ToolTip({html:"Open Project"}),listeners:{scope:this,render:function(f){f.getEl().fadeIn({endOpacity:1,easing:"easeIn",duration:1.5,useDisplay:true})},afterrender:function(f){Ext.get("qs-projet-logo").on("load",function(){f.getEl().on("mouseleave",function(k,g,l){g.src="/sitools/client-admin/res/html/quickStart/icons/project-logo.png"});f.getEl().on("mouseenter",function(k,g,l){g.src="/sitools/client-admin/res/html/quickStart/icons/project-logo-hover.png"});f.getEl().on("click",function(k,g,l){this.qs.openFeature("projectsNodeId")},this);f.getEl().alignTo("qs-projet","br-br",[50,40]);new Ext.ToolTip({target:"qs-projet-logo",anchor:"left",autoShow:true,showDelay:0,html:"<b>Open Project</b>"})},this)}}});this.add(e);this.doLayout()},this)}}});this.items=[c,b,a];sitools.admin.quickStart.qsProject.superclass.initComponent.call(this)}});Ext.namespace("sitools.admin.quickStart");sitools.admin.quickStart.qsDatasource=Ext.extend(Ext.Panel,{forceLayout:true,layout:"vbox",border:false,layoutConfig:{align:"center",pack:"start"},bodyCssClass:"quickStart",initComponent:function(){var c=new Ext.form.Label({cls:"qs-h1",html:i18n.get("label.qsDatasourceTitle"),listeners:{render:function(d){d.getEl().fadeIn({easing:"easeIn",duration:1})}}});var b=new Ext.form.Label({cls:"qs-div",id:"start-desc",html:i18n.get("label.qsDatasourceDesc"),listeners:{render:function(d){d.getEl().fadeIn({easing:"easeIn",duration:1})}}});var a=new Ext.form.Label({html:'<img id="qs-datasource" class="qs-image" src="/sitools/client-admin/res/html/quickStart/screenshots/datasources.png"/>',tooltip:"Open Datasource",listeners:{scope:this,afterrender:function(d){Ext.get("qs-datasource").on("load",function(){d.getEl().fadeIn({endOpacity:1,easing:"easeIn",duration:1,useDisplay:true});d.getEl().alignTo("start-desc","tl-bl");var e=new Ext.form.Label({html:'<img id="qs-datasource-logo" class="bouton_action" src="/sitools/client-admin/res/html/quickStart/icons/database-logo.png"/>',listeners:{scope:this,render:function(f){f.getEl().fadeIn({endOpacity:1,easing:"easeIn",duration:1.5,useDisplay:true})},afterrender:function(f){Ext.get("qs-datasource-logo").on("load",function(){f.getEl().on("mouseleave",function(k,g,l){g.src="/sitools/client-admin/res/html/quickStart/icons/database-logo.png"});f.getEl().on("mouseenter",function(k,g,l){g.src="/sitools/client-admin/res/html/quickStart/icons/database-logo-hover.png"});f.getEl().on("click",function(k,g,l){this.qs.openFeature("DatabaseJDBCNodeId")},this);f.getEl().alignTo("qs-datasource","br-br",[82,75])},this);new Ext.ToolTip({target:"qs-datasource-logo",anchor:"left",autoShow:true,showDelay:0,html:"<b>Open Datasource</b>"})}}});this.add(e);this.doLayout()},this)}}});this.items=[c,b,a];sitools.admin.quickStart.qsDatasource.superclass.initComponent.call(this)}});Ext.namespace("sitools.admin.quickStart");sitools.admin.quickStart.qsDataset=Ext.extend(Ext.Panel,{forceLayout:true,layout:"vbox",border:false,layoutConfig:{align:"center",pack:"start"},bodyCssClass:"quickStart",initComponent:function(){var c=new Ext.form.Label({cls:"qs-h1",html:i18n.get("label.qsDatasetTitle"),listeners:{render:function(d){d.getEl().fadeIn({easing:"easeIn",duration:1})}}});var b=new Ext.form.Label({cls:"qs-div",id:"start-desc",html:i18n.get("label.qsDatasetDesc"),listeners:{render:function(d){d.getEl().fadeIn({easing:"easeIn",duration:1})}}});var a=new Ext.form.Label({html:'<img id="qs-dataset" class="qs-image" src="/sitools/client-admin/res/html/quickStart/screenshots/datasets.png"/>',tooltip:"Open Dataset",listeners:{scope:this,afterrender:function(d){Ext.get("qs-dataset").on("load",function(){d.getEl().fadeIn({endOpacity:1,easing:"easeIn",duration:1,useDisplay:true});d.getEl().alignTo("start-desc","tl-bl");var e=new Ext.form.Label({html:'<img id="qs-dataset-logo" class="bouton_action" src="/sitools/client-admin/res/html/quickStart/icons/dataset-logo.png"/>',listeners:{scope:this,render:function(f){f.getEl().fadeIn({endOpacity:1,easing:"easeIn",duration:1.5,useDisplay:true})},afterrender:function(f){Ext.get("qs-dataset-logo").on("load",function(){f.getEl().on("mouseleave",function(k,g,l){g.src="/sitools/client-admin/res/html/quickStart/icons/dataset-logo.png"});f.getEl().on("mouseenter",function(k,g,l){g.src="/sitools/client-admin/res/html/quickStart/icons/dataset-logo-hover.png"});f.getEl().on("click",function(k,g,l){this.qs.openFeature("datasetsSqlNodeId")},this);f.getEl().alignTo("qs-dataset","br-br",[82,75]);new Ext.ToolTip({target:"qs-dataset-logo",anchor:"left",autoShow:true,showDelay:0,html:"<b>Open Dataset</b>"})},this)}}});this.add(e);this.doLayout()},this)}}});this.items=[c,b,a];sitools.admin.quickStart.qsDataset.superclass.initComponent.call(this)}});Ext.namespace("sitools.admin.quickStart");sitools.admin.quickStart.qsSecurity=Ext.extend(Ext.Panel,{forceLayout:true,layout:"vbox",border:false,layoutConfig:{align:"center",pack:"start"},bodyCssClass:"quickStart",initComponent:function(){var f=new Ext.form.Label({cls:"qs-h1",html:i18n.get("label.qsUserTitle"),listeners:{render:function(g){g.getEl().fadeIn({easing:"easeIn",duration:1})}}});var e=new Ext.form.Label({cls:"qs-div",id:"start-desc",html:i18n.get("label.qsUserDesc"),listeners:{render:function(g){g.getEl().fadeIn({easing:"easeIn",duration:1})}}});var c=new Ext.form.Label({html:'<img id="qs-user-logo" class="bouton_action" src="/sitools/client-admin/res/html/quickStart/icons/user-logo.png"/>',listeners:{scope:this,render:function(g){g.getEl().fadeIn({endOpacity:1,easing:"easeIn",duration:1,useDisplay:true})},afterrender:function(g){Ext.get("qs-user-logo").on("load",function(){g.getEl().alignTo("start-desc","tl",[50,30]);g.getEl().on("mouseleave",function(l,k,m){k.src="/sitools/client-admin/res/html/quickStart/icons/user-logo.png"});g.getEl().on("mouseenter",function(l,k,m){k.src="/sitools/client-admin/res/html/quickStart/icons/user-logo-hover.png"});g.getEl().on("click",function(l,k,m){this.qs.openFeature("usrNodeId")},this);new Ext.ToolTip({target:"qs-user-logo",anchor:"right",autoShow:true,showDelay:0,html:"<b>Open User</b>"})},this)}}});var b=new Ext.form.Label({html:'<img id="qs-share-logo" src="/sitools/client-admin/res/html/quickStart/icons/share-logo.png"/>',listeners:{scope:this,render:function(g){g.getEl().fadeIn({endOpacity:1,easing:"easeIn",duration:1,useDisplay:true})},afterrender:function(g){Ext.get("qs-share-logo").on("load",function(){g.getEl().alignTo(this.getEl(),"c-c",[-10,-25])},this)}}});var d=new Ext.form.Label({html:'<img id="qs-group-logo" class="bouton_action" src="/sitools/client-admin/res/html/quickStart/icons/group-logo.png"/>',listeners:{scope:this,render:function(g){g.getEl().fadeIn({endOpacity:1,easing:"easeIn",duration:1.5,useDisplay:true})},afterrender:function(g){Ext.get("qs-group-logo").on("load",function(){g.getEl().on("mouseleave",function(l,k,m){k.src="/sitools/client-admin/res/html/quickStart/icons/group-logo.png"});g.getEl().on("mouseenter",function(l,k,m){k.src="/sitools/client-admin/res/html/quickStart/icons/group-logo-hover.png"});g.getEl().on("click",function(l,k,m){this.qs.openFeature("grpNodeId")},this);g.getEl().alignTo(this.getEl(),"c-b",[-6,-60]);new Ext.ToolTip({target:"qs-group-logo",anchor:"bottom",autoShow:true,showDelay:0,html:"<b>Open Group</b>"})},this)}}});var a=new Ext.form.Label({html:'<img id="qs-role-logo" class="bouton_action" src="/sitools/client-admin/res/html/quickStart/icons/role-logo.png"/>',listeners:{scope:this,render:function(g){g.getEl().fadeIn({endOpacity:1,easing:"easeIn",duration:1.5,useDisplay:true})},afterrender:function(g){Ext.get("qs-role-logo").on("load",function(){g.getEl().on("mouseleave",function(l,k,m){k.src="/sitools/client-admin/res/html/quickStart/icons/role-logo.png"});g.getEl().on("mouseenter",function(l,k,m){k.src="/sitools/client-admin/res/html/quickStart/icons/role-logo-hover.png"});g.getEl().on("click",function(l,k,m){this.qs.openFeature("roleNodeId")},this);g.getEl().alignTo("qs-user-logo","tr",[255,0]);new Ext.ToolTip({target:"qs-role-logo",anchor:"left",autoShow:true,showDelay:0,html:"<b>Open Role</b>"})},this)}}});this.items=[f,e,c,b,d,a];sitools.admin.quickStart.qsSecurity.superclass.initComponent.call(this)}});Ext.namespace("sitools.admin.quickStart");sitools.admin.quickStart.qsForm=Ext.extend(Ext.Panel,{forceLayout:true,layout:"vbox",border:false,layoutConfig:{align:"center",pack:"start"},bodyCssClass:"quickStart",initComponent:function(){var c=new Ext.form.Label({cls:"qs-h1",html:i18n.get("label.qsFormTitle"),listeners:{render:function(d){d.getEl().fadeIn({easing:"easeIn",duration:1})}}});var b=new Ext.form.Label({cls:"qs-div",id:"start-desc",html:i18n.get("label.qsFormDesc"),listeners:{render:function(d){d.getEl().fadeIn({easing:"easeIn",duration:1})}}});var a=new Ext.form.Label({html:'<img id="qs-form" class="qs-image" height=280 src="/sitools/client-admin/res/html/quickStart/screenshots/forms.png"/>',listeners:{scope:this,afterrender:function(d){Ext.get("qs-form").on("load",function(){d.getEl().fadeIn({endOpacity:1,easing:"easeIn",duration:1,useDisplay:true});d.getEl().alignTo("start-desc","tl-bl");var e=new Ext.form.Label({html:'<img id="qs-form-logo" class="bouton_action" src="/sitools/client-admin/res/html/quickStart/icons/form-logo.png"/>',tooltip:new Ext.ToolTip({html:"Open Project"}),listeners:{scope:this,render:function(f){f.getEl().fadeIn({endOpacity:1,easing:"easeIn",duration:1.5,useDisplay:true})},afterrender:function(f){Ext.get("qs-form-logo").on("load",function(){f.getEl().on("mouseleave",function(k,g,l){g.src="/sitools/client-admin/res/html/quickStart/icons/form-logo.png"});f.getEl().on("mouseenter",function(k,g,l){g.src="/sitools/client-admin/res/html/quickStart/icons/form-logo-hover.png"});f.getEl().on("click",function(k,g,l){this.qs.openFeature("formsNodeId")},this);f.getEl().alignTo("qs-form","br-br",[115,23]);new Ext.ToolTip({target:"qs-form-logo",anchor:"left",autoShow:true,showDelay:0,html:"<b>Open Form</b>"})},this)}}});this.add(e);this.doLayout()},this)}}});this.items=[c,b,a];sitools.admin.quickStart.qsForm.superclass.initComponent.call(this)}});Ext.namespace("sitools.admin.common");sitools.admin.common.FormParametersConfigUtil=Ext.extend(Ext.form.FormPanel,{autoScroll:true,frame:true,border:false,monitorValid:true,labelWidth:150,isRenderer:false,initComponent:function(){this.bbar=new Ext.ux.StatusBar({text:i18n.get("label.formReady"),id:"bbarFormParam",iconCls:"x-status-valid"});this.parametersFieldset=new Ext.form.FieldSet({title:i18n.get("label.parameters"),padding:6});if(!Ext.isEmpty(this.rec)){this.title=i18n.get("label.projectModuleConfig")+" "+this.rec.name;this.buildViewConfig(this.rec)}this.items=[this.parametersFieldset],this.isRenderer=true;sitools.admin.common.FormParametersConfigUtil.superclass.initComponent.call(this)},buildViewConfig:function(recSelected){try{this.parametersFieldset.removeAll();var getParametersMethod=eval(recSelected.xtype+".getParameters");if(!Ext.isFunction(getParametersMethod)){Ext.Msg.alert(i18n.get("label.error"),i18n.get("label.notImplementedMethod"));return}var parameters=getParametersMethod();if(Ext.isEmpty(parameters)){this.parametersFieldset.add({xtype:"label",html:'<h2 style="text-align:center;">'+i18n.get("label.noParameter")+"</h2>"})}else{this.parametersFieldset.setVisible(true)}Ext.each(parameters,function(param){if(!Ext.isEmpty(this.parametersList)){Ext.iterate(this.parametersList,function(cmp){if(cmp.name==param.config.name){var customValue=cmp.value;var JsObj=eval(param.jsObj);var config=Ext.applyIf(param.config,{anchor:"100%"});var p=new JsObj(config);p.setValue(customValue);this.parametersFieldset.add(p)}},this)}else{var JsObj=eval(param.jsObj);var config=Ext.applyIf(param.config,{anchor:"100%"});var p=new JsObj(config);this.parametersFieldset.add(p)}},this);this.doLayout()}catch(err){throw err}},getParametersValue:function(){var a=[];if(Ext.isEmpty(this.parametersFieldset.items)){return a}this.parametersFieldset.items.each(function(b){if(Ext.isFunction(b.getValue)){a.push({name:b.name,value:b.getValue()})}},this);return a},setRecord:function(a){this.rec=a}});Ext.reg("s-formParametersConfigUtil",sitools.admin.common.FormParametersConfigUtil);Ext.namespace("sitools.admin.menu");sitools.admin.menu.TreeMenu=Ext.extend(Object,{constructor:function(b){var a=new Ext.tree.TreePanel({id:ID.CMP.MENU,component:this,useArrows:false,autoScroll:true,animate:true,root:{nodeType:"async"},loader:new Ext.tree.TreeLoader({requestMethod:"GET",url:b}),rootVisible:false,listeners:{beforeload:function(c){c.setText(i18n.get("label."+c.attributes.nodeName));return c.isRoot||Ext.isDefined(c.attributes.children)},load:function(c){c.eachChild(function(d){d.setText(i18n.get("label."+d.attributes.nodeName));return true})},click:function(c){if(c.isLeaf()){this.component.treeAction(c)}}}});a.getRootNode().expand(true);return a},treeAction:function(c){var e=c.attributes.nodeName;var d=c.attributes.id;if(!Ext.isDefined(e)){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("msg.nodeundefined"));return}if(!c.attributes.mvc&&!Ext.ComponentMgr.isRegistered("s-"+e)){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("label.component")+" 's-"+e+"' "+i18n.get("msg.undefined"));return}ann(mainPanel,"mainPanel is null");var a=new sitools.admin.menu.dataView();mainPanel.removeAll();mainPanel.add({width:"100%",bodyCssClass:"admin-bg",items:[{xtype:"s-box",label:i18n.get("label."+e),items:[{xtype:"s-"+e,sitoolsType:"mainAdminPanel"}],idItem:d}],listeners:{resize:function(g,l,f){var k=g.items.items[0].body.getSize();var m=g.items.items[0].items.items[0].getEl();k={height:k.height-(m.getHeight()+m.getMargins("t")+m.getMargins("b")),width:k.width-8};var n=g.find("sitoolsType","mainAdminPanel");n[0].setSize(k)}}});var b=new Ext.ux.ManagedIFrame.Panel({bodyCssClass:"admin-bg-transparent",id:ID.PANEL.HELP,width:"100%",flex:1,defaultSrc:loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/"+e+".html"});mainPanel.add(b);mainPanel.doLayout();b.setVisible(SHOW_HELP);helpUrl=loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/"+e+".html"}});Ext.namespace("sitools.admin.usergroups");sitools.admin.usergroups.RegCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.REG,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_INSCRIPTIONS_ADMIN_URL");this.store=new Ext.data.JsonStore({root:"data",restful:true,url:this.url,remoteSort:true,idProperty:"id",fields:[{name:"id",type:"string"},{name:"identifier",type:"string"},{name:"firstName",type:"string"},{name:"lastName",type:"string"},{name:"email",type:"string"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.login"),dataIndex:"identifier",width:100},{header:i18n.get("label.firstName"),dataIndex:"firstName",width:100},{header:i18n.get("label.lastName"),dataIndex:"lastName",width:100},{header:i18n.get("label.email"),dataIndex:"email",width:100}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.validate"),icon:"res/images/icons/icons_perso/toolbar_validate.png",handler:this.onValidate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.usergroups.RegCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.usergroups.RegCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onValidate:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id,method:"PUT",scope:this,success:function(b){this.store.reload()},failure:alertFailure})},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.usergroups.RegPropPanel({url:this.url+"/"+b.id,store:this.store});a.show(ID.BOX.REG)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("userCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(c){var b=Ext.decode(c.responseText);if(!b.success){Ext.Msg.alert(i18n.get("label.warning"),b.message);return}this.store.reload();var d=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get(b.message),autoDestroy:true,hideDelay:1000}).show(document)},failure:alertFailure})}});Ext.reg("s-regcrud",sitools.admin.usergroups.RegCrudPanel);Ext.namespace("sitools.admin.usergroups");sitools.admin.usergroups.UserCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.USER,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_SECURITY_URL")+"/users";this.store=new Ext.data.JsonStore({root:"data",restful:true,autoSave:false,url:this.url,idProperty:"identifier",remoteSort:true,fields:[{name:"identifier",type:"string"},{name:"firstName",type:"string"},{name:"lastName",type:"string"},{name:"email",type:"string"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.login"),dataIndex:"identifier",width:100},{header:i18n.get("label.firstName"),dataIndex:"firstName",width:100},{header:i18n.get("label.lastName"),dataIndex:"lastName",width:250},{header:i18n.get("label.email"),dataIndex:"email",width:200}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this._onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this._onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this._onDelete,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this._onModify};sitools.admin.usergroups.UserCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.usergroups.UserCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},_onCreate:function(){var a=new sitools.admin.usergroups.UserPropPanel({url:this.url,action:"create",store:this.getStore()});a.show(ID.BOX.USER)},_onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.usergroups.UserPropPanel({url:this.url+"/"+b.id,action:"modify",store:this.getStore()});a.show(ID.BOX.USER)},_onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("userCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(c){var b=Ext.decode(c.responseText);if(!b.success){Ext.Msg.alert(i18n.get("label.warning"),b.message);return}this.store.reload();var d=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get(b.message),autoDestroy:true,hideDelay:1000}).show(document)},failure:alertFailure})}});Ext.reg("s-usercrud",sitools.admin.usergroups.UserCrudPanel);Ext.namespace("sitools.admin.usergroups");sitools.admin.usergroups.GroupCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.GROUP,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_SECURITY_URL")+"/groups";this.store=new Ext.data.JsonStore({root:"data",restful:true,url:this.url,remoteSort:true,idProperty:"name",fields:[{name:"name",type:"string"},{name:"description",type:"string"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:200},{header:i18n.get("label.description"),dataIndex:"description",width:400}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},{text:i18n.get("label.users"),icon:"res/images/icons/icons_perso/toolbar_userman.png",handler:this.onMembers,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.usergroups.GroupCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.usergroups.GroupCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.admin.usergroups.GroupPropPanel({url:this.url,action:"create",store:this.getStore()});a.show(ID.BOX.GROUP)},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.usergroups.GroupPropPanel({url:this.url+"/"+b.id,action:"modify",store:this.getStore()});a.show(ID.BOX.GROUP)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("msg.group.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},onMembers:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.usergroups.UsersPanel({mode:"list",url:this.url+"/"+b.id+"/users",data:b.data});a.show(ID.BOX.GROUP)}});Ext.reg("s-groupcrud",sitools.admin.usergroups.GroupCrudPanel);Ext.namespace("sitools.admin.usergroups");sitools.admin.usergroups.RoleCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.ROLE,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_ROLES_URL");this.store=new Ext.data.JsonStore({root:"data",restful:true,url:this.url,remoteSort:true,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:200},{header:i18n.get("label.description"),dataIndex:"description",width:400,sortable:false}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},{text:i18n.get("label.users"),icon:"res/images/icons/icons_perso/toolbar_userman.png",handler:this.onUsers,xtype:"s-menuButton"},{text:i18n.get("label.groups"),icon:"res/images/icons/icons_perso/toolbar_groupman.png",handler:this.onGroups,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.usergroups.RoleCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.usergroups.RoleCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.admin.usergroups.RolePropPanel({url:this.url,action:"create",store:this.store});a.show(ID.BOX.ROLE)},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.usergroups.RolePropPanel({url:this.url+"/"+b.id,action:"modify",store:this.store});a.show(ID.BOX.ROLE)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("roleCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},onUsers:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.usergroups.UsersPanel({mode:"list",url:this.url+"/"+b.id+"/users",data:b.data});a.show(ID.BOX.ROLE)},onGroups:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.usergroups.GroupsPanel({mode:"list",url:this.url+"/"+b.id+"/groups",data:b.data});a.show(ID.BOX.ROLE)}});Ext.reg("s-rolecrud",sitools.admin.usergroups.RoleCrudPanel);Ext.namespace("sitools.admin.usergroups");sitools.admin.usergroups.RolePropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,initComponent:function(){if(this.action=="modify"){this.title=i18n.get("label.modifyRole")}else{this.title=i18n.get("label.createRole")}this.items=[{xtype:"panel",height:450,title:i18n.get("label.roleInfo"),items:[{xtype:"form",border:false,padding:10,items:[{xtype:"hidden",name:"id",fieldLabel:i18n.get("label.id"),anchor:"100%"},{xtype:"textfield",name:"name",fieldLabel:i18n.get("label.name"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"description",fieldLabel:i18n.get("label.description"),anchor:"100%",growMax:400}]}],buttons:[{id:ID.ITEM.OKBUTTON,text:i18n.get("label.ok"),scope:this,handler:this.onModify},{id:ID.ITEM.CANCELBUTTON,text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];sitools.admin.usergroups.RolePropPanel.superclass.initComponent.call(this)},onModify:function(){var a=this.findByType("form")[0].getForm();if(!a.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return}if(this.action=="modify"){Ext.Ajax.request({url:this.url,method:"PUT",scope:this,jsonData:a.getValues(),success:function(c){var b=Ext.decode(c.responseText);if(b.success){this.store.reload();this.close()}else{Ext.Msg.alert(i18n.get("label.warning"),b.message)}},failure:alertFailure})}else{Ext.Ajax.request({url:this.url,method:"POST",scope:this,jsonData:a.getValues(),failure:alertFailure,success:function(c){var b=Ext.decode(c.responseText);if(b.success){this.store.reload();this.close()}else{Ext.Msg.alert(i18n.get("label.warning"),b.message)}}})}},onRender:function(){sitools.admin.usergroups.RolePropPanel.superclass.onRender.apply(this,arguments);if(this.url){var a=this.findByType("form")[0].getForm();if(this.action=="modify"){Ext.Ajax.request({url:this.url,method:"GET",scope:this,success:function(b){var c=Ext.decode(b.responseText);if(c.success){a.setValues(c.role)}else{this.close();Ext.Msg.alert(i18n.get("label.warning"),c.message);return}},failure:alertFailure})}}}});Ext.reg("s-roleprop",sitools.admin.usergroups.RolePropPanel);Ext.namespace("sitools.admin.usergroups");sitools.admin.usergroups.RegPropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,storePanel:null,initComponent:function(){this.storePanel=this.store;this.title=i18n.get("label.modifyRegister");var d=new Ext.data.JsonStore({fields:[{name:"name",type:"string"},{name:"value",type:"string"},{name:"scope",type:"string"}],autoLoad:false});var c=[["Editable"],["ReadOnly"],["Hidden"]];var e=new Ext.data.ArrayStore({fields:["scope"],data:c});var b=new Ext.grid.RowSelectionModel({singleSelect:true});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.name"),dataIndex:"name",editor:new Ext.form.TextField({allowBlank:false})},{header:i18n.get("headers.value"),dataIndex:"value",editor:new Ext.form.TextField({allowBlank:false})},{header:i18n.get("headers.scope"),dataIndex:"scope",editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",lazyRender:true,lazyInit:false,mode:"local",forceSelection:true,valueField:"scope",displayField:"scope",store:e})}],defaults:{sortable:false,width:100}});var f=new Ext.Toolbar({defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreateProperties},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDeleteProperties}]});this.gridProperties=new Ext.grid.EditorGridPanel({title:i18n.get("title.properties"),id:"userGridProperties",height:180,store:d,tbar:f,cm:a,sm:b,viewConfig:{forceFit:true}});this.items=[{xtype:"panel",height:450,items:[{xtype:"panel",title:i18n.get("label.userInfo"),items:[{xtype:"form",border:false,padding:10,items:[{xtype:"textfield",name:"id",hidden:true},{xtype:"textfield",name:"identifier",fieldLabel:i18n.get("label.login"),anchor:"100%"},{xtype:"textfield",name:"firstName",fieldLabel:i18n.get("label.firstName"),anchor:"100%"},{xtype:"textfield",name:"lastName",fieldLabel:i18n.get("label.lastName"),anchor:"100%",growMax:400},{xtype:"textfield",name:"email",fieldLabel:i18n.get("label.email"),anchor:"100%"},{xtype:"textfield",fieldLabel:i18n.get("label.password"),anchor:"100%",inputType:"password",name:"password",id:"regPassword"},{xtype:"textfield",fieldLabel:i18n.get("label.confirmPassword"),anchor:"100%",inputType:"password",name:"confirmPassword",submitValue:false,initialPassField:"regPassword",vtype:"password"}]}]},this.gridProperties],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onModify},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];sitools.admin.usergroups.RegPropPanel.superclass.initComponent.call(this)},onCreateProperties:function(){var a=new Ext.data.Record();this.gridProperties.getStore().insert(this.gridProperties.getStore().getCount(),a)},onDeleteProperties:function(){var b=this.gridProperties.getSelectionModel().getSelections();var a,c;for(a=0;b[a];a++){c=b[a];this.gridProperties.getStore().remove(c)}},onModify:function(){var a=this.findByType("form")[0].getForm();if(!a.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return}var b=a.getValues();b.properties=[];this.gridProperties.getStore().each(function(c){b.properties.push({name:c.data.name,value:c.data.value,scope:c.data.scope})});Ext.Ajax.request({url:this.url,method:"PUT",scope:this,jsonData:b,success:function(c){var d=Ext.decode(c.responseText);if(!d.success){alertFailure(c);this.storePanel.reload();return}this.close();this.storePanel.reload()},failure:alertFailure})},onRender:function(){sitools.admin.usergroups.RegPropPanel.superclass.onRender.apply(this,arguments);if(this.url){var a=this.findByType("form")[0].getForm();Ext.Ajax.request({url:this.url,method:"GET",scope:this,success:function(b){var c=Ext.decode(b.responseText);c.inscription.password="";a.setValues(c.inscription);if(!Ext.isEmpty(c.inscription.properties)){Ext.each(c.inscription.properties,function(d){var e=new Ext.data.Record({name:d.name,value:d.value,scope:d.scope});this.gridProperties.getStore().add(e)},this)}},failure:alertFailure})}}});Ext.reg("s-regprop",sitools.admin.usergroups.RegPropPanel);Ext.namespace("sitools.admin.usergroups");sitools.admin.usergroups.UserPropPanel=Ext.extend(Ext.Window,{id:"winCreateUser",width:700,height:480,modal:true,pageSize:10,initComponent:function(){if(this.action=="create"){this.title=i18n.get("label.createUser")}else{this.title=i18n.get("label.modifyUser")}var d=new Ext.data.JsonStore({fields:[{name:"name",type:"string"},{name:"value",type:"string"},{name:"scope",type:"string"}],autoLoad:false});var c=[["Editable"],["ReadOnly"],["Hidden"]];var e=new Ext.data.ArrayStore({fields:["scope"],data:c});var b=new Ext.grid.RowSelectionModel({singleSelect:true});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.name"),dataIndex:"name",editor:new Ext.form.TextField({allowBlank:false})},{header:i18n.get("headers.value"),dataIndex:"value",editor:new Ext.form.TextField({allowBlank:false})},{header:i18n.get("headers.scope"),dataIndex:"scope",editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",lazyRender:true,lazyInit:false,mode:"local",forceSelection:true,valueField:"scope",displayField:"scope",store:e})}],defaults:{sortable:false,width:100}});var f=new Ext.Toolbar({defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreateProperties},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDeleteProperties}]});this.gridProperties=new Ext.grid.EditorGridPanel({title:i18n.get("title.properties"),id:"userGridProperties",height:180,store:d,tbar:f,cm:a,sm:b,viewConfig:{forceFit:true}});this.items=[{xtype:"panel",height:450,title:i18n.get("label.userInfo"),items:[{xtype:"form",id:"formCreateUser",border:false,padding:10,items:[{xtype:"textfield",name:"firstName",fieldLabel:i18n.get("label.firstName"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"lastName",fieldLabel:i18n.get("label.lastName"),anchor:"100%",growMax:400,allowBlank:false},{xtype:"textfield",name:"email",fieldLabel:i18n.get("label.email"),vtype:"uniqueemail",allowBlank:false,validationEvent:"",anchor:"100%"},{xtype:"textfield",name:"identifier",fieldLabel:i18n.get("label.login"),anchor:"100%",allowBlank:false,disabled:this.action=="create"?false:true,vtype:"name",id:"nameField"},{xtype:"textfield",fieldLabel:i18n.get("label.password"),anchor:"100%",inputType:"password",name:"secret",value:"",id:"passwordField",vtype:"passwordlength"},{id:"confirmSecret",xtype:"textfield",fieldLabel:i18n.get("label.confirmPassword"),anchor:"100%",inputType:"password",initialPassField:"passwordField",vtype:"password",name:"confirmSecret",submitValue:false,value:""},{xtype:"button",name:"generate",id:"generatePass",text:i18n.get("label.generatePassword"),anchor:"9%",handler:this.generatePassword}]},this.gridProperties],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onModifyOrCreate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];sitools.admin.usergroups.UserPropPanel.superclass.initComponent.call(this)},onCreateProperties:function(){var a=new Ext.data.Record();this.gridProperties.getStore().insert(this.gridProperties.getStore().getCount(),a)},onDeleteProperties:function(){var b=this.gridProperties.getSelectionModel().getSelections();var a,c;for(a=0;b[a];a++){c=b[a];this.gridProperties.getStore().remove(c)}},onModifyOrCreate:function(){var c=(this.action=="create")?"POST":"PUT";var a=this.findByType("form")[0].getForm();if(!a.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return}var b=a.getValues();b.properties=[];this.gridProperties.getStore().each(function(d){b.properties.push({name:d.data.name,value:d.data.value,scope:d.data.scope})});Ext.Ajax.request({url:this.url,method:c,scope:this,jsonData:b,success:function(d){var e=Ext.decode(d.responseText);if(!e.success){Ext.Msg.alert(i18n.get("label.warning"),e.message);return false}this.close();this.store.reload()},failure:alertFailure})},onRender:function(){sitools.admin.usergroups.UserPropPanel.superclass.onRender.apply(this,arguments);if(this.url){Ext.Ajax.request({url:this.url,method:"GET",scope:this,success:function(a){var c=this.findByType("form")[0].getForm();var b=Ext.decode(a.responseText);if(b.user!==undefined){c.setValues(b.user);c.findField("identifier").setValue(b.user.identifier);if(!Ext.isEmpty(b.user.properties)){Ext.each(b.user.properties,function(d){var e=new Ext.data.Record({name:d.name,value:d.value,scope:d.scope});this.gridProperties.getStore().add(e)},this)}}},failure:alertFailure})}},generatePassword:function(){var d="!0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";var g=6;var c="";for(var b=0;b<g;b++){var a=Math.floor(Math.random()*d.length);c+=d.substring(a,a+1)}var e=Ext.getCmp("formCreateUser").getForm();e.findField("secret").setValue(c);e.findField("confirmSecret").setValue(c)}});Ext.reg("s-userprop",sitools.admin.usergroups.UserPropPanel);Ext.namespace("sitools.admin.usergroups");sitools.admin.usergroups.GroupPropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,initComponent:function(){if(this.action=="create"){this.title=i18n.get("label.createGroup")}else{this.title=i18n.get("label.modifyGroup")}this.items=[{xtype:"panel",height:450,title:i18n.get("label.groupInfo"),items:[{xtype:"form",border:false,padding:10,items:[{xtype:"textfield",name:"name",fieldLabel:i18n.get("label.name"),anchor:"100%",disabled:this.action!="create",allowBlank:false},{xtype:"textfield",name:"description",fieldLabel:i18n.get("label.description"),anchor:"100%",growMax:400}]}],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onModifyOrCreate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];sitools.admin.usergroups.GroupPropPanel.superclass.initComponent.call(this)},onModifyOrCreate:function(){var a={};var b=this.findByType("form")[0].getForm();if(!b.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return}Ext.iterate(b.getFieldValues(),function(d,e){a[d]=e});var c=(this.action==="create")?"POST":"PUT";if(!b.isValid()){Ext.Msg.alert(i18n.get("warning.invalidForm"));return}Ext.Ajax.request({url:this.url,method:c,scope:this,jsonData:a,success:function(d){var e=Ext.decode(d.responseText);if(!e.success){Ext.Msg.alert(i18n.get("label.warning"),i18n.get(e.message));return false}this.close();this.store.reload()},failure:alertFailure})},onRender:function(){sitools.admin.usergroups.GroupPropPanel.superclass.onRender.apply(this,arguments);if(this.url){var a=this.findByType("form")[0].getForm();Ext.Ajax.request({url:this.url,method:"GET",success:function(b){var c=Ext.decode(b.responseText);if(c.group!==undefined){a.setValues(c.group)}},failure:alertFailure})}}});Ext.reg("s-groupprop",sitools.admin.usergroups.GroupPropPanel);Ext.namespace("sitools.admin.usergroups");sitools.admin.usergroups.UsersPanel=Ext.extend(Ext.Window,{width:350,modal:true,closable:false,pageSize:10,initComponent:function(){this.store=new Ext.data.JsonStore({root:"data",restful:true,autoSave:false,idProperty:"identifier",url:this.url,fields:[{name:"identifier",type:"string"},{name:"firstName",type:"string"},{name:"lastName",type:"string"}]});this.grid=new Ext.grid.GridPanel({xtype:"grid",sm:new Ext.grid.RowSelectionModel(),store:this.store,height:200,columns:[{header:i18n.get("label.login"),dataIndex:"identifier"},{header:i18n.get("label.firstName"),dataIndex:"firstName"},{header:i18n.get("label.lastName"),dataIndex:"lastName"}],bbar:{xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")}});this.items=[{xtype:"panel",title:this.mode=="list"?i18n.get("label.members"):i18n.get("label.selectUsers"),items:[this.grid],tbar:{xtype:"toolbar",defaults:{scope:this,hidden:true},items:[{text:i18n.get("label.add"),hidden:(this.mode=="select"||this.mode=="selectUnique"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this._onCreate},{text:i18n.get("label.remove"),hidden:(this.mode=="select"||this.mode=="selectUnique"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this._onDelete},"->",{xtype:"s-filter",hidden:this.mode=="list",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]},bbar:{xtype:"toolbar",defaults:{scope:this},items:["->",{text:i18n.get("label.ok"),handler:this._onAdd,hidden:this.mode=="list"},{text:i18n.get("label.ok"),handler:this._onOK,hidden:(this.mode=="select"||this.mode=="selectUnique")},{text:i18n.get("label.cancel"),handler:this._onCancel}]}}];sitools.admin.usergroups.UsersPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.usergroups.UsersPanel.superclass.onRender.apply(this,arguments);this.store.load({scope:this,params:{start:0,limit:this.pageSize},callback:function(b,a,c){if(!c){this.close();Ext.Msg.alert(i18n.get("label.warning"),i18n.get("label.loadError"))}}})},_onCreate:function(){var a=new sitools.admin.usergroups.UsersPanel({mode:"select",url:loadUrl.get("APP_URL")+loadUrl.get("APP_SECURITY_URL")+"/users?media=json",storeref:this.store});a.show(this)},_onDelete:function(){var a=this.grid.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}this.store.remove(a)},_onAdd:function(){if(this.mode=="select"){var a=this.grid.getSelectionModel().getSelections();var b=[];Ext.each(a,function(d){b.push(new this.store.recordType({identifier:d.data.identifier,firstName:d.data.firstName,lastName:d.data.lastName}))});this.storeref.add(b)}if(this.mode=="selectUnique"){var c=this.grid.getSelectionModel().getSelected();this.displayField.setValue(c.data.firstName+" "+c.data.lastName);this.valueField.setValue(c.data.identifier)}this.close()},_onOK:function(){var a=this.data;a.users=[];this.store.each(function(b){var c={id:b.data.identifier};a.users.push(c)});Ext.Ajax.request({url:this.url,method:"PUT",scope:this,jsonData:a,success:function(b){var c=Ext.decode(b.responseText);if(!c.success){Ext.Msg.alert(i18n.get("label.warning"),i18n.get(c.message));return false}this.close();this.store.reload()},failure:alertFailure})},_onCancel:function(){this.destroy()}});Ext.reg("s-users",sitools.admin.usergroups.UsersPanel);Ext.namespace("sitools.admin.usergroups");sitools.admin.usergroups.GroupsPanel=Ext.extend(Ext.Window,{width:350,modal:true,closable:false,pageSize:10,initComponent:function(){this.store=new Ext.data.JsonStore({root:"data",restful:true,autoSave:false,idProperty:"name",url:this.url,fields:[{name:"name",type:"string"},{name:"description",type:"string"}]});this.grid=new Ext.grid.GridPanel({xtype:"grid",sm:new Ext.grid.RowSelectionModel(),store:this.store,height:200,columns:[{header:i18n.get("label.name"),dataIndex:"name"},{header:i18n.get("label.description"),dataIndex:"description"}],bbar:{xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")}});this.items=[{xtype:"panel",title:this.mode=="list"?i18n.get("label.groups"):i18n.get("label.selectGroups"),items:[this.grid],tbar:{xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.add"),hidden:this.mode=="select",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this._onCreate},{text:i18n.get("label.remove"),hidden:this.mode=="select",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this._onDelete},"->",{xtype:"s-filter",hidden:this.mode=="list",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]},bbar:{xtype:"toolbar",defaults:{scope:this},items:["->",{text:i18n.get("label.add"),handler:this._onAdd,hidden:this.mode=="list"},{text:i18n.get("label.ok"),handler:this._onOK,hidden:this.mode=="select"},{text:i18n.get("label.cancel"),handler:this._onCancel}]}}];sitools.admin.usergroups.GroupsPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.usergroups.GroupsPanel.superclass.onRender.apply(this,arguments);this.store.load({scope:this,params:{start:0,limit:this.pageSize},callback:function(b,a,c){if(!c){this.close();Ext.Msg.alert(i18n.get("label.warning"),i18n.get("label.loadError"))}}})},_onCreate:function(){var a=new sitools.admin.usergroups.GroupsPanel({mode:"select",url:loadUrl.get("APP_URL")+loadUrl.get("APP_SECURITY_URL")+"/groups?media=json",storeref:this.store});a.show(this)},_onDelete:function(){var a=this.grid.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}this.store.remove(a)},_onAdd:function(){var a=this.grid.getSelectionModel().getSelections();var b=[];Ext.each(a,function(c){b.push(new this.store.recordType({name:c.data.name,description:c.data.description}))});this.storeref.add(b);this.close()},_onOK:function(){var a=this.data;a.groups=[];this.store.each(function(b){var c={id:b.data.name};a.groups.push(c)});Ext.Ajax.request({url:this.url,method:"PUT",scope:this,jsonData:a,success:function(b){var c=Ext.decode(b.responseText);if(!c.success){Ext.Msg.alert(i18n.get("label.warning"),i18n.get(c.message));return false}this.close();this.store.reload()},failure:alertFailure})},_onCancel:function(){this.destroy()}});Ext.reg("s-groups",sitools.admin.usergroups.GroupsPanel);Ext.namespace("sitools.admin.projects");sitools.admin.projects.datasetsWin=Ext.extend(Ext.Window,{width:350,modal:true,closable:false,pageSize:10,id:"projectsDatasetWinId",initComponent:function(){this.title=i18n.get("label.datasets");this.store=new Ext.data.JsonStore({root:"data",restful:true,autoSave:false,idProperty:"id",totalProperty:"total",url:loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_URL"),fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"type",type:"string"},{name:"mediaType",type:"string"},{name:"visible",type:"boolean"},{name:"status",type:"string"},{name:"nbRecords",type:"string"},{name:"sitoolsAttachementForUsers",type:"string"},{name:"image"},{name:"descriptionHTML",type:"string"}]});this.grid=new Ext.grid.GridPanel({sm:new Ext.grid.RowSelectionModel(),store:this.store,height:200,columns:[{header:i18n.get("label.name"),dataIndex:"name"},{header:i18n.get("label.description"),dataIndex:"description"}]});this.items=[{xtype:"panel",title:i18n.get("label.selectDataset"),items:[this.grid],bbar:{xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")}}];this.buttons=[{text:i18n.get("label.ok"),scope:this,handler:this._onOK},{text:i18n.get("label.cancel"),scope:this,handler:this._onCancel}];sitools.admin.projects.datasetsWin.superclass.initComponent.call(this)},onRender:function(){sitools.admin.projects.datasetsWin.superclass.onRender.apply(this,arguments);this.store.load({scope:this,params:{start:0,limit:this.pageSize},callback:function(b,a,c){if(!c){this.close();Ext.Msg.alert(i18n.get("label.warning"),i18n.get("label.loadError"))}}})},_onOK:function(){Ext.each(this.grid.getSelectionModel().getSelections(),function(c){if(this.storeDatasets.find("id",c.data.id)==-1){var b=c.data.image;var a=[{name:"nbRecord",value:c.data.nbRecords},{name:"descriptionHTML",value:c.data.descriptionHTML}];if(!Ext.isEmpty(b)){a.push({name:"imageUrl",value:b.url})}this.storeDatasets.add(new Ext.data.Record({id:c.data.id,name:c.data.name,description:c.data.description,type:c.data.type,mediaType:c.data.mediaType,visible:c.data.visible,status:c.data.status,properties:a,url:c.data.sitoolsAttachementForUsers}))}},this);this.close()},_onCancel:function(){this.destroy()}});Ext.namespace("sitools.component.projects");sitools.component.projects.ProjectsPropPanel=Ext.extend(Ext.Window,{width:700,height:580,modal:true,pageSize:10,id:ID.COMPONENT_SETUP.PROJECT,allModulesDetached:false,defaultValueTpl:"default.project.ftl",defaultDescription:"SITools2 est une plate-forme web conviviale permettant de mettre en place un systme de recherche et d'accs aux donnes  partir d'une ou plusieurs bases de donnes existantes. SiTools2 permet de prendre en compte et de s'adapter aux structures de nombreuses bases de donnes qui sont gres dans divers centres scientifiques, et permet d'viter des processus lourds et complexes de migration de donnes. <div class='field-items'> <p>L'architecture de cette plate-forme est compose&nbsp;:</p> <ol> <li>d'un serveur de donnes exposant des ressources,&nbsp; </li><li>d'une interface web pour l'administrateur permettant de configurer l'ensemble des fonctionnalits du serveur,&nbsp; </li><li>d'une interface web pour les utilisateurs comportant un portail qui liste les projets, avec un bureau pour chaque projet qui expose l'ensemble des services mis  disposition par l'administrateur,&nbsp; </li><li>d'un mcanisme de plugins permettant aux dveloppeurs d'ajouter des fonctionnalits mtiers aussi bien au niveau du serveur qu'au niveau du client et de les partager avec une communaut d'utilisateurs.&nbsp; </li></ol> <p>SITools2 s'articule autour de trois concepts importants&nbsp;:</p> <ul> <li>la source de donnes&nbsp;: infrastructure contenant les donnes (actuellement une base de donnes relationnelle accessible via l'API JDBC), </li><li>le jeu de donnes&nbsp;: exposition d'un sous-ensemble de la source de donnes par l'intermdiaire d'un service web, </li><li>le projet&nbsp;: ensemble de jeux de donnes. </li></ul> <p>Des services peuvent tre ensuite dfinis  partir de ces trois concepts&nbsp;:</p> <ul> <li>dfinition et exposition du formulaire de recherche, </li><li>dfinition et exposition de la recherche OpenSearch, </li><li>dfinition et exposition des fonctions de conversion (unit, fonction de transfert), </li><li>dfinition et exposition des fonctions de filtrage, </li><li>dfinition et exposition de dictionnaires de donnes, </li><li>dfinition et exposition de flux RSS, </li><li>dfinition et exposition des plugins. </li></ul> <p>Comme tout systme d'accs, il est important de pouvoir scuriser l'accs  certaines ressources selon le profil de l'utilisateur. C'est pourquoi SITools2 implmente une gestion complte des utilisateurs (information personnalisable, espace de stockage sur le serveur de donnes) et permet de scuriser l'ensemble des ressources en fonction du rle de chaque utilisateur.</p></div>",defaultHeader:'<div id="top-header" style="background-color: black;"> <a href="http://www.cnes.fr" target="_blank"> <img src="/sitools/common/res/images/entete_cnes.png" style="border: none;"> </a> </div>',defaultLinks:[{name:"label.legalInformations",url:"/sitools/common/html/legalInformations.html"},{name:"label.personalInformations",url:"/sitools/common/html/personalInformations.html"},{name:"label.contacts",url:"/sitools/common/html/contacts.html"},{name:"label.help",url:"/sitools/common/html/help.html"},{name:"label.editorialInformations",url:"/sitools/common/html/editorialInformations.html"}],initComponent:function(){var action=this.action;if(this.action==="view"){this.title=i18n.get("label.viewProject")}if(this.action==="modify"){this.title=i18n.get("label.modifyProject")}if(this.action==="create"){this.title=i18n.get("label.createProject")}if(this.action==="duplicate"){this.title=i18n.get("label.duplicateProject")}var storeDataSets=new Ext.data.JsonStore({id:"storeDataSets",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"type",type:"string"},{name:"mediaType",type:"string"},{name:"visible",type:"string"},{name:"status",type:"string"},{name:"properties"},{name:"url",type:"string"}]});var cmDataSets=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.name"),dataIndex:"name",width:100},{header:i18n.get("headers.description"),dataIndex:"description",width:100}],defaults:{sortable:true,width:100}});var smDataSets=new Ext.grid.RowSelectionModel({singleSelect:false});var tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.add"),hidden:this.mode==="select",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this._onCreate},{text:i18n.get("label.remove"),hidden:this.mode==="select",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this._onDelete},"->",{xtype:"s-filter",hidden:this.mode==="list",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.gridDataSets=new Ext.grid.EditorGridPanel({id:"gridDataSets",title:i18n.get("title.gridDataSets"),store:storeDataSets,tbar:tbar,cm:cmDataSets,sm:smDataSets,viewConfig:{forceFit:true},listeners:{activate:function(){if(action==="view"){this.getEl().mask()}}}});this.formProject=new Ext.FormPanel({title:i18n.get("label.projectInfo"),xtype:"form",border:false,autoScroll:true,padding:10,trackResetOnLoad:true,items:[{xtype:"hidden",name:"id"},{xtype:"hidden",name:"maintenance"},{xtype:"textfield",name:"name",fieldLabel:i18n.get("label.name"),anchor:"100%",maxLength:30,allowBlank:false},{xtype:"textfield",name:"description",fieldLabel:i18n.get("label.description"),anchor:"100%"},{xtype:"textfield",vtype:"attachment",name:"sitoolsAttachementForUsers",fieldLabel:i18n.get("label.userAttach"),anchor:"100%",maxLength:100},{xtype:"sitoolsSelectImage",name:"image",fieldLabel:i18n.get("label.image"),anchor:"100%",growMax:400},{xtype:"checkbox",name:"visible",fieldLabel:i18n.get("label.isVisible"),anchor:"100%",maxLength:100},{xtype:"textarea",name:"htmlDescription",cls:"ckeditor",fieldLabel:i18n.get("label.descriptionHTML"),height:150,anchor:"95%",value:this.defaultDescription},{xtype:"textarea",cls:"ckeditor",name:"maintenanceText",fieldLabel:i18n.get("label.maintenanceText"),height:150,anchor:"95%"}],listeners:{activate:function(){if(action==="view"){this.getEl().mask()}}}});this.ihmProfile=new Ext.FormPanel({title:i18n.get("label.ihmProfile"),xtype:"form",border:false,autoScroll:true,padding:10,trackResetOnLoad:true,items:[{xtype:"radiogroup",fieldLabel:i18n.get("label.navigationMode"),items:[{boxLabel:i18n.get("label.desktop"),name:"navigationMode",inputValue:"desktop",checked:true},{boxLabel:i18n.get("label.fixed"),name:"navigationMode",inputValue:"fixed"}]},{xtype:"textfield",name:"css",fieldLabel:i18n.get("label.css"),anchor:"100%",maxLength:100},{xtype:"textfield",name:"ftlTemplateFile",fieldLabel:i18n.get("label.ftlTemplateFile"),anchor:"100%",tooltip:i18n.get("label.projectTemplateHelp"),value:this.defaultValueTpl},{xtype:"textarea",name:"htmlHeader",cls:"ckeditor",fieldLabel:i18n.get("label.htmlHeader"),height:150,anchor:"95%",value:this.defaultHeader}],listeners:{activate:function(){if(action==="view"){this.getEl().mask()}}}});this.allModulesAttachedBtn=new Ext.Button({text:this.allModulesDetached?i18n.get("label.allDetached"):i18n.get("label.allAttached"),hidden:this.mode==="select",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this._onAllModulesAttached,scope:this});this.listRolesBtn=new Ext.Button({text:i18n.get("label.rolecrud"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/tree_role.png",scope:this,handler:this._onRoles});var tbarModules={xtype:"sitools.widget.GridSorterToolbar",gridId:"gridModules",items:[this.allModulesAttachedBtn,this.listRolesBtn]};var storeAllModules=new Ext.data.JsonStore({root:"data",url:loadUrl.get("APP_URL")+loadUrl.get("APP_PROJECTS_MODULES_URL"),restful:true,remoteSort:false,autoSave:false,autoLoad:true,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"attached",type:"boolean"},{name:"listRoles"},{name:"categoryModule"},{name:"divIdToDisplay"},{name:"xtype",type:"string"},{name:"moduleConfig"},{name:"label"},{name:"dependencies"}],listeners:{scope:this,load:function(store){this.loadNonAvailableProjects(store);if(this.action==="create"){this._onAllModulesAttached();var rec;var storeProject=this.modulePanel.getStore();var recDsExplorerIdx=storeProject.find("name","DataSetExplorer");if(recDsExplorerIdx!==-1){rec=storeProject.getAt(recDsExplorerIdx);rec.set("divIdToDisplay","news")}var recNewsIdx=storeProject.find("name","ProjectsFeeds");if(recNewsIdx!==-1){rec=storeProject.getAt(recNewsIdx);rec.set("divIdToDisplay","shortcuts")}}}}});var storeProjectModules=new Ext.data.JsonStore({autoLoad:false,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"attached",type:"boolean"},{name:"listRoles"},{name:"categoryModule"},{name:"divIdToDisplay"},{name:"xtype",type:"string"},{name:"listProjectModulesConfig"},{name:"label",type:"string"},{name:"dirty",type:"boolean"}],listeners:{scope:this,add:function(store){if(store.allAttached()){this.allModulesAttachedBtn.setText(i18n.get("label.Detached"));this.allModulesDetached=true}if(store.allDetached()){this.allModulesAttachedBtn.setText(i18n.get("label.Attached"));this.allModulesDetached=false}},update:function(store,record){var index=store.indexOf(record);if(store.allAttached()){this.allModulesAttachedBtn.setText(i18n.get("label.Detached"));this.allModulesDetached=true}if(store.allDetached()){this.allModulesAttachedBtn.setText(i18n.get("label.Attached"));this.allModulesDetached=false}}},allAttached:function(){var result=true;this.each(function(record){if(record.get("attached")===false){result=false;return false}});return result},allDetached:function(){var result=true;this.each(function(record){if(record.get("attached")===true){result=false;return false}});return result}});var smModules=new Ext.grid.RowSelectionModel({singleSelect:false});var attached=new Ext.grid.CheckColumn({header:i18n.get("headers.attached"),dataIndex:"attached",width:55});var visible=new Ext.grid.CheckColumn({header:i18n.get("headers.visible"),dataIndex:"visible",width:55});var cmModules=new Ext.grid.ColumnModel({columns:[attached,{header:i18n.get("headers.name"),dataIndex:"name",width:100},{header:i18n.get("headers.description"),dataIndex:"description",width:100},{header:i18n.get("headers.label"),dataIndex:"label",width:100,editor:new Ext.form.TextField()},{header:i18n.get("headers.category")+' <img title="Editable" height=14 widht=14 src="/sitools/common/res/images/icons/toolbar_edit.png"/>',dataIndex:"categoryModule",width:100,editor:new Ext.form.TextField()},{header:i18n.get("headers.divIdToDisplay")+' <img title="Editable" height=14 widht=14 src="/sitools/common/res/images/icons/toolbar_edit.png"/>',dataIndex:"divIdToDisplay",width:100,editor:new Ext.form.TextField()},{xtype:"actioncolumn",header:i18n.get("headers.projectModuleParameters"),width:100,items:[{icon:loadUrl.get("APP_URL")+"/common/res/images/icons/tree_projects_resources.png",scope:this,handler:function(grid,row,col,item,e){this.modulePanel.getSelectionModel().selectRow(row);var rec=this.modulePanel.getSelectionModel().getSelected();this._onModuleConfig(rec)}}],scope:this,renderer:function(value,metadata,record,rowInd,colInd,store){if(record.data.xtype){try{var getParametersMethod=eval(record.data.xtype+".getParameters");if(!Ext.isFunction(getParametersMethod)){metadata.attr+='style="display:none;"'}}catch(err){metadata.attr+='style="display:none;"';return}}}}],defaults:{sortable:true,width:100}});this.modulePanel=new Ext.grid.EditorGridPanel({id:"gridModules",title:i18n.get("title.modules"),store:storeProjectModules,cm:cmModules,sm:smModules,tbar:tbarModules,viewConfig:{forceFit:true,getRowClass:function(row,index){var cls="";var data=row.data;if(data.dirty){cls="red-row"}return cls}},listeners:{activate:function(){if(action=="view"){this.getEl().mask()}}},plugins:[attached,visible]});var storeLinks=new Ext.data.JsonStore({idProperty:"name",fields:[{name:"name",type:"string"},{name:"url",type:"string"}]});var linksPanelTbar={xtype:"sitools.widget.GridSorterToolbar",gridId:"linksPanelGrid",items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreateLink,scope:this},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDeleteLink,scope:this}]};this.linksPanel=new Ext.grid.EditorGridPanel({title:i18n.get("label.links"),store:storeLinks,tbar:linksPanelTbar,id:"linksPanelGrid",cm:new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.name"),dataIndex:"name",width:100,editor:new Ext.form.TextField({allowBlank:false})},{header:i18n.get("headers.url"),dataIndex:"url",width:100,editor:new Ext.form.TextField({allowBlank:false})}]}),sm:new Ext.grid.RowSelectionModel({singleSelect:true}),viewConfig:{forceFit:true},listeners:{activate:function(){if(action=="view"){this.getEl().mask()}}}});this.tabPanel=new Ext.TabPanel({height:550,activeTab:0,items:[this.formProject,this.ihmProfile,this.gridDataSets,this.modulePanel,this.linksPanel],deferredRender:false,buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate,hidden:this.action=="view"},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]});this.items=[this.tabPanel];this.listeners={scope:this,resize:function(window,width,height){var size=window.body.getSize();this.tabPanel.setSize(size)},beforedestroy:function(){this.destroyCkeditor()}};sitools.component.projects.ProjectsPropPanel.superclass.initComponent.call(this)},_onCreate:function(){var a=new sitools.admin.projects.datasetsWin({mode:"select",url:loadUrl.get("APP_URL")+"/datasets",storeDatasets:this.gridDataSets.getStore()});a.show(this)},_onDelete:function(){var a=this.gridDataSets.getSelectionModel().getSelections();if(a.length===0){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}this.gridDataSets.getStore().remove(a)},_onRoles:function(){var b=this.modulePanel.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.usergroups.RolesPanel({mode:"list",rec:b});a.show(ID.BOX.ROLE)},_onModuleConfig:function(){var b=this.modulePanel.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.projects.modules.ProjectModuleConfig({module:b});a.show()},onUpload:function(){function b(d,c){c.fieldUrl.setValue(d.url)}var a=new ImageChooser({url:loadUrl.get("APP_URL")+"/client-admin/res/json/componentList.json",width:515,height:350,fieldUrl:this.ownerCt.items.items[0]});a.show(document,b)},onValidate:function(){var c=this.findByType("form")[0].getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return false}this.refreshTextAreaValues();if(this.action=="modify"){var b=c.findField("name").getValue();var a=c.findField("name").originalValue;if(a!=b){Ext.Msg.show({title:i18n.get("label.warning"),buttons:Ext.Msg.YESNO,msg:i18n.get("projectProp.warning.projectName.changed"),scope:this,fn:function(d,e){if(d=="yes"){this.onSaveProject()}}})}else{this.onSaveProject()}}else{this.onSaveProject()}},onSaveProject:function(){var f=this.findByType("form")[0].getForm();var putObject={};Ext.iterate(f.getValues(),function(key,value){if(key=="image"){putObject.image={};putObject.image.url=value;putObject.image.type="Image";putObject.image.mediaType="Image"}else{if(key!="visible"){putObject[key]=value}}},this);var visibleField=f.findField("visible");putObject.visible=visibleField.getValue();f=this.ihmProfile.getForm();Ext.iterate(f.getValues(),function(key,value){putObject[key]=value},this);var store=this.findById("gridDataSets").getStore();if(store.getCount()>0){putObject.dataSets=[];store.each(function(record){putObject.dataSets.push({id:record.data.id,description:record.data.description,name:record.data.name,mediaType:"DataSet",type:"DataSet",visible:record.data.visible,status:record.data.status,properties:record.data.properties,url:record.data.url})})}var storeModule=this.modulePanel.getStore();var correctlyParamModule=true;if(storeModule.getCount()>0){putObject.modules=[];var i=0;storeModule.each(function(record){if(record.data.attached){if(Ext.isEmpty(record.data.listRoles)){record.data.listRoles=undefined}record.set("dirty",false);if(record.data.xtype){var getParametersMethod;try{if(!Ext.isFunction(eval(record.data.xtype))){record.set("dirty",true);Ext.Msg.alert(i18n.get("label.warning"),String.format(i18n.get("label.undefinedModule"),record.data.name));correctlyParamModule=false}getParametersMethod=eval(record.data.xtype+".getParameters")}catch(err){var tmp=null}if(Ext.isFunction(getParametersMethod)){var listProjectModulesConfig;if(record.data.listProjectModulesConfig!=undefined&&record.data.listProjectModulesConfig.length!=0){listProjectModulesConfig=record.data.listProjectModulesConfig;putObject.modules.push({description:record.data.description,id:record.data.id,name:record.data.name,visible:record.data.visible,priority:i,listRoles:record.data.listRoles,categoryModule:record.data.categoryModule,divIdToDisplay:record.data.divIdToDisplay,xtype:record.data.xtype,listProjectModulesConfig:listProjectModulesConfig,label:record.data.label})}else{record.set("dirty",true);Ext.Msg.alert(i18n.get("label.warning"),i18n.get("label.needToParamModule"));correctlyParamModule=false}}else{putObject.modules.push({description:record.data.description,id:record.data.id,name:record.data.name,visible:record.data.visible,priority:i,listRoles:record.data.listRoles,categoryModule:record.data.categoryModule,divIdToDisplay:record.data.divIdToDisplay,xtype:record.data.xtype,label:record.data.label})}}else{putObject.modules.push({description:record.data.description,id:record.data.id,name:record.data.name,visible:record.data.visible,priority:i,listRoles:record.data.listRoles,categoryModule:record.data.categoryModule,divIdToDisplay:record.data.divIdToDisplay,})}i++}},this)}var storeLinks=this.linksPanel.getStore();if(storeLinks.getCount()>0){putObject.links=[];storeLinks.each(function(record){putObject.links.push({name:record.get("name"),url:record.get("url")})})}var method=(this.action=="modify")?"PUT":"POST";if(correctlyParamModule){Ext.Ajax.request({url:this.url,method:method,scope:this,jsonData:putObject,success:function(ret){var data=Ext.decode(ret.responseText);if(data.success===false){Ext.Msg.alert(i18n.get("label.warning"),i18n.get(data.message))}else{this.close();this.store.reload()}},failure:alertFailure})}},afterRender:function(){sitools.component.projects.ProjectsPropPanel.superclass.afterRender.apply(this,arguments);if(this.url){var a=this.url;if(this.action=="duplicate"){a=this.projectUrlToCopy}if(this.action=="modify"||this.action=="view"||this.action=="duplicate"){Ext.Ajax.request({url:a,method:"GET",scope:this,success:function(n){var m=this.findByType("form")[0].getForm();var c=this.findById("gridDataSets");var q=c.getStore();var k=Ext.decode(n.responseText).project;var p=k.dataSets;Ext.each(p,function(f){var s={};s.id=f.id;s.name=f.name;s.description=f.description;s.type=f.description;s.mediaType=f.mediaType;s.status=f.status;s.visible=f.visible;s.properties=f.properties;s.url=f.url;q.add(new Ext.data.Record(s))});var e={};if(this.action=="duplicate"){e.name=k.name+"_copy"}else{e.id=k.id;e.name=k.name;e.sitoolsAttachementForUsers=k.sitoolsAttachementForUsers}e.description=k.description;e.image=k.image.url;e.visible=k.visible;e.htmlDescription=k.htmlDescription;e.maintenanceText=k.maintenanceText;e.maintenance=k.maintenance;var l=new Ext.data.Record(e);m.loadRecord(l);e={};e.css=k.css;e.htmlHeader=k.htmlHeader;e.ftlTemplateFile=k.ftlTemplateFile;e.navigationMode=k.navigationMode;m=this.ihmProfile.getForm();m.setValues(e);try{this.ihmProfile.find("xtype","radiogroup")[0].setValue(e.navigationMode)}catch(d){var g}if(!Ext.isEmpty(k.modules)){Ext.each(k.modules,function(f){var s=new Ext.data.Record(Ext.apply(f,{attached:true}));this.modulePanel.getStore().add(s)},this)}var r=k.links;var b=this.linksPanel.getStore();if(!Ext.isEmpty(r)){Ext.each(r,function(f){b.add(new Ext.data.Record(f))},this)}this.applyCkeditor()},failure:function(b){var c=Ext.decode(b.responseText);Ext.Msg.alert(i18n.get("label.warning"),c.errorMessage)}})}if(this.action==="create"){this.fillDefaultLinks();this.applyCkeditor()}}},fillDefaultLinks:function(){Ext.each(this.defaultLinks,function(a){var b=new Ext.data.Record(a);this.linksPanel.getStore().add(b)},this)},displayProjectModules:function(b,a){if(this.action==="create"){this.modulePanel.getStore().each(function(c){c.set("attached",true)})}else{Ext.each(b,function(c){c.set("priority",b.length+1);Ext.each(a.modules,function(d){if(c.id==d.id){c.set("attached",true);c.set("priority",d.priority);c.set("listRoles",d.listRoles);c.set("divIdToDisplay",d.divIdToDisplay);c.set("categoryModule",d.categoryModule);c.set("xtype",d.xtype);return false}})})}this.modulePanel.getStore().sort("priority")},_onAllModulesAttached:function(){var a=this.allModulesDetached;this.modulePanel.getStore().each(function(b){b.set("attached",!a)},this)},onCreateLink:function(){var a=new Ext.data.Record();this.linksPanel.getStore().insert(this.linksPanel.getStore().getCount(),a)},onDeleteLink:function(){var b=this.linksPanel.getSelectionModel().getSelections();var a,c;for(a=0;b[a];a++){c=b[a];this.linksPanel.getStore().remove(c)}},loadNonAvailableProjects:function(a){var b=[];a.each(function(d){if(!Ext.isEmpty(d.get("dependencies")&&!Ext.isEmpty(d.get("dependencies").js))){b=b.concat(d.get("dependencies").js)}var c=this.modulePanel.getStore();if(c.findExact("name",d.get("name"))===-1){c.add(d)}},this);if(!Ext.isEmpty(b)){includeJsForceOrder(b,0,function(){this.modulePanel.getView().refresh()},this)}},applyCkeditor:function(){CKEDITOR.replaceAll(function(a,b){if(!Ext.isEmpty(a.classList)&&a.classList.contains("ckeditor")){b.customConfig="config-basic.js";b.width="95%";b.displayDatasetLink=false;return true}else{return false}})},refreshTextAreaValues:function(){Ext.iterate(CKEDITOR.instances,function(b,a){a.updateElement()})},destroyCkeditor:function(){Ext.iterate(CKEDITOR.instances,function(b,a){if(!Ext.isEmpty(a)){a.destroy();CKEDITOR.remove(a)}a.updateElement()})}});Ext.reg("s-projectsprop",sitools.component.projects.ProjectsPropPanel);Ext.namespace("sitools.component.projects");sitools.component.projects.projectsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.PROJECTS,sm:new Ext.grid.RowSelectionModel(),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_PROJECTS_URL");this.store=new Ext.data.JsonStore({root:"data",restful:true,url:this.url,remoteSort:true,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"image",type:"string",mapping:"image.url"},{name:"description",type:"string"},{name:"status",type:"string"},{name:"maintenance",type:"boolean"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:false},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.image"),dataIndex:"image",width:300},{header:i18n.get("label.description"),dataIndex:"description",width:400},{header:i18n.get("label.status"),dataIndex:"status",width:150},{header:i18n.get("label.maintenance"),dataIndex:"maintenance",width:150,renderer:function(a){if(a){return'<div class="sitools-maintenance">&nbsp;</div>'}else{return"<div>&nbsp;</div>"}}}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},{text:i18n.get("label.active"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_active.png",handler:this._onActive,xtype:"s-menuButton"},{text:i18n.get("label.disactive"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_disactive.png",handler:this._onDisactive,xtype:"s-menuButton"},"-",{text:i18n.get("label.startmaintenance"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_active.png",handler:this._onStartMaintenance,xtype:"s-menuButton"},{text:i18n.get("label.stopmaintenance"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_disactive.png",handler:this._onStopMaintenance,xtype:"s-menuButton"},{text:i18n.get("label.duplicate"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/presentation1.png",handler:this.onDuplicate},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.component.projects.projectsCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.projects.projectsCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.component.projects.ProjectsPropPanel({url:this.url,action:"create",store:this.getStore()});a.show(ID.BOX.PROJECTS)},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.component.projects.ProjectsPropPanel({url:this.url+"/"+b.id,action:b.data.status=="ACTIVE"?"view":"modify",store:this.getStore(),projectName:b.name,projectAttachement:b.sitoolsAttachementForUsers});a.show(ID.BOX.PROJECTS)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("projectCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(c){var b=Ext.decode(c.responseText);if(showResponse(c)){this.store.reload()}},failure:alertFailure})},_onStartMaintenance:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"/startmaintenance",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onStopMaintenance:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"/stopmaintenance",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"/start",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"/stop",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},onDuplicate:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.component.projects.ProjectsPropPanel({projectUrlToCopy:this.url+"/"+b.id,url:this.url,action:"duplicate",store:this.getStore()});a.show(ID.BOX.DATASETS)}});Ext.reg("s-projects",sitools.component.projects.projectsCrudPanel);Ext.namespace("sitools.admin.collections");sitools.admin.collections.CollectionsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.COLLECTIONS,pageSize:10,initComponent:function(){this.urlCollections=loadUrl.get("APP_URL")+loadUrl.get("APP_COLLECTIONS_URL");this.store=new Ext.data.JsonStore({root:"data",restful:true,url:this.urlCollections,remoteSort:true,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"}],autoLoad:true});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:400,sortable:false}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.collections.CollectionsCrudPanel.superclass.initComponent.call(this)},onCreate:function(){var a=new sitools.admin.collections.CollectionsPropPanel({urlCollections:this.urlCollections,action:"create",store:this.getStore()});a.show(ID.BOX.FORMS)},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.collections.CollectionsPropPanel({urlCollections:this.urlCollections+"/"+b.data.id,action:"modify",store:this.getStore()});a.show()},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:{yes:i18n.get("label.yes"),no:i18n.get("label.no")},msg:i18n.get("collectionsCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.urlCollections+"/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-collections",sitools.admin.collections.CollectionsCrudPanel);Ext.namespace("sitools.admin.collections");sitools.admin.collections.CollectionsPropPanel=Ext.extend(Ext.Window,{width:700,height:580,modal:true,pageSize:10,dataSets:"",id:ID.COMPONENT_SETUP.COLLECTIONS,allModulesDetached:false,allModulesInvisible:false,initComponent:function(){var c=this.action;if(this.action=="modify"){this.title=i18n.get("label.modifyCollection")}if(this.action=="create"){this.title=i18n.get("label.createCollection")}var d=new Ext.data.JsonStore({id:"storeDataSets",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"type",type:"string"},{name:"mediaType",type:"string"},{name:"visible",type:"string"},{name:"status",type:"string"},{name:"properties"},{name:"url",type:"string"}]});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.name"),dataIndex:"name",width:100},{header:i18n.get("headers.description"),dataIndex:"description",width:100}],defaults:{sortable:true,width:100}});var b=new Ext.grid.RowSelectionModel({singleSelect:false});var e={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.add"),hidden:this.mode=="select",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this._onAttachDataset},{text:i18n.get("label.remove"),hidden:this.mode=="select",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this._onDeleteDataset}]};this.gridDataSets=new Ext.grid.GridPanel({id:"gridDataSets",flex:1,title:i18n.get("title.gridDataSets"),store:d,tbar:e,cm:a,sm:b,viewConfig:{forceFit:true},listeners:{activate:function(){if(c=="view"){this.getEl().mask()}}}});this.formCollection=new Ext.FormPanel({title:i18n.get("label.CollectionInfo"),xtype:"form",border:false,padding:10,trackResetOnLoad:true,items:[{xtype:"hidden",name:"id"},{xtype:"textfield",name:"name",fieldLabel:i18n.get("label.name"),anchor:"100%",maxLength:30,allowBlank:false},{xtype:"textfield",name:"description",fieldLabel:i18n.get("label.description"),anchor:"100%"}]});this.mainPanel=new Ext.Panel({height:550,layout:"vbox",layoutConfig:{align:"stretch"},items:[this.formCollection,this.gridDataSets],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate,hidden:this.action=="view"},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]});this.items=[this.mainPanel];this.listeners={scope:this,resize:function(l,k,f){var g=l.body.getSize();this.mainPanel.setSize(g)}};sitools.admin.collections.CollectionsPropPanel.superclass.initComponent.call(this)},_onAttachDataset:function(){var a=new sitools.admin.projects.datasetsWin({mode:"select",url:loadUrl.get("APP_URL")+"/datasets",storeDatasets:this.gridDataSets.getStore()});a.show(this)},_onDeleteDataset:function(){var a=this.gridDataSets.getSelectionModel().getSelections();if(a.length===0){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}this.gridDataSets.getStore().remove(a)},onValidate:function(){var a=this.findByType("form")[0].getForm();if(!a.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return false}this.onSaveCollection()},onSaveCollection:function(){var b=this.findByType("form")[0].getForm();var d={};Ext.iterate(b.getValues(),function(e,f){d[e]=f},this);var a=this.findById("gridDataSets").getStore();if(a.getCount()>0){d.dataSets=[];a.each(function(e){d.dataSets.push({id:e.data.id,description:e.data.description,name:e.data.name,mediaType:"DataSet",type:"DataSet",visible:e.data.visible,status:e.data.status,properties:e.data.properties,url:e.data.url})})}var c=(this.action=="modify")?"PUT":"POST";Ext.Ajax.request({url:this.urlCollections,method:c,scope:this,jsonData:d,success:function(e){var f=Ext.decode(e.responseText);if(f.success===false){Ext.Msg.alert(i18n.get("label.warning"),i18n.get(f.message))}else{this.close();this.store.reload()}},failure:alertFailure})},onRender:function(){sitools.admin.collections.CollectionsPropPanel.superclass.onRender.apply(this,arguments);if(this.urlCollections){if(this.action=="modify"){Ext.Ajax.request({url:this.urlCollections,method:"GET",scope:this,success:function(d){var k=this.findByType("form")[0].getForm();var e=this.findById("gridDataSets");var c=e.getStore();var g=Ext.decode(d.responseText).collection;var b=g.dataSets;Ext.each(b,function(f){var m={};m.id=f.id;m.name=f.name;m.description=f.description;m.type=f.description;m.mediaType=f.mediaType;m.status=f.status;m.visible=f.visible;m.properties=f.properties;m.url=f.url;c.add(new Ext.data.Record(m))});var l={};l.id=g.id;l.name=g.name;l.description=g.description;var a=new Ext.data.Record(l);k.loadRecord(a)},failure:function(a){var b=Ext.decode(a.responseText);Ext.Msg.alert(i18n.get("label.warning"),b.errorMessage)}})}}}});Ext.reg("s-collectionsprop",sitools.admin.collections.CollectionsPropPanel);Ext.namespace("sitools.admin.multiDs");sitools.admin.multiDs.MultiDsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.MULTIDS,pageSize:10,urlMultiDs:"/tmp",initComponent:function(){this.baseUrlMultiDs=loadUrl.get("APP_URL")+loadUrl.get("APP_PROJECTS_URL");this.urlProjects=loadUrl.get("APP_URL")+loadUrl.get("APP_PROJECTS_URL");this.httpProxyMultiDs=new Ext.data.HttpProxy({url:this.baseUrlMultiDs,restful:true,method:"GET"});this.store=new Ext.data.JsonStore({root:"data",restful:true,proxy:this.httpProxyMultiDs,remoteSort:true,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"collection"},{name:"dictionary"}]});var a=new Ext.data.JsonStore({fields:["id","name"],url:this.urlProjects,root:"data",autoLoad:true});this.comboProjects=new Ext.form.ComboBox({store:a,displayField:"name",valueField:"id",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",emptyText:i18n.get("label.selectProjects"),selectOnFocus:true,listeners:{scope:this,select:function(c,d,b){this.loadProject(d.data.id)}}});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:400,sortable:false}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[this.comboProjects,{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.multiDs.MultiDsCrudPanel.superclass.initComponent.call(this)},loadProject:function(a){this.httpProxyMultiDs.setUrl(this.baseUrlMultiDs+"/"+a+loadUrl.get("APP_FORMPROJECT_URL"),true);this.getStore().load({scope:this,callback:function(){this.getView().refresh()}})},onCreate:function(){var b=this.comboProjects.getValue();if(Ext.isEmpty(b)){return}this.httpProxyMultiDs.setUrl(this.baseUrlMultiDs+"/"+b+loadUrl.get("APP_FORMPROJECT_URL"),true);var a=new sitools.admin.multiDs.MultiDsPropPanel({urlMultiDs:this.baseUrlMultiDs+"/"+b+loadUrl.get("APP_FORMPROJECT_URL"),action:"create",store:this.getStore()});a.show(ID.BOX.FORMS)},onModify:function(){var b=this.comboProjects.getValue();if(Ext.isEmpty(b)){return}var c=this.getSelectionModel().getSelected();if(!c){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}this.httpProxyMultiDs.setUrl(this.baseUrlMultiDs+"/"+b+loadUrl.get("APP_FORMPROJECT_URL"),true);var a=new sitools.admin.multiDs.MultiDsPropPanel({urlMultiDs:this.baseUrlMultiDs+"/"+b+loadUrl.get("APP_FORMPROJECT_URL"),action:"modify",store:this.getStore(),formId:c.data.id,collection:c.data.collection,dictionary:c.data.dictionary});a.show(ID.PROP.MULTIDSPROP)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("formsCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(b){var a=this.comboProjects.getValue();if(Ext.isEmpty(a)){return}Ext.Ajax.request({url:this.baseUrlMultiDs+"/"+a+loadUrl.get("APP_FORMPROJECT_URL")+"/"+b.id,method:"DELETE",scope:this,success:function(c){if(showResponse(c)){this.httpProxyMultiDs.setUrl(this.baseUrlMultiDs+"/"+a+loadUrl.get("APP_FORMPROJECT_URL"),true);this.store.reload()}},failure:alertFailure})}});Ext.reg("s-multiDs",sitools.admin.multiDs.MultiDsCrudPanel);Ext.namespace("sitools.admin.multiDs");sitools.admin.multiDs.MultiDsPropPanel=Ext.extend(Ext.Window,{width:700,height:700,modal:true,pageSize:10,id:ID.COMPONENT_SETUP.MULTIDS,collectionId:null,dictionaryId:null,urlCollections:null,propServiceDefaultUrl:"/propService",multiDSServiceDefaultUrl:"/multiDsService",formSize:{width:500,height:600},initComponent:function(){this.urlCollections=loadUrl.get("APP_URL")+loadUrl.get("APP_COLLECTIONS_URL");this.urlDictionnaires=loadUrl.get("APP_URL")+loadUrl.get("APP_DICTIONARIES_URL");var f=this.action;if(this.action=="modify"){this.title=i18n.get("label.modifyForm")}if(this.action=="create"){this.title=i18n.get("label.createForm")}var d=new Ext.data.JsonStore({id:"storeCollections",restful:true,url:this.urlCollections,root:"data",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"dataSets"}],autoLoad:true,listeners:{scope:this,load:function(v){this.fireEvent("collectionStoreLoaded",v)}}});this.comboCollections=new Ext.form.ComboBox({disabled:false,id:"comboCollections",store:d,fieldLabel:i18n.get("label.collection"),mode:"local",displayField:"name",valueField:"name",typeAhead:true,name:"comboCollections",forceSelection:true,triggerAction:"all",editable:false,emptyText:i18n.get("label.CollectionsSelect"),selectOnFocus:true,anchor:"95%",itemSelector:"div.search-item",allowBlank:false,autoSelect:true,maxHeight:200,tpl:new Ext.XTemplate('<tpl for=".">','<div class="search-item combo-datasetview"><div class="combo-datasetview-name">{name}</div>','<tpl if="this.descEmpty(description) == false" ><div class="sitoolsDescription-datasetview"><div class="sitoolsDescriptionHeader">Description :&nbsp;</div><p class="sitoolsDescriptionText"> {description} </p></div></tpl>',"</div></tpl>",{compiled:true,descEmpty:function(v){return Ext.isEmpty(v)}}),listeners:{change:function(A,z,v){this.getBubbleTarget().fireEvent("collectionChanged",A,z,v)},beforeselect:function(B,v){var A=v.get("name");var z=B.getValue();this.getBubbleTarget().fireEvent("collectionChanged",B,A,z)}}});var m=new Ext.data.JsonStore({id:"storeDictionnaires",restful:true,url:this.urlDictionnaires,root:"data",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"}],autoLoad:true,listeners:{scope:this,load:function(v){this.fireEvent("dictionaryStoreLoaded",v)}}});this.comboDictionnaires=new Ext.form.ComboBox({disabled:false,id:"comboDictionnaires",store:m,fieldLabel:i18n.get("label.dictionary"),displayField:"name",valueField:"name",typeAhead:true,name:"comboDictionnaires",forceSelection:true,triggerAction:"all",editable:false,emptyText:i18n.get("label.DictionarySelect"),selectOnFocus:true,anchor:"95%",itemSelector:"div.search-item",allowBlank:false,autoSelect:true,maxHeight:200,tpl:new Ext.XTemplate('<tpl for=".">','<div class="search-item combo-datasetview"><div class="combo-datasetview-name">{name}</div>','<tpl if="this.descEmpty(description) == false" ><div class="sitoolsDescription-datasetview"><div class="sitoolsDescriptionHeader">Description :&nbsp;</div><p class="sitoolsDescriptionText"> {description} </p></div></tpl>',"</div></tpl>",{compiled:true,descEmpty:function(v){return Ext.isEmpty(v)}}),listeners:{change:function(A,z,v){this.getBubbleTarget().fireEvent("dictionaryChanged",A,z,v)},beforeselect:function(B,v){var A=v.get("name");var z=B.getValue();this.getBubbleTarget().fireEvent("dictionaryChanged",B,A,z)}}});this.mainForm=new Ext.FormPanel({xtype:"form",border:false,padding:10,trackResetOnLoad:true,id:"formMainFormId",items:[{xtype:"hidden",name:"id"},{xtype:"textfield",name:"name",fieldLabel:i18n.get("label.name"),anchor:"100%",maxLength:30,allowBlank:false,vtype:"name",listeners:{scope:this,blur:function(A){if(A.isValid()){var z=A.getValue().replace(/\s/g,"_");var v=A.ownerCt.getForm().findField("urlServicePropertiesSearch");if(Ext.isEmpty(v.getValue())){v.setValue("/"+z+this.propServiceDefaultUrl)}var B=A.ownerCt.getForm().findField("urlServiceDatasetSearch");if(Ext.isEmpty(B.getValue())){B.setValue("/"+z+this.multiDSServiceDefaultUrl)}}}}},{xtype:"textfield",name:"description",fieldLabel:i18n.get("label.description"),anchor:"100%"},{xtype:"textfield",vtype:"attachment",name:"urlServicePropertiesSearch",fieldLabel:i18n.get("label.urlServicePropertiesSearch"),anchor:"100%",maxLength:100},{xtype:"textfield",vtype:"attachment",name:"urlServiceDatasetSearch",fieldLabel:i18n.get("label.urlServiceDatasetSearch"),anchor:"100%",maxLength:100},{xtype:"textfield",name:"css",fieldLabel:i18n.get("label.css"),anchor:"100%",maxLength:100},{xtype:"textfield",name:"nbDatasetsMax",fieldLabel:i18n.get("label.nbDatasetsMax"),anchor:"100%",maxLength:100},this.comboCollections,this.comboDictionnaires,{xtype:"hidden",name:"idServicePropertiesSearch"},{xtype:"hidden",name:"idServiceDatasetSearch"}],listeners:{activate:function(){if(f=="view"){this.getEl().mask()}},collectionChanged:function(A,z,v){this.getBubbleTarget().fireEvent("collectionChanged",A,z,v)},dictionaryChanged:function(A,z,v){this.getBubbleTarget().fireEvent("dictionaryChanged",A,z,v)}},flex:1});var q=new Ext.data.HttpProxy({url:this.action=="create"?"/tmp":loadUrl.get("APP_URL")+loadUrl.get("APP_COLLECTIONS_URL")+"/"+this.collection.id+"/concepts/"+this.dictionary.id,restful:true});var u=new Ext.data.JsonStore({root:"data",proxy:q,restful:true,remoteSort:false,fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"}],autoLoad:this.action!="create"});var n=new Ext.grid.ColumnModel({columns:[{header:i18n.get("label.name"),dataIndex:"name",type:"string"},{header:i18n.get("label.description"),dataIndex:"description",type:"string"}]});this.gridConcepts=new Ext.grid.GridPanel({store:u,cm:n,title:i18n.get("label.sharedConcepts"),flex:1,viewConfig:{forceFit:true}});var k=new Ext.Panel({title:i18n.get("label.FormInfo"),layout:"vbox",layoutConfig:{align:"stretch"},items:[this.mainForm,this.gridConcepts],listeners:{collectionChanged:function(A,z,v){this.getBubbleTarget().fireEvent("collectionChanged",A,z,v)},dictionaryChanged:function(A,z,v){this.getBubbleTarget().fireEvent("dictionaryChanged",A,z,v)}}});var t=new Ext.data.JsonStore({fields:[{name:"name",type:"string"},{name:"type",type:"string"}],autoLoad:false});var r=new Ext.grid.RowSelectionModel({singleSelect:true});var b=new Ext.data.JsonStore({fields:["name"],data:[{name:"TEXTFIELD"},{name:"NUMERIC_BETWEEN"},{name:"DATE_BETWEEN"},{name:"NUMBER_FIELD"}]});var c=new Ext.form.ComboBox({store:b,mode:"local",typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,dataIndex:"orderBy",lazyRender:true,listClass:"x-combo-list-small",valueField:"name",displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item comboItem">{name}</div></tpl>',width:55});var g=new Ext.data.HttpProxy({url:this.urlCollections+"/"+this.collectionId+"/properties",restful:true,method:"GET"});this.storeComboProperties=new Ext.data.JsonStore({fields:["id","name","description"],proxy:g,root:"data"});var p=new Ext.form.ComboBox({disabled:false,id:"comboProperties",store:this.storeComboProperties,displayField:"name",valueField:"name",typeAhead:true,mode:"local",name:"comboProperties",forceSelection:true,triggerAction:"all",editable:false,emptyText:i18n.get("label.comboPropertiesSelect"),selectOnFocus:true,allowBlank:false,autoSelect:true});var l=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.name"),dataIndex:"name",editor:p},{header:i18n.get("headers.type"),dataIndex:"type",editor:c}],defaults:{sortable:false,width:100}});var e={xtype:"sitools.widget.GridSorterToolbar",gridId:"gridProperties",items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:function(){var v=this.gridProperties;var z=new Ext.data.Record();v.getStore().insert(0,z)},scope:this},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:function(){var z=this.gridProperties;var A=z.getSelectionModel().getSelections();var v,B;for(v=0;A[v];v++){B=A[v];z.getStore().remove(B)}},scope:this}]};this.gridProperties=new Ext.grid.EditorGridPanel({layout:"fit",title:i18n.get("title.properties"),id:"gridProperties",store:t,tbar:e,cm:l,sm:r,viewConfig:{forceFit:true},listeners:{scope:this,activate:function(){this.storeComboProperties.proxy.setUrl(this.urlCollections+"/"+this.collectionId+"/properties");this.storeComboProperties.reload()}}});this.zoneStore=new Ext.data.JsonStore({root:"data",idProperty:"id",fields:[{id:"id",type:"string"},{name:"title",type:"string"},{name:"height",type:"int"},{name:"css",type:"string"},{name:"position",type:"string"},{name:"collapsible",type:"boolean"},{name:"collapsed",type:"boolean"},{name:"params"},{name:"containerPanelId",type:"string"}],listeners:{scope:this,remove:function(v,A,z){v.commitChanges();this.absoluteLayout.fireEvent("activate")}}});this.formComponentsStore=new Ext.data.JsonStore({root:"data",fields:[{name:"id",type:"string"},{name:"label",type:"string"},{name:"type",type:"string"},{name:"code",type:"string"},{name:"values"},{name:"width",type:"int"},{name:"height",type:"int"},{name:"xpos",type:"int"},{name:"ypos",type:"int"},{name:"css",type:"string"},{name:"jsAdminObject",type:"string"},{name:"jsUserObject",type:"string"},{name:"defaultValues"},{name:"valueSelection",type:"string"},{name:"autoComplete",type:"boolean"},{name:"parentParam"},{name:"dimensionId",type:"string"},{name:"unit"},{name:"extraParams"}],autoLoad:false});this.absoluteLayout=new sitools.admin.forms.ComponentsDisplayPanel({zoneStore:this.zoneStore,formComponentsStore:this.formComponentsStore,storeConcepts:this.gridConcepts.getStore(),context:"project",formSize:this.formSize,action:this.action});var s=new Ext.Panel({title:i18n.get("label.disposition"),flex:1,autoScroll:true,tbar:new Ext.Toolbar({items:[{scope:this,text:i18n.get("label.changeFormSize"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/sva_exe_synchrone.png",handler:this._sizeUp},{scope:this,text:i18n.get("label.addAdvancedCritera"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/tree_forms.png",handler:this._addPanel}]}),items:[this.absoluteLayout]});this.componentListPanel=new sitools.admin.forms.componentsListPanel({formComponentsStore:this.formComponentsStore,action:"create",context:"project",storeConcepts:this.gridConcepts.getStore()});var a=new Ext.Panel({layout:"hbox",title:i18n.get("label.disposition"),layoutConfig:{align:"stretch"},items:[this.componentListPanel,s],listeners:{scope:this,activate:function(){this.absoluteLayout.fireEvent("activate");var v=this.absoluteLayout}}});this.tabPanel=new Ext.TabPanel({height:550,activeTab:0,items:[k,this.gridProperties,a],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate,hidden:this.action=="view"},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}],listeners:{scope:this,collectionChanged:function(C,B,z){var v=C.getStore().find("name",B);var D=C.getStore().getAt(v);if(!Ext.isEmpty(z)&&B!=z&&this.formComponentsStore.getCount()>0){var A=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("warning.changeCollection"),scope:this,fn:function(E,J){if(E=="yes"){this.collectionId=D.data.id;this.loadConcepts();this.eraseComponents();this.eraseProperties()}else{C.setValue(z)}}})}else{this.collectionId=D.data.id;this.loadConcepts()}},dictionaryChanged:function(C,B,z){var v=C.getStore().find("name",B);var D=C.getStore().getAt(v);if(!Ext.isEmpty(z)&&B!=z&&this.formComponentsStore.getCount()>0){var A=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("warning.changeDictionary"),scope:this,fn:function(E,J){if(E=="yes"){this.dictionaryId=D.data.id;this.loadConcepts();this.eraseComponents()}else{C.setValue(z)}}})}else{this.dictionaryId=D.data.id;this.loadConcepts()}}}});this.items=[this.tabPanel];this.listeners={scope:this,resize:function(B,A,v){var z=B.body.getSize();this.tabPanel.setSize(z)},dictionaryStoreLoaded:function(v){var z=v.find("name",this.comboCollections.getValue());var A=this.comboCollections.getStore().getAt(z);if(Ext.isEmpty(A)){return}this.collectionId=A.data.id;if(!Ext.isEmpty(this.collectionId)&&!Ext.isEmpty(this.dictionaryId)){this.loadConcepts()}},collectionStoreLoaded:function(v){var z=v.find("name",this.comboDictionnaires.getValue());var A=this.comboDictionnaires.getStore().getAt(z);if(Ext.isEmpty(A)){return}this.dictionaryId=A.data.id;if(!Ext.isEmpty(this.collectionId)&&!Ext.isEmpty(this.dictionaryId)){this.loadConcepts()}}};sitools.component.projects.ProjectsPropPanel.superclass.initComponent.call(this)},loadConcepts:function(){var a=loadUrl.get("APP_URL")+loadUrl.get("APP_COLLECTIONS_URL")+"/"+this.collectionId+"/concepts/"+this.dictionaryId;this.gridConcepts.getStore().proxy.setUrl(a);this.gridConcepts.getStore().load()},eraseComponents:function(){this.formComponentsStore.removeAll()},eraseProperties:function(){this.gridProperties.getStore().removeAll()},_sizeUp:function(){var a=new sitools.admin.forms.absoluteLayoutProp({absoluteLayout:this.absoluteLayout,tabPanel:this.absoluteLayout.ownerCt.ownerCt.ownerCt,win:this,formSize:this.formSize});a.show()},_addPanel:function(){var a=new sitools.admin.forms.setupAdvancedFormPanel({parentContainer:this.absoluteLayout,currentPosition:this.absoluteLayout.position});a.show();this.absoluteLayout.doLayout()},onValidate:function(){var g=this.findByType("form")[0].getForm();if(!g.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return false}var l={};Ext.iterate(g.getValues(),function(m,n){var q,f;if(m=="comboCollections"){f=this.comboCollections.getStore().find("name",this.comboCollections.getValue());q=this.comboCollections.getStore().getAt(f);var p={name:q.data.name,id:q.data.id,description:q.data.description};l.collection=p}else{if(m=="comboDictionnaires"){f=this.comboDictionnaires.getStore().find("name",this.comboDictionnaires.getValue());q=this.comboDictionnaires.getStore().getAt(f);var r={name:q.data.name,id:q.data.id,description:q.data.description};l.dictionary=r}else{l[m]=n}}},this);var d=this.formSize.width;var a=this.formSize.height;l.width=d;l.height=a;var e=this.gridProperties.getStore();if(e.getCount()>0){l.properties=[]}e.each(function(f){l.properties.push(f.data)});if(this.zoneStore.getCount()>0){l.zones=[]}proppanel=this;this.zoneStore.each(function(f){var n={};var m=proppanel.formComponentsStore;if(m.getCount()>0){n=[];m.each(function(p){if(p.data.containerPanelId==f.data.containerPanelId){n.push({type:p.data.type,code:p.data.code,label:p.data.label,values:p.data.values,width:p.data.width,height:p.data.height,xpos:p.data.xpos,ypos:p.data.ypos,id:p.data.id,css:p.data.css,jsAdminObject:p.data.jsAdminObject,jsUserObject:p.data.jsUserObject,defaultValues:p.data.defaultValues,valueSelection:p.data.valueSelection,autoComplete:p.data.autoComplete,parentParam:p.data.parentParam,dimensionId:p.data.dimensionId,unit:p.data.unit,extraParams:p.data.extraParams,containerPanelId:p.data.containerPanelId})}});if(!Ext.isEmpty(n)){l.zones.push({id:f.data.containerPanelId,height:f.data.height,position:f.data.position,css:f.data.css,collapsible:f.data.collapsible,collapsed:f.data.collapsed,title:f.data.title,params:n})}}});var b=this.formComponentsStore;var k=(this.action=="modify")?"PUT":"POST";var c=(this.action=="modify")?this.urlMultiDs+"/"+this.formId:this.urlMultiDs;Ext.Ajax.request({url:c,method:k,scope:this,jsonData:l,success:function(f){var m=Ext.decode(f.responseText);if(m.success===false){Ext.Msg.alert(i18n.get("label.warning"),i18n.get(m.message))}else{this.close();this.store.reload()}},failure:alertFailure})},onRender:function(){sitools.admin.multiDs.MultiDsPropPanel.superclass.onRender.apply(this,arguments);if(this.formId){if(this.action=="modify"){Ext.Ajax.request({url:this.urlMultiDs+"/"+this.formId,method:"GET",scope:this,success:function(m){var b=Ext.decode(m.responseText);if(!b.success){this.close();Ext.Msg.alert(i18n.get("label.warning"),b.message);return}var l=this.findByType("form")[0].getForm();var g=b.formProject;if(!Ext.isEmpty(g.width)){this.formSize.width=g.width}if(!Ext.isEmpty(g.height)){this.formSize.height=g.height}this.absoluteLayout.setSize(this.formSize);var d={};d.id=g.id;d.name=g.name;d.description=g.description;d.css=g.css;d.nbDatasetsMax=g.nbDatasetsMax;d.urlServicePropertiesSearch=g.urlServicePropertiesSearch;d.urlServiceDatasetSearch=g.urlServiceDatasetSearch;d.idServiceDatasetSearch=g.idServiceDatasetSearch;d.idServicePropertiesSearch=g.idServicePropertiesSearch;var k=new Ext.data.Record(d);l.loadRecord(k);this.comboCollections.setValue(g.collection.name);this.comboDictionnaires.setValue(g.dictionary.name);this.collectionId=g.collection.id;this.dictionaryId=g.dictionary.id;if(g.properties){var n=g.properties;var q=this.gridProperties.getStore();Ext.each(n,function(f){q.add(new Ext.data.Record(f))})}var c={};if(!Ext.isEmpty(g.parameters)){c.oldParams=g.parameters}else{c.formZones=g.zones}if(!Ext.isEmpty(c.formZones)){Ext.each(c.formZones,function(f){this.zoneStore.add(new Ext.data.Record({containerPanelId:f.id,title:f.title,height:f.height,collapsible:f.collapsible,collapsed:f.collapsed,css:f.css,position:f.position,params:f.params}));if(!Ext.isEmpty(f.params)){Ext.each(f.params,function(r){this.formComponentsStore.add(new Ext.data.Record({type:r.type,code:r.code,label:r.label,values:r.values,width:r.width,height:r.height,xpos:r.xpos,ypos:r.ypos,id:r.id,css:r.css,jsAdminObject:r.jsAdminObject,jsUserObject:r.jsUserObject,defaultValues:r.defaultValues,valueSelection:r.valueSelection,autoComplete:r.autoComplete,parentParam:r.parentParam,dimensionId:r.dimensionId,unit:r.unit,extraParams:r.extraParams,containerPanelId:r.containerPanelId}))},this)}},this)}else{if(!Ext.isEmpty(c.oldParams)){var a=Ext.id();this.zoneStore.add(new Ext.data.Record({containerPanelId:a,title:g.name,height:g.height,css:g.css,position:0,params:c.oldParams}));if(!Ext.isEmpty(c.oldParams)){var p=c.oldParams;for(var e=0;e<p.length;e++){this.formComponentsStore.add(new Ext.data.Record({type:p[e].type,code:p[e].code,label:p[e].label,values:p[e].values,width:p[e].width,height:p[e].height,xpos:p[e].xpos,ypos:p[e].ypos,id:p[e].id,css:p[e].css,jsAdminObject:p[e].jsAdminObject,jsUserObject:p[e].jsUserObject,defaultValues:p[e].defaultValues,valueSelection:p[e].valueSelection,autoComplete:p[e].autoComplete,parentParam:p[e].parentParam,dimensionId:p[e].dimensionId,unit:p[e].unit,extraParams:p[e].extraParams,containerPanelId:a}))}}}}this.doLayout()},failure:function(a){var b=Ext.decode(a.responseText);Ext.Msg.alert(i18n.get("label.warning"),b.errorMessage)}})}}}});Ext.ns("sitools.admin.datasets");sitools.admin.datasets.PredicatsPanel=function(c){Ext.apply(this,c);var f=[];var b=new Ext.data.JsonStore({fields:[{name:"parentheseOuvrante",type:"text"},{name:"leftAttribute"},{name:"operateur",type:"text"},{name:"rightAttribute"},{name:"parentheseFermante"},{name:"opLogique"}]});Ext.util.Format.comboRenderer=function(k){return function(m){var l=k.findRecord(k.valueField,m);return l?l.get(k.displayField):k.valueNotFoundText}};var d=new Ext.form.ComboBox({id:"comboOlEditor",typeAhead:false,triggerAction:"all",lazyRender:true,mode:"local",store:new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],data:[["",""],["and","and"],["or","or"]]}),valueField:"myId",displayField:"displayText"});var a=new Ext.form.ComboBox({id:"comboOpEditor",typeAhead:false,triggerAction:"all",lazyRender:true,mode:"local",store:new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],data:[["GT",">"],["GTE",">="],["LT","<"],["LTE","<="],["LIKE","like"],["EQ","="],["NE","!="]]}),valueField:"myId",displayField:"displayText"});Ext.util.Format.attributeRenderer=function(){return function(l){if(l){var k="";if(l.tableAlias){k=l.tableAlias+"."}else{if(l.tableName){k=l.tableName+"."}}return k+l.dataIndex}}};var e;if(this.type=="join"){e={id:"rightAttribute",name:"rightAttribute",header:i18n.get("label.rightAttribute"),width:100,sortable:false,dataIndex:"rightAttribute",renderer:Ext.util.Format.attributeRenderer()}}else{e={header:i18n.get("label.rightAttribute"),width:200,sortable:false,dataIndex:"rightAttribute",editor:new Ext.form.TextField({allowBlank:false})}}var g={xtype:"sitools.widget.GridSorterToolbar",defaults:{scope:this},items:[]};sitools.admin.datasets.PredicatsPanel.superclass.constructor.call(this,Ext.apply({layout:"fit",flex:0.45,id:this.gridId,resizable:true,autoHeight:false,viewConfig:{forceFit:true},autoScroll:true,store:b,enableColumnHide:false,enableColumnMove:false,enableColumnSort:false,clicksToEdit:2,tbar:g,columns:[{header:"",width:50,sortable:false,dataIndex:"opLogique",editor:d,renderer:Ext.util.Format.comboRenderer(d)},{header:"",width:20,sortable:false,dataIndex:"parentheseOuvrante"},{id:"leftAttribute",name:"leftAttribute",header:i18n.get("header.leftAttribute"),width:100,sortable:false,dataIndex:"leftAttribute",renderer:Ext.util.Format.attributeRenderer()},{header:i18n.get("header.operateur"),width:70,sortable:false,dataIndex:"operateur",editor:a,renderer:Ext.util.Format.comboRenderer(a)},e,{header:"",width:20,sortable:false,dataIndex:"parentheseFermante",monType:"parenthese"}],stripeRows:true,sm:new Ext.grid.RowSelectionModel(),listeners:{celldblclick:function(m,s,n,q){var k;var l;var r;var p;if(n==1){k=m.getStore().getAt(s);r=m.getColumnModel().getDataIndex(n);p=k.get(r);k.set(r,p+"(")}if(n==2){k=m.getStore().getAt(s);l=new sitools.admin.datasets.selectPredicat({field:"leftAttribute",recordPredicat:k,storePredicat:this.storeSelectFields,viewPredicat:m.getView()});l.show(ID.BOX.DATASETS)}if(n==4&&this.type=="join"){k=m.getStore().getAt(s);l=new sitools.admin.datasets.selectPredicat({field:"rightAttribute",recordPredicat:k,storePredicat:this.storeSelectFields,viewPredicat:m.getView()});l.show(ID.BOX.DATASETS)}if(n==5){k=m.getStore().getAt(s);r=m.getColumnModel().getDataIndex(n);p=k.get(r);k.set(r,p+")")}m.getView().refresh()},contextmenu:function(l){if(!Ext.isEmpty(Ext.getCmp("gridCritereCtxMenu"))){Ext.getCmp("gridCritereCtxMenu").destroy()}this.contextMenu=new Ext.menu.Menu({id:"gridCritereCtxMenu",items:[{text:i18n.get("label.ajoutCondition"),icon:loadUrl.get("APP_URL")+"/res/images/icons/add_condition.png",listeners:{scope:this,click:function(){var r=0;var m=this.getSelectionModel();if(m.hasSelection()){r=this.getStore().indexOf(m.getSelected())+1}var n=this.getStore().recordType;var q=new n({parentheseOuvrante:" ",parentheseFermante:" "});this.stopEditing();b.insert(r,q)}}},{text:i18n.get("label.suppressionCondition"),icon:loadUrl.get("APP_URL")+"/res/images/icons/delete_condition.png",listeners:{scope:this,click:function(){if(!this.getSelectionModel().hasSelection()){Ext.Msg.alert(i18n.get("warning.noselection"),i18n.get("warning.noselection"));return}var n=this.getSelectionModel().getSelections();for(var m=0,p;p=n[m];m++){b.remove(p)}}}},{text:i18n.get("label.suppressionParenthese"),icon:loadUrl.get("APP_URL")+"/res/images/icons/delete_parenthesis.png",listeners:{scope:this,click:function(){var m=this.getSelectionModel();if(!m.hasSelection()){Ext.Msg.alert(i18n.get("warning.noselection"),i18n.get("warning.noselection"));return}var p=m.getSelections();var n=0;m.each(function(q){q.data.parentheseOuvrante=" ";q.data.parentheseFermante=" "});this.getView().refresh()}}}]});var k=l.getXY();this.contextMenu.showAt(k);l.stopEvent()}}}))};Ext.extend(sitools.admin.datasets.PredicatsPanel,Ext.grid.EditorGridPanel,{});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.selectPredicat=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,id:"selectPredicatId",initComponent:function(){this.title=i18n.get("label.selectPredicat");this.cmSelectPredicat=new Ext.grid.ColumnModel({columns:[{id:"tableAlias",header:i18n.get("headers.tableAlias"),sortable:true,dataIndex:"tableAlias"},{id:"tableName",header:i18n.get("headers.tableName"),sortable:true,dataIndex:"tableName"},{id:"name",header:i18n.get("headers.alias"),sortable:true,dataIndex:"columnAlias"}]});this.smSelectPredicat=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridSelectPredicat=new Ext.grid.GridPanel({title:i18n.get("title.gridSelectPredicat"),height:380,autoScroll:true,store:this.storePredicat,cm:this.cmSelectPredicat,sm:this.smSelectPredicat});this.items=[{xtype:"panel",layout:"fit",items:[this.gridSelectPredicat],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];sitools.admin.datasets.selectPredicat.superclass.initComponent.call(this)},onValidate:function(){var b=this.gridSelectPredicat.getSelectionModel().getSelected();var a=b.data.tableAlias?b.data.tableAlias:b.data.tableName;a=a+"."+b.data.dataIndex;this.recordPredicat.data.nomAffiche=a;if(this.field=="leftAttribute"){this.recordPredicat.data.leftAttribute={tableName:b.data.tableName,tableAlias:b.data.tableAlias,dataIndex:b.data.dataIndex,schema:b.data.schemaName,columnAlias:b.data.columnAlias,specificColumnType:b.data.specificColumnType,sqlColumnType:b.data.sqlColumnType,javaSqlColumnType:b.data.javaSqlColumnType}}else{this.recordPredicat.data.rightAttribute={tableName:b.data.tableName,tableAlias:b.data.tableAlias,dataIndex:b.data.dataIndex,schema:b.data.schemaName,columnAlias:b.data.columnAlias,specificColumnType:b.data.specificColumnType,sqlColumnType:b.data.sqlColumnType,javaSqlColumnType:b.data.javaSqlColumnType}}this.viewPredicat.refresh();this.close()}});Ext.reg("s-datasetspredicat",sitools.admin.datasets.selectPredicat);Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.joinConditionWin=Ext.extend(Ext.Window,{width:650,modal:true,closable:false,pageSize:10,resizable:false,id:"joinConditionWin",initComponent:function(){this.storeColumnDataset.filterBy(function(e){return e.data.specificColumnType=="DATABASE"});var b;try{b=this.node.attributes.predicat||{}}catch(d){b={}}this.logicOperator=new Ext.form.ComboBox({typeAhead:false,triggerAction:"all",lazyRender:true,mode:"local",width:50,store:new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],data:[["",""],["on","on"],["and","and"],["or","or"]]}),valueField:"myId",displayField:"displayText",value:Ext.isEmpty(b.logicOperator)?"on":b.logicOperator});var a=new Ext.XTemplate('<tpl for=".">','<div class="x-combo-list-item">','<tpl if="this.isNull(tableAlias)">','<tpl if="this.isNotNull(tableName)">{[values.tableName.toUpperCase()]}.</tpl>',"</tpl>",'<tpl if="this.isNotNull(tableAlias)">[values.tableAlias.toUpperCase()].</tpl>',"{columnAlias}</div>","</tpl>",{compiled:true,isNull:function(e){return Ext.isEmpty(e)},isNotNull:function(e){return !Ext.isEmpty(e)},isDatabase:function(e){return e=="DATABASE"}});this.leftAttribute=new Ext.form.ComboBox({fieldLabel:"left",typeAhead:false,triggerAction:"all",forceSelection:true,id:"leftAttributeField",flex:2,lazyRender:true,mode:"local",displayField:"columnAlias",valueField:"columnAlias",store:this.storeColumnDataset,value:b.leftAttribute?b.leftAttribute.columnAlias:null,tpl:a});this.compareOperator=new Ext.form.ComboBox({typeAhead:false,forceSelection:true,triggerAction:"all",lazyRender:true,mode:"local",width:50,store:new Ext.data.ArrayStore({id:1,fields:["myId","displayText"],data:predicatOperators.operators}),valueField:"myId",displayField:"displayText",hiddenName:"compareOperator",value:Ext.isEmpty(b.compareOperator)?"EQ":b.compareOperator});this.rightAttribute=new Ext.form.ComboBox({fieldLabel:"left",typeAhead:false,triggerAction:"all",forceSelection:true,lazyRender:true,id:"rightAttributeField",mode:"local",flex:2,displayField:"columnAlias",valueField:"columnAlias",store:this.storeColumnDataset,value:b.rightAttribute?b.rightAttribute.columnAlias:null,tpl:a});var c=new Ext.form.FormPanel({labelWidth:100,bodyStyle:"padding:5px 5px 0",width:640,items:[{xtype:"compositefield",fieldLabel:i18n.get("label.joinCondition"),defaults:{flex:1},items:[this.logicOperator,this.leftAttribute,this.compareOperator,this.rightAttribute]}]});this.title=i18n.get("label.joinCondition");this.items=[c];this.buttons=[{text:i18n.get("label.ok"),handler:this._onOK,scope:this},{text:i18n.get("label.cancel"),handler:this._onCancel,scope:this}];sitools.admin.datasets.joinConditionWin.superclass.initComponent.call(this)},_onOK:function(){this.storeColumnDataset.clearFilter();var d=this.rightAttribute.getStore().getAt(this.rightAttribute.getStore().findExact("columnAlias",this.rightAttribute.getValue())).data;var a=this.leftAttribute.getStore().getAt(this.leftAttribute.getStore().findExact("columnAlias",this.leftAttribute.getValue())).data;var c={logicOperator:this.logicOperator.getValue(),rightAttribute:{id:d.id,dataIndex:d.dataIndex,header:d.header,toolTip:d.toolTip,width:d.width,sortable:d.sortable,visible:d.visible,filter:d.filter,sqlColumnType:d.sqlColumnType,columnOrder:d.columnOrder,primaryKey:d.primaryKey,schema:d.schemaName,tableAlias:d.tableAlias,tableName:d.tableName,specificColumnType:d.specificColumnType,columnAlias:d.columnAlias,datasetDetailUrl:d.datasetDetailUrl,columnAliasDetail:d.columnAliasDetail,notion:d.notion,javaSqlColumnType:d.javaSqlColumnType,columnClass:d.columnClass,image:d.image,dimensionId:d.dimensionId,unit:d.unit},leftAttribute:{id:a.id,dataIndex:a.dataIndex,header:a.header,toolTip:a.toolTip,width:a.width,sortable:a.sortable,visible:a.visible,filter:a.filter,sqlColumnType:a.sqlColumnType,columnOrder:a.columnOrder,primaryKey:a.primaryKey,schema:a.schemaName,tableAlias:a.tableAlias,tableName:a.tableName,specificColumnType:a.specificColumnType,columnAlias:a.columnAlias,datasetDetailUrl:a.datasetDetailUrl,columnAliasDetail:a.columnAliasDetail,notion:a.notion,javaSqlColumnType:a.javaSqlColumnType,columnClass:a.columnClass,image:a.image,dimensionId:a.dimensionId,unit:a.unit},compareOperator:this.compareOperator.getValue()};if(this.mode=="edit"){this.node.attributes.predicat=c;this.node.setText(this.getNodeText(c))}else{var b={leaf:true,predicat:c,text:this.getNodeText(c),type:"join"};if(!this.node.isExpanded()){this.node.expand()}if(this.node.childNodes.length!==0){this.node.insertBefore(b,this.node.findChild("leaf",false))}else{this.node.appendChild(b)}}this.destroy()},getNodeText:function(b){b.leftAttribute=b.leftAttribute||{};b.rightAttribute=b.rightAttribute||{};var a=predicatOperators.getOperatorValueForClient(b.compareOperator);return String.format("{0} {1} {2} {3}",b.logicOperator,this.getDisplayName(b.leftAttribute),a,this.getDisplayName(b.rightAttribute))},_onCancel:function(){this.storeColumnDataset.clearFilter();this.destroy()},getDisplayName:function(a){if(a.specificColumnType=="DATABASE"){return String.format("{0}.{1}",Ext.isEmpty(a.tableAlias)?a.tableName:a.tableAlias,a.columnAlias)}else{return a.columnAlias}}});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.joinTableWin=Ext.extend(Ext.Window,{width:350,height:300,modal:true,closable:false,layout:"fit",initComponent:function(){this.title=i18n.get("label.tables");var a=new Ext.grid.ColumnModel({columns:[{id:"name",header:i18n.get("headers.name"),width:160,sortable:true,dataIndex:"name"},{id:"alias",header:i18n.get("headers.tableAlias"),width:80,sortable:true,dataIndex:"alias",editor:new Ext.form.TextField({disabled:this.action=="view"?true:false})}]});var b=new sitools.widget.JsonStore({id:"storeTablesDataset",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"alias",type:"string"},{name:"schemaName",type:"string"}]});b.add(this.datasetSelectTables.getStoreSelectedTables().data.items);this.grid=new Ext.grid.GridPanel({layout:"fit",store:b,cm:a,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),autoScroll:true,enableDragDrop:false,stripeRows:true,title:"Tables Dataset"});this.items=[this.grid];this.buttons=[{text:i18n.get("label.ok"),handler:this._onOK,scope:this},{text:i18n.get("label.cancel"),handler:this._onCancel,scope:this}];sitools.admin.datasets.joinTableWin.superclass.initComponent.call(this)},_onOK:function(){var b=this.grid.getSelectionModel().getSelected();if(!Ext.isEmpty(b)){if(this.mode=="edit"){this.node.setText(this.typeJointure+" "+b.data.name);this.node.attributes.table={alias:b.data.alias,name:b.data.name,schema:b.data.schemaName};this.destroy()}else{if(this.mode=="edit-root"){this.node.setText(b.data.name);this.node.attributes.table={alias:b.data.alias,name:b.data.name,schema:b.data.schemaName};this.destroy()}else{var a={text:this.typeJointure+" "+b.data.name,typeJointure:this.typeJointure,type:"table",table:{name:b.data.name,alias:b.data.alias,schema:b.data.schemaName},leaf:false,children:[]};if(!this.node.isExpanded()){this.node.expand()}this.node.appendChild(a);this.destroy()}}}else{Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"));return}},_onCancel:function(){this.destroy()}});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.joinPanel=Ext.extend(Ext.Panel,{border:false,urlJDBC:loadUrl.get("APP_URL")+"/",autoScroll:true,layout:"fit",height:180,initComponent:function(){this.title="Join Configuration";this.tree=new sitools.component.datasets.joinCrudTreePanel(this);this.items=[this.tree];this.addEvents("contextmenu");sitools.admin.datasets.joinPanel.superclass.initComponent.call(this)},loadGraph:function(){this.removeAll();this.tree=new sitools.component.datasets.joinCrudTreePanel({datasetId:this.datasetId});this.tree.getRootNode().expand(true);this.add(this.tree);this.doLayout()},_onSave:function(){var d=this.comboProjects.getValue();if(!Ext.isEmpty(d)){var b=this.tree.getRootNode();var a=[];var g=b.childNodes;var e;for(e=0;e<g.length;e++){this.getAllNodes(g[e],a)}var c=this.tree.getIdGraph();var f={nodeList:a,id:c};var k=(!Ext.isEmpty(c))?"PUT":"POST";Ext.Ajax.request({url:this.urlProjects+"/"+d+"/graph",method:k,scope:this,jsonData:f,success:function(l){var n=Ext.decode(l.responseText);if(!n.success){Ext.Msg.alert(i18n.get("label.warning"),n.message);return false}else{var m=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.graphSaved"),autoDestroy:true,hideDelay:1000}).show(document);this.loadGraph(d)}},failure:alertFailure})}else{Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}},getAllNodes:function(a,c){var d={};if(Ext.isEmpty(a)){return}else{if(a.isLeaf()){d={text:a.text,predicat:a.predicat,leaf:a.leaf};c.push(d)}else{d={text:a.text,children:[],type:a.attributes.type,typeJointure:a.attributes.typeJointure,table:a.attributes.table,leaf:false};c.push(d);var e=a.childNodes;var b;for(b=0;b<e.length;b++){this.getAllNodes(e[b],d.children)}}}},buildDefault:function(){this.tree.buildDefault()},deleteJoinPanelItems:function(){this.tree.deleteJoinPanelItems()}});sitools.component.datasets.joinCrudTreePanel=Ext.extend(Ext.tree.TreePanel,{loader:null,projectId:null,layout:"fit",autoScroll:true,initComponent:function(){var a;a=new Ext.tree.TreeNode({text:this.name,leaf:false,expanded:true});Ext.apply(this,{rootVisible:true,layout:"fit",enableDD:false,root:a,contextMenuRoot:new Ext.menu.Menu({items:[{id:"create-node",text:i18n.get("Add Table"),icon:loadUrl.get("APP_URL")+"/res/images/icons/add_folder.png",menu:{items:[{id:"INNER_JOIN",action:"addTable",text:i18n.get("label.innerJoin")},{id:"CROSS_JOIN",action:"addTable",text:i18n.get("label.crossJoin")},{id:"LEFT_JOIN",action:"addTable",text:i18n.get("label.leftJoin")},{id:"LEFT_OUTER_JOIN",action:"addTable",text:i18n.get("label.leftOuterJoin")},{id:"RIGHT_JOIN",action:"addTable",text:i18n.get("label.rightJoin")},{id:"RIGHT_OUTER_JOIN",action:"addTable",text:i18n.get("label.rightOuterJoin")}],listeners:{scope:this,itemclick:this._cxtMenuHandler}}},{id:"edit-root",text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/res/images/icons/toolbar_edit.png"}],listeners:{scope:this,itemclick:this._cxtMenuHandler}}),contextMenuNode:new Ext.menu.Menu({items:[{id:"add-joinCondition",text:i18n.get("Add Join Condition"),icon:loadUrl.get("APP_URL")+"/res/images/icons/add_datasets.png"},{id:"edit-node",text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/res/images/icons/toolbar_edit.png"},{id:"edit-jointure",text:i18n.get("editJointure"),icon:loadUrl.get("APP_URL")+"/res/images/icons/toolbar_edit.png",menu:{items:[{id:"INNER_JOIN",action:"editJointure",text:i18n.get("label.innerJoin")},{id:"CROSS_JOIN",action:"editJointure",text:i18n.get("label.crossJoin")},{id:"LEFT_JOIN",action:"editJointure",text:i18n.get("label.leftJoin")},{id:"LEFT_OUTER_JOIN",action:"editJointure",text:i18n.get("label.leftOuterJoin")},{id:"RIGHT_JOIN",action:"editJointure",text:i18n.get("label.rightJoin")},{id:"RIGHT_OUTER_JOIN",action:"editJointure",text:i18n.get("label.rightOuterJoin")}],listeners:{scope:this,itemclick:this._cxtMenuHandler}}},{id:"delete-node",text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/res/images/icons/toolbar_delete.png"}],listeners:{scope:this,itemclick:this._cxtMenuHandler}}),contextMenuLeaf:new Ext.menu.Menu({items:[{id:"edit-node",text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/res/images/icons/toolbar_edit.png"},{id:"delete-node",text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/res/images/icons/toolbar_delete.png"}],listeners:{scope:this,itemclick:this._cxtMenuHandler}}),listeners:{scope:this,contextmenu:function(b,d){d.stopEvent();b.select();var f;if(b==this.getRootNode()){f=b.getOwnerTree().contextMenuRoot;f.contextNode=this.getRootNode()}else{if(b.isLeaf()){f=b.getOwnerTree().contextMenuLeaf}else{f=b.getOwnerTree().contextMenuNode}f.contextNode=b}f.showAt(d.getXY())},beforenodedrop:function(b){if(b.target.attributes.type==b.data.node.attributes.type){return false}return true}}});sitools.component.datasets.joinCrudTreePanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.datasets.joinCrudTreePanel.superclass.onRender.apply(this,arguments)},_cxtMenuHandler:function(d){var c,a;switch(d.id){case"delete-node":var b=Ext.Msg.show({title:i18n.get("label.warning"),buttons:Ext.Msg.YESNO,msg:i18n.get("label.graphs.node.delete"),scope:this,fn:function(e,f){if(e=="yes"){var g=d.parentMenu.contextNode;if(g.parentNode){g.remove()}}}});break;case"add-joinCondition":c=d.parentMenu.contextNode;a=new sitools.admin.datasets.joinConditionWin({node:c,mode:"create",storeColumnDataset:this.storeColumnDataset});a.show(this);break;case"INNER_JOIN":case"LEFT_JOIN":case"CROSS_JOIN":case"LEFT_OUTER_JOIN":case"RIGHT_JOIN":case"RIGHT_OUTER_JOIN":if(d.action=="addTable"){c=d.parentMenu.parentMenu.contextNode;a=new sitools.admin.datasets.joinTableWin({node:c,mode:"create",datasetSelectTables:this.datasetSelectTables,typeJointure:d.id});a.show()}if(d.action=="editJointure"){c=d.parentMenu.parentMenu.contextNode;c.attributes.typeJointure=d.id;c.setText(this.getNodeText(c.attributes))}break;case"edit-node":c=d.parentMenu.contextNode;if(c.isLeaf()){a=new sitools.admin.datasets.joinConditionWin({node:c,mode:"edit",storeColumnDataset:this.storeColumnDataset})}else{a=new sitools.admin.datasets.joinTableWin({node:c,mode:"edit",datasetSelectTables:this.datasetSelectTables,typeJointure:c.attributes.typeJointure})}a.show();break;case"edit-root":c=d.parentMenu.contextNode;a=new sitools.admin.datasets.joinTableWin({node:c,mode:"edit-root",datasetSelectTables:this.datasetSelectTables});a.show();break}},getIdGraph:function(){return this.loader.getIdGraph()},buildDefault:function(){var d=this.scope.panelSelectTables.getStoreSelectedTables();if(d.getCount()!==0&&Ext.isEmpty(this.getRootNode().attributes.table)){var c=d.getAt(0);var a=this.getRootNode();Ext.apply(a,{text:c.data.name,leaf:false,children:[],type:"table"});a.setText(c.data.name);Ext.apply(a.attributes,{table:{name:c.data.name,alias:c.data.alias,schema:c.data.schemaName}});var b=0;d.each(function(e){if(b!==0){a.appendChild({typeJointure:"INNER_JOIN",text:"INNER_JOIN "+e.data.name,table:{name:e.data.name,alias:e.data.alias,schema:e.data.schemaName},leaf:false,type:"table",children:[]})}b++},this)}},loadTree:function(c){var b=this.getRootNode();var a=c.structure.mainTable;if(!Ext.isEmpty(a)){Ext.apply(b,{text:a.name,leaf:false,expanded:true});Ext.apply(b.attributes,{table:a})}Ext.each(c.structure.nodeList,function(d){this.loadNode(d,b)},this)},loadNode:function(d,c){var e;if(d.leaf){Ext.apply(d,{text:this.getNodeText(d),nodeType:"sync",expanded:true});e=new Ext.tree.TreeNode(d);d.children=[];c.appendChild(e)}else{Ext.apply(d,{text:this.getNodeText(d),nodeType:"sync",iconCls:"x-tree-node-folder",expanded:true});var b=d.children;c.appendChild(d);var a=c.lastChild;Ext.each(b,function(f){this.loadNode(f,a)},this)}},getNodeText:function(d){if(d.leaf){var b=d.predicat||{};b.leftAttribute=b.leftAttribute||{};b.rightAttribute=b.rightAttribute||{};var a=predicatOperators.getOperatorValueForClient(b.compareOperator);return String.format("{0} {1} {2} {3}",b.logicOperator,this.getDisplayName(b.leftAttribute),a,this.getDisplayName(b.rightAttribute))}else{var c=!Ext.isEmpty(d.table)?d.table:d.attributes.table;if(!Ext.isEmpty(c)){return d.typeJointure+" "+c.name}else{return"wrong node"}}},getDisplayName:function(a){if(a.specificColumnType=="DATABASE"){return String.format("{0}.{1}",Ext.isEmpty(a.tableAlias)?a.tableName:a.tableAlias,a.columnAlias)}else{return a.columnAlias}},deleteJoinPanelItems:function(){var a=new Ext.tree.TreeNode({text:this.name,leaf:false,expanded:true});this.setRootNode(a)}});Ext.apply(Ext.tree.TreePanel.nodeTypes,{sync:Ext.tree.TreeNode});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.gridFieldSetup=function(c){this.scope=c.scope;var b=new Ext.data.JsonStore({id:"storeColumnSelect",root:"ColumnModel",idProperty:"columnAlias",remoteSort:false,fields:[{name:"id",type:"string"},{name:"dataIndex",type:"string"},{name:"schemaName",mapping:"schema",type:"string"},{name:"tableAlias",type:"string"},{name:"tableName",type:"string"},{name:"header",type:"string"},{name:"toolTip",type:"string"},{name:"width",type:"int"},{name:"sortable",type:"boolean"},{name:"visible",type:"boolean"},{name:"filter",type:"boolean"},{name:"columnOrder",type:"int"},{name:"columnRendererCategory",type:"String"},{name:"columnRenderer",type:"object"},{name:"primaryKey",type:"boolean"},{name:"sqlColumnType",type:"string"},{name:"columnAlias",type:"string"},{name:"specificColumnType",type:"string"},{name:"javaSqlColumnType",type:"int"},{name:"columnClass",type:"int"},{name:"dimensionId",type:"string"},{name:"unit"},{name:"format",type:"string"}],listeners:{add:function(t,s){Ext.each(s,function(u){if(u.data.specificColumnType=="DATABASE"){if(Ext.isEmpty(u.data.header)){u.data.header=u.data.dataIndex}if(Ext.isEmpty(u.data.columnAlias)){u.data.columnAlias=u.data.dataIndex.toLowerCase()}if(sql2ext.get(u.get("sqlColumnType"))=="dateAsString"&&Ext.isEmpty(u.data.format)){u.data.format=SITOOLS_DEFAULT_IHM_DATE_FORMAT}}})}}});var d=new Ext.grid.CheckColumn({header:i18n.get("headers.visible"),dataIndex:"visible",width:55,helpUrl:loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/dataset/visible.html"});var g=new Ext.grid.CheckColumn({header:i18n.get("headers.sortable"),dataIndex:"sortable",width:55,helpUrl:loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/dataset/sortable.html",onMouseDown:function(z,v){if(v.className&&v.className.indexOf("x-grid3-cc-"+this.id)!=-1){z.stopEvent();var u=this.grid.getView().findRowIndex(v);var s=this.grid.store.getAt(u);if(s.data.specificColumnType!="VIRTUAL"){s.set(this.dataIndex,!s.data[this.dataIndex])}}}});var q=new Ext.grid.CheckColumn({header:i18n.get("headers.primaryKey"),dataIndex:"primaryKey",width:55,helpUrl:loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/dataset/primaryKey.html"});var k=new Ext.data.ArrayStore({fields:["value","display"],data:[["",""],["ASC","ASC"],["DESC","DESC"]]});var a=new Ext.form.ComboBox({header:i18n.get("headers.orderBy"),store:k,mode:"local",typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,dataIndex:"orderBy",lazyRender:true,listClass:"x-combo-list-small",valueField:"value",displayField:"display",tpl:'<tpl for="."><div class="x-combo-list-item comboItem">{display}</div></tpl>',width:55,helpUrl:loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/dataset/orderBy.html"});var p=new Ext.data.ArrayStore({fields:["value","display","tooltip"],data:[["",""],["Image","Image",i18n.get("label.image.tooltip")],["URL","URL",i18n.get("label.url.tooltip")],["DataSetLink","DataSetLink",i18n.get("label.datasetlink.tooltip")],["Other","Other",i18n.get("label.other.tooltip")]]});var m=new Ext.form.ComboBox({disabled:this.action=="view"?true:false,store:p,mode:"local",typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,data:"light",lazyRender:true,listClass:"x-combo-list-small",valueField:"value",displayField:"display",tpl:'<tpl for="."><div ext:qtip="{tooltip}" class="x-combo-list-item comboItem">{display}</div></tpl>',listeners:{scope:this,select:function(A,t){var z=A.getValue();var v=(Ext.isEmpty(A.lastValue))?A.startValue:A.lastValue;var s=this.getSelectionModel().getSelected();if(!Ext.isEmpty(z)){var u=new sitools.admin.datasets.columnRendererWin({selectedRecord:s,gridView:this.getView(),columnRendererType:z,datasetColumnStore:b,lastColumnRendererType:v});u.show()}}}});var f=new Ext.grid.CheckColumn({header:i18n.get("headers.filter"),dataIndex:"filter",width:55,helpUrl:loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/dataset/filters.html",onMouseDown:function(z,v){if(v.className&&v.className.indexOf("x-grid3-cc-"+this.id)!=-1){z.stopEvent();var u=this.grid.getView().findRowIndex(v);var s=this.grid.store.getAt(u);if(s.data.specificColumnType!="VIRTUAL"){s.set(this.dataIndex,!s.data[this.dataIndex])}}}});var n=new Ext.ux.grid.LockingColumnModel({columns:[{header:i18n.get("headers.sqlDefinition"),dataIndex:"dataIndex",width:120,locked:true,helpUrl:loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/dataset/sqlDefinition.html"},{header:i18n.get("headers.tableName"),dataIndex:"tableName",width:80},{header:i18n.get("headers.tableAlias"),dataIndex:"tableAlias",width:80},{header:i18n.get("headers.columnAlias"),dataIndex:"columnAlias",width:80,editor:new Ext.form.TextField({disabled:this.action=="view"?true:false,allowBlank:false,maxLength:50,validator:function(s){var t=new RegExp("^.*[!\"#$%&'/()*+,:;<=>?@\\`{}|~]+.*$");if(!t.test(s)){return !t.test(s)}else{return i18n.get("label.invalidColumnAlias")}}}),helpUrl:loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/dataset/columnAlias.html"},{header:i18n.get("headers.format"),dataIndex:"format",width:80,editor:new Ext.form.TextField({disabled:this.action=="view"?true:false,allowBlank:true,maxLength:50,value:"Y-m-d\\TH:i:s.u"}),helpUrl:loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/dataset/format.html"},{header:i18n.get("headers.unit"),dataIndex:"unit",width:80,helpUrl:loadUrl.get("APP_URL")+"client-admin/res/help/"+LOCALE+"/dataset/unit.html",renderer:function(s){if(Ext.isEmpty(s)){return""}else{return s.label}}},{header:i18n.get("headers.header"),dataIndex:"header",width:80,editor:new Ext.form.TextField({disabled:this.action=="view"?true:false,allowBlank:false,maxLength:50}),helpUrl:loadUrl.get("APP_URL")+"client-admin/res/help/"+LOCALE+"/dataset/headers.html"},{header:i18n.get("headers.width"),dataIndex:"width",width:40,editor:new Ext.form.TextField({disabled:this.action=="view"?true:false,allowBlank:false,maxLength:50})},g,d,f,{header:i18n.get("headers.orderBy"),dataIndex:"orderBy",width:55,editor:a,helpUrl:loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/dataset/orderBy.html"},q,{header:i18n.get("headers.previewUrl"),dataIndex:"columnRendererCategory",width:120,editor:m,helpUrl:loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/dataset/previewUrl.html"},{header:i18n.get("headers.tooltip"),dataIndex:"toolTip",width:80,helpUrl:loadUrl.get("APP_URL")+"client-admin/res/help/"+LOCALE+"/dataset/tooltip.html",editor:new Ext.form.TextField({disabled:this.action=="view"?true:false,maxLength:50})}],defaults:{sortable:false,width:80}});var r=new Ext.grid.RowSelectionModel({singleSelect:true});var l=new Ext.menu.Menu({defaults:{scope:this},items:[{text:i18n.get("label.assignUnit"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/refresh_clue.png",handler:this.onAssignUnit},{text:i18n.get("label.deleteUnit"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/refresh_clue.png",handler:this.onDeleteUnit}]});var e={xtype:"sitools.widget.GridSorterToolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreateColumn},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModifyColumn},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDeleteColumn},{text:i18n.get("label.action"),menu:l}]};sitools.admin.datasets.gridFieldSetup.superclass.constructor.call(this,Ext.apply({id:"gridColumnSelect",title:i18n.get("title.gridColumn"),layout:"fit",store:b,tbar:e,cm:n,sm:r,urlDictionary:c.urlDictionary,urlDimension:c.urlDimension,urlDataset:c.urlDataset,action:c.action,plugins:[g,d,f,q],listeners:{scope:this,beforeedit:function(t){if(t.column==4){var s=t.grid;var u=t.record;if(sql2ext.get(u.get("sqlColumnType"))!="dateAsString"){return false}}return true},activate:function(s){this.datasourceUtils=this.scope.datasourceUtils}}}))};Ext.extend(sitools.admin.datasets.gridFieldSetup,Ext.ux.grid.LockingEditorGridPanel,{onAssignUnit:function(){var b=this;var c=b.getSelectionModel().getSelected();if(!c){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"));return}var a=new sitools.admin.datasets.unitWin({recordColumn:c,viewColumn:b.getView(),urlDimension:this.urlDimension});a.show(ID.BOX.DATASETS)},onCreateColumn:function(){var a=new sitools.admin.datasets.columnsPropPanel({action:"create",store:this.getStore(),datasourceUtils:this.datasourceUtils});a.show()},onModifyColumn:function(){var b=this.getSelectionModel().getSelected();if(!b){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"));return}if(b.get("specificColumnType")==="DATABASE"&&this.datasourceUtils.isJdbc){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.cannotUpdateDatabaseColumn"));return}var a=new sitools.admin.datasets.columnsPropPanel({action:"modify",store:this.getStore(),recordColumn:b,datasourceUtils:this.datasourceUtils});a.show()},onDeleteColumn:function(){var a=this;var b=a.getSelectionModel().getSelected();if(!b){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"));return}a.getStore().remove(b);a.getView().refresh()},onDeleteUnit:function(){var a=this;var b=a.getSelectionModel().getSelected();if(!b){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"));return}b.set("unit",null);b.set("dimensionId",null)},getData:function(c){var b;this.getStore().removeAll();for(b=0;b<c.length;b++){var a;var d=c[b].columnRenderer;var e="";if(!Ext.isEmpty(d)){e=ColumnRendererEnum.getColumnRendererCategoryFromBehavior(d.behavior)}this.getStore().add(new Ext.data.Record({id:c[b].id,dataIndex:c[b].dataIndex,header:c[b].header,toolTip:c[b].toolTip,width:c[b].width,sortable:c[b].sortable,orderBy:c[b].orderBy,visible:c[b].visible,filter:c[b].filter,sqlColumnType:c[b].sqlColumnType,columnOrder:c[b].columnOrder,primaryKey:c[b].primaryKey,columnRenderer:d,columnRendererCategory:e,schemaName:c[b].schema,tableName:c[b].tableName,tableAlias:c[b].tableAlias,specificColumnType:c[b].specificColumnType,columnAlias:c[b].columnAlias,javaSqlColumnType:c[b].javaSqlColumnType,columnClass:c[b].columnClass,format:c[b].format,dimensionId:c[b].dimensionId,unit:c[b].unit}))}},gridFieldSetupValidation:function(){var a={success:true,message:""};var b=this.getStore();var f=0;var e=0;if(b.getCount()>0){var c;for(c=0;c<b.getCount();c++){var g=b.getAt(c).data;if(g.columnAlias.toLowerCase()!=g.columnAlias){a={success:false,message:String.format(i18n.get("label.columnAliasMaj"),g.columnAlias)};return a}if(!Ext.isEmpty(g.primaryKey)&&g.primaryKey){f++;if(Ext.isEmpty(g.filter)||!g.filter){a={success:false,message:String.format(i18n.get("label.columnPKNoFilter"),g.columnAlias)};return a}}if(!Ext.isEmpty(g.orderBy)&&g.orderBy){e++}}if(f!=1){a={success:false,message:f+i18n.get("label.wrongPrimaryKey")};return a}if(e<1){a={success:false,message:i18n.get("label.noOrderBy")};return a}}var d=this.checkForDoublon();if(d.found){a={success:false,message:i18n.get("label.doublonFound")+d.doublon}}return a},checkForDoublon:function(){var g=null,c;var a=this.getStore();var f=false;for(c=0;c<a.getCount()&&!f;c++){var e=a.getAt(c).data;f=false;for(var b=0;b<a.getCount()&&g===null&&!f;b++){var d=a.getAt(b).data;if(e.columnAlias==d.columnAlias&&e!=d){f=true;g=e.columnAlias}}}return{found:f,doublon:g}}});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.datasetCriteria=Ext.extend(Ext.Panel,{initComponent:function(){this.wizardJoinCondition=new sitools.admin.datasets.joinPanel({datasetId:this.scope.datasetId,datasetSelectTables:this.scope.panelSelectTables,action:this.scope.action,storeColumnDataset:this.scope.gridFields.getStore(),scope:this.scope});this.wizardWhereClause=new sitools.admin.datasets.PredicatsPanel({gridId:"whereClauseId",title:i18n.get("label.wizardWhereClause"),storeSelectFields:this.scope.gridFields.getStore(),type:"where"});this.SqlWhereClause=new Ext.Panel({height:350,items:[{xtype:"form",items:[{xtype:"textarea",id:"sqlQuery",autoScroll:true,height:350,anchor:"100%",name:"sqlQuery",validator:function(b){if(b.toLowerCase().match("where")){if(b.toLowerCase().match("from")){return true}else{return false}}else{return false}},invalidText:i18n.get("label.invalidSQl")}]}]});var a=new Ext.form.FormPanel({height:30,flex:0.1,id:"selecteurId",items:[{xtype:"radiogroup",id:"radioQueryType",fieldLabel:i18n.get("label.queryType"),width:300,height:30,items:[{disabled:this.action==="view"?true:false,boxLabel:i18n.get("label.assistant"),name:"queryType",inputValue:"W",checked:true},{disabled:this.action==="view"?true:false,boxLabel:i18n.get("label.sql"),name:"queryType",inputValue:"S"}],listeners:{scope:this,change:function(c,b){if(!Ext.isEmpty(b)){this.scope.queryType=b.inputValue}if(this.scope.queryType==="W"){this.whereClausePanel.remove(this.SqlWhereClause,false);this.SqlWhereClause.hide();this.whereClausePanel.add(this.wizardJoinCondition);this.whereClausePanel.add(this.wizardWhereClause);this.wizardJoinCondition.show();this.wizardWhereClause.show();this.whereClausePanel.doLayout()}else{this.whereClausePanel.remove(this.wizardJoinCondition,false);this.whereClausePanel.remove(this.wizardWhereClause,false);this.wizardJoinCondition.hide();this.wizardWhereClause.hide();this.whereClausePanel.add(this.SqlWhereClause);this.SqlWhereClause.show();this.whereClausePanel.doLayout()}}}}]});this.whereClausePanel=new Ext.Panel({flex:0.9,layout:"vbox",layoutConfig:{align:"stretch"}});Ext.apply(this,{items:[a,this.whereClausePanel],listeners:{activate:function(){if(this.scope.action==="view"){this.getEl().mask()}if(!Ext.isEmpty(this.scope.datasourceUtils)){this.wizardJoinCondition.setVisible(this.scope.datasourceUtils.isJdbc);a.setVisible(this.scope.datasourceUtils.isJdbc);if(this.scope.queryType==="W"){this.scope.datasourceUtils.loadColumnsBDD();this.wizardJoinCondition.buildDefault();this.whereClausePanel.add([this.wizardJoinCondition,this.wizardWhereClause]);this.whereClausePanel.doLayout()}else{this.whereClausePanel.add(this.SqlWhereClause);this.whereClausePanel.doLayout()}}},scope:this}});sitools.admin.datasets.datasetCriteria.superclass.initComponent.call(this)},getWizardWhereClause:function(){return this.wizardWhereClause},getWizardJoinCondition:function(){return this.wizardJoinCondition},getQueryType:function(){return this.scope.queryType}});Ext.ux.sitoolsGridView=Ext.extend(Ext.grid.GridView,{doRender:function(d,z,m,a,s,u){var e=this.templates,c=e.cell,C=e.row,p=s-1;var b="width:"+this.getTotalWidth()+";";var k=[],l=[],n={tstyle:b},r={},g,f;for(var t=0,A=z.length;t<A;t++){f=z[t];l=[];var q=t+a;for(var v=0;v<s;v++){g=d[v];r.id=g.id;r.css=v===0?"x-grid3-cell-first ":(v==p?"x-grid3-cell-last ":"");r.attr=r.cellAttr="";r.style=g.style;r.value=g.renderer.call(g.scope,f.data[g.name],r,f,q,v,m);if(Ext.isEmpty(r.value)){r.value="&#160;"}if(this.markDirty&&f.dirty&&Ext.isDefined(f.modified[g.name])){r.css+=" x-grid3-dirty-cell"}l[l.length]=c.apply(r)}var B=[];if(u&&((q+1)%2===0)){B[0]="x-grid3-row-alt"}if(f.dirty){B[1]=" x-grid3-dirty-row"}n.cols=s;if(this.getRowClass){B[2]=this.getRowClass(f,q,n,m)}n.alt=B.join(" ");n.cells=l.join("");k[k.length]=C.apply(n)}if(z.length==0){var B=[];n.cols=s;n.cells=" ";k[0]=C.apply(n)}return k.join("")},renderRows:function(l,c){var d=this.grid,f=d.colModel,a=d.store,m=d.stripeRows;var k=f.getColumnCount();var e=this.getColumnData();l=l||0;c=!Ext.isDefined(c)?a.getCount()-1:c;var b=a.getRange(l,c);return this.doRender(e,b,a,l,k,m)}});Ext.namespace("sitools.admin.datasets.datasourceUtils");sitools.admin.datasets.datasourceUtils.DatasourceFactory=function(a,b){if(a.jdbc){return new sitools.admin.datasets.datasourceUtils.jdbcUtils({scope:b})}if(a.mongoDb){return new sitools.admin.datasets.datasourceUtils.mongoDbUtils({scope:b})}};Ext.namespace("sitools.admin.datasets.datasourceUtils");sitools.admin.datasets.datasourceUtils.jdbcUtils=Ext.extend(Ext.util.Observable,{isJdbc:true,isMongoDb:false,constructor:function(a){Ext.apply(this,a.scope);sitools.admin.datasets.datasourceUtils.jdbcUtils.superclass.constructor.call(this)},logInfo:function(){console.log("jdbc")},getDataSourceUrl:function(){var a=this.formulairePrincipal.getDataSourceCombo().getStore().getById(this.formulairePrincipal.getDataSourceCombo().getValue());if(!a){return false}return a.data.sitoolsAttachementForUsers},getFieldsBDDSelected:function(a){return a.getSelectionModel().getSelections()},createGridFieldsBDD:function(){var c=new Ext.data.HttpProxy({url:"/",restful:true,method:"GET"});var a=new Ext.data.JsonStore({proxy:c,datasourceUtils:this,root:"table.attributes",autoLoad:false,fields:[{name:"name"},{name:"tableName"},{name:"schemaName"},{name:"structure"},{name:"nomAffiche"},{name:"sqlColumnType",mapping:"type"},{name:"javaSqlColumnType",mapping:"javaSqlType"},{name:"columnClass"}],listeners:{scope:this,beforeload:function(e){var d=this.datasourceUtils.getDataSourceUrl();if(!this.dataSourceUrl){return false}this.proxy.setUrl(d)},add:function(e,d){Ext.each(d,function(f){f.data.structure={tableName:f.data.tableName,tableAlias:f.data.tableAlias,schemaName:f.data.schemaName,dataIndex:f.data.dataIndex};var g=f.data.tableAlias?f.data.tableAlias:f.data.tableName;g+="."+f.data.dataIndex;f.data.nomAffiche=g})}}});var b=new Ext.grid.ColumnModel({columns:[{id:"tableName",header:i18n.get("headers.tableName"),sortable:true,dataIndex:"tableName"},{id:"name",header:i18n.get("headers.name"),sortable:true,dataIndex:"dataIndex"}]});return new Ext.grid.GridPanel({layout:"fit",store:a,cm:b,enableDragDrop:true,stripeRows:true,title:"Columns Table"})},createGridTablesBDD:function(){var b=new Ext.data.HttpProxy({url:loadUrl.get("APP_URL"),restful:true,method:"GET"});var c=new Ext.data.JsonStore({root:"database.tables",datasourceUtils:this,fields:[{name:"url"},{name:"schemaName",mapping:"schema"},{name:"name"}],proxy:b,listeners:{beforeload:function(){var d=this.datasourceUtils.getDataSourceUrl();this.proxy.setUrl(d)}}});var a=new Ext.grid.ColumnModel({columns:[{id:"name",header:i18n.get("headers.name"),width:160,sortable:true,dataIndex:"name"}]});return new Ext.grid.GridPanel({layout:"fit",store:c,cm:a,sm:new Ext.grid.RowSelectionModel({}),enableDragDrop:true,stripeRows:true,title:"Tables JDBC",id:"Tables_JDBC"})},loadColumnsBDD:function(){var b=this.panelSelectTables.getStoreSelectedTables();var a=this.getDataSourceUrl();if(!a){return false}if(b._getDirty()||b.getModifiedRecords().length>0){if(this.panelSelectFields.getBDDPanel()){var c=this.panelSelectFields.getBDDPanel().getStore();c.removeAll()}b.each(function(d){Ext.Ajax.request({url:a+"/"+d.data.name,method:"GET",params:{tableName:d.data.name,tableAlias:d.data.alias,schemaName:d.data.schemaName},scope:this,success:function(g,f){var e=Ext.decode(g.responseText);if(e.success){var k=e.table;Ext.each(k.attributes,function(n,l,m){this.panelSelectFields.getBDDPanel().getStore().add(new Ext.data.Record({dataIndex:n.name,schemaName:f.params.schemaName,tableName:f.params.tableName,tableAlias:f.params.tableAlias,sqlColumnType:n.type,javaSqlColumnType:n.javaSqlType,columnClass:n.columnClass}))},this)}else{Ext.Msg.alert(i18n.get("label.warning"),e.message)}},failure:alertFailure})},this);b._setDirty(false);b.commitChanges()}},validateTablesSelection:function(a){return{success:true}},getCmTablesDataset:function(){return new Ext.grid.ColumnModel({columns:[{id:"name",header:i18n.get("headers.name"),width:160,sortable:true,dataIndex:"name"},{id:"alias",header:i18n.get("headers.tableAlias"),width:80,sortable:true,dataIndex:"alias",editor:new Ext.form.TextField({disabled:this.action==="view"?true:false}),renderer:function(e,d,a,f,c,b){if(!this.editable){d.css="uneditable-cell";d.attr='ext:qtip="'+i18n.get("label.cannotChangeTableAlias")+'"'}return e}}]})},getCmFieldsDataset:function(){return new Ext.grid.ColumnModel({columns:[{id:"tableAlias",header:i18n.get("headers.tableAlias"),sortable:true,dataIndex:"tableAlias"},{id:"tableName",header:i18n.get("headers.tableName"),sortable:true,dataIndex:"tableName"},{id:"name",header:i18n.get("headers.name"),sortable:true,dataIndex:"dataIndex"}]})},getColumnsType:function(){return[["SQL",i18n.get("label.sql")],["VIRTUAL",i18n.get("label.virtual")]]}});Ext.namespace("sitools.admin.datasets.datasourceUtils");sitools.admin.datasets.datasourceUtils.mongoDbUtils=Ext.extend(Ext.util.Observable,{isJdbc:false,isMongoDb:true,constructor:function(a){Ext.apply(this,a.scope);sitools.admin.datasets.datasourceUtils.jdbcUtils.superclass.constructor.call(this)},logInfo:function(){console.log("mongoDb")},getDataSourceUrl:function(){var a=this.formulairePrincipal.getDataSourceCombo().getStore().getById(this.formulairePrincipal.getDataSourceCombo().getValue());if(!a){return false}return a.data.sitoolsAttachementForUsers+"/collections"},getFieldsBDDSelected:function(a){return a.getSelectionModel().getSelectedNodes()},createGridFieldsBDD:function(){var a=new Ext.Panel();return a},loadColumnsBDD:function(){var b=this.panelSelectTables.getStoreSelectedTables();var a=this.getDataSourceUrl();if(!a){return false}if(b._getDirty()||b.getModifiedRecords().length>0){if(b.getCount()>0){var c=a+"/"+b.getAt(0).data.name;var d=new sitools.admin.datasource.mongoDb.CollectionExplorer({collection:{name:b.getAt(0).data.name,url:c}});this.panelSelectFields.setFirstGrid(d)}}},createGridTablesBDD:function(){var c=new Ext.data.HttpProxy({url:loadUrl.get("APP_URL"),restful:true,method:"GET"});var b=new Ext.data.JsonStore({root:"mongodbdatabase.collections",datasourceUtils:this,fields:[{name:"url"},{name:"name"}],proxy:c,listeners:{beforeload:function(){var d=this.datasourceUtils.getDataSourceUrl();this.proxy.setUrl(d)}}});var a=new Ext.grid.ColumnModel({columns:[{id:"name",header:i18n.get("headers.name"),width:160,sortable:true,dataIndex:"name"}]});return new Ext.grid.GridPanel({layout:"fit",store:b,cm:a,sm:new Ext.grid.RowSelectionModel({}),enableDragDrop:true,stripeRows:true,title:"Tables Mongo",id:"Tables_Mongo"})},validateTablesSelection:function(a){if(a.getStore().getCount()>1){return{success:false,message:i18n.get("label.tooManyTablesSelected")}}return{success:true}},getCmTablesDataset:function(){return new Ext.grid.ColumnModel({columns:[{id:"name",header:i18n.get("headers.name"),width:160,sortable:true,dataIndex:"name"}]})},getCmFieldsDataset:function(){return new Ext.grid.ColumnModel({columns:[{id:"tableName",header:i18n.get("headers.tableName"),sortable:true,dataIndex:"tableName"},{id:"name",header:i18n.get("headers.name"),sortable:true,dataIndex:"dataIndex"}]})},getColumnsType:function(){return[["DATABASE",i18n.get("label.database")],["VIRTUAL",i18n.get("label.virtual")]]}});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.datasetViewConfig=Ext.extend(Ext.form.FormPanel,{padding:10,initComponent:function(){this.title=i18n.get("label.viewConfig");var a=this.action;this.storeDatasetViews=new Ext.data.JsonStore({fields:["id","name","description","jsObject","fileUrl","priority"],url:this.urlDatasetViews,autoLoad:false,root:"data",sortInfo:{field:"priority",direction:"ASC"},listeners:{scope:this,load:function(b,d){if(Ext.isEmpty(this.comboDatasetViews.getValue())){if(!Ext.isEmpty(d)&&Ext.isArray(d)&&d.length>0){var e=null;for(var c=0;c<d.length;c++){if(Ext.isEmpty(e)||d[c].data.priority<e.data.priority){e=d[c]}}this.comboDatasetViews.setValue(e.id);this.comboDatasetViews.fireEvent("select",this.comboDatasetViews,e)}}}}});this.comboDatasetViews=new Ext.form.ComboBox({disabled:this.action=="view"?true:false,id:"comboDatasetViews",store:this.storeDatasetViews,fieldLabel:i18n.get("label.datasetViews"),displayField:"name",valueField:"id",typeAhead:true,mode:"local",name:"comboDatasetViews",forceSelection:true,triggerAction:"all",editable:false,emptyText:i18n.get("label.datasetViewsSelect"),selectOnFocus:true,anchor:"95%",itemSelector:"div.search-item",allowBlank:false,autoSelect:true,maxHeight:200,validator:function(b){if(Ext.isEmpty(b)){return false}else{return true}},tpl:new Ext.XTemplate('<tpl for=".">','<div class="search-item combo-datasetview"><div class="combo-datasetview-name">{name}</div>','<tpl if="this.descEmpty(description) == false" ><div class="sitoolsDescription-datasetview"><div class="sitoolsDescriptionHeader">Description :&nbsp;</div><p class="sitoolsDescriptionText"> {description} </p></div></tpl>',"</div></tpl>",{compiled:true,descEmpty:function(b){return Ext.isEmpty(b)}}),listeners:{scope:this,select:function(c,d,b){this.buildViewConfig(d)}}});this.parametersFieldset=new Ext.form.FieldSet({title:i18n.get("label.parameters"),anchor:"95%"});Ext.apply(this,{items:[this.comboDatasetViews,this.parametersFieldset],listeners:{activate:function(){if(a=="view"){this.getEl().mask()}}}});sitools.admin.datasets.datasetViewConfig.superclass.initComponent.call(this)},getDatasetViewsCombo:function(){return this.comboDatasetViews},setViewConfigParamsValue:function(a){this.viewConfigParamsValue=a},buildViewConfig:function(recSelected){try{this.parametersFieldset.removeAll();var getParametersMethod=eval(recSelected.json.jsObject+".getParameters");if(!Ext.isFunction(getParametersMethod)){Ext.Msg.alert(i18n.get("label.error"),i18n.get("label.notImplementedMethod <br/>"+getParametersMethod));return}var parameters=getParametersMethod();if(Ext.isEmpty(parameters)){this.parametersFieldset.setVisible(false)}else{this.parametersFieldset.setVisible(true)}Ext.each(parameters,function(param){var parameterValue=this.findDefaultParameterValue(param);var JsObj=eval(param.jsObj);var config=Ext.applyIf(param.config,{anchor:"95%"});var p=new JsObj(config);if(!Ext.isEmpty(parameterValue)){p.setValue(parameterValue)}this.parametersFieldset.add(p)},this);this.doLayout()}catch(err){Ext.Msg.alert(i18n.get("label.error"),i18n.get("label.notImplementedMethod <br/>")+err);return}},getParametersValue:function(){var a=[];if(Ext.isEmpty(this.parametersFieldset.items)){return a}this.parametersFieldset.items.each(function(b){a.push({name:b.parameterName,value:b.getValue()})},this);return a},findDefaultParameterValue:function(b){var a;Ext.each(this.viewConfigParamsValue,function(c){if(c.name==b.config.parameterName){a=c.value}});return a}});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.datasetForm=Ext.extend(Ext.Panel,{initComponent:function(){var b=this.action;var a=new Ext.data.JsonStore({fields:["id","name","sitoolsAttachementForUsers","jdbc","mongoDb"],root:"data",listeners:{scope:this,load:function(c,d){if(this.action==="create"){if(!Ext.isEmpty(d)&&Ext.isArray(d)&&d.length>0){this.comboDataSource.setValue(d[0].id);this.comboDataSource.fireEvent("initValue",this.comboDataSource,d[0].id)}}}}});this.comboDataSource=new Ext.form.ComboBox({disabled:this.action=="view"?true:false,id:"comboDataSource",store:a,fieldLabel:i18n.get("label.dataSource"),displayField:"name",valueField:"id",typeAhead:true,mode:"local",name:"comboDataSource",forceSelection:true,triggerAction:"all",editable:false,emptyText:i18n.get("label.dataSourceSelect"),selectOnFocus:true,anchor:"50%",value:"",listeners:{scope:this,change:function(e,d,c){this.getBubbleTarget().fireEvent("datasourceChanged",e,d,c)},select:function(e,f,c){var d=f.get("id");e.fireEvent("change",d,e.getValue())},initValue:function(d,c){this.getBubbleTarget().fireEvent("initComboDatasource",d,c)}},validator:function(c){if(Ext.isEmpty(c)){return false}else{return true}},getDatasourceType:function(){var c=this.getStore().getAt(this.getStore().findExact("id",this.getValue()));return{jdbc:c.get("jdbc"),mongoDb:c.get("mongoDb")}}});Ext.apply(this,{layout:"fit",id:"datasetMainForm",title:i18n.get("label.datasetInfo"),items:[{xtype:"form",border:false,padding:10,autoScroll:true,defaults:{disabled:this.action=="view"?true:false},items:[{xtype:"hidden",name:"id"},{xtype:"textfield",name:"name",fieldLabel:i18n.get("label.name"),anchor:"95%",allowBlank:false,vtype:"name",maxLength:50},{xtype:"textfield",name:"description",fieldLabel:i18n.get("label.description"),anchor:"95%",maxLength:200},{xtype:"sitoolsSelectImage",name:"image",vtype:"image",fieldLabel:i18n.get("label.image"),anchor:"95%",growMax:400},this.comboDataSource,{xtype:"textfield",vtype:"attachment",name:"sitoolsAttachementForUsers",id:"sitoolsAttachementForUsers",fieldLabel:i18n.get("label.userAttach"),anchor:"95%",maxLength:100},{xtype:"checkbox",name:"visible",id:"visible",fieldLabel:i18n.get("label.isVisible"),anchor:"95%",maxLength:100},{xtype:"textfield",disabled:true,name:"expirationDate",id:"expirationDate",fieldLabel:i18n.get("label.expirationDate"),anchor:"95%",maxLength:100},{xtype:"textarea",name:"descriptionHTML",cls:"ckeditor",fieldLabel:i18n.get("label.descriptionHTML"),height:150,width:"94%"},{xtype:"hidden",name:"dirty",value:false}]}],listeners:{activate:function(){if(b=="view"){this.getEl().mask()}}}});sitools.admin.datasets.datasetForm.superclass.initComponent.call(this)},getForm:function(){return this.items.items[0].getForm()},getDataSourceCombo:function(){return this.comboDataSource},getDataSourceUrl:function(){var a=this.getDataSourceCombo().getStore().getById(this.getDataSourceCombo().getValue());if(!a){return false}return a.data.sitoolsAttachementForUsers},loadDatasources:function(e,a){var d=this.urlDatasources;var c=this.urlDatasourcesMongoDB;var b=this.comboDataSource.getStore();Ext.Ajax.request({url:d,method:"GET",scope:this,success:function(g){var f=Ext.decode(g.responseText);if(!f.success){Ext.Msg.alert(i18n.get("label.warning"),f.message);return}Ext.each(f.data,function(k){k.jdbc=true});b.loadData(f);Ext.Ajax.request({url:c,method:"GET",scope:a,success:function(l){var k=Ext.decode(l.responseText);if(!k.success){Ext.Msg.alert(i18n.get("label.warning"),k.message);return}Ext.each(k.data,function(m){m.mongoDb=true});b.loadData(k,true);b.fireEvent("load",b,b.getRange(0,b.getTotalCount()))},failure:alertFailure,callback:e})},failure:alertFailure})}});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.abstractDatasetWin={minWidth:700,minHeight:480,width:700,height:480,modal:true,defaultColumnWidth:100,defaultColumnVisible:true,defaultColumnSortable:true,defaultColumnFiltrable:true,queryType:"W",id:"datasetsMultiTablesPanel",resizable:true,onUpload:function(){function b(d,c){c.fieldUrl.setValue(d.url)}var a=new ImageChooser({url:loadUrl.get("APP_URL")+loadUrl.get("APP_UPLOAD_URL")+"/?media=json",width:515,height:350,fieldUrl:this.ownerCt.items.items[0]});a.show(document,b)},getAllNodes:function(a,c){var d={};if(Ext.isEmpty(a)){return}else{if(a.isLeaf()){d={leaf:true,predicat:a.attributes.predicat,type:a.attributes.type};c.push(d)}else{d={table:a.attributes.table,typeJointure:a.attributes.typeJointure,children:[],leaf:false,type:a.attributes.type};c.push(d);var e=a.childNodes;var b;for(b=0;b<e.length;b++){this.getAllNodes(e[b],d.children)}}}},loadDataset:function(){if(this.action==="modify"||this.action==="view"||this.action==="duplicate"){var a="";if(this.action==="duplicate"){a=this.datasetUrlToCopy}else{a=this.url}Ext.Ajax.request({url:a,method:"GET",scope:this,success:function(r){var m;var d=Ext.decode(r.responseText);if(!d.success){this.close();Ext.Msg.alert(i18n.get("label.warning"),d.message);return}var q=this.findByType("form")[0].getForm();var u=this.findById("gridColumnSelect").getStore();var l=d.dataset;this.initialData=l;var e={};if(this.action!=="duplicate"){e.id=l.id;e.sitoolsAttachementForUsers=l.sitoolsAttachementForUsers;e.dirty=l.dirty;e.name=l.name}else{e.name=l.name+"_copy"}e.description=l.description;if(!Ext.isEmpty(l.image)){e.image=l.image.url}e.expirationDate=l.expirationDate;e.queryType=l.queryType;e.visible=l.visible;e.orderBy=l.orderBy;e.descriptionHTML=l.descriptionHTML;var n=new Ext.data.Record(e);q.loadRecord(n);this.queryType=l.queryType;Ext.getCmp("radioQueryType").setValue(this.queryType);Ext.getCmp("sqlQuery").setValue(l.sqlQuery);this.formulairePrincipal.loadDatasources(function(){if(l.datasource){var v=this.findByType("form")[0].getComponent("comboDataSource");var f=v.getValue();v.setValue(l.datasource.id);v.fireEvent("initValue",v,l.datasource.id)}},this.formulairePrincipal);this.viewConfigPanel.getDatasetViewsCombo().getStore().load({scope:this,callback:function(z){if(l.datasetView){var v=this.viewConfigPanel.getDatasetViewsCombo().getStore();var f=v.getAt(v.find("id",l.datasetView.id));this.viewConfigPanel.getDatasetViewsCombo().setValue(l.datasetView.id);this.viewConfigPanel.setViewConfigParamsValue(l.datasetViewConfig);this.viewConfigPanel.getDatasetViewsCombo().fireEvent("select",this.viewConfigPanel.getDatasetViewsCombo(),f)}}});if(l.predicat){var g=l.predicat;var b=this.panelWhere.getWizardWhereClause().getStore();for(m=0;m<g.length;m++){var k;if(g[m]){k={tableName:g[m].leftAttribute.tableName,tableAlias:g[m].leftAttribute.tableAlias,schemaName:g[m].leftAttribute.schemaName,dataIndex:g[m].leftAttribute.dataIndex,columnAlias:g[m].leftAttribute.columnAlias,specificColumnType:g[m].leftAttribute.specificColumnType};var c=b.recordType;e=new c({parentheseFermante:g[m].closedParenthesis,parentheseOuvrante:g[m].openParenthesis,opLogique:g[m].logicOperator,operateur:g[m].compareOperator,leftAttribute:k,rightAttribute:g[m].rightValue.$});b.add(e)}}}if(!l.columnModel){return}var p=l.columnModel;this.findById("gridColumnSelect").getData(p);if(!Ext.isEmpty(l.structure)){this.panelWhere.getWizardJoinCondition().items.items[0].loadTree(l)}if(l.properties){var t=this.gridProperties.getStore();var s;Ext.each(l.properties,function(v){if(v.type=="Date"){var f=Date.parseDate(v.value,SITOOLS_DATE_FORMAT);if(Ext.isEmpty(f)){v.value="invalid date"}else{v.value=f.format(SITOOLS_DEFAULT_IHM_DATE_FORMAT)}}s=new Ext.data.Record(v);t.add(s)})}this.applyCkeditor()},failure:function(b){var c=Ext.decode(b.responseText);Ext.Msg.alert(i18n.get("label.warning"),c.errorMessage)}})}else{this.formulairePrincipal.loadDatasources();this.viewConfigPanel.getDatasetViewsCombo().getStore().load();this.applyCkeditor()}},applyCkeditor:function(){CKEDITOR.replaceAll(function(a,b){if(!Ext.isEmpty(a.classList)&&a.classList.contains("ckeditor")){b.customConfig="config-basic.js";b.width="95%";b.displayDatasetLink=false;return true}else{return false}})},refreshTextAreaValues:function(){Ext.iterate(CKEDITOR.instances,function(b,a){a.updateElement()})}};Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.datasetProperties=Ext.extend(Ext.grid.EditorGridPanel,{initComponent:function(){var f=this.action;var e=new Ext.data.JsonStore({fields:[{name:"name",type:"string"},{name:"type",type:"string"},{name:"value",type:"string"}],autoLoad:false});var b=new Ext.grid.RowSelectionModel({singleSelect:true});var c=new Ext.data.JsonStore({fields:["name"],data:[{name:"String"},{name:"Enum"},{name:"Numeric"},{name:"Date"}]});var d=new Ext.form.ComboBox({store:c,mode:"local",typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,dataIndex:"orderBy",lazyRender:true,listClass:"x-combo-list-small",valueField:"name",displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item comboItem">{name}</div></tpl>',width:55});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.name"),dataIndex:"name",editor:new Ext.form.TextField()},{header:i18n.get("headers.type"),dataIndex:"type",editor:d},{header:i18n.get("headers.value"),dataIndex:"value",editor:new Ext.form.TextField()}],defaults:{sortable:false,width:100}});var g={defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreateProperty},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDeleteProperty}]};Ext.apply(this,{title:i18n.get("title.properties"),id:"componentGridProperties",tbar:g,anchor:"95%",height:180,store:e,cm:a,sm:b,viewConfig:{forceFit:true},listeners:{scope:this,activate:function(k){if(this.action=="view"){k.getEl().mask()}},beforeedit:function(n){if(n.column==2){var k=n.grid;var p=n.record;var m=k.getColumnModel().columns[n.column];if(Ext.isEmpty(p.get("type"))){return false}var l;switch(p.get("type")){case"String":l=new Ext.form.TextField();break;case"Numeric":l=new Ext.form.NumberField();break;case"Date":l=new Ext.form.DateField({format:SITOOLS_DEFAULT_IHM_DATE_FORMAT,showTime:true});break;case"Enum":l=new Ext.form.TextField();break}m.setEditor(l)}return true},afteredit:function(n){if(n.column==2){var k=n.grid;var p=n.record;var l=k.getColumnModel().columns[n.column];var m=n.value;if(Ext.isEmpty(p.get("type"))){return false}switch(p.get("type")){case"String":m=String.format(m);break;case"Numeric":m=Ext.util.Format.number(m,"0.00");break;case"Date":m=m.format(SITOOLS_DEFAULT_IHM_DATE_FORMAT);break;case"Enum":m=String.format(m);break}p.set("value",m)}}}});sitools.admin.datasets.datasetProperties.superclass.initComponent.call(this)},onCreateProperty:function(){var a=new Ext.data.Record({type:"String"});this.getStore().insert(0,a)},onDeleteProperty:function(){var b=this.getSelectionModel().getSelections();var a,c;for(a=0;b[a];a++){c=b[a];this.getStore().remove(c)}}});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.datasetSelectTables=Ext.extend(Ext.Panel,{initComponent:function(){var a=this.action;Ext.apply(this,{title:i18n.get("label.selectTables"),layout:"fit",id:"selectTablesPanel",listeners:{scope:this,activate:function(b){if(Ext.isEmpty(this.items)){this.buildPanel();this.loadInitialData()}if(a=="view"){b.getEl().mask()}},datasourceChanged:function(){this.datasourceUtils=this.scope.datasourceUtils;this.gridTablesBDD=this.datasourceUtils.createGridTablesBDD();this.displayPanelTables.setFirstGrid(this.gridTablesBDD);this.gridTablesBDD.getStore().load()},initializeDatasource:function(){if(Ext.isEmpty(this.items)){this.buildPanel();this.loadInitialData()}}}});sitools.admin.datasets.datasetSelectTables.superclass.initComponent.call(this)},loadInitialData:function(){var c=this.scope.initialData;if(c&&c.structures){var b=c.structures;for(var a=0;a<b.length;a++){this.storeTablesDataset.add(new Ext.data.Record({name:b[a].name,alias:b[a].alias,schemaName:b[a].schemaName}))}}},buildPanel:function(){this.datasourceUtils=this.scope.datasourceUtils;this.gridTablesBDD=this.datasourceUtils.createGridTablesBDD();this.gridTablesBDD.getStore().load();var a=this.datasourceUtils.getCmTablesDataset();this.storeTablesDataset=new sitools.widget.JsonStore({id:"storeTablesDataset",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"alias",type:"string"},{name:"schemaName",type:"string"}]});this.gridTablesDataset=new Ext.grid.EditorGridPanel({layout:"fit",store:this.storeTablesDataset,cm:a,sm:new Ext.grid.RowSelectionModel({}),autoScroll:true,enableDragDrop:true,stripeRows:true,title:"Tables Dataset"});this.displayPanelTables=new sitools.component.datasets.selectItems({grid1:this.gridTablesBDD,grid2:this.gridTablesDataset,defaultRecord:{}});this.add(this.displayPanelTables);this.doLayout()},isFilled:function(){return this.gridTablesDataset.getStore().getCount()>0},getStoreSelectedTables:function(){return this.gridTablesDataset.getStore()},validatePanel:function(){return this.datasourceUtils.validateTablesSelection(this.gridTablesDataset)}});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.datasetSelectFields=Ext.extend(Ext.Panel,{initComponent:function(){var a=this.action;Ext.apply(this,{title:i18n.get("label.selectFields"),layout:"fit",id:"selectTablesFields",listeners:{scope:this,activate:function(b){if(Ext.isEmpty(this.items)||this.items.getCount()===0){this.buildPanel();this.loadInitialData()}this.scope.datasourceUtils.loadColumnsBDD();if(a=="view"){b.getEl().mask()}},datasourceChanged:function(){this.datasourceUtils=this.scope.datasourceUtils;this.gridTablesBDD=this.datasourceUtils.getGridTablesBDD();this.displayPanelTables.setFirstGrid(this.gridTablesBDD);this.gridTablesBDD.getStore().load()},initializeDatasource:function(){if(Ext.isEmpty(this.items)||this.items.getCount()===0){this.buildPanel();this.loadInitialData()}}}});sitools.admin.datasets.datasetSelectTables.superclass.initComponent.call(this)},loadInitialData:function(){return},buildPanel:function(){this.datasourceUtils=this.scope.datasourceUtils;this.gridFieldsBDD=this.datasourceUtils.createGridFieldsBDD();var a=this.datasourceUtils.getCmFieldsDataset();this.gridFieldsDataset=new Ext.grid.GridPanel({layout:"fit",store:this.gridFieldsDataset,cm:a,autoScroll:true,enableDragDrop:true,stripeRows:true,title:"Columns Dataset"});var b=[{name:"width",value:this.scope.defaultColumnWidth},{name:"visible",value:this.scope.defaultColumnVisible},{name:"sortable",value:this.scope.defaultColumnSortable},{name:"filter",value:this.scope.defaultColumnFiltrable},{name:"specificColumnType",value:"DATABASE"}];this.displayPanelFields=new sitools.component.datasets.selectItems({grid1:this.gridFieldsBDD,grid2:this.gridFieldsDataset,defaultRecord:b,listeners:{activate:function(c){if(action=="view"){c.getEl().mask()}}},scope:this.scope});this.add(this.displayPanelFields);this.datasourceUtils.loadColumnsBDD();this.doLayout()},isFilled:function(){return this.gridFieldsDataset.getStore().getCount()>0},getBDDPanel:function(){return this.gridFieldsBDD},setFirstGrid:function(a){if(!Ext.isEmpty(this.displayPanelFields)){this.displayPanelFields.setFirstGrid(a)}}});Ext.namespace("sitools.component.datasets");sitools.component.datasets.datasetsMultiTablesPanel=Ext.extend(Ext.Window,{closeAction:"close",initComponent:function(){Ext.apply(this,sitools.admin.datasets.abstractDatasetWin);this.urlDictionary=loadUrl.get("APP_URL")+loadUrl.get("APP_DICTIONARIES_URL");this.urlDatasources=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASOURCES_URL");this.urlDatasourcesMongoDB=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASOURCES_MONGODB_URL");this.urlDimension=loadUrl.get("APP_URL")+loadUrl.get("APP_DIMENSIONS_ADMIN_URL")+"/dimension";this.urlDatasetViews=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_VIEWS_URL");var a=this.action;if(this.action==="modify"){this.title=i18n.get("label.modifyDataset")}if(this.action==="create"||this.action==="duplicate"){this.title=i18n.get("label.datasetProject")}if(this.action==="view"){this.title=i18n.get("label.viewDataset")}this.gridFields=new sitools.admin.datasets.gridFieldSetup({urlDictionary:this.urlDictionary,urlDimension:this.urlDimension,action:a,urlDataset:this.url,scope:this});this.gridFields.addListener("activate",function(b){if(a==="view"){b.getEl().mask()}});this.formulairePrincipal=new sitools.admin.datasets.datasetForm({urlDatasetViews:this.urlDatasetViews,action:this.action,urlDatasources:this.urlDatasources,urlDatasourcesMongoDB:this.urlDatasourcesMongoDB,observer:this});this.panelSelectTables=new sitools.admin.datasets.datasetSelectTables({scope:this,action:this.action});this.panelSelectTables.addListener("activate",function(b){var c=b.datasourceUtils.getCmTablesDataset().getIndexById("alias");if(c!==-1){if(this.gridFields.getStore().getCount()>0){b.gridTablesDataset.getColumnModel().setEditable(c,false)}else{b.gridTablesDataset.getColumnModel().setEditable(c,true)}}b.gridTablesDataset.getView().refresh()},this);this.panelSelectTables.addListener("deactivate",function(b){b.gridTablesDataset.stopEditing(false)});this.panelSelectFields=new sitools.admin.datasets.datasetSelectFields({scope:this,gridFieldsDataset:this.gridFields.getStore(),action:this.action});this.panelWhere=new sitools.admin.datasets.datasetCriteria({scope:this,layout:"vbox",layoutConfig:{align:"stretch",flex:"ratio"},title:i18n.get("label.whereClause")});this.panelWhere.addListener("activate",function(){if(a==="view"){this.getEl().mask()}});this.gridProperties=new sitools.admin.datasets.datasetProperties({action:this.action});Ext.Ajax.request({url:this.urlDatasetViews,method:"GET",scope:this,success:function(b){var c=Ext.decode(b.responseText);if(!c.success){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noProjectName"));return false}else{var d=c.data;var e=[];Ext.each(d,function(f){if(!Ext.isEmpty(f.dependencies&&!Ext.isEmpty(f.dependencies.js))){e=e.concat(f.dependencies.js)}},this);if(!Ext.isEmpty(e)){includeJsForceOrder(e,0,function(){if(this.url){this.loadDataset()}},this)}}}});this.viewConfigPanel=new sitools.admin.datasets.datasetViewConfig({urlDatasetViews:this.urlDatasetViews,action:this.action});this.tabPanel=new Ext.TabPanel({height:450,layoutConfig:{layoutOnCardChange:true},activeTab:0,items:[this.formulairePrincipal,this.gridProperties,this.panelSelectTables,this.panelSelectFields,this.gridFields,this.panelWhere,this.viewConfigPanel],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate,disabled:a==="view"?true:false},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:function(d,f,e){var b={success:true};if(!Ext.isEmpty(e)&&e.id==="gridColumnSelect"){b=this.gridFields.gridFieldSetupValidation()}if(!Ext.isEmpty(e)&&e.id==="selectTablesPanel"){b=this.panelSelectTables.validatePanel()}if(!b.success){var c=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.error"),html:b.message,autoDestroy:true,hideDelay:1000}).show(document);return false}return true},initComboDatasource:function(d,c){var b=this.formulairePrincipal.getDataSourceCombo().getDatasourceType();this.datasourceUtils=new sitools.admin.datasets.datasourceUtils.DatasourceFactory(b,this);this.panelSelectTables.fireEvent("initializeDatasource");this.panelSelectFields.fireEvent("initializeDatasource")},datasourceChanged:function(f,e,c){var b=this.formulairePrincipal.getDataSourceCombo().getDatasourceType();this.datasourceUtils=new sitools.admin.datasets.datasourceUtils.DatasourceFactory(b,this);if(Ext.isEmpty(c)){this.panelSelectTables.fireEvent("initializeDatasource");this.panelSelectFields.fireEvent("initializeDatasource");return}if(e!=c){if(this.gridFields.getStore().getCount()>0||this.panelWhere.getWizardWhereClause().getStore().getCount()>0||this.panelSelectTables.isFilled()||(Ext.getCmp("sqlQuery").getValue()&&Ext.getCmp("sqlQuery").getValue()!=="")){var d=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("warning.changeDatasource"),scope:this,fn:function(g,k){if(g==="yes"){this.gridFields.getStore().removeAll();this.panelWhere.getWizardJoinCondition().deleteJoinPanelItems();this.panelWhere.getWizardWhereClause().getStore().removeAll();this.panelSelectTables.getStoreSelectedTables().removeAll();Ext.getCmp("sqlQuery").setValue("")}else{f.setValue(c)}}})}this.panelSelectTables.fireEvent("datasourceChanged")}}}});this.listeners={scope:this,resize:function(e,d,b){var c=e.body.getSize();this.tabPanel.setSize(c)}};this.items=[this.tabPanel];sitools.component.datasets.datasetsMultiTablesPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.datasets.datasetsMultiTablesPanel.superclass.onRender.apply(this,arguments)},onValidate:function(){this.queryType=this.panelWhere.getQueryType();var d=this.datasetValidation();if(!d.success){Ext.Msg.alert(i18n.get("label.error"),d.message);return}var p=this.findByType("form")[0].getForm();if(!p.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return}this.refreshTextAreaValues();var s={};Ext.iterate(p.getFieldValues(),function(f,z){if(f==="image"){s.image={};s.image.url=z;s.image.type="Image";s.image.mediaType="Image"}else{if(f==="comboDataSource"){s.datasource={};s.datasource.url=this.dataSourceUrl;s.datasource.id=this.formulairePrincipal.getDataSourceCombo().getValue();s.datasource.type="datasource";s.datasource.mediaType="datasource"}else{if(f!=="visible"){s[f]=z}}}},this);s.datasetView={};var k=this.viewConfigPanel.getDatasetViewsCombo().getStore();var c=k.find("id",this.viewConfigPanel.getDatasetViewsCombo().getValue());var r=k.getAt(c);s.datasetView=r.data;s.datasetViewConfig=this.viewConfigPanel.getParametersValue();s.properties=[];this.gridProperties.getStore().each(function(A){if(A.data.type==="Date"){var z=A.get("value");var f=Date.parseDate(z,SITOOLS_DEFAULT_IHM_DATE_FORMAT);if(!Ext.isEmpty(f)){A.data.value=f.format(SITOOLS_DATE_FORMAT)}}s.properties.push(A.data)});var b=p.findField("visible");s.visible=b.getValue();s.queryType=this.queryType;s.sqlQuery=Ext.getCmp("sqlQuery").getValue();if(this.panelWhere.getWizardJoinCondition()||this.panelWhere.getWizardWhereClause()){s.predicat=[]}if(this.panelWhere.getWizardWhereClause()){this.panelWhere.getWizardWhereClause().getStore().each(function(f){s.predicat.push({closedParenthesis:f.data.parentheseFermante,openParenthesis:f.data.parentheseOuvrante,logicOperator:f.data.opLogique,compareOperator:f.data.operateur,leftAttribute:f.data.leftAttribute,rightValue:f.data.rightAttribute})})}s.structures=[];this.panelSelectTables.getStoreSelectedTables().each(function(f){s.structures.push({alias:f.data.alias,name:f.data.name,schemaName:f.data.schemaName,type:"table"})});var t=this.gridFields.getStore();t.clearFilter();if(t.getCount()>0){s.columnModel=[];var n;for(n=0;n<t.getCount();n++){var g=t.getAt(n).data;var m={id:g.id,dataIndex:g.dataIndex,header:g.header,toolTip:g.toolTip,width:g.width,sortable:g.sortable,orderBy:g.orderBy,visible:g.visible,filter:g.filter,sqlColumnType:g.sqlColumnType,columnOrder:g.columnOrder,primaryKey:g.primaryKey,schema:g.schemaName,tableAlias:g.tableAlias,tableName:g.tableName,specificColumnType:g.specificColumnType,columnAlias:g.columnAlias,datasetDetailUrl:g.datasetDetailUrl,columnAliasDetail:g.columnAliasDetail,javaSqlColumnType:g.javaSqlColumnType,format:g.format,columnClass:g.columnClass,image:g.image,dimensionId:g.dimensionId,unit:g.unit};if(!Ext.isEmpty(g.columnRendererCategory)&&!Ext.isEmpty(g.columnRenderer)){m.columnRenderer=g.columnRenderer}s.columnModel.push(m)}}this.panelWhere.getWizardJoinCondition().buildDefault();this.treeStructure=this.panelWhere.getWizardJoinCondition().items.items[0];var v=this.treeStructure.getRootNode();if(Ext.isEmpty(v)){Ext.Msg.alert(i18n.get("label.error"),i18n.get("label.noStructure"));return}var a=v.attributes.table;var u=[];var q=v.childNodes;for(var l=0;l<q.length;l++){this.getAllNodes(q[l],u)}var e={mainTable:a,nodeList:u};s.structure=e;if(this.action==="modify"){Ext.Ajax.request({url:this.url,method:"PUT",scope:this,jsonData:s,success:function(z){var f=Ext.decode(z.responseText);if(!f.success){Ext.Msg.alert(i18n.get("label.warning"),f.message);return}this.close();this.store.reload()},failure:alertFailure})}else{Ext.Ajax.request({url:this.url,method:"POST",scope:this,jsonData:s,success:function(z){var f=Ext.decode(z.responseText);if(!f.success){Ext.Msg.alert(i18n.get("label.warning"),f.message);return}this.close();this.store.reload()},failure:alertFailure})}},datasetValidation:function(){var a=this.gridFields.gridFieldSetupValidation();if(this.queryType==="S"&&(Ext.getCmp("sqlQuery").getValue().substr(0,4)!=="FROM"||!Ext.getCmp("sqlQuery").getValue().toLowerCase().match("where"))){a={success:false,message:i18n.get("label.invalidSQl")}}return a},onDestroy:function(){sitools.component.datasets.datasetsMultiTablesPanel.superclass.onDestroy.apply(this,arguments);this.destroyCkeditor()},destroyCkeditor:function(){Ext.iterate(CKEDITOR.instances,function(b,a){if(a){CKEDITOR.remove(a)}a.updateElement()})}});Ext.reg("s-datasetsMultiTablesPanel",sitools.component.datasets.datasetsMultiTablesPanel);Ext.namespace("sitools.admin.datasets.columnRenderer");sitools.admin.datasets.columnRenderer.behaviorEnum={URL_LOCAL:"localUrl",URL_EXT_NEW_TAB:"extUrlNewTab",URL_EXT_DESKTOP:"extUrlDesktop",IMAGE_NO_THUMB:"ImgNoThumb",IMAGE_THUMB_FROM_IMAGE:"ImgAutoThumb",IMAGE_FROM_SQL:"ImgThumbSQL",DATASET_LINK:"datasetLink",DATASET_ICON_LINK:"datasetIconLink",NO_CLIENT_ACCESS:"noClientAccess",getColumnRendererCategoryFromBehavior:function(b){var a;switch(b){case ColumnRendererEnum.URL_LOCAL:case ColumnRendererEnum.URL_EXT_NEW_TAB:case ColumnRendererEnum.URL_EXT_DESKTOP:a="URL";break;case ColumnRendererEnum.IMAGE_NO_THUMB:case ColumnRendererEnum.IMAGE_THUMB_FROM_IMAGE:case ColumnRendererEnum.IMAGE_FROM_SQL:a="Image";break;case ColumnRendererEnum.DATASET_LINK:case ColumnRendererEnum.DATASET_ICON_LINK:a="DataSetLink";break;case ColumnRendererEnum.NO_CLIENT_ACCESS:a="Other";break;default:a="";break}return a},isDisplayingImage:function(b){var a=false;switch(b.behavior){case ColumnRendererEnum.IMAGE_THUMB_FROM_IMAGE:case ColumnRendererEnum.IMAGE_FROM_SQL:case ColumnRendererEnum.DATASET_ICON_LINK:a=true;break;case ColumnRendererEnum.URL_LOCAL:case ColumnRendererEnum.URL_EXT_NEW_TAB:case ColumnRendererEnum.URL_EXT_DESKTOP:if(b.type=="Image"){a=true}break}return a}};var ColumnRendererEnum=sitools.admin.datasets.columnRenderer.behaviorEnum;Ext.namespace("sitools.admin.datasets.columnRenderer");sitools.admin.datasets.columnRenderer.datasetLinkPanel=Ext.extend(Ext.Panel,{flex:1,layout:{type:"vbox",align:"stretch"},border:false,initComponent:function(){this.urlDatasets=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_URL");this.httpProxy=new Ext.data.HttpProxy({url:this.urlDatasets,restful:true,method:"GET"});this.storeColumns=new Ext.data.JsonStore({id:"datasetColumnId",root:"dataset.columnModel",idProperty:"id",proxy:this.httpProxy,fields:[{name:"id",type:"string"},{name:"tableName",type:"string"},{name:"columnAlias",type:"string"}]});this.gridViewColumns=new Ext.grid.GridView({forceFit:true,listeners:{scope:this,refresh:function(){if(!Ext.isEmpty(this.columnRenderer)&&!Ext.isEmpty(this.columnRenderer.columnAlias)&&this.comboDatasets.getValue()==this.columnRenderer.datasetLinkUrl){var c=this.columnRenderer.columnAlias;var b=this.gridColumns.getStore().find("columnAlias",c);if(b!=-1){this.gridColumns.getSelectionModel().selectRow(b)}}}}});this.cmColumns=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.tableName"),dataIndex:"tableName"},{header:i18n.get("headers.columnAlias"),dataIndex:"columnAlias"}],defaults:{sortable:true}});this.smColumns=new Ext.grid.RowSelectionModel({singleSelect:true,listeners:{scope:this,rowselect:function(b,d,c){Ext.getCmp("status_bar_column").hide();this.doLayout()}}});this.bbar=new Ext.ux.StatusBar({id:"status_bar_column",hidden:true,text:i18n.get("label.no_column_selected"),iconCls:"x-status-error"});var a=new Ext.data.JsonStore({fields:["id","name","sitoolsAttachementForUsers"],url:this.urlDatasets,root:"data",autoLoad:true,listeners:{scope:this,load:function(){if(!Ext.isEmpty(this.columnRenderer)&&this.columnRenderer.behavior==this.behaviorType){var b=this.columnRenderer.datasetLinkUrl;var d=this.comboDatasets.getStore().find("sitoolsAttachementForUsers",b);if(d!=-1){this.comboDatasets.setValue(b);var c=this.comboDatasets.getStore().getAt(d);this.comboDatasets.fireEvent("select",this.comboDatasets,c,d)}}}}});this.comboDatasets=new Ext.form.ComboBox({store:a,name:"comboDatasets",displayField:"name",valueField:"sitoolsAttachementForUsers",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",emptyText:i18n.get("label.selectADataset"),selectOnFocus:true,anchor:"100%",fieldLabel:i18n.get("label.dataset"),allowBlank:false,listeners:{scope:this,select:function(c,d,b){this.loadColumns(d.data.id)}}});this.gridColumns=new Ext.grid.GridPanel({id:"gridColumnsSelect",title:i18n.get("title.datasetLinkDetails"),layout:"fit",flex:1,view:this.gridViewColumns,autoScroll:true,store:this.storeColumns,cm:this.cmColumns,sm:this.smColumns,bbar:this.bbar,tbar:{xtype:"toolbar",defaults:{scope:this},items:[this.comboDatasets]}});this.items=[];if(this.behaviorType==ColumnRendererEnum.DATASET_ICON_LINK){this.formImage=new Ext.form.FormPanel({padding:5,items:[{xtype:"sitoolsSelectImage",name:"image",vtype:"image",fieldLabel:i18n.get("label.image"),anchor:"100%",allowBlank:false}]});this.items.push(this.formImage)}else{this.title=""}this.items.push(this.gridColumns);sitools.admin.datasets.columnRenderer.datasetLinkPanel.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.datasets.columnRenderer.datasetLinkPanel.superclass.afterRender.apply(this,arguments);if(!Ext.isEmpty(this.columnRenderer)&&this.columnRenderer.behavior==this.behaviorType){if(this.columnRenderer.behavior==ColumnRendererEnum.DATASET_ICON_LINK&&!Ext.isEmpty(this.columnRenderer.image)){this.formImage.getForm().findField("image").setValue(this.columnRenderer.image.url)}}},isValid:function(){var b=true;if(this.behaviorType==ColumnRendererEnum.DATASET_ICON_LINK){b=this.formImage.getForm().isValid()}if(b){b=this.comboDatasets.isValid();if(b){var a=this.gridColumns.getSelectionModel().getSelected();if(Ext.isEmpty(a)){b=false;Ext.getCmp("status_bar_column").show()}}}return b},fillSpecificValue:function(c){var e=this.comboDatasets.getValue();c.datasetLinkUrl=e;var b=this.gridColumns.getSelectionModel().getSelected();if(Ext.isEmpty(b)){return false}c.columnAlias=b.get("columnAlias");if(this.behaviorType==ColumnRendererEnum.DATASET_ICON_LINK){var d=this.formImage.getForm().findField("image").getValue();var a={};if(!Ext.isEmpty(d)){a.url=d;a.type="Image";a.mediaType="Image"}c.image=a}return true},loadColumns:function(a){this.httpProxy.setUrl(this.urlDatasets+"/"+a);this.gridColumns.getStore().load({callback:function(){this.gridColumns.getView().refresh()},scope:this})}});Ext.namespace("sitools.admin.datasets.columnRenderer");sitools.admin.datasets.columnRenderer.urlPanel=Ext.extend(Ext.Panel,{flex:1,layout:"fit",initComponent:function(){this.formPanel=new Ext.form.FormPanel({defaults:{anchor:"100%"},padding:5,items:[{fieldLabel:i18n.get("label.display"),name:"display",xtype:"radiogroup",columns:2,items:[{boxLabel:"Text",name:"display",inputValue:"Text",checked:true},{boxLabel:"Image",name:"display",inputValue:"Image"}],listeners:{scope:this,change:function(b,c){var a=c.getGroupValue();var d=true;if(a=="Text"){d=false}this.formPanel.getForm().findField("linkText").setVisible(!d);this.formPanel.getForm().findField("linkText").setDisabled(d);this.formPanel.getForm().findField("image").setVisible(d);this.formPanel.getForm().findField("image").setDisabled(!d);this.doLayout()}}},{fieldLabel:i18n.get("label.linkText"),name:"linkText",xtype:"textfield",allowBlank:false},{xtype:"sitoolsSelectImage",name:"image",hidden:true,disabled:true,fieldLabel:i18n.get("label.image"),anchor:"100%",growMax:400,allowBlank:false},{xtype:"checkbox",fieldLabel:i18n.get("label.isDisplayable"),name:"displayable",anchor:"100%",tooltip:i18n.get("label.isDisplayable.tooltip"),hidden:(this.behaviorType!=ColumnRendererEnum.URL_EXT_DESKTOP),disabled:(this.behaviorType!=ColumnRendererEnum.URL_EXT_DESKTOP)}]});this.items=[this.formPanel];sitools.admin.datasets.columnRenderer.urlPanel.superclass.initComponent.call(this)},isValid:function(){var a=this.formPanel.getForm();return a.isValid()},fillSpecificValue:function(d){var c=this.formPanel.getForm();var f=c.findField("display").getValue().getGroupValue();if("Text"==f){var b=c.findField("linkText").getValue();d.linkText=b}else{var e=c.findField("image").getValue();var a={};if(!Ext.isEmpty(e)){a.url=e;a.type="Image";a.mediaType="Image";d.image=a}}if(this.behaviorType==ColumnRendererEnum.URL_EXT_DESKTOP){d.displayable=c.findField("displayable").getValue()}return true},afterRender:function(){sitools.admin.datasets.columnRenderer.urlPanel.superclass.afterRender.apply(this,arguments);if(!Ext.isEmpty(this.columnRenderer)&&this.columnRenderer.behavior==this.behaviorType){var b=this.formPanel.getForm();var a={};var d;if(!Ext.isEmpty(this.columnRenderer.linkText)){a.linkText=this.columnRenderer.linkText;a.display="Text";d=false}if(!Ext.isEmpty(this.columnRenderer.image)){a.image=this.columnRenderer.image.url;a.display="Image";d=true}if(this.behaviorType==ColumnRendererEnum.URL_EXT_DESKTOP){a.displayable=this.columnRenderer.displayable}else{a.displayable=false}var c=new Ext.data.Record(a);b.loadRecord(c);b.findField("linkText").setVisible(!d);b.findField("linkText").setDisabled(d);b.findField("image").setVisible(d);b.findField("image").setDisabled(!d)}}});Ext.namespace("sitools.admin.datasets.columnRenderer");sitools.admin.datasets.columnRenderer.imagePanel=Ext.extend(Ext.Panel,{flex:1,layout:{type:"vbox",align:"stretch"},initComponent:function(){this.items=[];switch(this.behaviorType){case ColumnRendererEnum.IMAGE_NO_THUMB:this.formPanel=new Ext.form.FormPanel({flex:1,defaults:{anchor:"100%"},padding:5,items:{fieldLabel:i18n.get("label.linkText"),name:"linkText",xtype:"textfield",allowBlank:false}});this.items.push(this.formPanel);break;case ColumnRendererEnum.IMAGE_THUMB_FROM_IMAGE:this.title=undefined;this.border=false;this.frame=true;break;case ColumnRendererEnum.IMAGE_FROM_SQL:this.items.push(this.createDatasetColumnGrid(this.datasetColumnStore));break;default:break}sitools.admin.datasets.columnRenderer.imagePanel.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.datasets.columnRenderer.imagePanel.superclass.afterRender.apply(this,arguments);if(!Ext.isEmpty(this.columnRenderer)&&this.columnRenderer.behavior==this.behaviorType){switch(this.behaviorType){case ColumnRendererEnum.IMAGE_NO_THUMB:this.formPanel.getForm().findField("linkText").setValue(this.columnRenderer.linkText);break}}},createDatasetColumnGrid:function(b){var c=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.tableName"),dataIndex:"tableName"},{header:i18n.get("headers.columnAlias"),dataIndex:"columnAlias"}],defaults:{sortable:true,width:100}});var a=new Ext.grid.RowSelectionModel({singleSelect:true,listeners:{scope:this,rowselect:function(d,f,e){Ext.getCmp("status_bar_column").hide();this.doLayout()}}});this.bbar=new Ext.ux.StatusBar({id:"status_bar_column",hidden:true,text:i18n.get("label.no_column_selected"),iconCls:"x-status-error"});this.gridColumns=new Ext.grid.GridPanel({id:"gridColumnsSelect",layout:"fit",autoScroll:true,store:b,cm:c,sm:a,flex:1,bbar:this.bbar,viewConfig:{forceFit:true},listeners:{scope:this,viewReady:function(){if(!Ext.isEmpty(this.columnRenderer)&&!Ext.isEmpty(this.columnRenderer.columnAlias)){var e=this.columnRenderer.columnAlias;var d=this.gridColumns.getStore().find("columnAlias",e);if(d!=-1){this.gridColumns.getSelectionModel().selectRow(d)}}}}});return this.gridColumns},isValid:function(){var c=true,b;switch(this.behaviorType){case ColumnRendererEnum.IMAGE_NO_THUMB:b=this.formPanel.getForm();c=b.isValid();break;case ColumnRendererEnum.IMAGE_FROM_SQL:var a=this.gridColumns.getSelectionModel().getSelected();if(Ext.isEmpty(a)){c=false;Ext.getCmp("status_bar_column").show()}break}return c},fillSpecificValue:function(b){switch(this.behaviorType){case ColumnRendererEnum.IMAGE_NO_THUMB:b.linkText=this.formPanel.getForm().findField("linkText").getValue();break;case ColumnRendererEnum.IMAGE_FROM_SQL:var a=this.gridColumns.getSelectionModel().getSelected();if(Ext.isEmpty(a)){return false}b.columnAlias=a.get("columnAlias");break}return true}});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.columnRendererWin=Ext.extend(Ext.Window,{width:400,height:600,modal:true,layout:{type:"vbox",align:"stretch"},initComponent:function(){this.title=this.columnRendererType+" "+i18n.get("label.detailColumnDefinition");var b;switch(this.columnRendererType){case"URL":b=[[i18n.get("label.url_local"),ColumnRendererEnum.URL_LOCAL],[i18n.get("label.url_ext_new_tab"),ColumnRendererEnum.URL_EXT_NEW_TAB],[i18n.get("label.url_ext_desktop"),ColumnRendererEnum.URL_EXT_DESKTOP]];break;case"Image":b=[[i18n.get("label.image_no_thumb"),ColumnRendererEnum.IMAGE_NO_THUMB],[i18n.get("label.image_thumb_from_image"),ColumnRendererEnum.IMAGE_THUMB_FROM_IMAGE],[i18n.get("label.image_from_sql"),ColumnRendererEnum.IMAGE_FROM_SQL]];break;case"DataSetLink":b=[[i18n.get("label.dataset_link"),ColumnRendererEnum.DATASET_LINK],[i18n.get("label.dataset_icon_link"),ColumnRendererEnum.DATASET_ICON_LINK]];break;case"Other":b=[[i18n.get("label.noClientAccess"),ColumnRendererEnum.NO_CLIENT_ACCESS]];break;default:break}var a=new Ext.data.ArrayStore({fields:[{name:"name"},{name:"behavior"}],data:b});this.comboBehavior=new Ext.form.ComboBox({store:a,displayField:"name",valueField:"behavior",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",emptyText:i18n.get("label.selectABehavior"),fieldLabel:i18n.get("label.behavior"),anchor:"100%",selectOnFocus:true,allowBlank:false,listeners:{scope:this,select:function(f,g,c){if(!Ext.isEmpty(this.panelDetails)){this.remove(this.panelDetails);this.panelDetails=null}var e=g.get("behavior");var d=this.selectedRecord.get("columnRenderer");switch(this.columnRendererType){case"URL":this.panelDetails=new sitools.admin.datasets.columnRenderer.urlPanel({behaviorType:e,title:i18n.get("label.behaviorDetails"),columnRenderer:d});break;case"Image":this.panelDetails=new sitools.admin.datasets.columnRenderer.imagePanel({behaviorType:e,title:i18n.get("label.behaviorDetails"),datasetColumnStore:this.datasetColumnStore,columnRenderer:d});break;case"DataSetLink":this.panelDetails=new sitools.admin.datasets.columnRenderer.datasetLinkPanel({behaviorType:e,title:i18n.get("label.behaviorDetails"),columnRenderer:d});break;default:break}if(!Ext.isEmpty(this.panelDetails)){this.add(this.panelDetails);this.doLayout()}}}});this.behaviorForm=new Ext.form.FormPanel({title:i18n.get("label.behavior"),height:80,padding:5,items:[this.comboBehavior,{fieldLabel:i18n.get("label.tooltip"),name:"toolTip",xtype:"textfield",}]});this.items=[this.behaviorForm];this.buttons=[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}];this.listeners={scope:this,beforeclose:function(){if(!this.validAction){var c=this.lastColumnRendererType;this.selectedRecord.set("columnRendererCategory",c);this.gridView.refresh()}}};sitools.admin.datasets.columnRendererWin.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.datasets.columnRendererWin.superclass.afterRender.apply(this,arguments);var e=this.selectedRecord.get("columnRenderer");if(!Ext.isEmpty(e)){var d=e.behavior;var c=e.toolTip;this.behaviorForm.getForm().findField("toolTip").setValue(c);var b=this.comboBehavior.getStore().find("behavior",d);if(b!=-1){this.comboBehavior.setValue(d);var a=this.comboBehavior.getStore().getAt(b);this.comboBehavior.fireEvent("select",this.comboBehavior,a,b)}}},onValidate:function(){var c=this.comboBehavior.getValue();var d=this.behaviorForm.getForm().findField("toolTip").getValue();var a=true;if(this.behaviorForm.getForm().isValid()){var b={};b.behavior=c;b.toolTip=d;if(!Ext.isEmpty(this.panelDetails)){if(this.panelDetails.isValid()){this.panelDetails.fillSpecificValue(b)}else{a=false}}if(a){this.selectedRecord.set("columnRenderer",b);this.gridView.refresh();this.validAction=true;this.close()}}}});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.datasetUrlWin=Ext.extend(Ext.Window,{width:400,height:400,modal:true,initComponent:function(){this.urlDatasets=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_URL");this.title=i18n.get("label.detailColumnDefinition");this.httpProxy=new Ext.data.HttpProxy({url:this.urlDatasets,restful:true,method:"GET"});this.storeColumns=new Ext.data.JsonStore({id:"datasetColumnId",root:"dataset.columnModel",idProperty:"id",proxy:this.httpProxy,fields:[{name:"id",type:"string"},{name:"tableName",type:"string"},{name:"columnAlias",type:"string"}]});this.gridViewColumns=new Ext.grid.GridView({listeners:{scope:this,refresh:function(){if(!Ext.isEmpty(this.selectedRecord.data.columnAliasDetail)){var c=this.storeColumns.find("columnAlias",this.selectedRecord.data.columnAliasDetail);if(c>-1){this.smColumns.selectRow(c)}}}}});this.cmColumns=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.tableName"),dataIndex:"tableName"},{header:i18n.get("headers.columnAlias"),dataIndex:"columnAlias"}],defaults:{sortable:true,width:100}});this.smColumns=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridColumns=new Ext.grid.EditorGridPanel({id:"gridColumnsSelect",title:i18n.get("title.gridColumns"),layout:"fit",height:280,view:this.gridViewColumns,autoScroll:true,store:this.storeColumns,cm:this.cmColumns,sm:this.smColumns});var a=new Ext.data.JsonStore({fields:["id","name","sitoolsAttachementForUsers"],url:this.urlDatasets,root:"data",autoLoad:true,listeners:{scope:this,load:function(){if(!Ext.isEmpty(this.selectedRecord.data.datasetDetailUrl)){this.comboDatasets.setValue(this.selectedRecord.data.datasetDetailUrl);this.loadColumns(this.selectedRecord.data.datasetDetailUrl)}}}});this.comboDatasets=new Ext.form.ComboBox({store:a,displayField:"name",valueField:"sitoolsAttachementForUsers",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",emptyText:"Select a dataset...",selectOnFocus:true,listeners:{scope:this,select:function(d,e,c){this.loadColumns(e.data.id)}}});this.formImage=new Ext.form.FormPanel({layout:"fit",title:i18n.get("label.formImage"),height:80,items:[{xtype:"sitoolsSelectImage",name:"image",vtype:"image",fieldLabel:i18n.get("label.image"),anchor:"100%",growMax:400}]});var b=[this.comboDatasets,this.gridColumns];if(this.withImage){this.height+=80;b.push(this.formImage)}this.items=[{xtype:"panel",layout:"fit",title:i18n.get("label.datasetSelect"),items:b,buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];sitools.admin.datasets.datasetUrlWin.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.datasets.datasetUrlWin.superclass.afterRender.apply(this,arguments);if(!Ext.isEmpty(this.selectedRecord)&&!Ext.isEmpty(this.selectedRecord.data)&&!Ext.isEmpty(this.selectedRecord.data.image)){var b={};var a=this.formImage.getForm();b.image=this.selectedRecord.data.image.url;a.loadRecord(new Ext.data.Record(b))}},loadColumns:function(a){this.httpProxy.setUrl(this.urlDatasets+"/"+a);this.gridColumns.getStore().load({callback:function(){this.gridColumns.getView().refresh()},scope:this})},onValidate:function(){var c=this.gridColumns.getSelectionModel().getSelected();this.selectedRecord.data.datasetDetailUrl=this.comboDatasets.getValue();this.selectedRecord.data.columnAliasDetail=c.data.columnAlias;var a=this.formImage.getForm();var b=a.findField("image").getValue();if(!Ext.isEmpty(b)){this.selectedRecord.data.image={};this.selectedRecord.data.image.url=b;this.selectedRecord.data.image.type="Image";this.selectedRecord.data.image.mediaType="Image"}this.gridView.refresh();this.close()}});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.columnsPropPanel=Ext.extend(Ext.Window,{width:600,height:300,modal:true,id:"columnPropId",dataSets:"",initComponent:function(){this.title=i18n.get("label.details");var d=this.datasourceUtils.getColumnsType();var c=new Ext.data.ArrayStore({fields:["value","display"],data:d});this.comboColumnType=new Ext.form.ComboBox({store:c,mode:"local",fieldLabel:i18n.get("label.specificColumnType"),typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,lazyRender:true,listClass:"x-combo-list-small",valueField:"value",displayField:"display",anchor:"90%",value:this.datasourceUtils.isJdbc?"SQL":"DATABASE",listeners:{scope:this,change:function(g,f,e){if(f==="SQL"||f==="DATABASE"){this.sqlDef.setDisabled(false)}else{this.sqlDef.setDisabled(true)}}}});this.columnAlias=new Ext.form.TextField({fieldLabel:i18n.get("label.columnAlias"),anchor:"90%",validator:function(e){var f=new RegExp("^.*[!\"#$%&'/()*+,:;<=>?@\\`{}|~]+.*$");if(!f.test(e)){return !f.test(e)}else{return i18n.get("label.invalidColumnAlias")}}});this.sqlDef=new Ext.form.TextArea({fieldLabel:i18n.get("label.SQLDefinition"),anchor:"90%"});var b=new Ext.data.JsonStore({fields:["name"],data:JAVA_TYPES});this.sqlColumnType=new Ext.form.ComboBox({store:b,mode:"local",fieldLabel:i18n.get("label.columnType"),typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,lazyRender:true,listClass:"x-combo-list-small",valueField:"name",displayField:"name",anchor:"90%",value:"String"});var a=[this.comboColumnType,this.columnAlias,this.sqlDef];(this.datasourceUtils.isMongoDb)?a.push(this.sqlColumnType):null;this.items=[{xtype:"panel",height:250,items:[{xtype:"form",border:false,labelWidth:150,padding:10,defaults:{disabled:false},items:a}],buttons:[{text:i18n.get("label.ok"),scope:this,handler:function(){this.onValidate()}},{text:i18n.get("label.close"),scope:this,handler:function(){this.close()}}]}];sitools.admin.datasets.columnsPropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.datasets.columnsPropPanel.superclass.onRender.apply(this,arguments);if(this.action=="modify"){this.comboColumnType.setValue(this.recordColumn.get("specificColumnType"));this.columnAlias.setValue(this.recordColumn.get("columnAlias"));this.sqlDef.setValue(this.recordColumn.get("dataIndex"));this.sqlColumnType.setValue(this.recordColumn.get("sqlColumnType"))}},onValidate:function(){if(this.action=="modify"){this.recordColumn.set("specificColumnType",this.comboColumnType.getValue());this.recordColumn.set("columnAlias",this.columnAlias.getValue());this.recordColumn.set("dataIndex",this.sqlDef.getValue());if(this.sqlColumnType){this.recordColumn.set("sqlColumnType",this.sqlColumnType.getValue())}}else{var a;if(this.comboColumnType.getValue()=="DATABASE"){a=new Ext.data.Record({dataIndex:this.sqlDef.getValue(),specificColumnType:this.comboColumnType.getValue(),header:this.columnAlias.getValue(),columnAlias:this.columnAlias.getValue(),width:100,visible:true,sortable:true,tableName:"",tableAlias:"",sqlColumnType:(this.sqlColumnType)?this.sqlColumnType.getValue():null})}if(this.comboColumnType.getValue()=="SQL"){a=new Ext.data.Record({dataIndex:this.sqlDef.getValue(),specificColumnType:this.comboColumnType.getValue(),header:this.columnAlias.getValue(),columnAlias:this.columnAlias.getValue(),width:100,visible:true,sortable:true,tableName:"",tableAlias:"",sqlColumnType:(this.sqlColumnType)?this.sqlColumnType.getValue():null})}if(this.comboColumnType.getValue()==="VIRTUAL"){a=new Ext.data.Record({specificColumnType:this.comboColumnType.getValue(),header:this.columnAlias.getValue(),columnAlias:this.columnAlias.getValue(),width:100,visible:true,sortable:false,tableName:"",tableAlias:""})}this.store.add(a)}this.close()}});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.datasetsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:ADMIN_PANEL_HEIGHT,id:ID.BOX.DATASETS,sm:new Ext.grid.RowSelectionModel(),pageSize:ADMIN_PANEL_NB_ELEMENTS,viewConfig:{forceFit:true,autoFill:true,getRowClass:function(d,b){var a="";var c=d.data;if(c.dirty=="true"){a="red-row"}return a}},initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_URL");this.store=new Ext.data.JsonStore({root:"data",restful:true,remoteSort:true,url:this.url,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"status",type:"string"},{name:"dirty",type:"string"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:false},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:350},{header:i18n.get("label.status"),dataIndex:"status",width:90,sortable:true}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};var a=[];this.tbar={xtype:"toolbar",defaults:{scope:this,xtype:"s-menuButton"},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onEdit},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete},{text:i18n.get("label.opensearch"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_open_search.png",handler:this.onEditOpenSearch},{text:i18n.get("label.refresh"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_refresh.png",handler:this._onRefresh},{text:i18n.get("label.active"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_active.png",handler:this._onActive},{text:i18n.get("label.disactive"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_disactive.png",handler:this._onDisactive},{text:i18n.get("label.sqlString"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/sql_request.png",handler:this._getSqlString},{text:i18n.get("label.semantic"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/tree_dictionary.png",handler:this._onEditSemantic},{text:i18n.get("label.duplicate"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/presentation1.png",handler:this.onDuplicate},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.listeners={scope:this,rowDblClick:this.onEdit};sitools.admin.datasets.datasetsCrudPanel.superclass.initComponent.call(this)},onEdit:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}if(a.data.status=="ACTIVE"){this.onView()}else{this.onModify()}},onDuplicate:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.component.datasets.datasetsMultiTablesPanel({datasetUrlToCopy:this.url+"/"+b.id,action:"duplicate",store:this.getStore(),url:this.url});a.show(ID.BOX.DATASETS)},onRender:function(){sitools.admin.usergroups.GroupCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.component.datasets.datasetsMultiTablesPanel({url:this.url,action:"create",store:this.getStore()});a.show(ID.BOX.DATASETS)},onView:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.component.datasets.datasetsMultiTablesPanel({url:this.url+"/"+b.id,action:"view",store:this.getStore(),datasetId:b.id});a.show(ID.BOX.DATASETS)},onModify:function(){var b=this.getSelectionModel().getSelected();if(b.data.status==i18n.get("status.active")){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.wrongStatus"));return}if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.component.datasets.datasetsMultiTablesPanel({url:this.url+"/"+b.id,action:"modify",store:this.getStore(),datasetId:b.id});a.show(ID.BOX.DATASETS)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("datasetCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},onEditOpenSearch:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.datasets.datasetsOpenSearch({url:this.url+"/"+b.id,action:"edit",store:this.getStore()});a.show(ID.BOX.DATASETS)},_onRefresh:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}if(a.data.status!=i18n.get("status.active")){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.wrongStatus"));return}Ext.Ajax.request({url:this.url+"/"+a.id+"/refresh",method:"PUT",scope:this,success:function(b){Ext.Msg.alert(i18n.get("label.info"),i18n.get("dataset.refresh.needReactive"));if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"/start",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"/stop",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_getSqlString:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"/getSqlString",method:"PUT",scope:this,success:function(c){var d=Ext.decode(c.responseText);if(d.success){var b=new Ext.Window({title:i18n.get("label.sqlString"),height:300,width:500,modal:true,resizable:true,autoScroll:true,html:d.message,buttons:[{text:i18n.get("label.ok"),handler:function(){this.ownerCt.ownerCt.close()}}]});b.show()}},failure:alertFailure})},_onEditSemantic:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.datasets.DicoMapping({url:this.url+"/"+b.id,masked:(b.data.status=="ACTIVE")});a.show(ID.BOX.DATASETS)}});Ext.reg("s-datasets",sitools.admin.datasets.datasetsCrudPanel);Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.dictionaryWin=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,initComponent:function(){this.title=i18n.get("label.dictionary");this.httpProxy=new Ext.data.HttpProxy({url:this.urlDictionary,restful:true,method:"GET"});this.storeNotion=new Ext.data.JsonStore({id:"storeNotionSelect",root:"dictionary.notions",idProperty:"id",proxy:this.httpProxy,fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"unit",type:"string"},{name:"description",type:"string"},{name:"type",type:"string"},{name:"dictionaryId",type:"string"}]});this.cmNotion=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.id"),dataIndex:"id",width:100},{header:i18n.get("headers.name"),dataIndex:"name",width:100},{header:i18n.get("headers.unit"),dataIndex:"unit",width:100},{header:i18n.get("headers.type"),dataIndex:"type",width:50},{header:i18n.get("headers.description"),dataIndex:"description",width:100}],defaults:{sortable:true,width:100}});this.smNotion=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridNotion=new Ext.grid.EditorGridPanel({id:"gridNotionSelect",title:i18n.get("title.gridNotion"),layout:"fit",height:350,autoScroll:true,store:this.storeNotion,cm:this.cmNotion,sm:this.smNotion});var a=new Ext.data.JsonStore({fields:["id","name"],url:this.urlDictionary,root:"data",autoLoad:true});this.comboDictionary=new Ext.form.ComboBox({store:a,displayField:"name",valueField:"id",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",emptyText:"Select a dictionary...",selectOnFocus:true,listeners:{scope:this,select:function(c,d,b){this.loadNotions(d.data.id)}}});this.items=[{xtype:"panel",height:450,title:i18n.get("label.dictionarySelect"),items:[this.comboDictionary,this.gridNotion],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];sitools.admin.datasets.dictionaryWin.superclass.initComponent.call(this)},loadNotions:function(a){this.httpProxy.setUrl(this.urlDictionary+a);this.gridNotion.getStore().load({callback:function(){this.gridNotion.getView().refresh()},scope:this})},onValidate:function(){var a=this.gridNotion.getSelectionModel().getSelected();this.recordColumn.data.notion=a.data;this.recordColumn.data.notion.url=this.urlDictionary+this.comboDictionary.getValue()+"/notions/"+a.data.id;this.viewColumn.refresh();this.close()}});Ext.reg("s-datasetsdictionary",sitools.admin.datasets.dictionaryWin);Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.unitWin=Ext.extend(Ext.Window,{width:600,height:400,modal:true,pageSize:10,initComponent:function(){this.title=i18n.get("label.units");this.httpProxy=new Ext.data.HttpProxy({url:this.urlDimension,restful:true,method:"GET"});this.storeUnits=new Ext.data.JsonStore({id:"storeUnitSelect",root:"dimension.sitoolsUnits",idProperty:"id",proxy:this.httpProxy,fields:[{name:"label",type:"string"},{name:"unitName",type:"string"}]});this.cmUnits=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.label"),dataIndex:"label",width:100}],defaults:{sortable:true,width:100}});this.smUnits=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridUnits=new Ext.grid.GridPanel({id:"gridUnitId",title:i18n.get("title.unitList"),autoScroll:true,store:this.storeUnits,cm:this.cmUnits,sm:this.smUnits,region:"center"});var a=new Ext.data.JsonStore({fields:["id","name","description"],url:this.urlDimension,root:"data",autoLoad:true});this.cmDimensions=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.name"),dataIndex:"name",width:100},{header:i18n.get("headers.description"),dataIndex:"description",width:100}],defaults:{sortable:true,width:100}});this.smDimensions=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridDimensions=new Ext.grid.GridPanel({id:"gridViewDimensionsId",title:i18n.get("title.DimensionsList"),region:"west",autoScroll:true,store:a,cm:this.cmDimensions,sm:this.smDimensions,width:200,collapsible:true,resizable:true,listeners:{scope:this,rowclick:function(b,e){var d=b.getStore().getAt(e);var c=d.get("id");this.loadUnits(c)}}});this.layout="border";this.items=[this.gridUnits,this.gridDimensions];this.buttons=[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}];sitools.admin.datasets.unitWin.superclass.initComponent.call(this)},loadUnits:function(a){this.httpProxy.setUrl(this.urlDimension+"/"+a);this.storeUnits.load({callback:function(){this.gridUnits.getView().refresh()},scope:this})},onValidate:function(){var b=this.gridUnits.getSelectionModel().getSelected();if(Ext.isEmpty(b)){Ext.Msg.alert(i18n.get("label.error"),i18n.get("label.noSelection"));return}var a=this.gridDimensions.getSelectionModel().getSelected();this.recordColumn.data.unit=b.data;this.recordColumn.data.dimensionId=a.data.id;this.viewColumn.refresh();this.close()}});Ext.reg("s-datasetsUnits",sitools.admin.datasets.unitWin);Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.datasetsOpenSearch=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:false,state:null,id:ID.COMPONENT_SETUP.OPENSEARCH,initComponent:function(){this.idOpenSearch=null;this.title=i18n.get("label.editOpenSearchIndexes");var f=[{fieldLabel:i18n.get("label.name"),name:"name",anchor:"100%",maxLength:16,allowBlank:false},{fieldLabel:i18n.get("label.description"),name:"description",anchor:"100%",allowBlank:false},{xtype:"sitoolsSelectImage",name:"image",fieldLabel:i18n.get("label.image"),anchor:"100%",growMax:400},{fieldLabel:i18n.get("label.lastImportDate"),name:"lastImportDate",anchor:"100%",disabled:true}];this.formPanel=new Ext.FormPanel({labelWidth:100,height:120,frame:true,defaultType:"textfield",items:f,region:"north"});var l=new Ext.data.JsonStore({root:"dataset.columnModel",idProperty:"id",fields:[{name:"id",type:"string"},{name:"dataIndex",type:"string"},{name:"width",type:"string"},{name:"sortable",type:"boolean"},{name:"visible",type:"boolean"},{name:"filter",type:"boolean"},{name:"columnOrder",type:"string"},{name:"columnType",type:"string"},{name:"notion",type:"string"},{name:"schema",type:"string"},{name:"tableName",type:"string"},{name:"sqlColumnType",type:"string"},{name:"specificColumnType",type:"string"},{name:"columnAlias",type:"string"},{name:"indexed",type:"boolean"},{name:"returned"},{name:"defaultSearchField",type:"boolean"},{name:"uniqueKey",type:"boolean"},{name:"primaryKey",type:"boolean"},{name:"keyword",type:"boolean"},{name:"solrType",type:"string"},{name:"linkFieldRelative",type:"boolean"}]});var b=new Ext.grid.CheckColumn({header:i18n.get("header.indexed"),dataIndex:"indexed",width:60});var a=new Ext.grid.CheckColumn({header:i18n.get("header.defaultSearchField"),dataIndex:"defaultSearchField",width:120});var m=new Ext.grid.CheckColumn({header:i18n.get("header.uniqueKey"),dataIndex:"uniqueKey",width:80});var c=new Ext.grid.CheckColumn({header:i18n.get("header.useForKeyWord"),dataIndex:"keyword",width:80});this.rssFieldData=[[0,""],[1,"titleField"],[2,"linkField"],[3,"guidField"],[4,"pubDateField"],[5,"descriptionField"]];var e={header:i18n.get("header.returned"),dataIndex:"returned",width:130,scope:this,editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",lazyRender:true,lazyInit:false,mode:"local",emptyText:" ",forceSelection:true,store:new Ext.data.ArrayStore({fields:["idRssField","textRssField"],data:this.rssFieldData}),valueField:"textRssField",displayField:"textRssField",tpl:'<tpl for="."><div class="x-combo-list-item comboItem">{textRssField}</div></tpl>',listeners:{scope:this,select:function(r,p){if(p.data.textRssField=="linkField"){var q=new sitools.admin.datasets.datasetsOpenSearch.relativeLink({selectedRecord:this.grid.getSelectionModel().getSelected()});q.show()}}}})};this.solrTypeData=[[0,""],[1,"text"],[2,"string"],[3,"rss_date"],[4,"date"]];var g={header:i18n.get("headers.solrType"),dataIndex:"solrType",width:130,helpUrl:loadUrl.get("APP_URL")+"/client-admin/res/help/"+LOCALE+"/dataset/opensearch/solrType.html",editor:new Ext.form.ComboBox({triggerAction:"all",mode:"local",emptyText:" ",store:new Ext.data.ArrayStore({fields:["idSolrType","textSolrType"],data:this.solrTypeData}),valueField:"textSolrType",displayField:"textSolrType",tpl:'<tpl for="."><div class="x-combo-list-item comboItem">{textSolrType}</div></tpl>'})};var k=new Ext.ux.grid.LockingColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),id:"dataIndex",dataIndex:"columnAlias",locked:true},{header:i18n.get("headers.tableName"),id:"tableName",dataIndex:"tableName",locked:true},b,e,a,m,c,g]});var d=[b,a,m,c];var n=new Ext.grid.RowSelectionModel({singleSelect:true});this.grid=new Ext.ux.grid.LockingEditorGridPanel({border:false,layout:"fit",pageSize:10,urlDatasets:loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_URL"),cm:k,sm:n,store:l,plugins:d,autoExpandColumn:"dataIndex",clicksToEdit:1,enableColumnMove:false,region:"center",viewConfig:{forceFit:true,autoFill:true,getRowClass:function(s,q){var p="";var r=s.data;if(!r.indexed&&!Ext.isEmpty(r.returned)){p="red-row"}return p}}});this.layout="border";this.items=[this.formPanel,this.grid];this.saveAndQuitButton=new Ext.Button({text:i18n.get("label.save"),scope:this,hidden:true});this.refreshStatusButton=new Ext.Button({text:i18n.get("label.refreshStatus"),scope:this,handler:function(){this._onRefreshStatusHandler()},hidden:true});this.buttonCancel=new Ext.Button({text:i18n.get("label.cancel"),scope:this,handler:function(){this._onCancel()},hidden:true});this.buttons=[this.saveAndQuitButton,this.refreshStatusButton,this.buttonCancel,{text:i18n.get("label.close"),scope:this,handler:function(){this.close()}}];this.buttonState1=[{text:i18n.get("label.saveIndex"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/save.png",handler:this._onSaveIndexHandler,xtype:"s-menuButton"},{text:i18n.get("label.help"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/help.png",handler:this._onHelp,xtype:"s-menuButton"}];this.buttonState2=[{text:i18n.get("label.saveIndex"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/save.png",handler:this._onUpdateIndexHandler,xtype:"s-menuButton"},{text:i18n.get("label.deleteIndex"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this._onDeleteIndex,xtype:"s-menuButton"},{text:i18n.get("label.activateIndex"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_active.png",handler:this._onActivateIndex,xtype:"s-menuButton"},{text:i18n.get("label.help"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/help.png",handler:this._onHelp,xtype:"s-menuButton"}];this.buttonState3=[];this.buttonState4=[{text:i18n.get("label.refreshIndex"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_refresh.png",handler:this._onRefreshIndex,xtype:"s-menuButton"},{text:i18n.get("label.desactivateIndex"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_disactive.png",handler:this._onDesactivateIndex,xtype:"s-menuButton"},{text:i18n.get("label.help"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/help.png",handler:this._onHelp,xtype:"s-menuButton"}];this.state1=1;this.state2=2;this.state3=3;this.state4=4;this.tbar={xtype:"toolbar",defaults:{scope:this},height:27};this.buttonbbar=new Ext.Button({text:i18n.get("label.errorDetails")});this.bbar=new Ext.ux.StatusBar({id:"statusBar",hidden:true,items:[this.buttonbbar],text:i18n.get("label.osErrorLastExe"),iconCls:"x-status-error"});this.grid.getView().addListener("refresh",function(){this.applyMask(this.state)},this);sitools.admin.datasets.datasetsOpenSearch.superclass.initComponent.call(this)},onRender:function(){sitools.admin.datasets.datasetsOpenSearch.superclass.onRender.apply(this,arguments);this.objectList={};Ext.Ajax.request({url:this.url,method:"GET",scope:this,success:function(b){var d=Ext.decode(b.responseText);if(!d.success){Ext.Msg.alert(i18n.get("label.warning"),d.message);return false}this.idOpenSearch=d.dataset.id;var e=d.dataset.columnModel;var a=this.grid.getStore();for(var c=0;c<e.length;c++){if(e[c].specificColumnType==="DATABASE"||e[c].specificColumnType==="SQL"){a.add(new Ext.data.Record(e[c]))}}this.loadModifications()}})},loadModifications:function(){Ext.Ajax.request({url:this.url+loadUrl.get("APP_OPENSEARCH_URL"),method:"GET",scope:this,success:function(a){var b=Ext.decode(a.responseText);if(!b.success){Ext.Msg.alert(i18n.get("label.information"),"Server error");return false}b=b.opensearch;this.updateState(b);this.populateForm(b);this.populateStore(b)},failure:alertFailure})},populateStore:function(e){this.cleanGridInput();if(e!==undefined){var d;var c;var b=e.indexedColumns;if(b!==undefined){for(d=0;d<b.length;d++){c=this.getObjectFromStore("id",b[d].idColumn);if(c!==undefined){c.indexed=true;c.solrType=b[d].type}}}var a=e.keywordColumns;if(a!==undefined){for(d=0;d<a.length;d++){c=this.getObjectFromStore("columnAlias",a[d]);if(c!==undefined){c.keyword=true}}}c=this.getObjectFromStore("id",e.defaultSearchField);if(c!==undefined){c.defaultSearchField=true}c=this.getObjectFromStore("id",e.uniqueKey);if(c!==undefined){c.uniqueKey=true}this.setReturnField("titleField",e);this.setReturnField("linkField",e);this.setReturnField("guidField",e);this.setReturnField("pubDateField",e);this.setReturnField("descriptionField",e);if(a!==undefined){for(d=0;d<a.length;d++){c=this.getObjectFromStore("dataIndex",a[d]);if(c!==undefined){c.keyword=true}}}this.grid.getView().refresh()}},updateState:function(a){Ext.getCmp("statusBar").hide();if(a!==undefined){if(a.status=="ACTIVE"){this.updateButtons(this.state4);this.state=this.state4}else{if(a.status=="PENDING"){this.updateButtons(this.state3);this.state=this.state3}else{this.updateButtons(this.state2);this.state=this.state2;if(!Ext.isEmpty(a.errorMsg)){Ext.getCmp("statusBar").show();this.buttonbbar.setHandler(function(){Ext.Msg.alert(i18n.get("msg.error"),i18n.get("label.osErrorLastExe")+"<BR/>"+a.errorMsg+"<BR/>"+i18n.get("label.checkLogMoreInfo"))})}}}}else{this.updateButtons(this.state1);this.state=this.state1}},populateForm:function(c){if(c!==undefined){var b=this.formPanel.getForm();var d={};d.name=c.name;d.description=c.description;if(c.image!==undefined){d.image=c.image.url}if(c.lastImportDate!==undefined){d.lastImportDate=c.lastImportDate}var a=new Ext.data.Record(d);b.loadRecord(a)}},getObjectFromStore:function(e,d){var a=this.grid.getStore();var c=a.find(e,d);if(c!=-1){var b=a.getAt(c);return b.data}else{return undefined}},setReturnField:function(d,c){var a=this.grid.getStore();if(c[d]!==undefined){var b=this.getObjectFromStore("id",c[d]);if(b!==undefined){b.returned=d;if(d=="linkField"){b.linkFieldRelative=c.linkFieldRelative}}}},updateButtons:function(b){var a=this.getTopToolbar();a.removeAll();this.hideLoadingMask();this.applyMask(b);if(b==this.state1){this.addButtonToToolbar(a,this.buttonState1);this.saveAndQuitButton.setHandler(this._onSaveAndQuitIndexHandler,this);this.saveAndQuitButton.show();this.refreshStatusButton.hide();this.buttonCancel.hide()}else{if(b==this.state2){this.addButtonToToolbar(a,this.buttonState2);this.saveAndQuitButton.show();this.saveAndQuitButton.setHandler(this._onUpdateAndQuitIndexHandler,this);this.refreshStatusButton.hide();this.buttonCancel.hide()}else{if(b==this.state3){this.addButtonToToolbar(a,this.buttonState2);this.saveAndQuitButton.hide();this.refreshStatusButton.show();this.buttonCancel.show()}else{if(b==this.state4){this.addButtonToToolbar(a,this.buttonState4);this.saveAndQuitButton.hide();this.refreshStatusButton.hide();this.buttonCancel.hide()}}}}this.doLayout()},applyMask:function(a){if(a==this.state4){this.grid.getView().getLockedBody().mask();this.grid.getView().mainBody.mask();this.formPanel.getEl().mask()}else{if(a==this.state3){this.applyLoadingMask()}else{this.grid.getView().getLockedBody().unmask();this.grid.getView().mainBody.unmask();this.formPanel.getEl().unmask()}}this.doLayout()},applyLoadingMask:function(){this.items.items[0].getEl().mask();this.getTopToolbar().getEl().mask();var a=new Ext.LoadMask(this.items.items[1].getEl(),{msg:i18n.get("label.waitForActivation")+"<br/>"+i18n.get("label.refreshOsToCheckStatus")});a.show()},hideLoadingMask:function(){this.items.items[0].getEl().unmask();this.items.items[1].getEl().unmask();this.getTopToolbar().getEl().unmask()},addButtonToToolbar:function(b,a){for(var c=0;c<a.length;c++){b.add(a[c])}},_onActivateIndex:function(){this.applyLoadingMask();Ext.Ajax.request({url:this.url+loadUrl.get("APP_OPENSEARCH_URL")+"/start",method:"PUT",scope:this,success:function(b){var a=Ext.decode(b.responseText);if(!a.success){Ext.Msg.alert(i18n.get("label.warning"),a.message);return false}var c=a.opensearch;this.updateState(c);this.populateForm(c);this.populateStore(c)},failure:function(a,b){alertFailure(a,b)}})},_onDesactivateIndex:function(){Ext.Ajax.request({url:this.url+loadUrl.get("APP_OPENSEARCH_URL")+"/stop",method:"PUT",scope:this,success:function(b){var a=Ext.decode(b.responseText);if(!a.success){Ext.Msg.alert(i18n.get("label.warning"),a.message);return false}var c=a.opensearch;this.updateState(c);this.populateForm(c);this.populateStore(c)},failure:alertFailure})},_onUpdateAndQuitIndexHandler:function(){this._onSaveIndex("update",true)},_onSaveAndQuitIndexHandler:function(){this._onSaveIndex("create",true)},_onUpdateIndexHandler:function(){this._onSaveIndex("update",false)},_onSaveIndexHandler:function(){this._onSaveIndex("create",false)},_onHelp:function(){showHelp(loadUrl.get("APP_URL")+"/client-admin/res/help/en/openSearch.html")},_onSaveIndex:function(k,m){var s=this.grid.getStore();var t=this.checkForDoubloon(this.rssFieldData,s,"returned");if(t!==null){Ext.Msg.alert(i18n.get("label.information"),i18n.get("label.doubloonReturnAsMsg")+t);return false}var a=this.grid.getView();var b=false;var f=[];var q=[];var c={};for(var p=0;p<s.getCount();p++){var g=s.getAt(p).data;if(g.indexed){var l={};l.idColumn=g.id;if(!Ext.isEmpty(g.solrType)&&g.solrType!==""){l.type=g.solrType}f.push(l)}if(g.keyword){q.push(g.columnAlias)}if(g.defaultSearchField){c.defaultSearchField=g.id}if(g.uniqueKey){c.uniqueKey=g.id}var n=g.returned;if(!Ext.isEmpty(g.returned)){c[g.returned]=g.id;if(!g.indexed){b=true}if(g.returned=="linkField"){c.linkFieldRelative=g.linkFieldRelative}}}if(b){Ext.Msg.alert(i18n.get("label.information"),i18n.get("label.osColReturnedButNotIndexed"));return false}c.indexedColumns=f;c.keywordColumns=q;c.id=this.idOpenSearch;var d=this.formPanel.getForm();Ext.iterate(d.getValues(),function(u,v){if(u=="image"){c.image={};c.image.url=v;c.image.type="Image";c.image.mediaType="Image"}else{c[u]=v}},this);if(f.length===0){Ext.Msg.alert(i18n.get("label.information"),i18n.get("label.noColumnMsg"))}else{if(c.defaultSearchField===undefined){Ext.Msg.alert(i18n.get("label.information"),i18n.get("label.noDefaultSearchField"))}else{if(c.uniqueKey===undefined){Ext.Msg.alert(i18n.get("label.information"),i18n.get("label.noUniqueKey"))}else{if(!d.isValid()){Ext.Msg.alert(i18n.get("label.information"),i18n.get("label.formErrorValidation"))}}}}var e=this.checkMapping(this.rssFieldData,s,"returned");if(!e){var r=Ext.Msg.show({title:i18n.get("label.information"),buttons:Ext.Msg.YESNO,msg:i18n.get("label.opensearch.checkMapping"),scope:this,fn:function(u,v){if(u=="yes"){this._doSaveIndex(k,m,c)}}})}else{this._doSaveIndex(k,m,c)}},_doSaveIndex:function(c,a,b){var d=(c=="create")?"POST":"PUT";Ext.Ajax.request({url:this.url+loadUrl.get("APP_OPENSEARCH_URL"),method:d,scope:this,jsonData:b,success:function(e){var g=Ext.decode(e.responseText);if(!g.success){Ext.Msg.alert(i18n.get("label.warning"),g.message);return false}if(!a){var f=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.indexSaved"),autoDestroy:true,hideDelay:1000}).show(document);this.updateButtons(this.state2)}else{this.close()}},failure:alertFailure})},_onDeleteIndex:function(){var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("label.opensearch.delete"),scope:this,fn:function(b,c){if(b=="yes"){this.doDelete()}}})},doDelete:function(){Ext.Ajax.request({url:this.url+loadUrl.get("APP_OPENSEARCH_URL"),method:"DELETE",scope:this,success:function(b){var a=Ext.decode(b.responseText);if(!a.success){Ext.Msg.alert(i18n.get("label.warning"),a.message);return}this.cleanGridInput();this.cleanForm();this.updateButtons(this.state1)},failure:alertFailure})},cleanGridInput:function(){var b=this.grid.getStore();for(var a=0;a<b.getCount();a++){var c=b.getAt(a).data;c.indexed=false;c.returned=undefined;c.defaultSearchField=false;c.uniqueKey=false;c.keyword=false;c.solrType=undefined}this.grid.getView().refresh()},cleanForm:function(){var a=this.formPanel.getForm();a.reset()},_onRefreshIndex:function(){this.applyLoadingMask();Ext.Ajax.request({url:this.url+loadUrl.get("APP_OPENSEARCH_URL")+"/refresh",method:"PUT",scope:this,success:function(b){var a=Ext.decode(b.responseText);if(!a.success){Ext.Msg.alert(i18n.get("label.warning"),a.message);return false}var c=a.opensearch;this.updateState(c);this.populateForm(c)},failure:function(a,b){alertFailure(a,b)}})},_onRefreshStatusHandler:function(){Ext.Ajax.request({url:this.url+loadUrl.get("APP_OPENSEARCH_URL"),method:"GET",scope:this,success:function(b){var a=Ext.decode(b.responseText);if(!a.success){Ext.Msg.alert(i18n.get("label.warning"),a.message);return false}var c=a.opensearch;this.updateState(c);this.populateForm(c)},failure:function(a,b){alertFailure(a,b)}})},_onCancel:function(){this.hideLoadingMask();Ext.Ajax.request({url:this.url+loadUrl.get("APP_OPENSEARCH_URL")+"/cancel",method:"PUT",scope:this,success:function(c){var a=Ext.decode(c.responseText);if(!a.success){Ext.Msg.alert(i18n.get("label.warning"),a.message);return false}var b={};b.opensearch={};b.opensearch.status="INACTIVE";this.updateState(b)},failure:function(a,b){alertFailure(a,b)}})},checkForDoubloon:function(c,f,g){var k=[c.length];for(var d=0;d<c.length;d++){k[d]=0}var e=null;for(d=0;d<f.getCount()&&e===null;d++){var a=f.getAt(d).data;var l=false;if(a[g]!==""){for(var b=0;b<c.length&&e===null&&!l;b++){if(a[g]==c[b][1]){k[b]++;l=true;if(k[b]>1){e=c[b][1]}}}}}return e},checkMapping:function(c,g,d){var f=0;var a=c.length-1;for(var b=0;b<g.getCount()&&f<a;b++){var e=g.getAt(b).data;if(!Ext.isEmpty(e[d])){f++}}return f==a}});Ext.reg("s-datasetsOpenSearch",sitools.admin.datasets.datasetsOpenSearch);sitools.admin.datasets.datasetsOpenSearch.relativeLink=Ext.extend(Ext.Window,{modal:true,width:200,initComponent:function(){this.title=i18n.get("label.detailColumnDefinition");this.formRelative=new Ext.form.FormPanel({padding:10,labelWidth:120,items:[{xtype:"checkbox",name:"relative",fieldLabel:i18n.get("label.isRelative"),anchor:"100%",maxLength:100}]});this.buttons=[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}];this.items=[this.formRelative];sitools.admin.datasets.datasetsOpenSearch.relativeLink.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.datasets.datasetsOpenSearch.relativeLink.superclass.afterRender.apply(this,arguments);if(!Ext.isEmpty(this.selectedRecord)&&!Ext.isEmpty(this.selectedRecord.data)){var b={};var a=this.formRelative.getForm();b.relative=this.selectedRecord.data.linkFieldRelative;a.loadRecord(new Ext.data.Record(b))}},onValidate:function(){var a=this.formRelative.getForm();var b=a.findField("relative").getValue();this.selectedRecord.data.linkFieldRelative=b;this.close()}});Ext.namespace("sitools.component.dictionary");sitools.component.dictionary.dictionaryPropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,templateLoaded:false,conceptTemplate:null,initComponent:function(){this.conceptTemplatesUrl=loadUrl.get("APP_URL")+loadUrl.get("APP_DICTIONARIES_TEMPLATES_URL");if(this.action=="modify"){this.title=i18n.get("label.modifyDictionary")}if(this.action=="create"){this.title=i18n.get("label.createDictionary")}this.gridTemplates=new Ext.grid.GridPanel({viewConfig:{forceFit:true},id:"gridTemplates",title:i18n.get("title.conceptTemplates"),store:new Ext.data.JsonStore({root:"data",restful:true,proxy:new Ext.data.HttpProxy({url:this.conceptTemplatesUrl,restful:true,method:"GET"}),remoteSort:false,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"properties"}],autoLoad:true,listeners:{scope:this,load:function(){this.templateLoaded=true;if(this.action=="modify"){this.gridTemplates.fireEvent("conceptTemplateLoaded")}}}}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:300,sortable:true}]}),listeners:{scope:this,rowclick:this.onTemplateClick,conceptTemplateLoaded:function(){if(this.templateLoaded&&!Ext.isEmpty(this.conceptTemplate)&&this.action=="modify"&&!Ext.isEmpty(this.conceptTemplate.id)){var b=this.gridTemplates.getStore().indexOfId(this.conceptTemplate.id);if(b>-1){this.gridTemplates.getSelectionModel().selectRow(b)}}}}});var a=new Ext.Panel({title:i18n.get("title.gridConcept"),id:"gridConceptsSelect",listeners:{scope:this,activate:this.onTemplateClick}});this.dictionaryFormPanel=new Ext.FormPanel({border:false,padding:10,id:"dictionaryFormPanel",title:i18n.get("label.dictionaryInfo"),height:400,items:[{xtype:"hidden",name:"id"},{xtype:"textfield",name:"name",fieldLabel:i18n.get("label.name"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"description",fieldLabel:i18n.get("label.description"),anchor:"100%"}]});this.mainTabPanel=new Ext.TabPanel({xtype:"tabpanel",height:450,activeTab:0,id:"tabPanelDictionary",items:[this.gridTemplates,this.dictionaryFormPanel,a],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.items=[this.mainTabPanel];this.listeners={scope:this,resize:function(e,d,b){var c=e.body.getSize();this.mainTabPanel.setSize(c)}};sitools.component.dictionary.dictionaryPropPanel.superclass.initComponent.call(this)},onUpload:function(){Ext.Msg.alert("upload non impl&eacute;ment&eacute;")},onCreateConcept:function(){var d;if(Ext.isEmpty(this.conceptTemplate)){d=this.gridTemplates.getSelectionModel().getSelected().data}else{d=this.conceptTemplate}var a={};for(var b=0;b<d.properties.length;b++){var c=d.properties[b];a[c.name]=c.value}this.findById("gridConceptsSelect").getStore().add(new Ext.data.Record(a));if(this.findById("gridConceptsSelect").getStore().getCount()==1){this.gridTemplates.getEl().mask()}},onDeleteConcet:function(){var a=this.findById("gridConceptsSelect");var b=a.getSelectionModel().getSelected();if(!b){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"));return}a.getStore().remove(b);if(this.findById("gridConceptsSelect").getStore().getCount()===0){this.gridTemplates.getEl().unmask()}},onValidate:function(){var c=this.gridTemplates.getSelectionModel().getSelected();var e;if(!c){e=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noTemplateselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}var k,m={},n,g;e=[];k=this.dictionaryFormPanel.getForm();if(!k.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return false}Ext.iterate(k.getFieldValues(),function(f,r){if(f=="image"){m.image={};m.image.url=r;m.image.type="Image";m.image.mediaType="Image"}else{m[f]=r}},this);var q;if(Ext.isEmpty(this.conceptTemplate)){q=this.gridTemplates.getSelectionModel().getSelected().data}else{q=this.conceptTemplate}if(!Ext.isEmpty(q)){m.conceptTemplate=q;if(Ext.isEmpty(m.conceptTemplate.properties)){m.conceptTemplate.properties=[]}}var d=this.findById("gridConceptsSelect");if(!Ext.isEmpty(d)&&Ext.isFunction(d.getStore)){n=this.findById("gridConceptsSelect").getStore();if(n.getCount()>0){m.concepts=[];for(g=0;g<n.getCount();g++){var l=n.getAt(g).data;var b={id:l.id,name:l.name,description:l.description,properties:[]};for(var p in l){if(p!="id"&&p!="name"&&p!="description"){b.properties.push({name:p,value:l[p]})}}m.concepts.push(b)}}}var a=(this.action=="modify")?"PUT":"POST";Ext.Ajax.request({url:this.url,method:a,scope:this,jsonData:m,success:function(f){this.close();this.store.reload()},failure:alertFailure})},onRender:function(){sitools.component.dictionary.dictionaryPropPanel.superclass.onRender.apply(this,arguments);if(this.url){var a;if(this.action=="modify"){Ext.Ajax.request({url:this.url,method:"GET",scope:this,success:function(l){var e=Ext.decode(l.responseText).dictionary;var k=this.findById("dictionaryFormPanel").getForm();var c={};c.id=e.id;c.name=e.name;c.description=e.description;var g=new Ext.data.Record(c);k.loadRecord(g);if(!Ext.isEmpty(e.conceptTemplate)){this.conceptTemplate=e.conceptTemplate}this.gridTemplates.fireEvent("conceptTemplateLoaded");this.createConceptGrid(e.conceptTemplate);if(!e.concepts){return}var n=this.findById("gridConceptsSelect").getStore();var m=0;for(a=0;a<e.concepts.length;a++){m++;var q=e.concepts[a];var b={id:q.id,name:q.name,description:q.description};for(var d=0;d<q.properties.length;d++){var p=q.properties[d];b[p.name]=p.value}c=new Ext.data.Record(b);n.add(c)}if(m>0){this.gridTemplates.getEl().mask()}},failure:function(b){var c=Ext.decode(b.responseText);Ext.Msg.alert(i18n.get("label.warning"),c.errorMessage)}})}}},onTemplateClick:function(a,f,c){var d=this.gridTemplates.getSelectionModel().getSelected();if(!d){return false}var b=d.data.id;if(Ext.isEmpty(this.conceptTemplate)||this.conceptTemplate.id!=b){this.createConceptGrid(d.data);this.conceptTemplate=d.data}},createConceptGrid:function(b){var a=new sitools.component.dictionary.gridPanel({template:b,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),tbar:{xtype:"sitools.widget.GridSorterToolbar",gridId:"gridConceptsSelect",items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreateConcept,scope:this},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDeleteConcet,scope:this}]},id:"gridConceptsSelect",title:i18n.get("title.gridConcept"),editable:true});var c=this.get("tabPanelDictionary");c.remove("gridConceptsSelect");c.add(a);this.doLayout()},beforeTabChange:function(a,e,d){if(e.id=="gridConceptsSelect"||e.id=="dictionaryFormPanel"){var c=this.gridTemplates.getSelectionModel().getSelected();if(!c&&Ext.isEmpty(this.conceptTemplate)){var b=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noTemplateselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}}}});Ext.reg("s-dictionaryprop",sitools.component.dictionary.dictionaryPropPanel);Ext.namespace("sitools.component.dictionary");sitools.component.dictionary.dictionaryCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.GROUP,sm:new Ext.grid.RowSelectionModel(),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_DICTIONARIES_URL");this.store=new Ext.data.JsonStore({root:"data",restful:true,url:this.url,remoteSort:true,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"template",type:"string"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:100},{header:i18n.get("label.description"),dataIndex:"description",width:400,sortable:false}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.component.dictionary.dictionaryCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.dictionary.dictionaryCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.component.dictionary.dictionaryPropPanel({url:this.url,action:"create",store:this.getStore()});a.show(ID.BOX.DICTIONARY)},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.component.dictionary.dictionaryPropPanel({url:this.url+"/"+b.id,action:"modify",store:this.getStore()});a.show(ID.BOX.DICTIONARY)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("dictionaryCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-dictionary",sitools.component.dictionary.dictionaryCrudPanel);Ext.namespace("sitools.component.dictionary");sitools.component.dictionary.templatePropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,initComponent:function(){if(this.action=="modify"){this.title=i18n.get("label.modifyTemplate")}if(this.action=="create"){this.title=i18n.get("label.createTemplate")}var b=new Ext.data.JsonStore({id:"storePropertiesSelect",root:"property",idProperty:"name",fields:[{name:"name",type:"string"},{name:"value",type:"string"}]});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.name"),dataIndex:"name",width:100,editor:new Ext.form.TextField({allowBlank:false})},{header:i18n.get("headers.value"),dataIndex:"value",width:150,editor:new Ext.form.TextField({allowBlank:true})}],defaults:{sortable:true,width:100,editor:new Ext.form.TextField({allowBlank:false})}});var d=new Ext.grid.RowSelectionModel({singleSelect:true});var e={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreateProperty},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDeleteProperty}]};var c=new Ext.grid.EditorGridPanel({id:"gridPropertySelect",title:i18n.get("title.gridProperty"),store:b,tbar:e,cm:a,sm:d});this.items=[{xtype:"tabpanel",height:450,activeTab:0,items:[{xtype:"panel",height:400,title:i18n.get("label.templateInfo"),items:[{xtype:"form",border:false,padding:10,items:[{xtype:"hidden",name:"id"},{xtype:"textfield",name:"name",fieldLabel:i18n.get("label.name"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"description",fieldLabel:i18n.get("label.description"),anchor:"100%"}]}]},c],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];sitools.component.dictionary.templatePropPanel.superclass.initComponent.call(this)},onUpload:function(){Ext.Msg.alert("upload non impl&eacute;ment&eacute;")},onCreateProperty:function(){this.findById("gridPropertySelect").getStore().add(new Ext.data.Record())},onDeleteProperty:function(){var a=this.findById("gridPropertySelect");var b=a.getSelectionModel().getSelected();if(!b){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"));return}a.getStore().remove(b)},onValidate:function(){var d,e={},a,c=[],b;d=this.findByType("form")[0].getForm();if(!d.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return false}if(this.action=="modify"){Ext.iterate(d.getValues(),function(f,g){if(f=="image"){e.image={};e.image.url=g;e.image.type="Image";e.image.mediaType="Image"}else{e[f]=g}},this);a=this.findById("gridPropertySelect").getStore();if(a.getCount()>0){e.properties=[];for(b=0;b<a.getCount();b++){e.properties.push(a.getAt(b).data)}}Ext.Ajax.request({url:this.url,method:"PUT",scope:this,jsonData:e,success:function(f){this.close();this.store.reload()},failure:alertFailure})}if(this.action=="create"){Ext.iterate(d.getValues(),function(f,g){if(f=="image"){e.image={};e.image.url=g;e.image.type="Image";e.image.mediaType="Image"}else{e[f]=g}},this);a=this.findById("gridPropertySelect").getStore();if(a.getCount()>0){e.properties=[];for(b=0;b<a.getCount();b++){e.properties.push(a.getAt(b).data)}}Ext.Ajax.request({url:this.url,method:"POST",scope:this,jsonData:e,success:function(f){this.close();this.store.reload()},failure:alertFailure})}},onRender:function(){sitools.component.dictionary.templatePropPanel.superclass.onRender.apply(this,arguments);if(this.url){var a;if(this.action=="modify"){Ext.Ajax.request({url:this.url,method:"GET",scope:this,success:function(d){var k=this.findByType("form")[0].getForm();var c=this.findById("gridPropertySelect").getStore();var g=Ext.decode(d.responseText).template;var l={};l.id=g.id;l.name=g.name;l.description=g.description;var b=new Ext.data.Record(l);k.loadRecord(b);if(!g.properties){return}var e;if(typeof g.properties[0]&&g.properties[0] instanceof Array){e=g.properties[0]}else{e=g.properties}for(a=0;a<e.length;a++){l=new Ext.data.Record(e[a]);c.add(l)}},failure:function(b){var c=Ext.decode(b.responseText);Ext.Msg.alert(i18n.get("label.warning"),c.errorMessage)}})}}}});Ext.reg("s-templateprop",sitools.component.dictionary.templatePropPanel);Ext.namespace("sitools.component.dictionary");sitools.component.dictionary.templateCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.GROUP,sm:new Ext.grid.RowSelectionModel(),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_DICTIONARIES_TEMPLATES_URL");this.store=new Ext.data.JsonStore({root:"data",restful:true,url:this.url,remoteSort:true,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:100},{header:i18n.get("label.description"),dataIndex:"description",width:400,sortable:false}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.component.dictionary.templateCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.dictionary.templateCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.component.dictionary.templatePropPanel({url:this.url,action:"create",store:this.getStore()});a.show(ID.BOX.TEMPLATE)},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.component.dictionary.templatePropPanel({url:this.url+"/"+b.id,action:"modify",store:this.getStore()});a.show(ID.BOX.TEMPLATE)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("templateCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-template",sitools.component.dictionary.templateCrudPanel);Ext.namespace("sitools.component.dictionary");sitools.component.dictionary.selectDictionary=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,initComponent:function(){this.title=i18n.get("title.selectDictionary");this.cmselectDictionary=new Ext.grid.ColumnModel({columns:[{id:"name",header:i18n.get("headers.name"),sortable:true,dataIndex:"name"},{id:"description",header:i18n.get("headers.description"),sortable:false,dataIndex:"description"}]});this.smselectDictionary=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridselectDictionary=new Ext.grid.GridPanel({height:380,autoScroll:true,viewConfig:{forceFit:true},store:new Ext.data.JsonStore({root:"data",restful:true,proxy:new Ext.data.HttpProxy({url:this.url,restful:true,method:"GET"}),remoteSort:true,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"}],autoLoad:true}),cm:this.cmselectDictionary,sm:this.smselectDictionary});this.items=[{xtype:"panel",layout:"fit",items:[this.gridselectDictionary],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];sitools.component.dictionary.selectDictionary.superclass.initComponent.call(this)},onValidate:function(){var a=this.gridselectDictionary.getSelectionModel().getSelected();if(a!==null){this.record.data[this.field]=a.data.name;this.parentView.refresh();this.close()}else{new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document)}}});Ext.reg("s-selectDictionaryWin",sitools.component.dictionary.selectDictionary);Ext.namespace("sitools.admin.datasource.jdbc");sitools.admin.datasource.jdbc.DataBaseCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.DATABASE,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASOURCES_URL");this.store=new Ext.data.JsonStore({root:"data",restful:true,remoteSort:true,autoSave:false,url:this.url,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"url",type:"string"},{name:"status",type:"string"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:205,sortable:false},{header:i18n.get("label.url"),dataIndex:"url",width:350,sortable:false},{header:i18n.get("label.status"),dataIndex:"status",width:90,sortable:true}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this._onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this._onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this._onDelete,xtype:"s-menuButton"},{text:i18n.get("label.active"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_active.png",handler:this._onActive,xtype:"s-menuButton"},{text:i18n.get("label.disactive"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_disactive.png",handler:this._onDisactive,xtype:"s-menuButton"},{text:i18n.get("label.testCnx"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_test_connection.png",handler:this._onTest,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this._onModify};sitools.admin.datasource.jdbc.DataBaseCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.datasource.jdbc.DataBaseCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},_onCreate:function(){var a=new sitools.admin.datasource.jdbc.DataBasePropPanel({url:this.url,action:"create",store:this.store});a.show(ID.BOX.DATABASE)},_onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}if(b.data.status==i18n.get("status.active")){this._onView();return}var a=new sitools.admin.datasource.jdbc.DataBasePropPanel({url:this.url+"/"+b.id,action:"modify",store:this.store});a.show(ID.BOX.DATABASE)},_onView:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.datasource.jdbc.DataBasePropPanel({url:this.url+"/"+b.id,action:"view",store:this.store});a.show()},_onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("databaseCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"/start",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"/stop",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onTest:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.datasource.DataBaseTest({url:this.url+"/"+b.id+"/test"});a.show()}});Ext.reg("s-databaseJDBC",sitools.admin.datasource.jdbc.DataBaseCrudPanel);Ext.namespace("sitools.admin.datasource.jdbc");sitools.admin.datasource.jdbc.DataBasePropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,id:ID.COMPONENT_SETUP.DATABASE,initComponent:function(){if(this.action=="create"){this.title=i18n.get("label.createDatabase")}else{if(this.action=="modify"){this.title=i18n.get("label.modifyDatabase")}else{if(this.action=="view"){this.title=i18n.get("label.viewDatabase")}}}this.items=[{xtype:"panel",layout:"fit",title:i18n.get("label.databaseInfo"),items:[{xtype:"form",formId:"datasourceForm",border:false,labelWidth:150,padding:10,defaultType:"textfield",defaults:{anchor:"100%",allowBlank:false},items:[{name:"id",hidden:true,allowBlank:true},{name:"name",fieldLabel:i18n.get("label.name"),vtype:"withoutSpace"},{name:"description",fieldLabel:i18n.get("label.description"),allowBlank:true},{xtype:"combo",id:"driverDatasourceId",mode:"local",triggerAction:"all",editable:false,name:"driverClass",fieldLabel:i18n.get("label.driver"),width:100,store:new Ext.data.ArrayStore({fields:[{name:"code"},{name:"label"}],data:[["org.gjt.mm.mysql.Driver","MySQL"],["org.postgresql.Driver","PostgreSQL"]]}),valueField:"code",displayField:"label",anchor:"50%",listeners:{select:function(e,b,c){var a=b.get("code");var d=Ext.getCmp("portField");switch(a){case"org.gjt.mm.mysql.Driver":d.setValue("3306");break;case"org.postgresql.Driver":d.setValue("5432");break}}}},{name:"host",fieldLabel:i18n.get("label.host"),vtype:"withoutSpace"},{id:"portField",name:"port",fieldLabel:i18n.get("label.portNumber"),xtype:"numberfield"},{name:"database",fieldLabel:i18n.get("label.databaseName"),vtype:"withoutSpace"},{name:"schemaOnConnection",fieldLabel:i18n.get("label.schemaOnConnection"),allowBlank:true},{name:"userLogin",fieldLabel:i18n.get("label.userLogin"),vtype:"withoutSpace"},{fieldLabel:i18n.get("label.userPassword"),inputType:"password",name:"userPassword",vtype:"withoutSpace"},{xtype:"fieldset",title:i18n.get("label.advancedParameters"),collapsible:true,collapsed:true,autoHeight:true,defaultType:"textfield",items:[{name:"sitoolsAttachementForUsers",fieldLabel:i18n.get("label.userAttach"),vtype:"attachment",allowBlank:true,anchor:"100%"},{xtype:"spinnerfield",name:"maxActive",id:"maxActiveId",fieldLabel:i18n.get("label.maxActive"),minValue:0,maxValue:20,allowDecimals:false,incrementValue:1,accelerate:true,anchor:"50%",value:10,validator:function(a){var b=Ext.getCmp("initialSizeId").getValue();if(Ext.isEmpty(b)){b=0}if(Ext.isEmpty(a)){return i18n.get("label.nullValue")}if(b>a){return String.format(i18n.get("label.dbMaxActiveError"),a,b)}else{return true}}},{xtype:"spinnerfield",name:"initialSize",id:"initialSizeId",fieldLabel:i18n.get("label.initialSize"),minValue:0,maxValue:20,allowDecimals:false,incrementValue:1,accelerate:true,anchor:"50%",value:5,validator:function(b){var a=Ext.getCmp("maxActiveId").getValue();if(Ext.isEmpty(a)){a=0}if(Ext.isEmpty(b)){return i18n.get("label.nullValue")}if(a<b){return String.format(i18n.get("label.dbMaxActiveError"),a,b)}else{return true}}}]}]}],buttons:[{text:i18n.get("label.testCnx"),scope:this,handler:this._onTest},{text:i18n.get("label.ok"),scope:this,handler:this._onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];this.listeners={scope:this,resize:function(d,c,a){var b=d.body.getSize();this.findByType("panel")[0].setSize(b)}};sitools.admin.datasource.jdbc.DataBasePropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.datasource.jdbc.DataBasePropPanel.superclass.onRender.apply(this,arguments);Ext.each(this.findByType("form")[0].items.items,function(b){b.disable()},this);this.findByType("panel")[0].buttons[1].disable();this.findByType("panel")[0].buttons[0].disable();if(this.action=="modify"||this.action=="view"){var a=this.findByType("form")[0].getForm();Ext.Ajax.request({url:this.url,method:"GET",scope:this,success:function(d){var f=Ext.decode(d.responseText);var c=f.jdbcdatasource;var b=new Reference(c.url);c.host=b.getHost();c.port=b.getPort();var g=b.getFile();c.database=g.substring(1,g.length);a.setValues(f.jdbcdatasource);var e=a.isValid()},failure:alertFailure})}if(this.action=="modify"||this.action=="create"){Ext.each(this.findByType("form")[0].items.items,function(b){b.enable()},this);this.findByType("panel")[0].buttons[1].enable();this.findByType("panel")[0].buttons[0].enable()}},_onValidate:function(){var c=this.findByType("form")[0].getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.invalidForm"));return}var a=this.action=="modify"?"PUT":"POST";var b=c.getFieldValues();b.url=this._createUrl(b);Ext.destroyMembers(b,"host","port","database");Ext.Ajax.request({url:this.url,method:a,scope:this,jsonData:b,success:function(d){this.store.reload();this.close()},failure:alertFailure})},_onTest:function(){var b=this.findByType("form")[0].getForm();var a=b.getFieldValues();a.url=this._createUrl(a);Ext.destroyMembers(a,"host","port","database");var c=new sitools.admin.datasource.DataBaseTest({url:this.url+"/test",data:a});c.show()},_createUrl:function(b){var c="jdbc:";var a=b.driverClass;switch(a){case"org.gjt.mm.mysql.Driver":c+="mysql";break;case"org.postgresql.Driver":c+="postgresql";break}c+="://";return c+b.host+":"+b.port+"/"+b.database}});Ext.reg("s-databaseprop",sitools.admin.datasource.jdbc.DataBasePropPanel);Ext.namespace("sitools.admin.datasource");sitools.admin.datasource.DataBaseTest=Ext.extend(Ext.Window,{width:400,height:210,modal:true,closable:false,layout:"fit",buttonAlign:"center",initComponent:function(){this.title=i18n.get("label.databaseInfo");this.bbar=new Ext.ux.StatusBar({text:i18n.get("label.ready"),id:"sbDBTest",iconCls:"x-status-valid"});this.items=[{xtype:"panel",baseCls:"x-plain",layout:"fit",items:[{xtype:"textarea",id:"DBText"}]}];this.buttons=[{text:i18n.get("label.ok"),scope:this,handler:function(){this.close()}}];sitools.admin.datasource.DataBaseTest.superclass.initComponent.call(this)},onRender:function(){sitools.admin.datasource.DataBaseTest.superclass.onRender.apply(this,arguments);Ext.getCmp("sbDBTest").showBusy();Ext.Ajax.request({url:this.url,method:"PUT",scope:this,jsonData:this.data,success:function(b){var c=Ext.decode(b.responseText);var a=c.success?i18n.get("msg.success"):i18n.get("msg.failure");var d=c.data?c.data.join("\n"):c.message;Ext.getCmp("sbDBTest").setStatus({text:a,iconCls:c.success?"x-status-valid":"x-status-error"});Ext.getCmp("DBText").setValue(d)},failure:function(a){var c=i18n.get("warning.serverError");try{c=Ext.decode(a.responseText).logs.join("\n")}catch(b){}Ext.getCmp("sbDBTest").setStatus({text:a.statusText,iconCls:"x-status-error"});Ext.getCmp("DBText").setValue(c)}})}});Ext.namespace("sitools.admin.datasource.mongoDb");sitools.admin.datasource.mongoDb.DataBaseCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.DATABASE,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASOURCES_MONGODB_URL");this.store=new Ext.data.JsonStore({root:"data",restful:true,remoteSort:true,autoSave:false,url:this.url,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"url",type:"string"},{name:"sitoolsAttachementForUsers",type:"numeric"},{name:"portNumber",type:"numeric"},{name:"databaseName",type:"string"},{name:"status",type:"string"},{name:"authentication",type:"boolean"},{name:"userLogin",type:"string"},{name:"userPassword",type:"string"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:205,sortable:false},{header:i18n.get("label.url"),dataIndex:"url",width:350,sortable:false},{header:i18n.get("label.status"),dataIndex:"status",width:90,sortable:true},{xtype:"actioncolumn",width:30,items:[{getClass:function(a,b,c){if(c.get("status")==="ACTIVE"){this.items[0].tooltip=i18n.get("label.databaseExplorer");return"sitools-explore-datasource"}else{return""}},handler:function(b,e,a){var d=b.getStore().getAt(e);var c=new sitools.admin.datasource.mongoDb.DataBaseExplorer({database:d.data});c.show()}}]}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this._onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this._onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this._onDelete,xtype:"s-menuButton"},{text:i18n.get("label.active"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_active.png",handler:this._onActive,xtype:"s-menuButton"},{text:i18n.get("label.disactive"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_disactive.png",handler:this._onDisactive,xtype:"s-menuButton"},{text:i18n.get("label.testCnx"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_test_connection.png",handler:this._onTest,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this._onModify};sitools.admin.datasource.mongoDb.DataBaseCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.datasource.mongoDb.DataBaseCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},_onCreate:function(){var a=new sitools.admin.datasource.mongoDb.DataBasePropPanel({url:this.url,action:"create",store:this.store});a.show(ID.BOX.DATABASE)},_onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}if(b.data.status===i18n.get("status.active")){this._onView();return}var a=new sitools.admin.datasource.mongoDb.DataBasePropPanel({url:this.url+"/"+b.id,action:"modify",store:this.store});a.show(ID.BOX.DATABASE)},_onView:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.datasource.mongoDb.DataBasePropPanel({url:this.url+"/"+b.id,action:"view",store:this.store});a.show()},_onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("databaseCrud.delete"),scope:this,fn:function(c,d){if(c==="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"/start",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"/stop",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onTest:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.datasource.DataBaseTest({url:this.url+"/"+b.id+"/test"});a.show()}});Ext.reg("s-databaseMongoDb",sitools.admin.datasource.mongoDb.DataBaseCrudPanel);Ext.namespace("sitools.admin.datasource.mongoDb");sitools.admin.datasource.mongoDb.DataBasePropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,id:ID.COMPONENT_SETUP.DATABASE,initComponent:function(){if(this.action==="create"){this.title=i18n.get("label.createDatabase")}else{if(this.action==="modify"){this.title=i18n.get("label.modifyDatabase")}else{if(this.action==="view"){this.title=i18n.get("label.viewDatabase")}}}this.items=[{xtype:"panel",layout:"fit",title:i18n.get("label.databaseInfo"),items:[{xtype:"form",formId:"datasourceForm",border:false,labelWidth:150,padding:10,defaultType:"textfield",defaults:{anchor:"100%",allowBlank:false},items:[{name:"id",hidden:true,allowBlank:true},{name:"name",fieldLabel:i18n.get("label.name")},{name:"description",fieldLabel:i18n.get("label.description"),allowBlank:true},{xtype:"combo",id:"driverDatasourceId",mode:"local",triggerAction:"all",editable:false,name:"driverClass",fieldLabel:i18n.get("label.driver"),width:100,store:new Ext.data.ArrayStore({fields:[{name:"code"},{name:"label"}],data:[["com.mongo.driver","MongoDb"]]}),valueField:"code",displayField:"label",anchor:"50%",value:"com.mongo.driver"},{name:"url",fieldLabel:i18n.get("label.url"),validator:function(b){var a=Ext.getCmp("driverDatasourceId").getValue();if(Ext.isEmpty(a)){return"The Driver is empty"}return true}},{name:"sitoolsAttachementForUsers",fieldLabel:i18n.get("label.userAttach"),vtype:"attachment"},{name:"databaseName",fieldLabel:i18n.get("label.databaseName"),vtype:"withoutSpace"},{xtype:"numberfield",name:"portNumber",fieldLabel:i18n.get("label.portNumber")},{name:"authentication",fieldLabel:i18n.get("label.authentication"),xtype:"checkbox",listeners:{check:function(b,a){var c=b.ownerCt.getForm();c.findField("userLogin").setVisible(a);c.findField("userPassword").setVisible(a)}}},{name:"userLogin",allowBlank:true,fieldLabel:i18n.get("label.userLogin")},{fieldLabel:i18n.get("label.userPassword"),allowBlank:true,inputType:"password",name:"userPassword"},{xtype:"spinnerfield",name:"maxActive",id:"maxActiveId",fieldLabel:i18n.get("label.maxActive"),minValue:0,maxValue:20,allowDecimals:false,incrementValue:1,accelerate:true,anchor:"50%",value:10}]}],buttons:[{text:i18n.get("label.testCnx"),scope:this,handler:this._onTest},{text:i18n.get("label.ok"),scope:this,handler:this._onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];this.listeners={scope:this,resize:function(d,c,a){var b=d.body.getSize();this.findByType("panel")[0].setSize(b)}};sitools.admin.datasource.mongoDb.DataBasePropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.datasource.mongoDb.DataBasePropPanel.superclass.onRender.apply(this,arguments);var b=this.findByType("form")[0];var c=this.findByType("form")[0].getForm();Ext.each(b.items.items,function(d){d.disable()},this);this.findByType("panel")[0].buttons[1].disable();this.findByType("panel")[0].buttons[0].disable();if(this.action==="modify"||this.action==="view"){var a=this.findByType("form")[0].getForm();Ext.Ajax.request({url:this.url,method:"GET",scope:this,success:function(d){var f=Ext.decode(d.responseText);a.setValues(f.mongodbdatasource);var e=a.isValid()},failure:alertFailure})}else{c.findField("authentication").setValue(true)}if(this.action==="modify"||this.action==="create"){Ext.each(b.items.items,function(d){d.enable()},this);this.findByType("panel")[0].buttons[1].enable();this.findByType("panel")[0].buttons[0].enable()}c.findField("userLogin").setVisible(c.findField("authentication").getValue());c.findField("userPassword").setVisible(c.findField("authentication").getValue())},_onValidate:function(){var b=this.findByType("form")[0].getForm();if(!b.isValid()){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.invalidForm"));return}var a=this.action==="modify"?"PUT":"POST";Ext.Ajax.request({url:this.url,method:a,scope:this,jsonData:b.getFieldValues(),success:function(c){this.store.reload();this.close()},failure:alertFailure})},_onTest:function(){var b=this.findByType("form")[0].getForm();var a=b.getFieldValues();var c=new sitools.admin.datasource.DataBaseTest({url:this.url+"/test",data:a});c.show()}});Ext.reg("s-databaseprop",sitools.admin.datasource.mongoDb.DataBasePropPanel);Ext.namespace("sitools.admin.datasource.mongoDb");sitools.admin.datasource.mongoDb.DataBaseExplorer=Ext.extend(Ext.Window,{width:800,height:500,closable:true,layout:"hbox",layoutConfig:{pack:"start",align:"stretch"},initComponent:function(){this.title=i18n.get("label.databaseExplorer");var a=new Ext.data.JsonStore({fields:["name","url"],url:this.database.sitoolsAttachementForUsers+"/collections",root:"mongodbdatabase.collections",autoLoad:true,listeners:{scope:this,load:function(b,c){if(c.length!==0){this.combobox.setValue(c[0].get("name"));this.combobox.fireEvent("select",this.combobox,c[0],0)}}}});this.combobox=new Ext.form.ComboBox({store:a,fieldLabel:i18n.get("label.selectCollection"),displayField:"name",valueField:"name",typeAhead:true,mode:"local",emptyText:i18n.get("label.selectACollection"),forceSelection:true,triggerAction:"all",selectOnFocus:true,listeners:{scope:this,select:function(c,d,b){this.collection=d.data;this.loadCollection()}}});this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{xtype:"label",text:i18n.get("label.selectCollection")+" : "},this.combobox]};this.buttons=[{text:i18n.get("label.ok"),scope:this,handler:function(){this.close()}}];this.listeners={scope:this,metadataLoaded:function(b){this.displayRecords(b)}};sitools.admin.datasource.mongoDb.DataBaseExplorer.superclass.initComponent.call(this)},loadCollection:function(){if(!Ext.isEmpty(this.metadataPanel)){this.remove(this.metadataPanel)}this.metadataPanel=new sitools.admin.datasource.mongoDb.CollectionExplorer({collection:this.collection,observer:this,flex:1});this.add(this.metadataPanel);this.doLayout()},displayRecords:function(b){if(!Ext.isEmpty(this.recordsPanel)){this.remove(this.recordsPanel)}try{this.recordsPanel=new sitools.admin.datasource.mongoDb.RecordsPanel({collection:this.collection,node:b,flex:2});this.add(this.recordsPanel);this.doLayout()}catch(a){Ext.Msg.alert(i18n.get("label.error"),i18n.get("label.displayRecordsProblem"));this.removeAll();this.doLayout()}}});Ext.namespace("sitools.admin.datasource.mongoDb");sitools.admin.datasource.mongoDb.CollectionExplorer=Ext.extend(Ext.tree.TreePanel,{initComponent:function(){var a=!Ext.isEmpty(this.collection)?this.collection.url+"/metadata":null;sitools.admin.datasource.mongoDb.CollectionExplorer.superclass.initComponent.call(Ext.apply(this,{title:i18n.get("label.metadata"),useArrows:false,autoScroll:true,animate:true,selModel:new Ext.tree.MultiSelectionModel(),root:{nodeType:"async"},loader:new sitools.widget.rootTreeLoader({requestMethod:"GET",root:"data",url:a,listeners:{scope:this,load:function(b,d,c){if(this.observer){this.observer.fireEvent("metadataLoaded",d)}}}}),rootVisible:false,listeners:{scope:this,beforeload:function(b){b.setText(b.attributes.name);b.attributes.collection=this.collection.name;return b.isRoot||Ext.isDefined(b.attributes.children)},load:function(b){b.eachChild(function(c){c.setText(c.attributes.name);return true})}}}))},getLoader:function(){return this.loader}});Ext.namespace("sitools.admin.datasource.mongoDb");sitools.admin.datasource.mongoDb.RecordsPanel=Ext.extend(Ext.grid.GridPanel,{initComponent:function(){var c=this.metadatas2ExtObject(this.node)||{};var a=c.columnModel||new Ext.grid.ColumnModel({columns:[]});var b=c.store;b.load({params:{start:0,limit:300}});sitools.admin.datasource.mongoDb.RecordsPanel.superclass.initComponent.call(Ext.apply(this,{cm:a,store:b,loadMask:true,title:i18n.get("label.records"),bbar:new Ext.PagingToolbar({store:b,displayInfo:true,pageSize:300,prependButtons:true}),listeners:{scope:this,render:function(d){d.getEl().mask(i18n.get("label.loading"),"ext-el-mask-msg x-mask-loading")}}}))},metadatas2ExtObject:function(e){if(Ext.isEmpty(e.childNodes)){return null}var b=[],a=[],c,d;Ext.each(e.childNodes,function(f){c=!Ext.isEmpty(f.leaf)&&f.leaf?this.metadata2Column(f):this.metadata2ActionColumn(f);d={name:f.text};a.push(d);b.push(c)},this);return{columnModel:new Ext.grid.ColumnModel({columns:b,defaults:[{width:100}]}),store:new Ext.data.JsonStore({fields:a,url:this.collection.url+"/records",autoLoad:false,restful:true,root:"data",totalProperty:"total",listeners:{scope:this,load:function(f){if(this.getEl()){this.getEl().unmask()}}}})}},metadata2ActionColumn:function(a){var b=new Ext.grid.Column({scope:this,header:a.text,dataIndex:a.text,width:70,processEvent:function(e,c,f,m,d){if(Ext.getCmp("jsonDetailWin")){Ext.getCmp("jsonDetailWin").destroy()}var g=f.getColumnModel().columns[d];var k=f.getStore().getAt(m).get(g.dataIndex);f.getSelectionModel().selectRow(m);var l=new Ext.Window({id:"jsonDetailWin",title:i18n.get("label.detail")+" "+g.header+" object",modal:true,autoScroll:true,html:String.format("<pre>{0}</pre>",sitools.common.utils.Utils.syntaxHighlight(JSON.stringify(k,undefined,4))),height:400,x:c.getXY()[0],y:c.getXY()[1]});l.show();l.toFront()},renderer:function(l,e,d,m,g,f){var k=0;for(var c in l){k++}return"<div style='float: left; width:50px;'>["+k+" "+i18n.get("label.key")+"] </div><div style='width:18px;'><img src=/sitools/common/res/images/icons/detailJson.png></div>"}});return b},metadata2Column:function(a){var b=new Ext.grid.Column({header:a.text,dataIndex:a.text});if(a.text==="_id"){Ext.apply(b,{renderer:function(c){if(Ext.isString(c)){return c}if(Ext.isObject(c)&&c.$oid){return c.$oid}return c}})}return b}});Ext.namespace("sitools.component.forms.componentsAdminDef");sitools.component.forms.componentsAdminDef.DatasetContext=function(){this.context="dataset";this.buildComboParam1=function(a){a.storeColumn=new Ext.data.JsonStore({root:"ColumnModel",idProperty:"header",remoteSort:false,fields:[{name:"id",type:"string"},{name:"dataIndex",type:"string"},{name:"schema",type:"string"},{name:"tableAlias",type:"string"},{name:"tableName",type:"string"},{name:"header",type:"string"},{name:"toolTip",type:"string"},{name:"width",type:"int"},{name:"sortable",type:"boolean"},{name:"visible",type:"boolean"},{name:"filter",type:"boolean"},{name:"columnOrder",type:"int"},{name:"columnType",type:"string"},{name:"notion",type:"string",mapping:"notion.name"},{name:"notionUrl",type:"string",mapping:"notion.url"},{name:"columnAlias",type:"string"},{name:"dimensionId",type:"string"},{name:"unitName",type:"string"}]});Ext.each(a.datasetColumnModel,function(b){if(b.specificColumnType!="VIRTUAL"){a.storeColumn.add(new Ext.data.Record(b))}},this);return new Ext.form.ComboBox({fieldLabel:i18n.get("label.column")+"1",triggerAction:"all",name:"PARAM1",specificType:"mapParam",columnIndex:1,lazyRender:true,mode:"local",store:a.storeColumn,valueField:"columnAlias",displayField:"header",anchor:"100%",allowBlank:false})};this.buildCombosConeSearch=function(b){var c=["X/RA","Y/DEC","Z/ID"];for(var a=1;a<=3;a++){b["mapParam"+a]=new Ext.form.ComboBox({fieldLabel:c[a-1],triggerAction:"all",name:"PARAM"+a,specificType:"mapParam",columnIndex:a,lazyRender:true,mode:"local",store:b.storeColumn,valueField:"columnAlias",displayField:"header",anchor:"100%",allowBlank:false});if(b.action=="modify"){Ext.apply(b["mapParam"+a],{value:b.selectedRecord.data.code[a-1]})}b.insert(a,b["mapParam"+a])}};this.onChangeColumn=function(){var c=this.storeColumn;var a=this.mapParam1.getValue();if(Ext.isEmpty(a)){this.dimension.setValue(null);this.dimension.setDisabled(true);return}var b=c.getAt(c.find("columnAlias",a));if(Ext.isEmpty(b)){this.dimension.setValue(null);this.dimension.setDisabled(true);return}this.columnDimensionId=b.get("dimensionId");if(!Ext.isEmpty(this.columnDimensionId)){this.dimension.setValue(this.columnDimensionId);this.dimension.setDisabled(false)}else{this.dimension.setValue(null);this.dimension.setDisabled(true)}this.columnUnit=b.get("unit")};this.activeDimension=function(){var c=this.storeColumn;var a=this.mapParam1.getValue();if(!Ext.isEmpty(a)){var b=c.getAt(c.find("columnAlias",a));if(!Ext.isEmpty(b)){this.columnDimensionId=b.get("dimensionId");if(!Ext.isEmpty(this.columnDimensionId)){this.dimension.setDisabled(false)}}}};this.buildUnit=function(){return}};Ext.namespace("sitools.component.forms.componentsAdminDef");sitools.component.forms.componentsAdminDef.ProjectContext=function(){this.context="project";this.buildComboParam1=function(a){return new Ext.form.ComboBox({fieldLabel:i18n.get("label.concept"),triggerAction:"all",name:"PARAM1",specificType:"mapParam",columnIndex:1,lazyRender:false,mode:"local",store:a.storeConcepts,valueField:"name",displayField:"name",anchor:"100%",allowBlank:false})};this.buildCombosConeSearch=function(b){var c=["X/RA","Y/DEC","Z/ID"];for(var a=1;a<=3;a++){b["mapParam"+a]=new Ext.form.ComboBox({fieldLabel:c[a-1],triggerAction:"all",name:"PARAM"+a,specificType:"mapParam",columnIndex:a,lazyRender:true,mode:"local",store:b.storeConcepts,valueField:"name",displayField:"name",anchor:"100%",allowBlank:false});if(b.action=="modify"){Ext.apply(b["mapParam"+a],{value:b.selectedRecord.data.code[a-1]})}b.insert(a,b["mapParam"+a])}};this.onChangeColumn=function(){return};this.activeDimension=function(){this.dimension.setDisabled(false);this.dimension.on("select",this.context.onChangeDimension,this)};this.onChangeDimension=function(){this.storeUnits.proxy.setUrl(loadUrl.get("APP_URL")+loadUrl.get("APP_DIMENSIONS_ADMIN_URL")+"/dimension/"+this.dimension.getValue());this.storeUnits.load()};this.buildUnit=function(){var a=new Ext.data.HttpProxy({url:loadUrl.get("APP_URL")+loadUrl.get("APP_DIMENSIONS_ADMIN_URL")+"/dimension/"+this.dimensionId,restful:true});this.storeUnits=new Ext.data.JsonStore({root:"dimension.sitoolsUnits",fields:[{name:"label",type:"string"},{name:"unitName",type:"string"}],proxy:a,autoLoad:this.action=="modify"&&(!Ext.isEmpty(this.dimensionId)),listeners:{scope:this,load:this.context._onUnitLoad}});this.unitCombo=new Ext.form.ComboBox({fieldLabel:i18n.get("label.unit"),store:this.storeUnits,displayField:"label",mode:"local",forceSelection:false,triggerAction:"all",emptyText:i18n.get("label.selectUnits"),selectOnFocus:true,valueField:"unitName",name:"unit",anchor:"100%"});this.add(this.unitCombo);this.doLayout()};this._onUnitLoad=function(){if(this.dimensionId==this.dimension.getValue()){var a=Ext.isEmpty(this.selectedRecord)?null:this.selectedRecord.data.unit;this.unitCombo.setValue(a?a.unitName:null)}else{this.unitCombo.setValue(null)}}};Ext.namespace("sitools.component.forms.componentsAdminDef");sitools.component.forms.componentsAdminDef.ComponentFactory=function(a){if(a=="dataset"){return new sitools.component.forms.componentsAdminDef.DatasetContext()}if(a=="project"){return new sitools.component.forms.componentsAdminDef.ProjectContext()}};Ext.namespace("sitools.admin.forms");sitools.admin.forms.FormGridComponents=Ext.extend(Ext.grid.GridPanel,{initComponent:function(){var c=new Ext.data.JsonStore({root:"data",fields:[{name:"id",type:"string"},{name:"label",type:"string"},{name:"type",type:"string"},{name:"code",type:"string"},{name:"values"},{name:"width",type:"int"},{name:"height",type:"int"},{name:"xpos",type:"int"},{name:"ypos",type:"int"},{name:"css",type:"string"},{name:"jsAdminObject",type:"string"},{name:"jsUserObject",type:"string"},{name:"defaultValues"},{name:"valueSelection",type:"string"},{name:"autoComplete",type:"boolean"},{name:"parentParam"},{name:"dimensionId",type:"string"},{name:"unit"},{name:"extraParams"}],autoLoad:false});var b=new Ext.grid.RowSelectionModel({singleSelect:true});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.label"),dataIndex:"label"},{header:i18n.get("headers.type"),dataIndex:"type"}],defaults:{sortable:true,width:100}});var d={xtype:"sitools.widget.GridSorterToolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete}]};Ext.apply(this,{title:i18n.get("title.gridComponents"),id:"gridFormComponents",height:430,store:c,cm:a,sm:b,tbar:d,viewConfig:{forceFit:true},listeners:{scope:this,rowDblClick:this.onModify,dictionaryChanged:function(e){this.dictionaryId=e},collectionChanged:function(e){this.collectionId=e}}});sitools.admin.forms.FormGridComponents.superclass.initComponent.call(this)},onCreate:function(){var a=new sitools.admin.forms.componentsListPanel({datasetColumnModel:this.datasetColumnModel,gridFormComponents:this,action:"create",context:this.context,storeConcepts:this.storeConcepts});a.show()},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.forms.componentPropPanel({datasetColumnModel:this.datasetColumnModel,gridFormComponents:this,action:"modify",urlFormulaire:this.urlFormulaire,context:this.context,storeConcepts:this.storeConcepts});a.show()},onDelete:function(){var c=this.getSelectionModel().getSelected();if(!c){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var b=false,a=[];this.getStore().each(function(d){if(c.data.id===d.data.parentParam){b=true;a.push(d.data.label)}});if(a.length>0){Ext.Msg.alert(i18n.get("label.error"),i18n.get("label.atLeastOneChildren")+a.join(", "));return}this.getStore().remove(c)}});Ext.namespace("sitools.admin.forms");sitools.admin.forms.ComponentsDisplayPanel=Ext.extend(Ext.Panel,{y:0,position:0,padding:5,bodyStyle:"background-color : #EDF2FF;",initComponent:function(){Ext.apply(this,{id:"absoluteLayout",layout:{type:"vbox",align:"stretch"},autoScroll:true,height:this.formSize.height,width:this.formSize.width,listeners:{scope:this,activate:this._activeDisposition}});sitools.admin.forms.ComponentsDisplayPanel.superclass.initComponent.call(this)},_activeDisposition:function(){this.body.addClass(Ext.getCmp("formMainFormId").find("name","css")[0].getValue());this.setWidth(this.formSize.width);this.removeAll(true);var a=0;if(this.action!="modify"){var b=new sitools.admin.forms.advancedFormPanel({containerPanelId:"main",title:i18n.get("label.mainForm"),height:300,border:true,ddGroup:"gridComponentsList",collapsible:false,datasetColumnModel:this.datasetColumnModel,formComponentsStore:this.formComponentsStore,storeConcepts:this.storeConcepts,context:this.context,absoluteLayout:this})}if(this.zoneStore.getCount()==0&&b){this.zoneStore.add(new Ext.data.Record(b))}if(this.zoneStore.getCount()>0){this.zoneStore.each(function(d){a+=d.data.height;var c=new sitools.admin.forms.advancedFormPanel({containerPanelId:d.data.containerPanelId,title:d.data.title,height:d.data.height,position:d.data.position,collapsible:d.data.collapsible,border:true,ddGroup:"gridComponentsList",datasetColumnModel:this.datasetColumnModel,formComponentsStore:this.formComponentsStore,storeConcepts:this.storeConcepts,context:this.context,absoluteLayout:this});this.add(c)},this)}if(this.formSize.height<=a){this.formSize.height=a+20;this.setHeight(a+20)}this.doLayout();if(!Ext.isEmpty(this.items)){this.items.each(function(c){c.fireEvent("activate")},this)}}});Ext.namespace("sitools.admin.forms");sitools.admin.forms.formsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.FORMS,pageSize:10,urlFormulaires:"/tmp",initComponent:function(){this.baseUrlFormulaires=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_URL");this.urlDatasets=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_URL");this.httpProxyForms=new Ext.data.HttpProxy({url:"/tmp",restful:true,method:"GET"});this.store=new Ext.data.JsonStore({root:"data",restful:true,proxy:this.httpProxyForms,remoteSort:true,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"}]});var a=new Ext.data.JsonStore({fields:["id","name","columnModel"],url:this.urlDatasets,root:"data",autoLoad:true});this.comboDatasets=new Ext.form.ComboBox({store:a,displayField:"name",valueField:"id",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",emptyText:i18n.get("label.selectDatasets"),selectOnFocus:true,listeners:{scope:this,select:function(c,d,b){this.datasetId=d.data.id;this.datasetColumnModel=d.data.columnModel;this.httpProxyForms.setUrl(this.baseUrlFormulaires+"/"+d.data.id+"/forms",true);this.loadFormulaires(d.data.id)}}});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:400,sortable:false}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[this.comboDatasets,{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.forms.formsCrudPanel.superclass.initComponent.call(this)},loadFormulaires:function(a){this.urlFormulaires=this.baseUrlFormulaires+"/"+a+"/forms";this.httpProxyForms.setUrl(this.urlFormulaires,true);this.getStore().load({scope:this,callback:function(){this.getView().refresh()}})},onCreate:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.forms.formPropPanel({urlFormulaire:this.urlFormulaires,action:"create",store:this.getStore(),datasetColumnModel:this.datasetColumnModel});a.show(ID.BOX.FORMS)},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.forms.formPropPanel({urlFormulaire:this.baseUrlFormulaires+"/"+this.datasetId+"/forms/"+b.data.id,action:"modify",store:this.getStore(),datasetColumnModel:this.datasetColumnModel});a.show(ID.BOX.FORMS.COMPONENTLIST)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("formsCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.baseUrlFormulaires+"/"+this.datasetId+"/forms/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-forms",sitools.admin.forms.formsCrudPanel);Ext.namespace("sitools.admin.forms");sitools.admin.forms.componentPropPanel=Ext.extend(Ext.Window,{modal:true,pageSize:10,initComponent:function(){this.title=i18n.get("label.componentProperties");var specificComponentString,config={},JsObj;if(this.action=="modify"){var rec=this.record;if(!rec){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}JsObj=eval(rec.data.jsAdminObject);config={datasetColumnModel:this.datasetColumnModel,winPropComponent:this,action:this.action,selectedRecord:rec,jsUserObject:rec.data.jsUserObject,ctype:rec.data.type,componentDefaultHeight:rec.data.height,componentDefaultWidth:rec.data.width,dimensionId:rec.data.dimensionId,unit:rec.data.unit,extraParams:rec.data.extraParams,context:this.context,storeConcepts:this.storeConcepts,formComponentsStore:this.formComponentsStore,containerPanelId:this.containerPanelId}}else{JsObj=eval(this.jsAdminObject);config={datasetColumnModel:this.datasetColumnModel,winPropComponent:this,action:this.action,ctype:this.ctype,jsAdminObject:this.jsAdminObject,jsUserObject:this.jsUserObject,componentDefaultHeight:this.componentDefaultHeight,componentDefaultWidth:this.componentDefaultWidth,extraParams:this.extraParams,context:this.context,storeConcepts:this.storeConcepts,formComponentsStore:this.formComponentsStore,xyOnCreate:this.xyOnCreate,containerPanelId:this.containerPanelId}}var specificComponent=new JsObj(config);this.componentPropPanel=new Ext.Panel({layout:"fit",padding:10,autoScroll:true,items:[specificComponent],buttons:[{text:i18n.get("label.addColumn"),hidden:!Ext.isFunction(specificComponent.addColumn),handler:function(){specificComponent.addColumn()}},{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:this._close}]});this.items=[this.componentPropPanel];sitools.admin.forms.componentPropPanel.superclass.initComponent.call(this)},afterRender:function(){this.height=this.specificHeight;this.width=this.specificWidth;sitools.admin.forms.componentPropPanel.superclass.afterRender.call(this)},onValidate:function(){var a=this.findById("sitools.component.forms.definitionId");if(a._onValidate(this.action,this.formComponentsStore)){this.close()}this.absoluteLayout.fireEvent("activate")},_close:function(){this.close()}});Ext.namespace("sitools.admin.forms");sitools.admin.forms.absoluteLayoutProp=Ext.extend(Ext.Window,{modal:true,initComponent:function(){var b=this.formSize.width;var a=this.formSize.height;var c=new Ext.form.FormPanel({labelWidth:75,padding:5,items:[{xtype:"textfield",id:"absolutePanelWidth",value:b,fieldLabel:i18n.get("label.width"),anchor:"100%"},{xtype:"textfield",id:"absolutePanelHeight",value:a,fieldLabel:i18n.get("label.height"),anchor:"100%"}],buttons:[{scope:this,text:i18n.get("label.ok"),handler:this._onValidate},{scope:this,text:i18n.get("label.cancel"),handler:this._onCancel}]});this.height=130;this.width=260;this.title=i18n.get("label.setSize");this.items=[c];sitools.admin.forms.absoluteLayoutProp.superclass.initComponent.call(this)},_onValidate:function(){var d=this.findByType("form")[0].getForm();var c=parseInt(d.findField("absolutePanelWidth").getValue(),10);var a=parseInt(d.findField("absolutePanelHeight").getValue(),10);var b={width:c,height:a};this.absoluteLayout.setSize(b);this.absoluteLayout.doLayout();this.absoluteLayout.formSize=b;this.win.formSize=b;this.destroy()},_onCancel:function(){this.destroy()}});Ext.namespace("sitools.admin.forms");sitools.admin.forms.setupAdvancedFormPanel=Ext.extend(Ext.Window,{modal:true,height:210,width:260,initComponent:function(){this.title=i18n.get("label.setupAdvancedFormPanel");this.fielsetPosition=this.parentContainer.zoneStore.getCount()+1;this.form=new Ext.form.FormPanel({padding:5,items:[{xtype:"textfield",name:"title",id:"title",fieldLabel:i18n.get("label.titleCriteria"),anchor:"100%"},{xtype:"textfield",name:"height",id:"height",fieldLabel:i18n.get("label.height"),value:200,anchor:"100%"},{xtype:"textfield",fieldLabel:i18n.get("label.css"),name:"css",id:"cssFieldset",anchor:"100%"},{xtype:"checkbox",fieldLabel:i18n.get("label.collapsible"),name:"collapsible",id:"collapseFieldset",anchor:"100%"},{xtype:"checkbox",fieldLabel:i18n.get("label.collapsed"),name:"collapsed",id:"isCollapseFieldset",anchor:"100%"}],buttons:[{scope:this,text:i18n.get("label.ok"),handler:this._onValidate},{scope:this,text:i18n.get("label.cancel"),handler:this._onCancel}]});this.items=[this.form];sitools.admin.forms.setupAdvancedFormPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.forms.setupAdvancedFormPanel.superclass.onRender.apply(this,arguments);if(this.action==="modify"){var a=new Ext.data.Record(this.zone);this.form.getForm().loadRecord(a)}},_onValidate:function(){var c=this.form.getForm();var k=c.findField("title").getValue();var e=c.findField("collapseFieldset").getValue();var b=c.findField("isCollapseFieldset").getValue();var l=c.findField("cssFieldset").getValue();var m=parseInt(c.findField("height").getValue(),10);var a={title:k,height:m,css:l,collapsible:e,collapsed:b,position:this.fielsetPosition};if(this.action==="modify"){if(!Ext.isEmpty(this.zone.containerPanelId)){var d=this.parentContainer.zoneStore.find("containerPanelId",this.zone.containerPanelId)}else{var d=this.parentContainer.zoneStore.find("position",0)}var g=this.parentContainer.zoneStore.getAt(d);Ext.apply(g.data,a,{containerPanelId:this.zone.containerPanelId})}else{a.containerPanelId=Ext.id();this.parentContainer.zoneStore.add(new Ext.data.Record(a))}this.destroy();this.parentContainer.fireEvent("activate")},_onCancel:function(){this.destroy()}});Ext.namespace("sitools.admin.forms");sitools.admin.forms.componentsListPanel=Ext.extend(Ext.grid.GridPanel,{width:220,id:"gridsource",draggable:true,initComponent:function(){this.title=i18n.get("label.chooseComponent");var c=new Ext.data.JsonStore({root:"data",url:loadUrl.get("APP_URL")+loadUrl.get("APP_FORMCOMPONENTS_URL"),fields:[{name:"id",type:"string"},{name:"type",type:"string"},{name:"componentDefaultHeight",type:"string"},{name:"componentDefaultWidth",type:"string"},{name:"jsAdminObject",type:"string"},{name:"jsUserObject",type:"string"},{name:"imageUrl",type:"string"},{name:"dimensionId",type:"string"},{name:"unit",type:"string"},{name:"extraParams"}],autoLoad:true,sortInfo:{field:"type",direction:"ASC"}});var b=new Ext.grid.RowSelectionModel({singleSelect:true});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.type"),dataIndex:"type",width:150},{header:i18n.get("headers.image"),dataIndex:"imageUrl",renderer:function(d){return"<a href='#' onClick='sitools.admin.forms.componentsListPanel.showPreview(\""+d+"\"); return false;'>"+i18n.get("label.preview")+"</a>"},width:70}],defaults:{sortable:true,width:100}});Ext.apply(this,{layout:"fit",title:i18n.get("title.componentList"),autoScroll:true,store:c,cm:a,sm:b,ddGroup:"gridComponentsList",enableDragDrop:true,viewConfig:{forceFit:true}});sitools.admin.forms.componentsListPanel.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.forms.componentsListPanel.superclass.afterRender.apply(this,arguments);this.dd.addToGroup("gridComponentsTest")},onClose:function(){this.close()}});sitools.admin.forms.componentsListPanel.showPreview=function(b){var a=new Ext.Window({title:i18n.get("label.showPreview"),modal:true,html:"<img src ='"+b+"'>",layout:"fit",height:"auto",width:"auto",buttons:[{text:i18n.get("label.close"),handler:function(){this.ownerCt.ownerCt.destroy()}}]});a.show()};Ext.namespace("sitools.admin.forms");sitools.admin.forms.formPropPanel=Ext.extend(Ext.Window,{width:700,height:580,modal:true,pageSize:10,autoScroll:true,formSize:{width:500,height:500},initComponent:function(){if(this.action=="modify"){this.title=i18n.get("label.modifyForm")}if(this.action=="create"){this.title=i18n.get("label.createForm")}this.zoneStore=new Ext.data.JsonStore({root:"data",idProperty:"id",fields:[{id:"id",type:"string"},{name:"title",type:"string"},{name:"height",type:"int"},{name:"css",type:"string"},{name:"position",type:"string"},{name:"collapsible",type:"boolean"},{name:"collapsed",type:"boolean"},{name:"params"},{name:"containerPanelId",type:"string"}],listeners:{scope:this,remove:function(f,k,g){f.commitChanges();this.absoluteLayout.fireEvent("activate")}}});this.formComponentsStore=new Ext.data.JsonStore({root:"data",autoLoad:false,fields:[{name:"id",type:"string"},{name:"label",type:"string"},{name:"type",type:"string"},{name:"code",type:"string"},{name:"values"},{name:"width",type:"int"},{name:"height",type:"int"},{name:"xpos",type:"int"},{name:"ypos",type:"int"},{name:"css",type:"string"},{name:"jsAdminObject",type:"string"},{name:"jsUserObject",type:"string"},{name:"defaultValues"},{name:"valueSelection",type:"string"},{name:"autoComplete",type:"boolean"},{name:"parentParam"},{name:"dimensionId",type:"string"},{name:"unit"},{name:"extraParams"},{name:"containerPanelId"}]});this.formulairePrincipal=new Ext.FormPanel({title:i18n.get("label.formInfo"),id:"formMainFormId",border:false,padding:10,items:[{xtype:"hidden",name:"id"},{xtype:"textfield",name:"name",fieldLabel:i18n.get("label.name"),anchor:"100%",maxLength:50,vtype:"name",allowBlank:false},{xtype:"textfield",name:"description",fieldLabel:i18n.get("label.description"),anchor:"100%",maxLength:50},{xtype:"textfield",name:"css",fieldLabel:i18n.get("label.css"),anchor:"100%",maxLength:50}]});var e=new Ext.data.JsonStore({remoteSort:false,autoLoad:false,fields:[{name:"tableName",type:"string"},{name:"columnAlias",type:"string"},{name:"filtrable"}]});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get("label.tableName"),dataIndex:"tableName",type:"string"},{header:i18n.get("label.columnAlias"),dataIndex:"columnAlias",type:"string"}]});this.gridColumns=new Ext.grid.GridPanel({store:e,cm:a,title:i18n.get("label.datasetColumns"),flex:1,viewConfig:{forceFit:true}});Ext.each(this.datasetColumnModel,function(f){if(f.specificColumnType!="VIRTUAL"){this.gridColumns.getStore().add(new Ext.data.Record(f))}},this);var d=new Ext.Panel({title:i18n.get("label.FormInfo"),layout:"vbox",layoutConfig:{align:"stretch"},items:[this.formulairePrincipal,this.gridColumns],listeners:{collectionChanged:function(k,g,f){this.getBubbleTarget().fireEvent("collectionChanged",k,g,f)},dictionaryChanged:function(k,g,f){this.getBubbleTarget().fireEvent("dictionaryChanged",k,g,f)}}});this.absoluteLayout=new sitools.admin.forms.ComponentsDisplayPanel({zoneStore:this.zoneStore,formComponentsStore:this.formComponentsStore,datasetColumnModel:this.datasetColumnModel,context:"dataset",formSize:this.formSize,action:this.action});var c=new Ext.Panel({title:i18n.get("label.disposition"),flex:1,autoScroll:true,tbar:new Ext.Toolbar({items:[{scope:this,text:i18n.get("label.changeFormSize"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/sva_exe_synchrone.png",handler:this._sizeUp},{scope:this,text:i18n.get("label.addAdvancedCritera"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/tree_forms.png",handler:this._addPanel}]}),items:[this.absoluteLayout]});this.componentListPanel=new sitools.admin.forms.componentsListPanel({datasetColumnModel:this.datasetColumnModel,formComponentsStore:this.formComponentsStore,action:"create",context:"dataset",storeConcepts:this.storeConcepts});var b=new Ext.Panel({layout:"hbox",title:i18n.get("label.disposition"),autoScroll:true,layoutConfig:{align:"stretch"},items:[this.componentListPanel,c],listeners:{scope:this,activate:function(){this.absoluteLayout.fireEvent("activate")}}});this.tabPanel=new Ext.TabPanel({height:450,activeTab:0,items:[d,b],listeners:{scope:this,afterrender:function(f){f.setSize(this.body.getSize())}}});this.items=[this.tabPanel];this.buttons=[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}];this.listeners={scope:this,resize:function(l,k,f){var g=l.body.getSize();this.tabPanel.setSize(g)}};sitools.admin.forms.formPropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.forms.formPropPanel.superclass.onRender.apply(this,arguments);if(this.urlFormulaire){if(this.action=="modify"){Ext.Ajax.request({url:this.urlFormulaire,method:"GET",scope:this,success:function(m){var b=Ext.decode(m.responseText);if(!b.success){this.close();Ext.Msg.alert(i18n.get("label.warning"),b.message);return}var l=this.findByType("form")[0].getForm();var g=b.form;if(!Ext.isEmpty(g.width)){this.formSize.width=g.width}if(!Ext.isEmpty(g.height)){this.formSize.height=g.height}this.absoluteLayout.setSize(this.formSize);var c={};c.id=g.id;c.name=g.name;c.description=g.description;c.css=g.css;var k=new Ext.data.Record(c);l.loadRecord(k);var d={};if(!Ext.isEmpty(g.parameters)){d.oldParams=g.parameters}else{d.formZones=g.zones}if(!Ext.isEmpty(d.formZones)){Ext.each(d.formZones,function(f){this.zoneStore.add(new Ext.data.Record({containerPanelId:f.id,title:f.title,height:f.height,collapsible:f.collapsible,collapsed:f.collapsed,css:f.css,position:f.position,params:f.params}));if(!Ext.isEmpty(f.params)){Ext.each(f.params,function(p){this.formComponentsStore.add(new Ext.data.Record({type:p.type,code:p.code,label:p.label,values:p.values,width:p.width,height:p.height,xpos:p.xpos,ypos:p.ypos,id:p.id,css:p.css,jsAdminObject:p.jsAdminObject,jsUserObject:p.jsUserObject,defaultValues:p.defaultValues,valueSelection:p.valueSelection,autoComplete:p.autoComplete,parentParam:p.parentParam,dimensionId:p.dimensionId,unit:p.unit,extraParams:p.extraParams,containerPanelId:p.containerPanelId}))},this)}},this)}else{if(!Ext.isEmpty(d.oldParams)){var a=Ext.id();this.zoneStore.add(new Ext.data.Record({containerPanelId:a,title:g.name,height:g.height,css:g.css,position:0,params:d.oldParams}));if(!Ext.isEmpty(d.oldParams)){var n=d.oldParams;for(var e=0;e<n.length;e++){this.formComponentsStore.add(new Ext.data.Record({type:n[e].type,code:n[e].code,label:n[e].label,values:n[e].values,width:n[e].width,height:n[e].height,xpos:n[e].xpos,ypos:n[e].ypos,id:n[e].id,css:n[e].css,jsAdminObject:n[e].jsAdminObject,jsUserObject:n[e].jsUserObject,defaultValues:n[e].defaultValues,valueSelection:n[e].valueSelection,autoComplete:n[e].autoComplete,parentParam:n[e].parentParam,dimensionId:n[e].dimensionId,unit:n[e].unit,extraParams:n[e].extraParams,containerPanelId:a}))}}}}this.doLayout()},failure:function(a){var b=Ext.decode(a.responseText);Ext.Msg.alert(i18n.get("label.warning"),b.errorMessage)}})}}},_sizeUp:function(){var a=new sitools.admin.forms.absoluteLayoutProp({absoluteLayout:this.absoluteLayout,tabPanel:this.absoluteLayout.ownerCt.ownerCt.ownerCt,win:this,formSize:this.formSize});a.show()},_addPanel:function(){var a=new sitools.admin.forms.setupAdvancedFormPanel({parentContainer:this.absoluteLayout,currentPosition:this.absoluteLayout.position});a.show();this.absoluteLayout.doLayout()},onValidate:function(){var c=this.findByType("form")[0].getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return false}var d={};Ext.iterate(c.getValues(),function(e,f){d[e]=f},this);var b=this.formSize.width;var a=this.formSize.height;d.width=b;d.height=a;if(this.formComponentsStore.getCount()==0){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("label.noComponentInForm"))}d.zones=[];proppanel=this;this.zoneStore.each(function(e){var g={};var f=proppanel.formComponentsStore;if(f.getCount()>0){g=[];f.each(function(k){if(k.data.containerPanelId==e.data.containerPanelId){g.push({type:k.data.type,code:k.data.code,label:k.data.label,values:k.data.values,width:k.data.width,height:k.data.height,xpos:k.data.xpos,ypos:k.data.ypos,id:k.data.id,css:k.data.css,jsAdminObject:k.data.jsAdminObject,jsUserObject:k.data.jsUserObject,defaultValues:k.data.defaultValues,valueSelection:k.data.valueSelection,autoComplete:k.data.autoComplete,parentParam:k.data.parentParam,dimensionId:k.data.dimensionId,unit:k.data.unit,extraParams:k.data.extraParams,containerPanelId:k.data.containerPanelId})}});if(!Ext.isEmpty(g)){d.zones.push({id:e.data.containerPanelId,height:e.data.height,position:e.data.position,css:e.data.css,collapsible:e.data.collapsible,collapsed:e.data.collapsed,title:e.data.title,params:g})}}});if(this.action=="modify"){Ext.Ajax.request({url:this.urlFormulaire,method:"PUT",scope:this,jsonData:d,success:function(f){var e=Ext.decode(f.responseText);if(!e.success){Ext.Msg.alert(i18n.get("label.warning"),e.message);return}this.close();this.store.reload()},failure:alertFailure})}else{Ext.Ajax.request({url:this.urlFormulaire,method:"POST",scope:this,jsonData:d,success:function(f){var e=Ext.decode(f.responseText);if(!e.success){Ext.Msg.alert(i18n.get("label.warning"),e.message);return}this.close();this.store.reload()},failure:alertFailure})}}});Ext.namespace("sitools.admin.forms");sitools.admin.forms.parentParamWin=Ext.extend(Ext.Window,{modal:true,title:i18n.get("label.chooseParent"),width:500,initComponent:function(){var c=this.store;var b=new Ext.grid.RowSelectionModel({singleSelect:true});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.label"),dataIndex:"label"},{header:i18n.get("headers.type"),dataIndex:"type"}],defaults:{sortable:true,width:100}});this.gridFormComponents=new Ext.grid.GridPanel({title:i18n.get("title.gridComponents"),layout:"fit",id:"gridFormParentComponents",height:430,store:c,cm:a,sm:b,viewConfig:{forceFit:true}});this.items=[{xtype:"panel",layout:"fit",items:[this.gridFormComponents],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.none"),scope:this,handler:this._none},{text:i18n.get("label.cancel"),scope:this,handler:this._close}]}];sitools.admin.forms.parentParamWin.superclass.initComponent.call(this)},onRender:function(){sitools.admin.forms.parentParamWin.superclass.onRender.apply(this,arguments)},onValidate:function(){this.parentParamField.setValue(this.gridFormComponents.getSelectionModel().getSelected().data);this.parentParamFieldDisplay.setValue(this.gridFormComponents.getSelectionModel().getSelected().data.label);this.close()},_close:function(){this.close()},_none:function(){this.parentParamField.setValue(null);this.parentParamFieldDisplay.setValue(null);this.close()}});Ext.namespace("sitools.admin.forms.oneParam");sitools.admin.forms.oneParam.abstractForm=Ext.extend(Ext.form.FormPanel,{autoScroll:true,context:null,initComponent:function(){this.context=new sitools.component.forms.componentsAdminDef.ComponentFactory(this.context);this.buttonAdd=new Ext.Button({text:i18n.get("label.addColumn"),scope:this,handler:function(a){this.addColumn(a)}});this.buttonDel=new Ext.Button({text:i18n.get("label.deleteColumn"),scope:this,handler:function(a){this.deleteColumn(a)}});this.labelParam1=new Ext.form.TextField({fieldLabel:i18n.get("label.label"),name:"LABEL_PARAM1",anchor:"100%",tooltip:i18n.get("label.formLabel")});this.mapParam1=this.context.buildComboParam1(this);this.css=new Ext.form.TextField({fieldLabel:i18n.get("label.css"),name:"CSS",anchor:"100%"});this.componentDefaultHeight=new Ext.form.TextField({fieldLabel:i18n.get("label.height"),name:"componentDefaultHeight",anchor:"100%",value:this.componentDefaultHeight,allowBlank:false});this.componentDefaultWidth=new Ext.form.TextField({fieldLabel:i18n.get("label.width"),name:"componentDefaultWidth",anchor:"100%",value:this.componentDefaultWidth,allowBlank:false});this.items=[this.labelParam1,this.mapParam1,this.css];if(this.action=="create"){this.items.push(this.componentDefaultHeight,this.componentDefaultWidth)}this.padding=10;sitools.admin.forms.oneParam.abstractForm.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.forms.oneParam.abstractForm.superclass.afterRender.apply(this,arguments);if(this.action=="modify"){this.labelParam1.setValue(this.selectedRecord.data.label);this.css.setValue(this.selectedRecord.data.css);var a=this.selectedRecord.data.code;this.mapParam1.setValue(this.selectedRecord.data.code[0])}},_onValidate:function(b,a){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("msg.OnvalidateNotDefined"))}});Ext.namespace("sitools.admin.forms.oneParam");sitools.admin.forms.oneParam.abstractWithUnit=Ext.extend(sitools.admin.forms.oneParam.abstractForm,{initComponent:function(){sitools.admin.forms.oneParam.abstractWithUnit.superclass.initComponent.call(this);this.storeDimension=new Ext.data.JsonStore({root:"data",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"dimensionHelperName",type:"string"}],url:loadUrl.get("APP_URL")+loadUrl.get("APP_DIMENSIONS_ADMIN_URL")+"/dimension",restful:true,autoLoad:false,listeners:{scope:this,load:this._onDimensionLoad}});this.on("beforerender",this.onBeforeRender,this);this.mapParam1.on("select",this.onChangeColumn,this)},onBeforeRender:function(){if(!this.loaded){this.storeDimension.load()}},_onDimensionLoad:function(){this.dimension=new Ext.form.ComboBox({fieldLabel:i18n.get("label.dimension"),store:this.storeDimension,displayField:"name",mode:"local",forceSelection:false,triggerAction:"all",emptyText:i18n.get("label.selectDimension"),selectOnFocus:true,valueField:"id",name:"dimensionId",anchor:"100%",disabled:true,value:Ext.isEmpty(this.selectedRecord)?null:this.selectedRecord.data.dimensionId});this.context.activeDimension.call(this);this.add(this.dimension);this.doLayout();this.context.buildUnit.call(this)},onChangeColumn:function(){this.context.onChangeColumn.call(this)}});Ext.namespace("sitools.admin.forms.multiParam");sitools.admin.forms.multiParam.abstractForm=Ext.extend(Ext.form.FormPanel,{autoScroll:true,initComponent:function(){this.context=new sitools.component.forms.componentsAdminDef.ComponentFactory(this.context);this.storeColumn=new Ext.data.JsonStore({id:"storeColumnSelect",root:"ColumnModel",idProperty:"header",remoteSort:false,fields:[{name:"id",type:"string"},{name:"dataIndex",type:"string"},{name:"schema",type:"string"},{name:"tableAlias",type:"string"},{name:"tableName",type:"string"},{name:"header",type:"string"},{name:"toolTip",type:"string"},{name:"width",type:"int"},{name:"sortable",type:"boolean"},{name:"visible",type:"boolean"},{name:"filter",type:"boolean"},{name:"columnOrder",type:"int"},{name:"columnType",type:"string"},{name:"notion",type:"string",mapping:"notion.name"},{name:"notionUrl",type:"string",mapping:"notion.url"},{name:"columnAlias",type:"string"}]});Ext.each(this.datasetColumnModel,function(a){if(a.specificColumnType!="VIRTUAL"){this.storeColumn.add(new Ext.data.Record(a))}},this);this.buttonAdd=new Ext.Button({text:i18n.get("label.addColumn"),scope:this,handler:function(a){this.addColumn(a)}});this.buttonDel=new Ext.Button({text:i18n.get("label.deleteColumn"),scope:this,handler:function(a){this.deleteColumn(a)}});this.labelParam1=new Ext.form.TextField({fieldLabel:i18n.get("label.label"),name:"LABEL_PARAM1",anchor:"100%"});this.css=new Ext.form.TextField({fieldLabel:i18n.get("label.css"),name:"CSS",anchor:"100%"});this.componentDefaultHeight=new Ext.form.TextField({fieldLabel:i18n.get("label.height"),name:"componentDefaultHeight",anchor:"100%",value:this.componentDefaultHeight,allowBlank:false});this.componentDefaultWidth=new Ext.form.TextField({fieldLabel:i18n.get("label.width"),name:"componentDefaultWidth",anchor:"100%",value:this.componentDefaultWidth,allowBlank:false});this.items=[this.labelParam1,this.css];if(this.action=="create"){this.items.push(this.componentDefaultHeight,this.componentDefaultWidth)}this.padding=10;sitools.admin.forms.multiParam.abstractForm.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.forms.multiParam.abstractForm.superclass.afterRender.apply(this,arguments);if(this.action=="modify"){this.labelParam1.setValue(this.selectedRecord.data.label);this.css.setValue(this.selectedRecord.data.css)}},_onValidate:function(b,a){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("msg.OnvalidateNotDefined"))}});Ext.namespace("sitools.admin.forms");sitools.admin.forms.advancedFormPanel=Ext.extend(Ext.form.FieldSet,{border:true,closable:true,style:"background-color : white;",initComponent:function(a){Ext.apply(this,a);this.padding="0 0 5 0";this.tools=[{id:"close",qtip:i18n.get("label.remove"),handler:function(d,c,b){Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("fieldset.delete"),scope:this,fn:function(e,f){if(e=="yes"){b.deletePanel()}}})}},{id:"gear",qtip:i18n.get("label.editFieldsetProps"),handler:function(d,c,b){b.editPanel()}}];Ext.apply(this,{layout:"absolute",autoScroll:true,enableDragDrop:true,listeners:{scope:this,activate:function(){var d=0;var b=25;this.removeAll(true);var c=this;this.formComponentsStore.each(function(g){var f=g.data.containerPanelId;if(f==this.containerPanelId){d=Ext.isEmpty(g.data.ypos)?d+50:g.data.ypos;b=Ext.isEmpty(g.data.xpos)?b:g.data.xpos;var k=[sitools.common.forms.formParameterToComponent(g.data,null,null,this.datasetColumnModel,this.context).component];k[0].setDisabled(true);var e=new Ext.Container({width:parseInt(g.data.width,10),height:parseInt(g.data.height,10),bodyCssClass:"noborder",cls:g.data.css,x:b,y:d,id:g.data.id,componentData:g.data,labelWidth:100,items:k,displayPanel:this,record:g,onEdit:function(){var m=this.record;if(!m){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var l=new sitools.admin.forms.componentPropPanel({datasetColumnModel:this.displayPanel.datasetColumnModel,action:"modify",urlFormulaire:this.displayPanel.urlFormulaire,context:this.displayPanel.context,storeConcepts:this.displayPanel.storeConcepts,record:this.record,formComponentsStore:this.displayPanel.formComponentsStore,absoluteLayout:this.displayPanel,containerPanelId:c.containerPanelId});l.show()},onDelete:function(){var n=this.record;if(!n){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var m=false,l=[];this.displayPanel.formComponentsStore.each(function(p){if(n.data.id===p.data.parentParam){m=true;l.push(p.data.label)}});if(l.length>0){Ext.Msg.alert(i18n.get("label.error"),i18n.get("label.atLeastOneChildren")+l.join(", "));return}this.displayPanel.formComponentsStore.remove(n);this.displayPanel.fireEvent("activate")}});this.add(e)}},this);this.doLayout();this.addResizers(this.items.items);this.addDragDrop(this.items.items)}}});sitools.admin.forms.advancedFormPanel.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.forms.advancedFormPanel.superclass.afterRender.apply(this,arguments);var e=this.ddGroup;var d=this.datasetColumnModel;var a=this.formComponentsStore;var l=this.storeConcepts;var g=this.absoluteLayout;var c=this;var f=this.body.dom;var k=this.body;var b=this.context;var f=new Ext.dd.DropTarget(f,{ddGroup:e,notifyDrop:function(s,r,q){var n=r.xy;var p=Ext.get(k).getXY();var m={x:n[0]-p[0],y:n[1]-p[1]};var t=s.dragData.selections[0];var u=new sitools.admin.forms.componentPropPanel({urlAdmin:t.data.jsonDefinitionAdmin,datasetColumnModel:d,ctype:t.data.type,action:"create",componentDefaultHeight:t.data.componentDefaultHeight,componentDefaultWidth:t.data.componentDefaultWidth,dimensionId:t.data.dimensionId,unit:t.data.unit,extraParams:t.data.extraParams,jsAdminObject:t.data.jsAdminObject,jsUserObject:t.data.jsUserObject,context:b,xyOnCreate:m,storeConcepts:l,absoluteLayout:g,record:t,formComponentsStore:a,containerPanelId:c.containerPanelId});u.show()},overClass:"over-dd-form"})},onContextMenu:function(c,d,b){c.stopEvent();var a=new Ext.menu.Menu({items:[{text:i18n.get("label.edit"),scope:this,handler:this.onEdit},{text:i18n.get("label.delete"),scope:this,handler:this.onDelete}]});var e=c.getXY();a.showAt(e)},addResizers:function(a){Ext.each(a,function(b){var c=new Ext.Resizable(b.getId(),{handles:"s e",minWidth:150,maxWidth:1000,constrainTo:this.body,resizeChild:true,listeners:{scope:this,resize:function(k,l,f,n){var g=this.formComponentsStore;var p=g.getAt(g.find("id",b.getId()));var m=this.getEl().getAnchorXY();p.set("width",l);p.set("height",f);b.items.items[0].setSize(l-b.getEl().getPadding("l")-b.getEl().getPadding("r"),f);if(p.data.type==="LISTBOX"||p.data.type==="LISTBOXMULTIPLE"){var d=b.findByType("multiselect")[0];d.view.container.setHeight(f-b.getEl().getPadding("b")-b.getEl().getPadding("t")-40)}}}})},this)},addDragDrop:function(a){Ext.each(a,function(c){c.getEl().on("contextmenu",this.onContextMenu,c);var b=new Ext.dd.DDProxy(c.getEl().dom.id,"group",{isTarget:false});Ext.apply(b,{win:this,startDrag:function(e,g){var d=Ext.get(this.getDragEl());var f=Ext.get(this.getEl());d.applyStyles({border:"","z-index":this.win.ownerCt.ownerCt.lastZIndex+1});d.update(f.dom.innerHTML);d.addClass(f.dom.className);this.constrainTo(this.win.body)},afterDrag:function(){var e=Ext.get(this.getDragEl());var f=Ext.get(this.getEl());var d=e.getX();var m=e.getY();var g=this.win.formComponentsStore;var l=g.getAt(g.find("id",f.id));var k=Ext.get(this.win.body).getAnchorXY();l.set("xpos",d-k[0]);l.set("ypos",m-k[1])}})},this)},editPanel:function(){if(!Ext.isEmpty(this.containerPanelId)){var c=this.absoluteLayout.zoneStore.find("containerPanelId",this.containerPanelId)}else{var c=this.absoluteLayout.zoneStore.find("position",0)}var b=this.absoluteLayout.zoneStore.getAt(c);var a=new sitools.admin.forms.setupAdvancedFormPanel({parentContainer:this.absoluteLayout,action:"modify",zone:b.data});a.show()},deletePanel:function(){var b=this.absoluteLayout;var a=b.zoneStore.find("containerPanelId",this.containerPanelId);b.zoneStore.removeAt(a);this.formComponentsStore.each(function(c){if(c.data.containerPanelId==this.containerPanelId){this.formComponentsStore.remove(c)}},this);this.destroy();b.doLayout()}});Ext.namespace("sitools.admin.applications");sitools.admin.applications.applicationsRolePanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,dataSets:"",initComponent:function(){this.title=i18n.get("label.authorizations")+" : "+this.applicationRecord.data.name;var a=new Ext.data.JsonStore({id:"storeAuthorizations",root:"authorization.authorizations",url:this.urlAuthorizations,idProperty:"role",fields:[{name:"role",type:"string"},{name:"allMethod",type:"boolean"},{name:"postMethod",type:"boolean"},{name:"getMethod",type:"boolean"},{name:"putMethod",type:"boolean"},{name:"deleteMethod",type:"boolean"},{name:"headMethod",type:"boolean"},{name:"optionsMethod",type:"boolean"}],autoLoad:true,listeners:{scope:this,update:function(e,d){var l=this.gridAuthorizations;var g=e.indexOf(d);var m=d.get("allMethod");for(var k=2;k<8;k++){var f=l.getView().getCell(g,k).firstChild.firstChild.id;var n=Ext.getCmp(f);n.setEnabled(!m)}},load:function(e,d){var k=this.gridAuthorizations;var l,g,f,m;Ext.each(d,function(n){e.fireEvent("update",e,n)},this)}}});this.cbAll=new Ext.grid.CheckColumn({header:i18n.get("headers.all"),dataIndex:"allMethod",width:55});this.cbPost=new Ext.grid.CheckColumn({header:i18n.get("headers.post"),dataIndex:"postMethod",width:55});this.cbGet=new Ext.grid.CheckColumn({header:i18n.get("headers.get"),dataIndex:"getMethod",width:55});this.cbPut=new Ext.grid.CheckColumn({header:i18n.get("headers.put"),dataIndex:"putMethod",width:55});this.cbDelete=new Ext.grid.CheckColumn({header:i18n.get("headers.delete"),dataIndex:"deleteMethod",width:55});this.cbHead=new Ext.grid.CheckColumn({header:i18n.get("headers.head"),dataIndex:"headMethod",width:55});this.cbOptions=new Ext.grid.CheckColumn({header:i18n.get("headers.options"),dataIndex:"optionsMethod",width:55});var c=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.role"),dataIndex:"role",width:100},this.cbAll,this.cbGet,this.cbPost,this.cbPut,this.cbDelete,this.cbHead,this.cbOptions],defaults:{sortable:true,width:100}});var b=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridAuthorizations=new Ext.grid.EditorGridPanel({id:"gridAuthorizations",height:450,store:a,tbar:{xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),hidden:this.mode=="select",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this._onCreateRole},{text:i18n.get("label.remove"),hidden:this.mode=="select",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this._onDeleteRole}]},cm:c,sm:b,plugins:[this.cbAll,this.cbGet,this.cbPost,this.cbPut,this.cbDelete,this.cbHead,this.cbOptions],viewConfig:{forceFit:true}});this.items=[this.gridAuthorizations];this.buttons=[{text:i18n.get("label.ok"),scope:this,handler:function(){this._onValidate()}},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}];sitools.admin.applications.applicationsRolePanel.superclass.initComponent.call(this)},_onCreateRole:function(){var a=new sitools.component.applications.rolesPanel({storeRolesApplication:this.gridAuthorizations.getStore()});a.show()},_onDeleteRole:function(){var a=this.gridAuthorizations.getSelectionModel().getSelections();if(a.length===0){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}this.gridAuthorizations.getStore().remove(a)},_onValidate:function(){var b={};b.id=this.applicationRecord.data.id;b.url=this.applicationRecord.data.url;b.name=this.applicationRecord.data.name;b.description=this.applicationRecord.data.description;var a=this.findById("gridAuthorizations").getStore();if(a.getCount()>0){b.authorizations=[];a.each(function(c){var d={role:c.data.role,allMethod:c.data.allMethod,postMethod:c.data.postMethod,getMethod:c.data.getMethod,putMethod:c.data.putMethod,deleteMethod:c.data.deleteMethod,headMethod:c.data.headMethod,optionsMethod:c.data.optionsMethod};b.authorizations.push(d)})}Ext.Ajax.request({url:this.urlAuthorizations,method:"PUT",scope:this,jsonData:b,success:function(d){var c=Ext.decode(d.responseText);if(!c.success){Ext.Msg.alert(i18n.get("label.warning"),c.message);return}this.close()},failure:alertFailure})}});Ext.namespace("sitools.component.applications");sitools.component.applications.rolesPanel=Ext.extend(Ext.Window,{width:350,modal:true,closable:false,pageSize:10,initComponent:function(){this.title=i18n.get("label.roleWin");this.store=new Ext.data.JsonStore({root:"data",restful:true,autoSave:false,idProperty:"id",url:loadUrl.get("APP_URL")+loadUrl.get("APP_ROLES_URL"),fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"}]});this.grid=new Ext.grid.GridPanel({sm:new Ext.grid.RowSelectionModel(),store:this.store,height:200,columns:[{header:i18n.get("label.name"),dataIndex:"name"},{header:i18n.get("label.description"),dataIndex:"description"}]});this.items=[{xtype:"panel",title:i18n.get("label.selectRoles"),items:[this.grid],bbar:{xtype:"toolbar",defaults:{scope:this},items:["->",{text:i18n.get("label.ok"),handler:this._onOK},{text:i18n.get("label.cancel"),handler:this._onCancel}]}}];sitools.component.applications.rolesPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.applications.rolesPanel.superclass.onRender.apply(this,arguments);this.store.load({scope:this,params:{start:0,limit:this.pageSize},callback:function(b,a,c){if(!c){this.close();Ext.Msg.alert(i18n.get("label.warning"),i18n.get("label.loadError"))}}})},_onOK:function(){Ext.each(this.grid.getSelectionModel().getSelections(),function(a){if(this.storeRolesApplication.find("role",a.data.name)==-1){this.storeRolesApplication.add(new Ext.data.Record({role:a.data.name}))}},this);this.close()},_onCancel:function(){this.destroy()}});Ext.namespace("sitools.admin.applications");sitools.admin.applications.applicationsPropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,dataSets:"",initComponent:function(){this.title=i18n.get("label.details");this.items=[{xtype:"panel",height:450,items:[{xtype:"form",border:false,padding:10,defaults:{disabled:true},items:[{xtype:"hidden",name:"id",id:"appFormIdId"},{xtype:"textfield",name:"name",fieldLabel:i18n.get("label.name"),anchor:"100%",maxLength:30,id:"appFormNameId"},{xtype:"textarea",name:"description",fieldLabel:i18n.get("label.description"),anchor:"100%",id:"appFormDescriptionId"},{xtype:"textfield",name:"urn",fieldLabel:i18n.get("label.urn"),anchor:"100%",id:"appFormUrnId"},{xtype:"textfield",name:"type",fieldLabel:i18n.get("label.type"),anchor:"100%",id:"appFormTypeId"},{xtype:"textfield",name:"url",fieldLabel:i18n.get("label.url"),anchor:"100%",id:"appFormUrlId"},{xtype:"textfield",name:"author",fieldLabel:i18n.get("label.author"),anchor:"100%",id:"appFormAuthotId"},{xtype:"textfield",name:"owner",fieldLabel:i18n.get("label.owner"),anchor:"100%",id:"appFormOwnerId"},{xtype:"textfield",name:"lastUpdate",fieldLabel:i18n.get("label.lastUpdate"),anchor:"100%",id:"appFormLastUpdateId"},{xtype:"textfield",name:"status",fieldLabel:i18n.get("label.status"),anchor:"100%",id:"appFormStatus"}]}],buttons:[{text:i18n.get("label.close"),scope:this,handler:function(){this.close()}}]}];sitools.admin.applications.applicationsPropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.projects.ProjectsPropPanel.superclass.onRender.apply(this,arguments);if(this.applicationRecord){var a=this.findByType("form")[0].getForm();a.loadRecord(this.applicationRecord)}}});Ext.namespace("sitools.admin.applications");sitools.admin.applications.applicationsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.GROUP,sm:new Ext.grid.RowSelectionModel(),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_APPLICATIONS_URL");this.urlAuthorizations=loadUrl.get("APP_URL")+loadUrl.get("APP_AUTHORIZATIONS_URL");var a=new Ext.data.JsonReader({root:"data",idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"category",type:"string"},{name:"urn",type:"string"},{name:"type",type:"string"},{name:"url",type:"string"},{name:"author",type:"string"},{name:"owner",type:"string"},{name:"lastUpdate",type:"string"},{name:"status",type:"string"},{name:"wadl",type:"string",convert:function(d,c){}}]});this.store=new Ext.data.GroupingStore({reader:a,url:this.url,restful:true,remoteSort:false,sortInfo:{field:"name",direction:"ASC"},groupField:"category"});var b=new Ext.ux.grid.RowExpander({tpl:new Ext.XTemplate('<tpl if="this.descEmpty(description)" ><div></div></tpl>','<tpl if="this.descEmpty(description) == false" ><div class="sitoolsDescription"><div class="sitoolsDescriptionHeader">Description :&nbsp;</div><p class="sitoolsDescriptionText"> {description} </p></div></tpl>',{compiled:true,descEmpty:function(c){return Ext.isEmpty(c)}}),expandOnDblClick:true});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[b,{header:i18n.get("label.category"),dataIndex:"category",width:150,hidden:true},{header:i18n.get("label.name"),dataIndex:"name",width:500},{header:i18n.get("label.status"),dataIndex:"status",width:50,sortable:false},{header:"",dataIndex:"url",width:20,sortable:false,renderer:function(k,f,c,l,e,d){var g=c.get("status");if(Ext.isEmpty(g)||"INACTIVE"==g){return null}else{return String.format("<a onClick='onClickOption(\"{0}\"); return false;' href=#>{1}</a>",k,String.format("<img alt={0} src='"+loadUrl.get("APP_URL")+"/common/res/images/icons/wadl.gif'>",i18n.get("label.wadl")))}}}]});this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.details"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_details.png",handler:this.onDetails,xtype:"s-menuButton"},{text:i18n.get("label.authorizations"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_autorizations.png",handler:this.onDefineRole,xtype:"s-menuButton"},{text:i18n.get("label.active"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_active.png",handler:this._onActive,xtype:"s-menuButton"},{text:i18n.get("label.disactive"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_disactive.png",handler:this._onDisactive,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store}]};this.view=new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Items" : "Item"]})'});this.plugins=b;sitools.admin.applications.applicationsCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.applications.applicationsCrudPanel.superclass.onRender.apply(this,arguments);this.store.load()},onDefineRole:function(){var b=this.getSelectionModel().getSelected(),a=new sitools.admin.applications.applicationsRolePanel({urlAuthorizations:this.urlAuthorizations+"/"+b.data.id,applicationRecord:b});if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}a.show(ID.BOX.APPLICATION)},onDetails:function(){var b=this.getSelectionModel().getSelected(),a=new sitools.admin.applications.applicationsPropPanel({applicationRecord:b});if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}a.show(ID.BOX.APPLICATION)},onDelete:function(){var b=this.getSelectionModel().getSelected(),a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:{yes:i18n.get("label.yes"),no:i18n.get("label.no")},msg:i18n.get("applicationsCrud.delete"),scope:this,fn:function(c,d){if(c==="yes"){this.doDelete(b)}}});if(!b){return false}},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"?action=start",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"?action=stop",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-applications",sitools.admin.applications.applicationsCrudPanel);Ext.namespace("sitools.admin.authorizations");sitools.admin.authorizations.authorizationsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.GROUP,sm:new Ext.grid.RowSelectionModel(),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_AUTHORIZATIONS_URL");this.urlAuthorizations=loadUrl.get("APP_URL")+loadUrl.get("APP_AUTHORIZATIONS_URL");this.store=new Ext.data.JsonStore({root:"data",restful:true,url:this.url,remoteSort:true,idProperty:"id",baseParams:{type:"class"},fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"url",type:"string"},{name:"authorizations"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.id"),dataIndex:"id",width:100,hidden:true},{header:i18n.get("label.name"),dataIndex:"name",width:150},{header:i18n.get("label.description"),dataIndex:"description",width:450,sortable:false}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.authorizations"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_autorizations.png",handler:this.onDefineRole,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.sm=new Ext.grid.RowSelectionModel();this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onDefineRole};sitools.admin.authorizations.authorizationsCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.authorizations.authorizationsCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onDefineRole:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.applications.applicationsRolePanel({urlAuthorizations:this.urlAuthorizations+"/"+b.data.id,applicationRecord:b});a.show(ID.BOX.APPLICATION)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:{yes:i18n.get("label.yes"),no:i18n.get("label.no")},msg:i18n.get("applicationsCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-authorizations",sitools.admin.authorizations.authorizationsCrudPanel);Ext.namespace("sitools.admin.userStorage");sitools.admin.userStorage.userStoragePropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,dataSets:"",initComponent:function(){if(this.action=="modify"){this.title=i18n.get("label.modifyUserStorage")+" : "+this.userStorageRec.data.userId}if(this.action=="create"){this.title=i18n.get("label.createUserStorage")}this.items=[{xtype:"panel",height:450,items:[{xtype:"panel",height:400,items:[{xtype:"form",border:false,padding:10,defaults:[{readOnly:true}],items:[{xtype:"hidden",name:"userId",id:"userValueFieldId"},{xtype:"textfield",name:"displayUser",fieldLabel:i18n.get("label.user"),anchor:"100%",maxLength:100,allowBlank:false,blankText:"The user field cannot be empty",listeners:{scope:this,focus:function(b){if(this.action=="create"){var a=new sitools.admin.usergroups.UsersPanel({mode:"selectUnique",url:loadUrl.get("APP_URL")+loadUrl.get("APP_SECURITY_URL")+"/users",displayField:b,valueField:this.findByType("form")[0].getForm().findField("userValueFieldId")});a.show()}}}},{xtype:"compositefield",fieldLabel:i18n.get("label.quota"),anchor:"100%",defaults:{flex:1},items:[{xtype:"textfield",name:"quota",fieldLabel:i18n.get("label.quota"),anchor:"75%"},{xtype:"label",text:i18n.get("label.quota.unit"),width:50,flex:0}]},{xtype:"textfield",name:"userStoragePath",fieldLabel:i18n.get("label.userStoragePath"),anchor:"100%",maxLength:100,readOnly:true,disabled:true},{xtype:"numberfield",name:"freeUserSpace",fieldLabel:i18n.get("label.freeUserSpace"),anchor:"100%",maxLength:100,readOnly:true,disabled:true},{xtype:"numberfield",name:"busyUserSpace",fieldLabel:i18n.get("label.busyUserSpace"),anchor:"100%",maxLength:100,readOnly:true,disabled:true},{xtype:"textfield",name:"status",fieldLabel:i18n.get("label.status"),anchor:"100%",maxLength:30,readOnly:true,disabled:true}]}]}],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];sitools.admin.userStorage.userStoragePropPanel.superclass.initComponent.call(this)},onValidate:function(){var a=this.findByType("form")[0].getForm();if(!a.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return}var b={};b.userId=a.findField("userValueFieldId").getValue();b.storage={};b.storage.quota=a.findField("quota").getValue();if(this.action=="modify"){Ext.Ajax.request({url:this.url,method:"PUT",scope:this,jsonData:b,success:function(c){var d=Ext.decode(c.responseText);if(d.success===false){Ext.Msg.alert(i18n.get("label.warning"),i18n.get(d.message))}else{this.close();this.store.reload()}},failure:alertFailure})}if(this.action=="create"){Ext.Ajax.request({url:this.url,method:"POST",scope:this,jsonData:b,success:function(c){var d=Ext.decode(c.responseText);if(d.success===false){Ext.Msg.alert(i18n.get("label.warning"),i18n.get(d.message))}else{this.close();this.store.reload()}},failure:alertFailure})}},afterRender:function(){sitools.admin.userStorage.userStoragePropPanel.superclass.afterRender.apply(this,arguments);if(this.action=="modify"){var a=this.findByType("form")[0].getForm();a.loadRecord(this.userStorageRec);a.findField("displayUser").destroy()}}});Ext.reg("s-userStoragesprop",sitools.admin.userStorage.userStoragePropPanel);Ext.namespace("sitools.admin.userStorage");sitools.admin.userStorage.userStorageCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.GROUP,sm:new Ext.grid.RowSelectionModel(),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_USERSTORAGE_URL")+"/users";this.store=new Ext.data.JsonStore({root:"data",restful:true,url:this.url,remoteSort:true,idProperty:"userId",fields:[{name:"userId",type:"string"},{name:"status",type:"string",mapping:"status"},{name:"freeUserSpace",type:"float",mapping:"storage.freeUserSpace"},{name:"busyUserSpace",type:"float",mapping:"storage.busyUserSpace"},{name:"quota",type:"float",mapping:"storage.quota"},{name:"userStoragePath",type:"string",mapping:"storage.userStoragePath"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.userLogin"),dataIndex:"userId",width:100},{header:i18n.get("label.userStoragePath"),dataIndex:"userStoragePath",width:160},{header:i18n.get("label.freeUserSpace"),dataIndex:"freeUserSpace",width:80,renderer:function(a){return Ext.util.Format.fileSize(a)}},{header:i18n.get("label.busyUserSpace"),dataIndex:"busyUserSpace",width:80,renderer:function(a){return Ext.util.Format.fileSize(a)}},{header:i18n.get("label.quota"),dataIndex:"quota",width:80,renderer:function(a){return Ext.util.Format.fileSize(a)}},{header:i18n.get("label.usedPourcentage"),width:80,renderer:function(g,a,e,f,l,k){var d=e.get("quota");var b=e.get("busyUserSpace");var c=b/d*100;if(c>=90&&c<100){a.css="sitools-userProfile-warning-text"}else{if(c>100){a.css="sitools-userProfile-error-text"}}return c+"%"}},{header:i18n.get("label.status"),dataIndex:"status",width:100}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},{text:i18n.get("label.active"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_active.png",handler:this._onActive,xtype:"s-menuButton"},{text:i18n.get("label.disactive"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_disactive.png",handler:this._onDisactive,xtype:"s-menuButton"},{text:i18n.get("label.clean"),icon:"res/images/icons/icons_perso/toolbar_clean.png",handler:this._onClean,xtype:"s-menuButton"},{text:i18n.get("label.refresh"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_refresh.png",handler:this._onRefresh,xtype:"s-menuButton"},{text:i18n.get("label.notify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/notify.png",handler:this._onNotify,xtype:"s-menuButton"}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.userStorage.userStorageCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.userStorage.userStorageCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.admin.userStorage.userStoragePropPanel({url:this.url,action:"create",store:this.getStore()});a.show(ID.BOX.PROJECTS)},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.userStorage.userStoragePropPanel({url:this.url+"/"+b.id,userStorageRec:b,action:"modify",store:this.getStore()});a.show(ID.BOX.USERSTORAGE)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("userStorageCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"/start",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"/stop",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onClean:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("userStorageCrud.clean"),scope:this,fn:function(c,d){if(c=="yes"){this.doClean(b)}}})},doClean:function(a){Ext.Ajax.request({url:this.url+"/"+a.id+"/clean",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onRefresh:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"/refresh",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onNotify:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"/notify",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-userStorage",sitools.admin.userStorage.userStorageCrudPanel);Ext.namespace("sitools.component.order");sitools.component.order.orderPropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,dataSets:"",layout:"fit",initComponent:function(){this.title=i18n.get("label.details")+" : ";this.title+=this.orderRec.data.userId;this.title+=" "+i18n.get("label.the");this.title+=" "+this.orderRec.data.dateOrder;var d=new Ext.data.JsonStore({fields:[{name:"eventDate",type:"string"},{name:"description",type:"string"},{name:"message",type:"string"}],data:this.orderRec.data.events});var f=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.date"),dataIndex:"eventDate",width:150},{header:i18n.get("headers.description"),dataIndex:"description",width:250},{header:i18n.get("headers.message"),dataIndex:"message",width:150}]});var b=new Ext.grid.GridPanel({layout:"fit",flex:0.5,title:i18n.get("label.events"),store:d,cm:f,rowSelectionModel:new Ext.grid.RowSelectionModel(),autoScroll:true,collapsible:false});var c=new Ext.data.JsonStore({fields:[{name:"resourceCollection",type:"string"}]});if(!Ext.isEmpty(this.orderRec.data.resourceCollection)){Ext.each(this.orderRec.data.resourceCollection,function(g){var k=new c.recordType({resourceCollection:g});c.add(k)})}if(!Ext.isEmpty(this.orderRec.data.adminResourceCollection)){Ext.each(this.orderRec.data.adminResourceCollection,function(g){var k=new c.recordType({resourceCollection:g});c.add(k)})}var e=new Ext.grid.ColumnModel({columns:[{header:i18n.get("headers.resource"),dataIndex:"resourceCollection",width:600}]});var a=new Ext.grid.GridPanel({layout:"fit",flex:0.5,title:i18n.get("label.resourceCollection"),store:c,cm:e,rowSelectionModel:new Ext.grid.RowSelectionModel(),autoScroll:true,collapsible:false});this.items=[{xtype:"panel",layout:"fit",items:[{xtype:"panel",layout:"vbox",layoutConfig:{align:"stretch",flex:"ratio"},items:[{xtype:"form",border:false,padding:10,items:[{xtype:"hidden",name:"orderId",id:"userValueFieldId"},{xtype:"textfield",name:"userId",fieldLabel:i18n.get("label.userLogin"),anchor:"100%",maxLength:100,readOnly:true},{xtype:"textfield",name:"description",fieldLabel:i18n.get("label.description"),anchor:"100%",maxLength:100,readOnly:true},{xtype:"textfield",name:"resourceDescriptor",fieldLabel:i18n.get("label.url"),anchor:"100%",maxLength:30,readOnly:true},{xtype:"textfield",name:"dateOrder",fieldLabel:i18n.get("label.dateOrder"),anchor:"100%",maxLength:100,readOnly:true}]},a,b]}],buttons:[{text:i18n.get("label.close"),scope:this,handler:function(){this.close()}}]}];sitools.component.order.orderPropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.order.orderPropPanel.superclass.onRender.apply(this,arguments);var a=this.findByType("form")[0].getForm();a.loadRecord(this.orderRec)}});Ext.reg("s-orderprop",sitools.component.order.orderPropPanel);Ext.namespace("sitools.component.order");sitools.component.order.orderCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.GROUP,sm:new Ext.grid.RowSelectionModel(),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_ORDERS_ADMIN_URL");this.store=new Ext.data.JsonStore({root:"data",restful:true,url:this.url,remoteSort:true,idProperty:"id",fields:[{name:"id",type:"string"},{name:"userId",type:"string"},{name:"description",type:"string"},{name:"resourceCollection"},{name:"resourceDescriptor",type:"string"},{name:"status",type:"string"},{name:"dateOrder",type:"string"},{name:"events"},{name:"adminResourceCollection"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.userLogin"),dataIndex:"userId",width:100},{header:i18n.get("label.description"),dataIndex:"description",width:350},{header:i18n.get("label.status"),dataIndex:"status",width:80},{header:i18n.get("label.dateOrder"),dataIndex:"dateOrder",width:150}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.details"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_details.png",handler:this._onDetail,xtype:"s-menuButton"},{text:i18n.get("label.active"),icon:"res/images/icons/icons_perso/toolbar_beginning.png",handler:this._onActive,xtype:"s-menuButton"},{text:i18n.get("label.done"),icon:"res/images/icons/icons_perso/toolbar_end.png",handler:this._onDone,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this._onDetail};sitools.component.order.orderCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.order.orderCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},_onDetail:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.component.order.orderPropPanel({url:this.url,action:"detail",store:this.getStore(),orderRec:b});a.show(ID.BOX.ORDER)},_onActive:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.component.order.events({baseUrl:this.url+"/"+b.data.id,action:"active",store:this.getStore(),orderRec:b});a.show()},_onDone:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.component.order.events({baseUrl:this.url+"/"+b.data.id,action:"done",store:this.getStore(),orderRec:b});a.show()},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("orderCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-order",sitools.component.order.orderCrudPanel);Ext.namespace("sitools.component.order");sitools.component.order.events=Ext.extend(Ext.Window,{width:350,height:230,modal:true,closable:true,baseUrl:this.baseUrl,initComponent:function(){this.title=i18n.get("label.orders");this.items=[{xtype:"panel",height:200,items:[{xtype:"form",border:false,padding:10,items:[{xtype:"textarea",name:"description",fieldLabel:i18n.get("label.description"),anchor:"100%",maxLength:100},{xtype:"textarea",name:"message",fieldLabel:i18n.get("label.message"),anchor:"100%",maxLength:100}]}],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this._onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];sitools.component.order.events.superclass.initComponent.call(this)},_onValidate:function(){var a=this.baseUrl+"/"+this.action;var b=this.findByType("form")[0].getForm();if(!b.isValid()){Ext.Msg.alert(i18n.get("warning.invalidForm"));return}var c={};Ext.iterate(b.getValues(),function(d,e){c[d]=e},this);Ext.Ajax.request({url:a,method:"PUT",scope:this,jsonData:c,success:function(d){this.store.reload();this.close()},failure:alertFailure})}});Ext.namespace("sitools.component.graphs");sitools.component.graphs.graphsCrudPanel=Ext.extend(Ext.Panel,{border:false,height:300,id:ID.BOX.GRAPHS,autoScroll:true,initComponent:function(){this.urlProjects=loadUrl.get("APP_URL")+loadUrl.get("APP_PROJECTS_URL");this.storeProjects=new Ext.data.JsonStore({fields:["id","name"],url:this.urlProjects,root:"data",autoLoad:true});this.comboProjects=new Ext.form.ComboBox({store:this.storeProjects,displayField:"name",valueField:"id",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",emptyText:i18n.get("label.selectProject"),selectOnFocus:true,listeners:{scope:this,select:function(b,c,a){this.loadGraph(c.data.id)}}});this.tbar={xtype:"toolbar",defaults:{scope:this},items:[this.comboProjects,{text:i18n.get("label.save"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/save.png",handler:this._onSave,xtype:"s-menuButton"},{text:i18n.get("label.reset"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_refresh.png",handler:this._onReset,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this._onDelete,xtype:"s-menuButton"}]};this.buttons=[{text:i18n.get("label.save"),scope:this,handler:this._onSave},{text:i18n.get("label.reset"),scope:this,handler:this._onReset},{text:i18n.get("label.delete"),scope:this,handler:this._onDelete}];sitools.component.graphs.graphsCrudPanel.superclass.initComponent.call(this)},loadGraph:function(b){var c=this.storeProjects.find("id",b);var d=this.storeProjects.getAt(c);var a=d.data.name;this.removeAll();this.tree=new sitools.component.graphs.graphsCrudTreePanel({name:a,projectId:b});this.tree.getRootNode().expand(true);this.add(this.tree);this.doLayout()},_onSave:function(){var d=this.comboProjects.getValue();if(!Ext.isEmpty(d)){var b=this.tree.getRootNode();var a=[];var g=b.childNodes;var e;for(e=0;e<g.length;e++){this.getAllNodes(g[e],a)}var c=this.tree.getIdGraph();var f={nodeList:a,id:c};var k=(!Ext.isEmpty(c))?"PUT":"POST";Ext.Ajax.request({url:this.urlProjects+"/"+d+"/graph",method:k,scope:this,jsonData:f,success:function(l){var n=Ext.decode(l.responseText);if(!n.success){Ext.Msg.alert(i18n.get("label.warning"),n.message);return false}else{var m=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.graphSaved"),autoDestroy:true,hideDelay:1000}).show(document);this.loadGraph(d)}},failure:alertFailure})}else{Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}},getAllNodes:function(a,c){var d={};if(Ext.isEmpty(a)){return}else{if(a.isLeaf()){d={text:a.text,datasetId:a.attributes.datasetId,visible:a.attributes.visible,status:a.attributes.status,nbRecord:a.attributes.nbRecord,imageDs:a.attributes.imageDs,readme:a.attributes.readme,url:a.attributes.url,leaf:true,type:a.attributes.type};c.push(d)}else{d={text:a.text,image:a.attributes.image,description:a.attributes.description,children:[],type:a.attributes.type,leaf:false};c.push(d);var e=a.childNodes;var b;for(b=0;b<e.length;b++){this.getAllNodes(e[b],d.children)}}}},_onReset:function(){var a=this.comboProjects.getValue();if(!Ext.isEmpty(a)){var b=Ext.Msg.show({title:i18n.get("label.warning"),buttons:Ext.Msg.YESNO,msg:i18n.get("label.graphs.reset"),scope:this,fn:function(c,d){if(c=="yes"){this.doReset()}}})}else{Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}},doReset:function(){if(!Ext.isEmpty(this.tree)){var a=this.tree.getRootNode();a.removeAll(true);this.tree.getLoader().load(a,function(){a.expand(true)},this)}},_onDelete:function(){var a=this.comboProjects.getValue();if(!Ext.isEmpty(a)){var b=Ext.Msg.show({title:i18n.get("label.warning"),buttons:Ext.Msg.YESNO,msg:i18n.get("label.graphs.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(a)}}})}else{Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}},doDelete:function(a){Ext.Ajax.request({url:this.urlProjects+"/"+a+"/graph",method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.loadGraph(a)}}})}});sitools.component.graphs.graphsCrudTreePanel=Ext.extend(Ext.tree.TreePanel,{idGraph:null,loader:null,projectId:null,constructor:function(a){this.loader=new sitools.component.graphs.graphTreeLoader({requestMethod:"GET",url:loadUrl.get("APP_URL")+loadUrl.get("APP_PROJECTS_URL")+"/"+a.projectId+"/graph",root:"graph.nodeList"});this.projectId=a.projectId;a=Ext.apply({rootVisible:true,loader:this.loader,layout:"fit",enableDD:true,root:{nodeType:"async",text:a.name},contextMenuRoot:new Ext.menu.Menu({items:[{id:"create-node",text:i18n.get("label.createNode"),icon:loadUrl.get("APP_URL")+"/res/images/icons/add_folder.png"},{id:"add-dataset",text:i18n.get("label.addDataset"),icon:loadUrl.get("APP_URL")+"/res/images/icons/add_datasets.png"}],listeners:{scope:this,itemclick:this._cxtMenuHandler}}),contextMenuNode:new Ext.menu.Menu({items:[{id:"create-node",text:i18n.get("label.createNode"),icon:loadUrl.get("APP_URL")+"/res/images/icons/add_folder.png"},{id:"add-dataset",text:i18n.get("label.addDataset"),icon:loadUrl.get("APP_URL")+"/res/images/icons/add_datasets.png"},{id:"edit-node",text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/res/images/icons/toolbar_edit.png"},{id:"delete-node",text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/res/images/icons/toolbar_delete.png"}],listeners:{scope:this,itemclick:this._cxtMenuHandler}}),contextMenuLeaf:new Ext.menu.Menu({items:[{id:"edit-node",text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/res/images/icons/toolbar_edit.png"},{id:"delete-node",text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/res/images/icons/toolbar_delete.png"}],listeners:{scope:this,itemclick:this._cxtMenuHandler}}),listeners:{scope:this,contextmenu:function(b,d){b.select();var f;if(b.id==this.root.id){f=b.getOwnerTree().contextMenuRoot}else{if(b.isLeaf()){f=b.getOwnerTree().contextMenuLeaf}else{f=b.getOwnerTree().contextMenuNode}}f.contextNode=b;f.showAt(d.getXY())}}});sitools.component.graphs.graphsCrudTreePanel.superclass.constructor.call(this,a)},onRender:function(){sitools.component.graphs.graphsCrudTreePanel.superclass.onRender.apply(this,arguments)},_cxtMenuHandler:function(d){var c,a;switch(d.id){case"delete-node":var b=Ext.Msg.show({title:i18n.get("label.warning"),buttons:Ext.Msg.YESNO,msg:i18n.get("label.graphs.node.delete"),scope:this,fn:function(e,f){if(e=="yes"){var g=d.parentMenu.contextNode;if(g.parentNode){g.remove()}}}});break;case"add-dataset":c=d.parentMenu.contextNode;a=new sitools.component.graphs.graphsDatasetWin({node:c,url:loadUrl.get("APP_URL")+"/projects/"+this.projectId+"?media=json",mode:"create"});a.show(this);break;case"create-node":c=d.parentMenu.contextNode;a=new sitools.component.graphs.graphsNodeWin({node:c,mode:"create"});a.show(this);break;case"edit-node":c=d.parentMenu.contextNode;if(c.isLeaf()){a=new sitools.component.graphs.graphsDatasetWin({node:c,url:loadUrl.get("APP_URL")+"/projects/"+this.projectId+"?media=json",mode:"edit"})}else{a=new sitools.component.graphs.graphsNodeWin({node:c,mode:"edit"})}a.show(this);break}},getIdGraph:function(){return this.loader.getIdGraph()}});sitools.component.graphs.graphTreeLoader=Ext.extend(Ext.tree.TreeLoader,{idGraph:null,createNode:function(a){return Ext.tree.TreeLoader.prototype.createNode.call(this,a)},processResponse:function(c,b,l,m){var n=c.responseText,a,k,d=0,f;try{if(!(a=c.responseData)){a=Ext.decode(n);this.idGraph=a.graph.id;if(this.root){if(!this.getRoot){this.getRoot=Ext.data.JsonReader.prototype.createAccessor(this.root)}a=this.getRoot(a)}}b.beginUpdate();for(f=a.length;d<f;d++){k=this.createNode(a[d]);if(k){b.appendChild(k)}}b.endUpdate();this.runCallback(l,m||b,[b])}catch(g){this.handleFailure(c)}},getIdGraph:function(){return this.idGraph}});Ext.reg("s-graphs",sitools.component.graphs.graphsCrudPanel);Ext.namespace("sitools.component.graphs");sitools.component.graphs.graphsDatasetWin=Ext.extend(Ext.Window,{width:350,modal:true,closable:false,pageSize:10,initComponent:function(){this.title=i18n.get("label.datasets");var a=this.projectId;this.store=new Ext.data.JsonStore({root:"project.dataSets",restful:true,autoSave:false,idProperty:"id",url:this.url,fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"type",type:"string"},{name:"mediaType",type:"string"},{name:"visible",type:"boolean"},{name:"status",type:"string"},{name:"url",type:"string"},{name:"properties"}]});this.grid=new Ext.grid.GridPanel({sm:new Ext.grid.RowSelectionModel({singleSelect:true}),store:this.store,height:200,columns:[{header:i18n.get("label.name"),dataIndex:"name"},{header:i18n.get("label.description"),dataIndex:"description"}],listeners:{scope:this,viewReady:function(){var c=this.node;if(this.mode=="edit"){var b=this.store.find("name",c.text);var d=this.grid.getSelectionModel();d.selectRow(b)}}}});this.items=[{xtype:"panel",title:i18n.get("label.selectDataset"),items:[this.grid],bbar:{xtype:"toolbar",defaults:{scope:this},items:["->",{text:i18n.get("label.ok"),handler:this._onOK},{text:i18n.get("label.cancel"),handler:this._onCancel}]}}];sitools.component.graphs.graphsDatasetWin.superclass.initComponent.call(this)},onRender:function(){sitools.component.graphs.graphsDatasetWin.superclass.onRender.apply(this,arguments);this.store.load({scope:this,params:{start:0,limit:this.pageSize},callback:function(b,a,c){if(!c){this.close();Ext.Msg.alert(i18n.get("label.error"),i18n.get("label.error.project.nodataset"))}}})},_onOK:function(){var f=this.grid.getSelectionModel().getSelected();if(this.mode=="edit"){this.node.setText(f.data.name)}else{var d=f.data.properties;var b=0;var a;var e;if(!Ext.isEmpty(d)){Ext.each(d,function(g){if(g.name=="nbRecord"){b=g.value}if(g.name=="imageUrl"){a=g.value}if(g.name=="descriptionHTML"){e=g.value}})}var c={text:f.data.name,datasetId:f.data.id,visible:f.data.visible,status:f.data.status,nbRecord:b,leaf:true,type:"dataset",imageDs:a,readme:e,url:f.data.url};if(!this.node.isExpanded()){this.node.expand()}this.node.appendChild(c)}this.close()},_onCancel:function(){this.destroy()}});Ext.namespace("sitools.component.projects");sitools.component.graphs.graphsNodeWin=Ext.extend(Ext.Window,{width:350,modal:true,closable:false,initComponent:function(){this.title=i18n.get("label.nodeDescription");this.itemsForm=[{fieldLabel:i18n.get("label.name"),name:"name",anchor:"100%",allowBlank:false},{fieldLabel:i18n.get("label.description"),name:"description",anchor:"100%"},{xtype:"sitoolsSelectImage",name:"image",fieldLabel:i18n.get("label.image"),anchor:"100%",growMax:400}];this.bbar={xtype:"toolbar",defaults:{scope:this},items:["->",{text:i18n.get("label.ok"),handler:this._onOK},{text:i18n.get("label.cancel"),handler:this._onCancel}]};this.formPanel=new Ext.FormPanel({labelWidth:100,frame:true,defaultType:"textfield",items:this.itemsForm});this.items=[this.formPanel];sitools.component.graphs.graphsNodeWin.superclass.initComponent.call(this)},onRender:function(){sitools.component.graphs.graphsNodeWin.superclass.onRender.apply(this,arguments)},afterRender:function(){sitools.component.graphs.graphsNodeWin.superclass.afterRender.apply(this,arguments);if(this.mode=="edit"){var c=this.node;var b=this.formPanel.getForm();var d={};d.name=c.text;d.image=c.attributes.image.url;d.description=c.attributes.description;var a=new Ext.data.Record(d);b.loadRecord(a)}},_onOK:function(){var c=this.formPanel.getForm();var a=c.getValues();var d={};if(!Ext.isEmpty(a.image)){d.url=a.image;d.type="Image";d.mediaType="Image"}if(this.mode=="edit"){this.node.setText(a.name);this.node.attributes.description=a.description;this.node.attributes.image=d}else{var b={text:a.name,image:d,description:a.description,type:"node",children:[]};if(!this.node.isExpanded()){this.node.expand()}this.node.appendChild(b)}this.close()},_onCancel:function(){this.destroy()},_onUpload:function(){Ext.msg.alert("Information","TODO")}});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.selectColumn=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,initComponent:function(){this.title=i18n.get("title.selectColumn");this.cmSelectColumn=new Ext.grid.ColumnModel({columns:[{id:"name",header:i18n.get("headers.name"),sortable:true,dataIndex:"columnAlias"}]});this.smSelectColumn=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridSelectColumn=new Ext.grid.GridPanel({height:380,autoScroll:true,store:new Ext.data.JsonStore({root:"dataset.columnModel",restful:true,proxy:new Ext.data.HttpProxy({url:this.url,restful:true,method:"GET"}),remoteSort:true,idProperty:"id",fields:[{name:"id",type:"string"},{name:"columnAlias",type:"string"},{name:"visible",type:"boolean"},{name:"schema",type:"string"},{name:"tableName",type:"string"},{name:"columnRenderer",type:"string"}],autoLoad:true,listeners:{scope:this,load:function(b,a,c){var d;for(d=0;d<a.length;d++){if(a[d].data!==undefined&&!a[d].data.visible&&a[d].data.columnRenderer!="noClientAccess"){b.remove(a[d])}}}}}),cm:this.cmSelectColumn,sm:this.smSelectColumn});this.items=[{xtype:"panel",layout:"fit",items:[this.gridSelectColumn],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];sitools.admin.datasets.selectColumn.superclass.initComponent.call(this)},onValidate:function(){var a=this.gridSelectColumn.getSelectionModel().getSelected();if(a!==null){this.record.data[this.field]=a.data.columnAlias;this.parentView.refresh();this.close()}else{new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document)}}});Ext.reg("s-datasetscolumnwin",sitools.admin.datasets.selectColumn);Ext.namespace("sitools.admin.converters");sitools.admin.converters.convertersCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.CONVERTERS,pageSize:10,modify:false,urlGrid:null,converterChainedId:{},conflictWarned:false,viewConfig:{forceFit:true,autoFill:true,getRowClass:function(d,b){var a="";var c=d.data;if(c.classVersion!==c.currentClassVersion&&c.currentClassVersion!==null&&c.currentClassVersion!==undefined){if(!this.conflictWarned){Ext.Msg.alert("warning.version.conflict","Converter "+c.name+" definition (v"+c.classVersion+") may conflict with current class version : "+c.currentClassVersion);this.conflictWarned=true}a="red-row"}return a}},initComponent:function(){this.urlDatasets=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_URL");this.converterUrlPart=loadUrl.get("APP_DATASETS_CONVERTERS_URL");this.httpProxyForms=new Ext.data.HttpProxy({url:"/tmp",restful:true,method:"GET"});this.store=new Ext.data.JsonStore({idProperty:"id",root:"converterChainedModel.converters",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"className",type:"string"},{name:"descriptionAction",type:"string"},{name:"parameters"},{name:"classVersion",type:"string"},{name:"classAuthor",type:"string"},{name:"currentClassVersion",type:"string"},{name:"currentClassAuthor",type:"string"},{name:"status",type:"string"},{name:"classOwner",type:"string"}],proxy:this.httpProxyForms});var a=new Ext.data.JsonStore({fields:["id","name"],url:this.urlDatasets,root:"data",autoLoad:true});this.comboDatasets=new Ext.form.ComboBox({store:a,displayField:"name",valueField:"id",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",emptyText:i18n.get("label.selectDatasets"),selectOnFocus:true,listeners:{scope:this,select:function(c,d,b){this.datasetId=d.data.id;this.httpProxyForms.setUrl(this.urlDatasets+"/"+this.datasetId+this.converterUrlPart,true);this.getStore().removeAll();this.getStore().load()}}});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:150,sortable:false},{header:i18n.get("label.description"),dataIndex:"description",width:200,sortable:false},{header:i18n.get("label.descriptionAction"),dataIndex:"descriptionAction",width:200,sortable:false},{header:i18n.get("label.status"),dataIndex:"status",width:50,sortable:false},{header:i18n.get("label.className"),dataIndex:"className",width:150,sortable:false},{header:i18n.get("label.classVersion"),dataIndex:"classVersion",width:50,sortable:false},{header:i18n.get("label.currentClassVersion"),dataIndex:"currentClassVersion",width:50,sortable:false},{header:i18n.get("label.classAuthor"),dataIndex:"classAuthor",width:100,sortable:false},{header:i18n.get("label.classOwner"),dataIndex:"classOwner",width:100,sortable:false}]});this.tbar={xtype:"sitools.widget.GridSorterToolbar",defaults:{scope:this},items:[this.comboDatasets,{text:i18n.get("label.add"),icon:"/sitools/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:"/sitools/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:"/sitools/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},"-",{text:i18n.get("label.deleteAll"),icon:"/sitools/common/res/images/icons/toolbar_delete.png",handler:this.onDeleteAll,xtype:"s-menuButton"},{text:i18n.get("label.saveOrder"),icon:"/sitools/common/res/images/icons/save.png",handler:this.onSave,xtype:"s-menuButton"},{text:i18n.get("label.active"),icon:"/sitools/common/res/images/icons/toolbar_active.png",handler:this._onActive,xtype:"s-menuButton"},{text:i18n.get("label.disactive"),icon:"/sitools/common/res/images/icons/toolbar_disactive.png",handler:this._onDisactive,xtype:"s-menuButton"}]};this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.converters.convertersCrudPanel.superclass.initComponent.call(this)},onCreate:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var a=new sitools.admin.converters.convertersProp({action:"create",parent:this,datasetId:this.datasetId,converterUrlPart:this.converterUrlPart,urlDatasets:this.urlDatasets});a.show()},onSave:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var d=this.comboDatasets.getValue(),c={};c.id=d;c.idOrder=[];for(var b=0;b<this.store.getCount();b++){var e=this.store.getAt(b).data;c.idOrder.push(e.id)}var a=this.urlDatasets+"/"+d+this.converterUrlPart;Ext.Ajax.request({url:a,method:"PUT",scope:this,jsonData:c,success:function(f){var k=Ext.decode(f.responseText);if(!k.success){Ext.Msg.alert(i18n.get("label.warning"),k.message);return false}var g=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.converterSaved"),autoDestroy:true,hideDelay:1000}).show(document);Ext.Msg.alert(i18n.get("label.information"),i18n.get("label.restartDsNeededConv"));this.getStore().reload()}})},onModify:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var c=this.getSelectionModel().getSelected();var b=this.getStore().indexOf(c);if(!c){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.converters.convertersProp({action:"modify",parent:this,converter:c.data,index:b,datasetId:this.datasetId,converterUrlPart:this.converterUrlPart,urlDatasets:this.urlDatasets,converterChainedId:this.converterChainedId});a.show()},onDelete:function(){var b=this.getSelectionModel().getSelected();if(Ext.isEmpty(b)){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("label.convertersCrud.deleteConverter"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b.data.id)}}})},doDelete:function(b){var c=this.comboDatasets.getValue();var a=this.urlDatasets+"/"+c+this.converterUrlPart+"/"+b;Ext.Ajax.request({url:a,method:"DELETE",scope:this,success:function(d){if(showResponse(d)){this.getStore().reload();Ext.Msg.alert(i18n.get("label.information"),i18n.get("label.restartDsNeededConvDelete"))}}})},onDeleteAll:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("label.convertersCrud.delete.all"),scope:this,fn:function(b,c){if(b=="yes"){this.doDeleteAll()}}})},doDeleteAll:function(){var b=this.comboDatasets.getValue();var a=this.urlDatasets+"/"+b+this.converterUrlPart;Ext.Ajax.request({url:a,method:"DELETE",scope:this,success:function(c){if(showResponse(c)){this.getStore().removeAll();this.getStore().reload();Ext.Msg.alert(i18n.get("label.information"),i18n.get("label.restartDsNeededConvDelete"))}}})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.urlDatasets+"/"+this.datasetId+this.converterUrlPart+"/"+a.data.id+"/start",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.urlDatasets+"/"+this.datasetId+this.converterUrlPart+"/"+a.data.id+"/stop",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-converters",sitools.admin.converters.convertersCrudPanel);Ext.namespace("sitools.admin.converters");sitools.admin.converters.convertersProp=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:true,initComponent:function(){this.convertersPluginUrl=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_CONVERTERS_PLUGINS_URL");this.title=this.action=="create"?i18n.get("label.createConverter"):i18n.get("label.modifyConverter");var b=new Ext.ux.grid.RowExpander({tpl:new Ext.XTemplate('<tpl if="this.descEmpty(description)" ><div></div></tpl>','<tpl if="this.descEmpty(description) == false" ><div class="sitoolsDescription"><div class="sitoolsDescriptionHeader">Description :&nbsp;</div><p class="sitoolsDescriptionText"> {description} </p></div></tpl>',{compiled:true,descEmpty:function(c){return Ext.isEmpty(c)}}),expandOnDblClick:true});this.gridConverter=new Ext.grid.GridPanel({viewConfig:{forceFit:true},id:"gridConverter",title:i18n.get("title.converterClass"),store:new Ext.data.JsonStore({root:"data",restful:true,proxy:new Ext.data.HttpProxy({url:this.convertersPluginUrl,restful:true,method:"GET"}),remoteSort:false,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"className",type:"string"},{name:"classAuthor",type:"string"},{name:"classVersion",type:"string"},{name:"classOwner",type:"string"}],autoLoad:true}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[b,{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.className"),dataIndex:"className",width:300,sortable:true},{header:i18n.get("label.author"),dataIndex:"classAuthor",width:100,sortable:true},{header:i18n.get("label.version"),dataIndex:"classVersion",width:100,sortable:true},{header:i18n.get("label.classOwner"),dataIndex:"classOwner",width:100,sortable:true}]}),listeners:{scope:this,rowclick:this.onClassClick},plugins:b});this.proxyFieldMapping=new Ext.data.HttpProxy({url:"/tmp",restful:true,method:"GET"});var a=new sitools.widget.ViolationRowExpander({tpl:new Ext.XTemplate('<tpl if="this.descEmpty(description)" ><div></div></tpl>','<tpl if="this.descEmpty(description) == false" ><div class="sitoolsDescription"><div class="sitoolsDescriptionHeader">Description :&nbsp;</div><p class="sitoolsDescriptionText"> {description} </p></div></tpl>',{compiled:true,descEmpty:function(c){return Ext.isEmpty(c)}}),expandOnDblClick:false});this.gridFieldMapping=new Ext.grid.EditorGridPanel({viewConfig:{forceFit:true,scope:this,getRowClass:function(d,g,k,f){var c="";var e=d.get("violation");if(!Ext.isEmpty(e)){if(e.level=="CRITICAL"){c="red-row"}else{if(e.level=="WARNING"){c="orange-row"}}}return c},listeners:{scope:this,refresh:function(c){var e=this.gridFieldMapping;var d=e.getStore();d.each(function(m){var n=m.get("violation");if(!Ext.isEmpty(n)){var p=d.indexOf(m);var k=c.getRow(p);var q=Ext.get(k);var l=(n.level=="CRITICAL")?"x-form-invalid-tip":"x-form-invalid-tip x-form-warning-tip";var g={html:n.message,dismissDelay:0,target:q,cls:l};var f=new Ext.ToolTip(g)}})}}},layout:"fit",region:"center",store:new Ext.data.JsonStore({root:"converter.parameters",proxy:this.proxyFieldMapping,restful:true,remoteSort:false,idProperty:"name",fields:[{name:"name",type:"string"},{name:"description",type:"string"},{name:"parameterType",type:"string"},{name:"attachedColumn",type:"string"},{name:"value",type:"string"},{name:"valueType",type:"string"},{name:"violation"}]}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[a,{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.type"),dataIndex:"parameterType",width:150,sortable:false},{header:i18n.get("label.attachedColumn"),dataIndex:"attachedColumn",width:100,sortable:false},{header:i18n.get("label.value"),dataIndex:"value",width:80,sortable:false,editable:true,editor:new Ext.form.TextField()}]}),bbar:new Ext.ux.StatusBar({id:"statusBar",hidden:true,iconCls:"x-status-error",text:i18n.get("label.converterErrorValidationNotification")}),listeners:{scope:this,celldblclick:function(c,m,d,k){var f=c.getStore().getAt(m);var l=f.data;if(d==3&&l.parameterType!="CONVERTER_PARAMETER_INTERN"){var g=new sitools.admin.datasets.selectColumn({field:"attachedColumn",record:f,parentStore:this.gridFieldMapping.getStore(),parentView:this.gridFieldMapping.getView(),url:this.urlDatasets+"/"+this.datasetId});g.show(ID.BOX.DATASETS)}else{if(d==4&&l.parameterType=="CONVERTER_PARAMETER_INTERN"){return true}else{return false}}}},plugins:a});this.fieldMappingFormPanel=new Ext.FormPanel({height:40,frame:true,defaultType:"textfield",items:[{fieldLabel:i18n.get("label.descriptionAction"),name:"descriptionAction",anchor:"100%"}],region:"north"});this.fieldMappingPanel=new Ext.Panel({layout:"border",id:"gridFieldMapping",title:i18n.get("title.fieldMapping"),items:[this.fieldMappingFormPanel,this.gridFieldMapping]});this.tabPanel=new Ext.TabPanel({height:450,activeTab:0,items:(this.action=="create")?[this.gridConverter,this.fieldMappingPanel]:[this.fieldMappingPanel],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.listeners={scope:this,resize:function(f,e,c){var d=f.body.getSize();this.tabPanel.setSize(d)}};this.items=[this.tabPanel];sitools.admin.converters.convertersProp.superclass.initComponent.call(this)},beforeTabChange:function(a,e,d){if(this.action=="create"){if(e.id=="gridFieldMapping"){var c=this.gridConverter.getSelectionModel().getSelected();if(!c){var b=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}}}},onClassClick:function(b,g,d){if(this.action=="create"){var f=this.gridConverter.getSelectionModel().getSelected();if(!f){return false}var c=f.data.className;this.proxyFieldMapping.setUrl(this.convertersPluginUrl+"/"+c+"/"+this.datasetId);var a=this.gridFieldMapping.getStore();a.removeAll();a.load()}},afterRender:function(){sitools.admin.converters.convertersProp.superclass.afterRender.apply(this,arguments);if(this.action=="modify"){var d=this.fieldMappingFormPanel.getForm();var e={};e.descriptionAction=this.converter.descriptionAction;d.loadRecord(new Ext.data.Record(e));var c=this.converter.parameters;if(c!==null){var a=this.gridFieldMapping.getStore();for(var b=0;b<c.length;b++){var f=new Ext.data.Record(c[b]);a.add(f)}this.gridFieldMapping.getView().refresh()}}},onValidate:function(){var e=this.gridConverter.getSelectionModel().getSelected();if(!e&&this.action=="create"){var f=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}var d={};var c=this.fieldMappingFormPanel.getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.invalidForm"));return}if(!Ext.isEmpty(c)){d.descriptionAction=c.findField("descriptionAction").getValue()}else{d.descriptionAction=undefined}var m=[];if(this.action=="create"){e=this.gridConverter.getSelectionModel().getSelected();var k=e.data;d.className=k.className;d.name=k.name;d.description=k.description;d.classVersion=k.classVersion;d.classAuthor=k.classAuthor;d.classOwner=k.classOwner}var n=this.gridFieldMapping.getStore();for(var g=0;g<n.getCount();g++){var l=n.getAt(g).data;l.violation=undefined;m.push(l)}d.parameters=m;var b=this.urlDatasets+"/"+this.datasetId+this.converterUrlPart;var a;if(this.action=="modify"){b+="/"+this.converter.id;a="PUT"}else{a="POST"}Ext.Ajax.request({url:b,method:a,scope:this,jsonData:d,success:function(q){var s=Ext.decode(q.responseText);if(!s.success){if(Ext.isEmpty(s.message)){var p=s.data;this.notifyViolations(p);Ext.getCmp("statusBar").show()}else{Ext.Msg.alert(i18n.get("label.warning"),s.message)}return false}var r=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.converterSaved"),autoDestroy:true,hideDelay:1000}).show(document);this.parent.getStore().reload();this.close()}})},notifyViolations:function(d){for(var e=0;e<d.length;e++){var c=d[e];var b=this.gridFieldMapping.getStore();var a=b.findExact("name",c.valueName);var f=b.getAt(a);f.set("violation",c)}this.gridFieldMapping.getView().refresh()},onClose:function(){}});Ext.namespace("sitools.component.filters");sitools.component.filters.filtersCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.FILTERS,pageSize:10,modify:false,urlGrid:null,filterChainedId:{},conflictWarned:false,viewConfig:{forceFit:true,autoFill:true,getRowClass:function(d,b){var a="";var c=d.data;if(c.classVersion!==c.currentClassVersion&&c.currentClassVersion!==null&&c.currentClassVersion!==undefined){if(!this.conflictWarned){Ext.Msg.alert("warning.version.conflict","Filter "+c.name+" definition (v"+c.classVersion+") may conflict with current class version : "+c.currentClassVersion);this.conflictWarned=true}a="red-row"}return a}},initComponent:function(){this.urlDatasets=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_URL");this.filterUrlPart=loadUrl.get("APP_DATASETS_FILTERS_URL");this.httpFilterForms=new Ext.data.HttpProxy({url:"/tmp",restful:true,method:"GET"});this.store=new Ext.data.JsonStore({idProperty:"id",root:"filterChainedModel.filters",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"className",type:"string"},{name:"descriptionAction",type:"string"},{name:"parameters"},{name:"classVersion",type:"string"},{name:"classAuthor",type:"string"},{name:"currentClassVersion",type:"string"},{name:"currentClassAuthor",type:"string"},{name:"status",type:"string"},{name:"classOwner",type:"string"}],proxy:this.httpFilterForms});var a=new Ext.data.JsonStore({fields:["id","name"],url:this.urlDatasets,root:"data",autoLoad:true});this.comboDatasets=new Ext.form.ComboBox({store:a,displayField:"name",valueField:"id",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",emptyText:i18n.get("label.selectDatasets"),selectOnFocus:true,listeners:{scope:this,select:function(c,d,b){this.datasetId=d.data.id;this.httpFilterForms.setUrl(this.urlDatasets+"/"+this.datasetId+this.filterUrlPart,true);this.getStore().removeAll();this.getStore().load()}}});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:150,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:200,sortable:false},{header:i18n.get("label.descriptionAction"),dataIndex:"descriptionAction",width:200,sortable:false},{header:i18n.get("label.status"),dataIndex:"status",width:50,sortable:false},{header:i18n.get("label.className"),dataIndex:"className",width:150,sortable:false},{header:i18n.get("label.classVersion"),dataIndex:"classVersion",width:50,sortable:false},{header:i18n.get("label.currentClassVersion"),dataIndex:"currentClassVersion",width:50,sortable:false},{header:i18n.get("label.classAuthor"),dataIndex:"classAuthor",width:100,sortable:false},{header:i18n.get("label.classOwner"),dataIndex:"classOwner",width:100,sortable:false}]});this.tbar={xtype:"sitools.widget.GridSorterToolbar",defaults:{scope:this},items:[this.comboDatasets,{text:i18n.get("label.add"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},"-",{text:i18n.get("label.deleteAll"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDeleteAll,xtype:"s-menuButton"},{text:i18n.get("label.saveOrder"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/save.png",handler:this.onSave,xtype:"s-menuButton"},{text:i18n.get("label.active"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_active.png",handler:this._onActive,xtype:"s-menuButton"},{text:i18n.get("label.disactive"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_disactive.png",handler:this._onDisactive,xtype:"s-menuButton"}]};this.listeners={scope:this,rowDblClick:this.onModify};sitools.component.filters.filtersCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.filters.filtersCrudPanel.superclass.onRender.apply(this,arguments)},onCreate:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var a=new sitools.component.filters.filtersProp({action:"create",parent:this,datasetId:this.datasetId,urlDatasets:this.urlDatasets,filterUrlPart:this.filterUrlPart});a.show()},onSave:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var d=this.comboDatasets.getValue(),c={};c.id=d;c.idOrder=[];for(var b=0;b<this.store.getCount();b++){var e=this.store.getAt(b).data;c.idOrder.push(e.id)}var a=this.urlDatasets+"/"+d+this.filterUrlPart;Ext.Ajax.request({url:a,method:"PUT",scope:this,jsonData:c,success:function(f){var k=Ext.decode(f.responseText);if(!k.success){Ext.Msg.alert(i18n.get("label.warning"),k.message);return false}var g=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.filtersSaved"),autoDestroy:true,hideDelay:1000}).show(document);Ext.Msg.alert(i18n.get("label.information"),i18n.get("label.restartDsNeededFilter"));this.getStore().reload()}})},onModify:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var c=this.getSelectionModel().getSelected();var b=this.getStore().indexOf(c);if(!c){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.component.filters.filtersProp({action:"modify",parent:this,filter:c.data,index:b,datasetId:this.datasetId,urlDatasets:this.urlDatasets,filterChainedId:this.filterChainedId,filterUrlPart:this.filterUrlPart});a.show()},onDelete:function(){var b=this.getSelectionModel().getSelected();if(Ext.isEmpty(b)){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("label.filtersCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b.data.id)}}})},doDelete:function(a){var c=this.comboDatasets.getValue();var b=this.urlDatasets+"/"+c+this.filterUrlPart+"/"+a;Ext.Ajax.request({url:b,method:"DELETE",scope:this,success:function(d){if(showResponse(d)){this.getStore().reload();Ext.Msg.alert(i18n.get("label.information"),i18n.get("label.restartDsNeededFilterDelete"))}}})},onDeleteAll:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("label.filtersCrud.delete.all"),scope:this,fn:function(b,c){if(b=="yes"){this.doDeleteAll()}}})},doDeleteAll:function(){var b=this.comboDatasets.getValue();var a=this.urlDatasets+"/"+b+this.filterUrlPart;Ext.Ajax.request({url:a,method:"DELETE",scope:this,success:function(c){if(showResponse(c)){this.getStore().removeAll();this.getStore().reload();Ext.Msg.alert(i18n.get("label.information"),i18n.get("label.restartDsNeededFilterDelete"))}}})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.urlDatasets+"/"+this.datasetId+this.filterUrlPart+"/"+a.data.id+"/start",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.urlDatasets+"/"+this.datasetId+this.filterUrlPart+"/"+a.data.id+"/stop",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-filters",sitools.component.filters.filtersCrudPanel);Ext.namespace("sitools.component.filters");sitools.component.filters.filtersProp=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:true,initComponent:function(){this.filtersUrl=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_FILTERS_PLUGINS_URL");this.title=this.action=="create"?i18n.get("label.createFilter"):i18n.get("label.modifyFilter");var b=new Ext.ux.grid.RowExpander({tpl:new Ext.XTemplate('<tpl if="this.descEmpty(description)" ><div></div></tpl>','<tpl if="this.descEmpty(description) == false" ><div class="sitoolsDescription"><div class="sitoolsDescriptionHeader">Description :&nbsp;</div><p class="sitoolsDescriptionText"> {description} </p></div></tpl>',{compiled:true,descEmpty:function(c){return Ext.isEmpty(c)}}),expandOnDblClick:true});this.gridFilter=new Ext.grid.GridPanel({viewConfig:{forceFit:true},id:"gridFilter",title:i18n.get("title.filterClass"),store:new Ext.data.JsonStore({root:"data",restful:true,proxy:new Ext.data.HttpProxy({url:this.filtersUrl,restful:true,method:"GET"}),remoteSort:false,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"className",type:"string"},{name:"classAuthor",type:"string"},{name:"classVersion",type:"string"},{name:"classOwner",type:"string"}],autoLoad:true}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[b,{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.className"),dataIndex:"className",width:300,sortable:true},{header:i18n.get("label.author"),dataIndex:"classAuthor",width:100,sortable:true},{header:i18n.get("label.version"),dataIndex:"classVersion",width:100,sortable:true},{header:i18n.get("label.classOwner"),dataIndex:"classOwner",width:100,sortable:true}]}),listeners:{scope:this,rowclick:this.onClassClick},plugins:b});this.proxyFieldMapping=new Ext.data.HttpProxy({url:"/tmp",restful:true,method:"GET"});var a=new sitools.widget.ViolationRowExpander({tpl:new Ext.XTemplate('<tpl if="this.descEmpty(description)" ><div></div></tpl>','<tpl if="this.descEmpty(description) == false" ><div class="sitoolsDescription"><div class="sitoolsDescriptionHeader">Description :&nbsp;</div><p class="sitoolsDescriptionText"> {description} </p></div></tpl>',{compiled:true,descEmpty:function(c){return Ext.isEmpty(c)}}),expandOnDblClick:false});this.gridFieldMapping=new Ext.grid.EditorGridPanel({viewConfig:{forceFit:true,scope:this,getRowClass:function(d,g,k,f){var c="";var e=d.get("violation");if(!Ext.isEmpty(e)){if(e.level=="CRITICAL"){c="red-row"}else{if(e.level=="WARNING"){c="orange-row"}}}return c},listeners:{scope:this,refresh:function(c){var e=this.gridFieldMapping;var d=e.getStore();d.each(function(m){var n=m.get("violation");if(!Ext.isEmpty(n)){var p=d.indexOf(m);var k=c.getRow(p);var q=Ext.get(k);var l=(n.level=="CRITICAL")?"x-form-invalid-tip":"x-form-invalid-tip x-form-warning-tip";var g={html:n.message,dismissDelay:0,target:q,cls:l};var f=new Ext.ToolTip(g)}})}}},layout:"fit",region:"center",store:new Ext.data.JsonStore({root:"filter.parameters",proxy:this.proxyFieldMapping,restful:true,remoteSort:false,idProperty:"name",fields:[{name:"name",type:"string"},{name:"description",type:"string"},{name:"parameterType",type:"string"},{name:"attachedColumn",type:"string"},{name:"value",type:"string"},{name:"valueType",type:"string"},{name:"violation"}]}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[a,{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.type"),dataIndex:"parameterType",width:150,sortable:false},{header:i18n.get("label.attachedColumn"),dataIndex:"attachedColumn",width:100,sortable:false},{header:i18n.get("label.value"),dataIndex:"value",width:80,sortable:false,editable:true,editor:new Ext.form.TextField()}]}),bbar:new Ext.ux.StatusBar({id:"statusBar",hidden:true,iconCls:"x-status-error",text:i18n.get("label.filterErrorValidationNotification")}),listeners:{scope:this,celldblclick:function(c,m,d,k){var f=c.getStore().getAt(m);var l=f.data;if(d==3&&l.parameterType!="PARAMETER_INTERN"){var g=new sitools.admin.datasets.selectColumn({field:"attachedColumn",record:f,parentStore:this.gridFieldMapping.getStore(),parentView:this.gridFieldMapping.getView(),url:this.urlDatasets+"/"+this.datasetId});g.show(ID.BOX.DATASETS)}else{if(d==4&&l.parameterType=="PARAMETER_INTERN"){return true}else{return false}}}},plugins:a});this.fieldMappingFormPanel=new Ext.FormPanel({height:40,frame:true,defaultType:"textfield",items:[{fieldLabel:i18n.get("label.descriptionAction"),name:"descriptionAction",anchor:"100%"}],region:"north"});this.fieldMappingPanel=new Ext.Panel({layout:"border",id:"gridFieldMapping",title:i18n.get("title.fieldMapping"),items:[this.fieldMappingFormPanel,this.gridFieldMapping]});this.tabPanel=new Ext.TabPanel({height:450,activeTab:0,items:(this.action=="create")?[this.gridFilter,this.fieldMappingPanel]:[this.fieldMappingPanel],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.listeners={scope:this,resize:function(f,e,c){var d=f.body.getSize();this.tabPanel.setSize(d)}};this.items=[this.tabPanel];sitools.component.filters.filtersProp.superclass.initComponent.call(this)},beforeTabChange:function(a,e,d){if(this.action=="create"){if(e.id=="gridFieldMapping"){var c=this.gridFilter.getSelectionModel().getSelected();if(!c){var b=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}}}},onClassClick:function(b,g,d){if(this.action=="create"){var f=this.gridFilter.getSelectionModel().getSelected();if(!f){return false}var c=f.data.className;this.proxyFieldMapping.setUrl(this.filtersUrl+"/"+c+"/"+this.datasetId);var a=this.gridFieldMapping.getStore();a.removeAll();a.load()}},afterRender:function(){sitools.component.filters.filtersProp.superclass.afterRender.apply(this,arguments);if(this.action=="modify"){var d=this.fieldMappingFormPanel.getForm();var e={};e.descriptionAction=this.filter.descriptionAction;d.loadRecord(new Ext.data.Record(e));var c=this.filter.parameters;if(c!==null){var a=this.gridFieldMapping.getStore();var b;for(b=0;b<c.length;b++){e=new Ext.data.Record(c[b]);a.add(e)}this.gridFieldMapping.getView().refresh()}}},onValidate:function(){var e=this.gridFilter.getSelectionModel().getSelected();if(!e&&this.action=="create"){var f=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}var d={};var c=this.fieldMappingFormPanel.getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return false}if(!Ext.isEmpty(c)){d.descriptionAction=c.findField("descriptionAction").getValue()}else{d.descriptionAction=undefined}var m=[];if(this.action=="create"){e=this.gridFilter.getSelectionModel().getSelected();var k=e.data;d.className=k.className;d.name=k.name;d.description=k.description;d.classVersion=k.classVersion;d.classAuthor=k.classAuthor;d.classOwner=k.classOwner}var n=this.gridFieldMapping.getStore();for(var g=0;g<n.getCount();g++){var l=n.getAt(g).data;l.violation=undefined;m.push(l)}d.parameters=m;var b=this.urlDatasets+"/"+this.datasetId+this.filterUrlPart;var a;if(this.action=="modify"){b+="/"+this.filter.id;a="PUT"}else{a="POST"}Ext.Ajax.request({url:b,method:a,scope:this,jsonData:d,success:function(q){var s=Ext.decode(q.responseText);if(!s.success){if(Ext.isEmpty(s.message)){var p=s.data;this.notifyViolations(p);Ext.getCmp("statusBar").show()}else{Ext.Msg.alert(i18n.get("label.warning"),s.message)}return false}var r=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.filterSaved"),autoDestroy:true,hideDelay:1000}).show(document);this.parent.getStore().reload();this.close()}})},notifyViolations:function(d){for(var e=0;e<d.length;e++){var c=d[e];var b=this.gridFieldMapping.getStore();var a=b.findExact("name",c.valueName);var f=b.getAt(a);f.set("violation",c)}this.gridFieldMapping.getView().refresh()},onClose:function(){}});Ext.namespace("sitools.component.formComponents");sitools.component.formComponents.FormComponentsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.FORMCOMPONENTS,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_FORMCOMPONENTS_URL");this.store=new Ext.data.JsonStore({root:"data",restful:true,remoteSort:true,autoSave:false,url:this.url,idProperty:"id",fields:[{name:"id",type:"string"},{name:"type",type:"string"},{name:"componentDefaultHeight",type:"string"},{name:"componentDefaultWidth",type:"string"},{name:"jsAdminObject",type:"string"},{name:"jsUserObject",type:"string"},{name:"imageUrl",type:"string"},{name:"priority",type:"integer"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.type"),dataIndex:"type",width:100,sortable:true},{header:i18n.get("label.jsAdminObject"),dataIndex:"jsAdminObject",width:350,sortable:false},{header:i18n.get("label.jsUserObject"),dataIndex:"jsUserObject",width:350,sortable:false},{header:i18n.get("label.priority"),dataIndex:"priority",width:50,sortable:true}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this._onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this._onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this._onDelete,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this._onModify};sitools.component.formComponents.FormComponentsCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.formComponents.FormComponentsCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},_onCreate:function(){var a=new sitools.component.formComponents.FormComponentsPropPanel({url:this.url,action:"create",store:this.store});a.show(ID.BOX.FORMCOMPONENTS)},_onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.component.formComponents.FormComponentsPropPanel({url:this.url+"/"+b.id,action:"modify",store:this.store});a.show(ID.BOX.FORMCOMPONENTS)},_onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("formComponentsCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-formComponents",sitools.component.formComponents.FormComponentsCrudPanel);Ext.namespace("sitools.component.formComponents");sitools.component.formComponents.FormComponentsPropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,id:ID.COMPONENT_SETUP.FORMCOMPONENTS,layout:"fit",initComponent:function(){if(this.action=="create"){this.title=i18n.get("label.createFormComponents")}else{if(this.action=="modify"){this.title=i18n.get("label.modifyFormComponents")}}this.items=[{xtype:"panel",layout:"fit",title:i18n.get("label.formComponentsInfo"),items:[{xtype:"form",border:false,labelWidth:150,padding:10,items:[{xtype:"textfield",name:"id",hidden:true},{xtype:"textfield",name:"type",fieldLabel:i18n.get("label.type"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"componentDefaultHeight",fieldLabel:i18n.get("label.defaultHeight"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"componentDefaultWidth",fieldLabel:i18n.get("label.defaultWidth"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"jsAdminObject",fieldLabel:i18n.get("label.jsAdminObject"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"jsUserObject",fieldLabel:i18n.get("label.jsUserObject"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"fileUrlUser",id:"fileUrlUserId",fieldLabel:i18n.get("label.fileUrlUser"),anchor:"100%",allowBlank:false},{xtype:"textfield",id:"fileUrlAdminId",name:"fileUrlAdmin",fieldLabel:i18n.get("label.fileUrlAdmin"),anchor:"100%",allowBlank:false},{xtype:"sitoolsSelectImage",name:"imageUrl",fieldLabel:i18n.get("label.image"),anchor:"100%",allowBlank:false},{xtype:"spinnerfield",name:"priority",id:"priorityId",fieldLabel:i18n.get("label.priority"),minValue:0,maxValue:10,allowDecimals:false,incrementValue:1,accelerate:true,anchor:"50%",allowBlank:false}]}],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this._onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];sitools.component.formComponents.FormComponentsPropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.formComponents.FormComponentsPropPanel.superclass.onRender.apply(this,arguments);if(this.action=="modify"){var a=this.findByType("form")[0].getForm();Ext.Ajax.request({url:this.url,method:"GET",scope:this,success:function(b){var c=Ext.decode(b.responseText);a.setValues(c.formComponent)},failure:alertFailure})}},_onValidate:function(){var c=this.findByType("form")[0].getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return false}var a=this.action=="modify"?"PUT":"POST";var b=c.getFieldValues();Ext.Ajax.request({url:this.url,method:a,scope:this,jsonData:b,success:function(d){includeJs(c.items.get("fileUrlUserId").getValue());includeJs(c.items.get("fileUrlAdminId").getValue());this.store.reload();this.close()},failure:alertFailure})}});Ext.reg("s-formComponentsprop",sitools.component.formComponents.FormComponentsPropPanel);Ext.namespace("sitools.admin.datasetView");sitools.admin.datasetView.DatasetViewsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.DATASETVIEW,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_VIEWS_URL");this.store=new Ext.data.JsonStore({root:"data",restful:true,remoteSort:true,autoSave:false,url:this.url,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"jsObject",type:"string"},{name:"fileUrl",type:"string"},{name:"imageUrl",type:"string"},{name:"priority",type:"integer"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:350,sortable:false},{header:i18n.get("label.jsObject"),dataIndex:"jsObject",width:350,sortable:false},{header:i18n.get("label.priority"),dataIndex:"priority",width:50,sortable:true}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this._onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this._onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this._onDelete,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this._onModify};sitools.admin.datasetView.DatasetViewsCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.datasetView.DatasetViewsCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},_onCreate:function(){var a=new sitools.admin.datasetView.DatasetViewPropPanel({url:this.url,action:"create",store:this.store});a.show(ID.PROP.DATASETVIEW)},_onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.datasetView.DatasetViewPropPanel({url:this.url+"/"+b.id,action:"modify",store:this.store});a.show(ID.PROP.DATASETVIEW)},_onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("datasetViewsCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-datasetView",sitools.admin.datasetView.DatasetViewsCrudPanel);Ext.namespace("sitools.admin.datasetView");sitools.admin.datasetView.DatasetViewPropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,id:ID.PROP.DATAVIEW,layout:"fit",initComponent:function(){if(this.action=="create"){this.title=i18n.get("label.createDatasetView")}else{if(this.action=="modify"){this.title=i18n.get("label.modifyDatasetView")}}var a=new Ext.data.JsonStore({fields:[{name:"url",type:"string"}],autoLoad:false});var b={xtype:"sitools.widget.GridSorterToolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreateDependencies},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDeleteDependencies}]};this.gridDependencies=new Ext.grid.EditorGridPanel({title:i18n.get("title.dependencies"),height:180,store:a,tbar:b,cm:new Ext.grid.ColumnModel({columns:[{header:i18n.get("label.url"),dataIndex:"url",editor:new Ext.form.TextField({allowBlank:false})}]}),sm:new Ext.grid.RowSelectionModel({singleSelect:true}),viewConfig:{forceFit:true}});this.formPanel=new Ext.form.FormPanel({title:i18n.get("label.datasetViewInfo"),border:false,labelWidth:150,padding:10,items:[{xtype:"textfield",name:"id",hidden:true},{xtype:"textfield",name:"name",fieldLabel:i18n.get("label.name"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"description",fieldLabel:i18n.get("label.description"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"jsObject",fieldLabel:i18n.get("label.jsObject"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"fileUrl",id:"fileUrlId",fieldLabel:i18n.get("label.fileUrl"),anchor:"100%"},{xtype:"sitoolsSelectImage",name:"imageUrl",fieldLabel:i18n.get("label.image"),anchor:"100%",allowBlank:true},{xtype:"spinnerfield",name:"priority",id:"priorityId",fieldLabel:i18n.get("label.priority"),minValue:0,maxValue:10,allowDecimals:false,incrementValue:1,accelerate:true,anchor:"50%",allowBlank:false}]});this.tabPanel=new Ext.TabPanel({activeTab:0,items:[this.formPanel,this.gridDependencies],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this._onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]});this.items=[this.tabPanel];sitools.admin.datasetView.DatasetViewPropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.datasetView.DatasetViewPropPanel.superclass.onRender.apply(this,arguments);if(this.action=="modify"){var a=this.findByType("form")[0].getForm();Ext.Ajax.request({url:this.url,method:"GET",scope:this,success:function(b){var e=Ext.decode(b.responseText);a.setValues(e.datasetView);var d=e.datasetView.dependencies;var c=this.gridDependencies.getStore();if(!Ext.isEmpty(d.js)){Ext.each(d.js,function(f){c.add(new Ext.data.Record(f))},this)}if(!Ext.isEmpty(d.css)){Ext.each(d.css,function(f){c.add(new Ext.data.Record(f))},this)}},failure:alertFailure})}},_onValidate:function(){var c=this.findByType("form")[0].getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.invalidForm"));return}var a=this.action=="modify"?"PUT":"POST";var b=c.getFieldValues();b.dependencies={};b.dependencies.js=[];b.dependencies.css=[];this.gridDependencies.getStore().each(function(d){if(!Ext.isEmpty(d.data.url)){if(d.data.url.indexOf(".css")!=-1){b.dependencies.css.push({url:d.data.url})}if(d.data.url.indexOf(".js")!=-1){b.dependencies.js.push({url:d.data.url})}}});Ext.Ajax.request({url:this.url,method:a,scope:this,jsonData:b,success:function(d){this.store.reload();this.close()},failure:alertFailure})},onCreateDependencies:function(){var a=new Ext.data.Record();this.gridDependencies.getStore().insert(this.gridDependencies.getStore().getCount(),a)},onDeleteDependencies:function(){var b=this.gridDependencies.getSelectionModel().getSelections();var a,c;for(a=0;b[a];a++){c=b[a];this.gridDependencies.getStore().remove(c)}}});Ext.reg("s-datasetViewprop",sitools.admin.datasetView.DatasetViewPropPanel);Ext.namespace("sitools.admin.rssFeed");sitools.admin.rssFeed.rssFeedCrud=Ext.extend(Ext.grid.GridPanel,{border:false,pageSize:10,modify:false,forceFit:"true",initComponent:function(){this.httpProxyRss=new Ext.data.HttpProxy({url:"/tmp",restful:true,method:"GET"});this.store=new Ext.data.JsonStore({idProperty:"id",root:"data",proxy:this.httpProxyRss,fields:[{name:"id",type:"string"},{name:"title",type:"string"},{name:"description",type:"string"},{name:"link",type:"string"},{name:"feedType",type:"string"},{name:"feedSource",type:"string"},{name:"name",type:"string"}]});var a=new Ext.data.JsonStore({fields:["id","name"],url:this.url,root:"data",autoLoad:true});this.combobox=new Ext.form.ComboBox({store:a,displayField:"name",valueField:"id",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",emptyText:this.label,selectOnFocus:true,listeners:{scope:this,select:function(c,d,b){this.dataId=d.data.id;this.getTopToolbar().findById("s-filter").enable();this.loadRss()}}});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:100},{header:i18n.get("label.titleRss"),dataIndex:"title",width:150},{header:i18n.get("label.description"),dataIndex:"description",width:200},{header:i18n.get("label.linkTitle"),dataIndex:"link",width:200},{header:i18n.get("headers.type"),dataIndex:"feedType",width:50},{header:i18n.get("headers.feedSource"),dataIndex:"feedSource",width:100}]});this.tbar={xtype:"toolbar",defaults:{scope:this},items:[this.combobox,{text:i18n.get("label.add"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize,disabled:true,id:"s-filter"}]};this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.rssFeed.rssFeedCrud.superclass.initComponent.call(this)},loadRss:function(){var a=this.url+"/"+this.dataId+this.urlRef;this.httpProxyRss.setUrl(a,true);this.getStore().load({scope:this,callback:function(){this.getView().refresh()}})},onCreate:function(){if(Ext.isEmpty(this.combobox.getValue())){return}var a=new sitools.admin.rssFeed.rssFeedProps({action:"create",store:this.store,id:this.dataId,url:this.url,urlRef:this.urlRef});a.show()},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.rssFeed.rssFeedProps({action:"modify",store:this.store,id:this.dataId,url:this.url,urlRef:this.urlRef,idFeed:b.data.id});a.show()},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("feedCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+this.dataId+this.urlRef+"/"+a.data.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-rssFeedCrud",sitools.admin.rssFeed.rssFeedCrud);Ext.namespace("sitools.admin.rssFeed");sitools.admin.rssFeed.rssFeedProps=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:false,stateful:false,urlValid:false,initComponent:function(){this.crudStore=this.store;this.buttonValidUrl=new Ext.Button({text:i18n.get("label.validateUrl"),scope:this,handler:function(){this.validateUrl()},width:150,iconCls:"img-help",iconAlign:"left"});this.boxComponent=new Ext.BoxComponent({hidden:true,labelSeparator:"",fieldLabel:" ",id:"boxComponentValid",cls:"sitools-form-valid-msg",setHtml:function(c){var d=this.getEl();d.update(c)}});this.formPanel=new Ext.FormPanel({labelWidth:100,defaultType:"textfield",padding:10,height:165,title:i18n.get("title.feedDetails"),trackResetOnLoad:true,items:[{xtype:"fieldset",title:i18n.get("title.feedDetailsCommon"),autoHeight:true,defaultType:"textfield",items:[{name:"id",xtype:"hidden"},{fieldLabel:i18n.get("label.name"),name:"name",anchor:"100%",allowBlank:false},{fieldLabel:i18n.get("label.feedSource"),name:"feedSource",xtype:"radiogroup",columns:1,items:[{boxLabel:"CLASSIC",name:"feedSource",inputValue:"CLASSIC",checked:true},{boxLabel:"EXTERNAL",name:"feedSource",inputValue:"EXTERNAL"}],listeners:{scope:this,change:function(d,e){var c=e.getGroupValue();this.toogleSpecificForm(c);if(c=="CLASSIC"){this.gridPanel.setDisabled(false)}else{this.gridPanel.setDisabled(true)}this.doLayout()}}}]},{xtype:"fieldset",title:i18n.get("title.feedDetailsSpecific"),autoHeight:true,defaultType:"textfield",items:[{fieldLabel:i18n.get("label.titleRss"),name:"title",anchor:"100%"},{fieldLabel:i18n.get("label.description"),name:"description",anchor:"100%"},{fieldLabel:i18n.get("label.linkTitle"),name:"link",anchor:"100%"},{fieldLabel:i18n.get("label.authorName"),name:"authorName",anchor:"100%"},{fieldLabel:i18n.get("label.authorEmail"),name:"authorEmail",anchor:"100%"},{fieldLabel:i18n.get("label.feedType"),name:"feedType",xtype:"radiogroup",columns:1,items:[{boxLabel:"RSS",name:"feedType",inputValue:"rss_2.0",checked:true},{boxLabel:"ATOM",name:"feedType",inputValue:"atom_1.0"}]},{xtype:"compositefield",anchor:"100%",fieldLabel:i18n.get("label.url"),msgTarget:"under",hidden:true,id:"compositeFieldExternalUrl",items:[{name:"externalUrl",xtype:"textfield",anchor:"100%",flex:1,status:"pending",allowBlank:"false",vtype:"uri",validator:function(d){var c=this.status;if(c=="invalid"){return this.invalidText}else{return true}},listeners:{scope:this,change:function(c,e,d){c.fireEvent("changeStatus",c,"pending")},changeStatus:function(d,c,e){d.status=c;d.clearInvalid();var f;switch(c){case"pending":f="img-help";this.boxComponent.setVisible(false);break;case"valid":f="img-valid";break;case"invalid":this.boxComponent.setVisible(false);f="img-error";if(Ext.isEmpty(e)){d.markInvalid()}else{d.markInvalid(e);d.invalidText=e}break;default:this.boxComponent.setVisible(false);f="img-error";break}this.buttonValidUrl.setIconClass(f)}}},this.buttonValidUrl]},this.boxComponent]}]});this.storeItem=new Ext.data.JsonStore({idProperty:"id",fields:[{name:"id",type:"string"},{name:"title",type:"string"},{name:"description",type:"string"},{name:"link",type:"string"},{name:"pubDate",type:"date"}]});var a=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.titleRss"),dataIndex:"title",width:150,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:200,sortable:false},{header:i18n.get("label.linkTitle"),dataIndex:"link",width:200,sortable:false},{header:i18n.get("label.updatedDate"),dataIndex:"updatedDate",width:100,sortable:true}]});var b={xtype:"sitools.widget.GridSorterToolbar",defaults:{scope:this},items:[{text:i18n.get("label.add"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"}]};this.gridPanel=new Ext.grid.GridPanel({viewConfig:{forceFit:true},layout:"fit",title:i18n.get("title.feedItems"),store:this.storeItem,cm:a,tbar:b});this.saveButton=new Ext.Button({text:i18n.get("label.ok"),scope:this,handler:this.onValidate});this.tabPanel=new Ext.TabPanel({height:450,activeTab:0,items:[this.formPanel,this.gridPanel],buttons:[this.saveButton,{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]});this.items=[this.tabPanel];sitools.admin.rssFeed.rssFeedProps.superclass.initComponent.call(this)},onRender:function(){sitools.admin.rssFeed.rssFeedProps.superclass.onRender.apply(this,arguments);if(this.action=="create"){this.title=i18n.get("title.createFeed")}else{this.title=i18n.get("title.editFeed");Ext.Ajax.request({url:this.url+"/"+this.id+this.urlRef+"/"+this.idFeed,method:"GET",scope:this,success:function(a){var b=Ext.decode(a.responseText);if(!b.success){Ext.Msg.alert(i18n.get("label.warning"),b.message);return false}var d=b.FeedModel;this.populateForm(d);this.populateStore(d);if(d.feedSource=="OPENSEARCH"){this.gridPanel.setDisabled(true);var e=this.formPanel.getForm().findField("feedType");e.setDisabled(true)}else{if(d.feedSource=="EXTERNAL"){this.gridPanel.setDisabled(true);var c=this.formPanel.getForm().findField("externalUrl");if(!Ext.isEmpty(c.getValue())){c.fireEvent("changeStatus",c,"valid")}}}},failure:alertFailure})}},populateForm:function(c){if(c!==undefined){var b=this.formPanel.getForm();var d={};d.id=c.id;d.name=c.name;d.feedType=c.feedType;d.feedSource=c.feedSource;d.title=c.title;d.description=c.description;if(c.feedSource=="EXTERNAL"){d.externalUrl=c.externalUrl}else{d.link=c.link;if(c.author!==undefined){d.authorName=c.author.name;d.authorEmail=c.author.email}}var a=new Ext.data.Record(d);b.loadRecord(a)}},populateStore:function(d){this.storeItem.removeAll();if(d!==undefined&&d.entries!==undefined){var b;for(b=0;b<d.entries.length;b++){var c=d.entries[b];var a=new Date(c.updatedDate);c.updatedDate=a;var e=new Ext.data.Record(c);this.storeItem.add(e)}}},onValidate:function(){var d=this.formPanel.getForm();if(!d.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return}var a=d.findField("feedSource").getValue().inputValue;var c=d.findField("externalUrl");var b=c.status;if(a=="EXTERNAL"&&("pending"==b)){this.validateUrl(this.onValidateModify)}else{if(a=="EXTERNAL"&&"invalid"==b){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return}else{this.onValidateModify()}}},onValidateModify:function(){var c=this.formPanel.getForm();if(this.action=="modify"){var b=c.findField("name").getValue();var a=c.findField("name").originalValue;if(a!=b){Ext.Msg.show({title:i18n.get("label.warning"),buttons:Ext.Msg.YESNO,msg:i18n.get("rssFeedProp.warning.feedName.changed"),scope:this,fn:function(d,e){if(d=="yes"){this.onSaveFeed()}}})}else{this.onSaveFeed()}}else{this.onSaveFeed()}},onSaveFeed:function(){var e=this.formPanel.getForm();var d=e.findField("feedType");d.setDisabled(false);var l={};l.author={};Ext.iterate(e.getValues(),function(n,p){if(n=="authorName"){l.author.name=p}else{if(n=="authorEmail"){l.author.email=p}else{l[n]=p}}},this);if(l.feedSource=="EXTERNAL"){l.title=e.findField("title").getValue();l.description=e.findField("description").getValue()}l.entries=[];if(l.feedSource=="CLASSIC"){var k;for(k=0;k<this.storeItem.getCount();k++){var g=this.storeItem.getAt(k).copy().data;var f=g.updatedDate;if(f!==null&&f!==undefined){var m=new Date(f);g.updatedDate=m.format("Y-m-d\\TH:i:s.u")+m.getGMTOffset()}f=g.publishedDate;if(f!==null&&f!==undefined){var b=new Date(f);g.publishedDate=b.format("Y-m-d\\TH:i:s.u")+b.getGMTOffset()}l.entries.push(g)}}var c=this.url+"/"+this.id+this.urlRef;var a;if(this.action=="create"){a="POST"}else{a="PUT";c+="/"+this.idFeed}Ext.Ajax.request({url:c,method:a,scope:this,jsonData:l,success:function(n){var p=Ext.decode(n.responseText);if(!p.success){Ext.Msg.alert(i18n.get("label.warning"),i18n.get(p.message));return false}this.store.reload();this.close()},failure:alertFailure})},toogleSpecificForm:function(a){var c=(a=="CLASSIC");var b=this.formPanel.getForm();b.findField("title").setDisabled(!c);b.findField("title").setVisible(c);b.findField("description").setDisabled(!c);b.findField("description").setVisible(c);b.findField("link").setDisabled(!c);b.findField("link").setVisible(c);b.findField("authorName").setDisabled(!c);b.findField("authorName").setVisible(c);b.findField("authorEmail").setDisabled(!c);b.findField("authorEmail").setVisible(c);b.findField("authorEmail").setDisabled(!c);b.findField("authorEmail").setVisible(c);b.findField("feedType").setVisible(c);Ext.getCmp("boxComponentValid").setDisabled(c);Ext.getCmp("boxComponentValid").setVisible(!c);Ext.getCmp("compositeFieldExternalUrl").setDisabled(c);Ext.getCmp("compositeFieldExternalUrl").setVisible(!c)},onCreate:function(){var a=new sitools.admin.rssFeed.rssFeedItemProps({store:this.storeItem,parent:this.gridPanel,action:"create"});a.show()},onModify:function(){var b=this.gridPanel.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.rssFeed.rssFeedItemProps({store:this.storeItem,parent:this.gridPanel,action:"modify",rec:b});a.show()},onDelete:function(){var a=this.gridPanel.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}this.storeItem.remove(a)},validateUrl:function(a){var c=this.formPanel.getForm().findField("externalUrl");if(c.isValid()){var d=c.getValue();var b="/sitools/proxy";this.saveButton.disable();this.buttonValidUrl.disable();this.buttonValidUrl.setIconClass("img-loading");Ext.Ajax.request({url:b,method:"GET",scope:this,doNotHandleRequestexception:true,params:{external_url:d},success:function(q){var t=q.responseXML;var r=false,k=false;var s=null,p=null;if(!Ext.isEmpty(t)){s=Ext.DomQuery.selectNode("rss",t);p=Ext.DomQuery.selectNode("feed",t);r=!Ext.isEmpty(s);k=!Ext.isEmpty(p)}var l=this.formPanel.getForm();var g=l.findField("feedType");var e=l.findField("externalUrl");if(r){g.setValue("rss_2.0")}else{if(k){g.setValue("atom_1.0")}}if(r||k){this.boxComponent.setHtml(String.format(i18n.get("label.feedTypeDetected"),g.getValue().inputValue));this.boxComponent.setVisible(true);var n=(r)?s:p;var m=Ext.DomQuery.selectNode("title",n);var f=Ext.DomQuery.selectNode("description",n);if(m){l.findField("title").setValue(m.textContent)}if(f){l.findField("description").setValue(f.textContent)}e.fireEvent("changeStatus",e,"valid");if(Ext.isFunction(a)){a.call(this)}}else{e.fireEvent("changeStatus",e,"invalid",i18n.get("label.incompatible.feed.type"))}},failure:function(e,f){this.urlValid=false;var g=this.formPanel.getForm().findField("externalUrl");g.fireEvent("changeStatus",g,"invalid",i18n.get("label.urlInvalid"))},callback:function(f,g,e){this.saveButton.enable();this.buttonValidUrl.enable()}})}}});Ext.namespace("sitools.admin.rssFeed");sitools.admin.rssFeed.rssFeedItemProps=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:false,layout:"fit",initComponent:function(){this.title=i18n.get("title.feedItemDetails");var a=[{fieldLabel:i18n.get("label.titleRss"),name:"title",anchor:"100%"},{fieldLabel:i18n.get("label.description"),name:"description",anchor:"100%",xtype:"textarea"},{fieldLabel:i18n.get("label.linkTitle"),name:"link",anchor:"100%"},{xtype:"sitoolsSelectImage",fieldLabel:i18n.get("label.image"),name:"image",anchor:"100%"},{fieldLabel:i18n.get("label.authorName"),name:"name",anchor:"100%"},{fieldLabel:i18n.get("label.authorEmail"),name:"email",anchor:"100%"},{xtype:"compositefield",fieldLabel:i18n.get("label.updatedDate"),items:[{fieldLabel:i18n.get("label.day"),name:"date",xtype:"datefield"},{name:"hours",xtype:"numberfield",width:48,maxValue:23,minValue:0},{xtype:"displayfield",value:i18n.get("label.hours")},{name:"minutes",xtype:"numberfield",width:48,maxValue:59,minValue:0},{xtype:"displayfield",value:i18n.get("label.minutes")},{xtype:"button",name:"nowUpdated",text:i18n.get("label.now"),width:50,flex:0,scope:this,handler:this.nowDate}]},{xtype:"compositefield",fieldLabel:i18n.get("label.publishedDate"),items:[{fieldLabel:i18n.get("label.day"),name:"datePub",xtype:"datefield",allowBlank:false},{name:"hoursPub",xtype:"numberfield",width:48,maxValue:23,minValue:0,allowBlank:false},{xtype:"displayfield",value:i18n.get("label.hours")},{name:"minutesPub",xtype:"numberfield",width:48,maxValue:59,minValue:0,allowBlank:false},{xtype:"displayfield",value:i18n.get("label.minutes")},{xtype:"button",name:"nowPublished",text:i18n.get("label.now"),width:50,flex:0,scope:this,handler:this.nowDate}]}];this.formPanel=new Ext.FormPanel({labelWidth:100,defaultType:"textfield",items:a,border:false,padding:10});this.items=[this.formPanel];this.buttons=[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}];sitools.admin.rssFeed.rssFeedItemProps.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.rssFeed.rssFeedItemProps.superclass.afterRender.apply(this,arguments);if(this.action=="modify"){var f=this.formPanel.getForm();var a=this.rec.copy();Ext.data.Record.id(a);var b=this.rec.get("updatedDate");var c=new Date(b);a.set("date",c.format("m/d/Y"));a.set("hours",c.format("H"));a.set("minutes",c.format("i"));var d=this.rec.get("publishedDate");var g=new Date(d);a.set("datePub",g.format("m/d/Y"));a.set("hoursPub",g.format("H"));a.set("minutesPub",g.format("i"));var e=a.get("author");if(!Ext.isEmpty(e)){a.set("name",e.name);a.set("email",e.email)}if(!Ext.isEmpty(a.get("image"))){a.set("image",a.get("image").url)}f.loadRecord(a)}},onValidate:function(){var l=this.findByType("form")[0].getForm();if(!l.isValid()){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.invalidForm"));return}var g;if(this.action=="create"){g=new Ext.data.Record()}else{g=this.rec}var b=this.formPanel.getForm();if(!b.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return false}var c=null;var m=null;var f=null;var d=null;var n=null;var a=null;var k={};g.set("author",k);Ext.iterate(b.getValues(),function(p,r){if(p=="date"){f=r}else{if(p=="hours"){m=r}else{if(p=="minutes"){c=r}else{if(p=="datePub"){a=r}else{if(p=="hoursPub"){n=r}else{if(p=="minutesPub"){d=r}else{if(p=="name"||p=="email"){k[p]=r}else{if(p=="image"){if(!Ext.isEmpty(r)){var q=this.getTypeFromUrl(r);g.set(p,{url:r,type:q})}}else{g.set(p,r)}}}}}}}}},this);var e;if(f!==null&&f!==""){if(m!==null&&c!==null){f+=" "+m+":"+c}e=new Date(f);g.set("updatedDate",e)}if(a!==null&&a!==""){if(n!==null&&n!==""&&d!==null&&d!==""){a+=" "+n+":"+d}e=new Date(a);g.set("publishedDate",e)}if(this.action=="create"){this.store.add(g)}this.parent.getView().refresh();this.close()},nowDate:function(c,f){var b=new Date(),d,a;if(c.name=="nowUpdated"){d=this.formPanel.getForm();a=new Ext.data.Record(d.getValues());a.set("date",b.format("m/d/Y"));a.set("hours",b.format("H"));a.set("minutes",b.format("i"));d.loadRecord(a)}if(c.name=="nowPublished"){d=this.formPanel.getForm();a=new Ext.data.Record(d.getValues());a.set("datePub",b.format("m/d/Y"));a.set("hoursPub",b.format("H"));a.set("minutesPub",b.format("i"));d.loadRecord(a)}},getTypeFromUrl:function(a){var b=a.split(".");var c=b[b.length-1];switch(c.toLowerCase()){case"jpg":case"jpeg":case"jpe":c="image/jpeg";break;case"gif":case"man":c="image/gif";break;case"png":c="image/png";break;case"tif":case"tiff":c="image/tiff";break;case"pbm":c="image/x-portable-bitmap";break;case"pgm":c="image/x-portable-graymap";break;case"ppm":c="image/x-portable-pixmap";break;default:c=null}return c}});Ext.namespace("sitools.component.projects");sitools.component.projects.rssFeedProject=Ext.extend(Ext.Panel,{border:false,height:300,id:ID.BOX.RSSPROJECT,layout:"fit",initComponent:function(){var a=new sitools.admin.rssFeed.rssFeedCrud({url:loadUrl.get("APP_URL")+loadUrl.get("APP_PROJECTS_URL"),label:i18n.get("label.selectProject"),urlRef:loadUrl.get("APP_FEEDS_URL")});this.items=[a];sitools.component.projects.rssFeedProject.superclass.initComponent.call(this)}});Ext.reg("s-rssFeedProjects",sitools.component.projects.rssFeedProject);Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.rssFeedDatasets=Ext.extend(Ext.Panel,{border:false,height:300,id:ID.BOX.RSSPROJECT,layout:"fit",initComponent:function(){var a=new sitools.admin.rssFeed.rssFeedCrud({url:loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_URL"),label:i18n.get("label.selectDatasets"),urlRef:loadUrl.get("APP_FEEDS_URL")});this.items=[a];sitools.admin.datasets.rssFeedDatasets.superclass.initComponent.call(this)}});Ext.reg("s-rssFeedDatasets",sitools.admin.datasets.rssFeedDatasets);Ext.namespace("sitools.component.portal");sitools.component.portal.rssFeedPortalCrud=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.RSSPORTAL,pageSize:10,label:i18n.get("label.selectPortal"),forceFit:"true",initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_PORTAL_URL");this.urlRef=loadUrl.get("APP_FEEDS_URL");this.httpProxyRss=new Ext.data.HttpProxy({url:"/tmp",restful:true,method:"GET"});this.store=new Ext.data.JsonStore({idProperty:"id",root:"data",proxy:this.httpProxyRss,fields:[{name:"id",type:"string"},{name:"title",type:"string"},{name:"description",type:"string"},{name:"link",type:"string"},{name:"feedType",type:"string"},{name:"visible",type:"boolean"},{name:"feedSource",type:"string"},{name:"externalUrl",type:"string"}]});var a=new Ext.grid.CheckColumn({header:i18n.get("headers.visible"),dataIndex:"visible",width:80});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.titleRss"),dataIndex:"title",width:150},{header:i18n.get("label.description"),dataIndex:"description",width:150},{header:i18n.get("label.url"),dataIndex:"externalUrl",width:150},{header:i18n.get("headers.type"),dataIndex:"feedType",width:50},a,{header:i18n.get("headers.feedSource"),dataIndex:"feedSource",width:100}]});this.plugins=[a];this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.save"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/save.png",handler:this.onSave,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.dataId="idPortal";this.loadRss();sitools.component.portal.rssFeedPortalCrud.superclass.initComponent.call(this)},loadRss:function(){var a=this.url+"/"+this.dataId+this.urlRef;this.httpProxyRss.setUrl(a,true);this.getStore().load({scope:this,callback:function(){this.getView().refresh()}})},onSave:function(){var c={};c.feeds=[];var b;for(b=0;b<this.store.getCount();b++){var d=this.store.getAt(b).data;c.feeds.push(d)}var a=this.url+"/"+this.dataId+this.urlRef;Ext.Ajax.request({url:a,method:"PUT",scope:this,jsonData:c,success:function(e){var g=Ext.decode(e.responseText);if(!g.success){Ext.Msg.alert(i18n.get("label.warning"),g.message);return false}var f=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.feedsSaved"),autoDestroy:true,hideDelay:1000}).show(document);this.store.load()}})}});Ext.reg("s-rssFeedPortal",sitools.component.portal.rssFeedPortalCrud);Ext.namespace("sitools.admin.applications.plugins");sitools.admin.applications.plugins.ApplicationPluginCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.APPLICATIONPLUGIN,pageSize:10,modify:false,urlGrid:null,conflictWarned:false,viewConfig:{forceFit:true,autoFill:true,getRowClass:function(d,b){var a="";var c=d.data;if(c.classVersion!==c.currentClassVersion&&c.currentClassVersion!==null&&c.currentClassVersion!==undefined){if(!this.conflictWarned){Ext.Msg.alert("warning.version.conflict","Application plugin "+c.name+"definition (v"+c.classVersion+") may conflict with current class version : "+c.currentClassVersion);this.conflictWarned=true}a="red-row"}return a}},initComponent:function(){this.urlAdmin=loadUrl.get("APP_URL")+loadUrl.get("APP_PLUGINS_APPLICATIONS_URL")+"/instances";this.urlList=loadUrl.get("APP_URL")+loadUrl.get("APP_PLUGINS_APPLICATIONS_URL")+"/classes";this.httpProxyForms=new Ext.data.HttpProxy({url:this.urlAdmin,restful:true,method:"GET"});this.store=new Ext.data.JsonStore({idProperty:"id",root:"data",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"className",type:"string"},{name:"status",type:"string"},{name:"label",type:"string"},{name:"urlAttach",type:"string"},{name:"classVersion",type:"string"},{name:"classAuthor",type:"string"},{name:"currentClassVersion",type:"string"},{name:"currentClassAuthor",type:"string"},{name:"classOwner",type:"string"}],proxy:this.httpProxyForms});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:150},{header:i18n.get("label.description"),dataIndex:"description",width:200,sortable:false},{header:i18n.get("label.label"),dataIndex:"label",width:100,sortable:false},{header:i18n.get("label.urlAttach"),dataIndex:"urlAttach",width:100,sortable:false},{header:i18n.get("label.status"),dataIndex:"status",width:100,sortable:false},{header:i18n.get("label.className"),dataIndex:"className",width:150,sortable:false},{header:i18n.get("label.classVersion"),dataIndex:"classVersion",width:50,sortable:false},{header:i18n.get("label.currentClassVersion"),dataIndex:"currentClassVersion",width:50,sortable:false},{header:i18n.get("label.classAuthor"),dataIndex:"classAuthor",width:100,sortable:false},{header:i18n.get("label.classOwner"),dataIndex:"classOwner",width:100,sortable:false}]});this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.add"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},{text:i18n.get("label.active"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_active.png",handler:this._onActive,xtype:"s-menuButton"},{text:i18n.get("label.disactive"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_disactive.png",handler:this._onDisactive,xtype:"s-menuButton"}]};this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.applications.plugins.ApplicationPluginCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.applications.plugins.ApplicationPluginCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.admin.applications.plugins.applicationPluginProp({action:"create",parent:this,urlList:this.urlList,urlAdmin:this.urlAdmin});a.show()},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}if("ACTIVE"===b.data.status){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.wrongStatus"));return}var a=new sitools.admin.applications.plugins.applicationPluginProp({action:"modify",record:b,parent:this,urlList:this.urlList,urlAdmin:this.urlAdmin});a.show()},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:{yes:i18n.get("label.yes"),no:i18n.get("label.no")},msg:i18n.get("applicationPluginCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.urlAdmin+"/"+a.id,method:"DELETE",scope:this,success:function(c){var b=Ext.decode(c.responseText);if(showResponse(c)){this.store.reload()}},failure:alertFailure})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.urlAdmin+"/"+a.id+"/start",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.urlAdmin+"/"+a.id+"/stop",method:"PUT",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-Application_plugins",sitools.admin.applications.plugins.ApplicationPluginCrudPanel);Ext.namespace("sitools.admin.applications.plugins");sitools.admin.applications.plugins.applicationPluginProp=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:true,classChosen:"",applicationPluginId:null,initComponent:function(){this.title=this.action=="create"?i18n.get("label.createApplicationPlugin"):i18n.get("label.modifyApplicationPlugin");this.crudStore=this.store;var a=new Ext.ux.grid.RowExpander({tpl:new Ext.XTemplate('<tpl if="this.descEmpty(description)" ><div></div></tpl>','<tpl if="this.descEmpty(description) == false" ><div class="sitoolsDescription"><div class="sitoolsDescriptionHeader">Description :&nbsp;</div><p class="sitoolsDescriptionText"> {description} </p></div></tpl>',{compiled:true,descEmpty:function(b){return Ext.isEmpty(b)}}),expandOnDblClick:true});this.gridapplicationPlugin=new Ext.grid.GridPanel({viewConfig:{forceFit:true},id:"gridapplicationPlugin",title:i18n.get("title.applicationPluginClass"),store:new Ext.data.JsonStore({root:"data",restful:true,proxy:new Ext.data.HttpProxy({url:this.urlList,restful:true,method:"GET"}),remoteSort:false,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"className",type:"string"},{name:"classAuthor",type:"string"},{name:"classOwner",type:"string"},{name:"classVersion",type:"string"},{name:"classOwner",type:"string"},{name:"violation"}],autoLoad:true}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[a,{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:300,sortable:true},{header:i18n.get("label.className"),dataIndex:"className",width:300,sortable:true},{header:i18n.get("label.author"),dataIndex:"classAuthor",width:100,sortable:true},{header:i18n.get("label.classOwner"),dataIndex:"classOwner",width:100,sortable:false},{header:i18n.get("label.version"),dataIndex:"classVersion",width:100,sortable:true}]}),bbar:new Ext.ux.StatusBar({id:"statusBar",hidden:true,iconCls:"x-status-error",text:i18n.get("label.filterErrorValidationNotification")}),listeners:{scope:this,rowclick:this.onClassClick},plugins:a});this.fieldMappingFormPanel=new Ext.FormPanel({padding:10,id:"fieldMappingFormPanel",defaultType:"textfield",title:i18n.get("title.applicationPluginDetails"),items:[{fieldLabel:i18n.get("label.label"),name:"label",anchor:"100%"},{fieldLabel:i18n.get("label.userAttach"),name:"urlAttach",anchor:"100%",vtype:"attachment",allowBlank:false}]});this.proxyFieldMapping=new Ext.data.HttpProxy({url:"/tmp",restful:true,method:"GET"});this.gridFieldMapping=new Ext.grid.EditorGridPanel({viewConfig:{forceFit:true,scope:this,getRowClass:function(c,f,g,e){var b="";var d=c.get("violation");if(!Ext.isEmpty(d)){if(d.level=="CRITICAL"){b="red-row"}else{if(d.level=="WARNING"){b="orange-row"}}}return b},listeners:{scope:this,refresh:function(b){var d=this.gridFieldMapping;var c=d.getStore();c.each(function(l){var m=l.get("violation");if(!Ext.isEmpty(m)){var n=c.indexOf(l);var g=b.getRow(n);var p=Ext.get(g);var k=(m.level=="CRITICAL")?"x-form-invalid-tip":"x-form-invalid-tip x-form-warning-tip";var f={html:m.message,dismissDelay:0,target:p,cls:k};var e=new Ext.ToolTip(f)}})}}},id:"gridFieldMapping",layout:"fit",title:i18n.get("title.parametersMapping"),store:new Ext.data.JsonStore({root:"ApplicationPlugin.model.parameters",proxy:this.proxyFieldMapping,restful:true,remoteSort:false,idProperty:"name",fields:[{name:"name",type:"string"},{name:"description",type:"string"},{name:"value",type:"string"},{name:"valueType",type:"string"}]}),bbar:new Ext.ux.StatusBar({id:"statusBar",hidden:true,iconCls:"x-status-error",text:i18n.get("label.applicationPluginErrorValidationNotification")}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:200,sortable:false},{header:i18n.get("label.value"),dataIndex:"value",width:100,sortable:false,editable:true,editor:new Ext.form.TextField()}]}),listeners:{scope:this,celldblclick:function(b,n,g,f){var k=b.getStore().getAt(n);var d=k.data;if(b.getColumnModel().getColumnHeader(g)=="Value"){if(d.valueType=="xs:dictionary"){var m=new sitools.component.dictionary.selectDictionary({field:"value",record:k,parentStore:this.gridFieldMapping.getStore(),parentView:this.gridFieldMapping.getView(),url:loadUrl.get("APP_URL")+loadUrl.get("APP_DICTIONARIES_URL")});m.show(ID.BOX.DATASETS)}else{if(d.valueType=="xs:boolean"){var q=new sitools.admin.resourcesPlugins.enumerationValueTypeSelector({field:"value",record:k,parentView:this.gridFieldMapping.getView(),type:d.name,enumeration:"[true,false]",value:d.value});q.show(ID.BOX.DATASETS)}else{if(d.valueType=="xs:image"){var p=new ImageChooser({url:loadUrl.get("APP_URL")+loadUrl.get("APP_UPLOAD_URL")+"/?media=json",width:515,height:450,field:"value",parentView:this.gridFieldMapping.getView(),record:k});p.show(document,function(r,e){e.record.data[e.field]=r.url;e.parentView.refresh()})}else{if(d.valueType.indexOf("xs:enum")!=-1){var c;if(d.valueType.indexOf("xs:enum-editable-multiple")!=-1){c="EEM"}else{if(d.valueType.indexOf("xs:enum-editable")!=-1){c="EE"}else{if(d.valueType.indexOf("xs:enum-multiple")!=-1){c="EM"}else{c="E"}}}var l=new sitools.admin.resourcesPlugins.enumerationValueTypeSelector({enumType:c,field:"value",fieldEnum:"valueType",record:k,parentView:this.gridFieldMapping.getView(),type:d.name,enumeration:d.valueType,value:d.value});l.show(ID.BOX.DATASETS)}}}}}else{return false}}}});this.tabPanel=new Ext.TabPanel({activeTab:0,items:(this.action=="create")?[this.gridapplicationPlugin,this.fieldMappingFormPanel,this.gridFieldMapping]:[this.fieldMappingFormPanel,this.gridFieldMapping],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.listeners={scope:this,resize:function(e,d,b){var c=e.body.getSize();this.tabPanel.setSize(c)}};this.items=[this.tabPanel];sitools.admin.applications.plugins.applicationPluginProp.superclass.initComponent.call(this)},beforeTabChange:function(a,e,d){if(this.action=="create"){if(e.id=="fieldMappingFormPanel"||e.id=="gridFieldMapping"){var c=this.gridapplicationPlugin.getSelectionModel().getSelected();if(!c){var b=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}}}},onClassClick:function(b,g,d){if(this.action=="create"){var f=this.gridapplicationPlugin.getSelectionModel().getSelected();if(!f){return false}var c=f.data.className;if(c!=this.classChosen){this.proxyFieldMapping.setUrl(this.urlList+"/"+c);var a=this.gridFieldMapping.getStore();this.classChosen=c;a.removeAll();a.load()}}},afterRender:function(){sitools.admin.applications.plugins.applicationPluginProp.superclass.afterRender.apply(this,arguments);if(this.action=="modify"){this.applicationPluginId=this.record.data.id;Ext.Ajax.request({url:this.urlAdmin+"/"+this.applicationPluginId,method:"GET",scope:this,success:function(a){var b=Ext.decode(a.responseText);if(!b.success){Ext.Msg.alert(i18n.get("label.warning"),b.message);return false}this.fillFormAndGrid(b.ApplicationPluginModel)},failure:alertFailure})}},fillFormAndGrid:function(g){var d=this.fieldMappingFormPanel.getForm();if(!Ext.isEmpty(g)){var e={};e.label=g.label;e.urlAttach=g.urlAttach;d.loadRecord(new Ext.data.Record(e));var c=g.parameters;if(!Ext.isEmpty(c)){var a=this.gridFieldMapping.getStore();for(var b=0;b<c.length;b++){var f=new Ext.data.Record(c[b]);a.add(f)}}}},onValidate:function(){var e;var d={};if(this.action=="create"){e=this.gridapplicationPlugin.getSelectionModel().getSelected();if(!e){var k=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}d.name=e.data.name;d.description=e.data.description}var c=this.fieldMappingFormPanel.getForm();if(!c.isValid()){var n=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.invalidForm"),autoDestroy:true,hideDelay:1000}).show(document);return false}Ext.iterate(c.getFieldValues(),function(q,r){d[q]=r});var m=[];var g;if(this.action=="create"){e=this.gridapplicationPlugin.getSelectionModel().getSelected();g=e.data}else{g=this.record.data;d.id=this.applicationPluginId}d.className=g.className;d.classVersion=g.classVersion;d.classAuthor=g.classAuthor;d.classOwner=g.classOwner;var p=this.gridFieldMapping.getStore();for(var f=0;f<p.getCount();f++){var l=p.getAt(f).data;l.violation=undefined;m.push(l)}d.parameters=m;var b=this.urlAdmin,a;if(this.action=="modify"){b+="/"+this.applicationPluginId;a="PUT"}else{a="POST"}Ext.Ajax.request({url:b,method:a,scope:this,jsonData:d,success:function(r){var t=Ext.decode(r.responseText);if(!t.success){if(Ext.isEmpty(t.message)){var q=t.data;this.notifyViolations(q);Ext.getCmp("statusBar").show()}else{Ext.Msg.alert(i18n.get("label.warning"),t.message)}return false}var s=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.applicationPluginSaved"),autoDestroy:true,hideDelay:1000}).show(document);this.parent.getStore().reload();this.close()},failure:alertFailure})},notifyViolations:function(d){for(var e=0;e<d.length;e++){var c=d[e];var b=this.gridFieldMapping.getStore();var a=b.findExact("name",c.valueName);var f=b.getAt(a);f.set("violation",c)}this.gridFieldMapping.getView().refresh()}});Ext.namespace("sitools.admin.storages");sitools.admin.storages.storagesCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.STORAGES,sm:new Ext.grid.RowSelectionModel(),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASTORAGE_ADMIN_URL")+"/directories";this.urlAuthorizations=loadUrl.get("APP_URL")+loadUrl.get("APP_AUTHORIZATIONS_URL");this.urlFilters=loadUrl.get("APP_URL")+loadUrl.get("APP_PLUGINS_FILTERS_CLASSES_URL");this.urlParents=loadUrl.get("APP_URL")+loadUrl.get("APP_PLUGINS_FILTERS_INSTANCES_URL");this.store=new Ext.data.JsonStore({root:"data",restful:true,url:this.url,remoteSort:true,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"localPath",type:"string"},{name:"publicUrl",type:"string"},{name:"attachUrl",type:"string"},{name:"deeplyAccessible",type:"boolean"},{name:"listingAllowed",type:"boolean"},{name:"modifiable",type:"boolean"},{name:"status",type:"string"}]});var b=new Ext.grid.CheckColumn({header:i18n.get("label.deeplyAccessible"),dataIndex:"deeplyAccessible",width:80,tooltip:i18n.get("label.deeplyAccessible")});var c=new Ext.grid.CheckColumn({header:i18n.get("label.listingAllowed"),dataIndex:"listingAllowed",width:55,tooltip:i18n.get("label.listingAllowed")});var a=new Ext.grid.CheckColumn({header:i18n.get("label.modifiable"),dataIndex:"modifiable",width:55,tooltip:i18n.get("label.modifiable")});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:false},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:50,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:120},{header:i18n.get("label.localPath"),dataIndex:"localPath",width:150},{header:i18n.get("label.attachUrl"),dataIndex:"attachUrl",width:150},b,c,a,{header:i18n.get("label.status"),dataIndex:"status",width:50}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},{text:i18n.get("label.authorizations"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_autorizations.png",handler:this.onDefineRole,xtype:"s-menuButton"},{text:i18n.get("label.customfilter"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/filters.png",xtype:"s-menuButton",handler:this.onDefineFilter},{text:i18n.get("label.active"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_active.png",handler:this.onActive,xtype:"s-menuButton"},{text:i18n.get("label.disactive"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_disactive.png",handler:this.onDisactive,xtype:"s-menuButton"},{text:i18n.get("label.storageCopy"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/converter.png",handler:this.onCopy,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.storages.storagesCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.storages.storagesCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onDefineRole:function(){var b=this.getSelectionModel().getSelected(),a=new sitools.admin.applications.applicationsRolePanel({urlAuthorizations:this.urlAuthorizations+"/"+b.data.id,applicationRecord:b});if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}if(b.data.status=="STARTED"){return Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.wrongStatus"))}a.show(ID.BOX.APPLICATION)},onDefineFilter:function(a,b){var c=this.getSelectionModel().getSelected();if(!c){return Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.noselection"))}if(c.data.status=="STARTED"){return Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.wrongStatus"))}Ext.Ajax.request({url:this.url+"/"+c.data.id+"/filter",method:"GET",scope:this,success:function(e){var g=Ext.decode(e.responseText),f;if(g.success){f="editDelete"}else{f="create"}var k=g.filterPlugin;var d=new sitools.component.filtersPlugins.filtersPluginsSingle({action:f,parentPanel:this,urlFilters:this.urlFilters,urlParent:this.urlParents+"/"+c.data.id,parentType:"storage",filterPlugin:k});d.show()},failure:alertFailure})},onCreate:function(){var a=new sitools.admin.storages.storagesPropPanel({url:this.url,action:"create",store:this.getStore()});a.show()},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.storages.storagesPropPanel({url:this.url+"/"+b.id,action:"modify",store:this.getStore()});a.show()},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("storageCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(c){var b=Ext.decode(c.responseText);if(showResponse(c)){this.store.reload()}},failure:alertFailure})},onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"?action=start",method:"PUT",scope:this,success:function(c){var b=Ext.decode(c.responseText);if(showResponse(c)){this.store.reload()}},failure:alertFailure})},onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Ajax.request({url:this.url+"/"+a.id+"?action=stop",method:"PUT",scope:this,success:function(c){var b=Ext.decode(c.responseText);if(showResponse(c)){this.store.reload()}},failure:alertFailure})},onCopy:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.storages.storageCopyProp({urlDirectories:this.url,idSrc:b.id,store:this.getStore()});a.show()}});Ext.reg("s-storages",sitools.admin.storages.storagesCrudPanel);Ext.namespace("sitools.admin.storages");sitools.admin.storages.storagesPropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,dataSets:"",id:ID.COMPONENT_SETUP.STORAGE,initComponent:function(){if(this.action=="modify"){this.title=i18n.get("label.modifyStorage")}if(this.action=="create"){this.title=i18n.get("label.createStorage")}this.items=[{xtype:"panel",height:450,items:[{xtype:"panel",height:410,title:i18n.get("label.storageInfo"),items:[{xtype:"form",border:false,padding:10,items:[{xtype:"hidden",name:"id"},{xtype:"textfield",name:"name",fieldLabel:i18n.get("label.name"),anchor:"100%",maxLength:30,allowBlank:false},{xtype:"textfield",name:"description",fieldLabel:i18n.get("label.description"),anchor:"100%",maxLength:100},{xtype:"textfield",name:"localPath",fieldLabel:i18n.get("label.localPath"),allowBlank:false,anchor:"100%",maxLength:100},{xtype:"textfield",name:"attachUrl",fieldLabel:i18n.get("label.attachUrl"),anchor:"100%",maxLength:100,vtype:"attachment",allowBlank:false},{xtype:"checkbox",fieldLabel:i18n.get("label.deeplyAccessible"),name:"deeplyAccessible"},{xtype:"checkbox",fieldLabel:i18n.get("label.listingAllowed"),name:"listingAllowed"},{xtype:"checkbox",fieldLabel:i18n.get("label.modifiable"),name:"modifiable"}]}]}],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];sitools.admin.storages.storagesPropPanel.superclass.initComponent.call(this)},onValidate:function(){var a=this.findByType("form")[0].getForm();if(!a.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return false}var b={};Ext.iterate(a.getFieldValues(),function(c,d){b[c]=d},this);if(b.localPath.match("file:///")==null){b.localPath="file:///"+b.localPath}if(this.action=="modify"){Ext.Ajax.request({url:this.url,method:"PUT",scope:this,jsonData:b,success:function(d){var c=Ext.decode(d.responseText);if(showResponse(d)){this.close();this.store.reload()}},failure:alertFailure})}if(this.action=="create"){Ext.Ajax.request({url:this.url,method:"POST",scope:this,jsonData:b,success:function(d){var c=Ext.decode(d.responseText);if(showResponse(d)){this.close();this.store.reload()}},failure:alertFailure})}},onRender:function(){sitools.admin.storages.storagesPropPanel.superclass.onRender.apply(this,arguments);if(this.url){if(this.action=="modify"){Ext.Ajax.request({url:this.url,method:"GET",scope:this,success:function(b){var d=this.findByType("form")[0].getForm();var c=Ext.decode(b.responseText).directory;var a=new Ext.data.Record(c);d.loadRecord(a)},failure:function(a){var b=Ext.decode(a.responseText);Ext.Msg.alert(i18n.get("label.warning"),b.errorMessage)}})}}}});Ext.reg("s-storagesprop",sitools.admin.storages.storagesPropPanel);Ext.namespace("sitools.admin.datasets.services");sitools.admin.datasets.services.datasetServicesCrud=Ext.extend(Ext.grid.EditorGridPanel,{border:false,height:300,pageSize:10,modify:false,urlGrid:null,conflictWarned:false,clicksToEdit:1,viewConfig:{forceFit:true,autoFill:true,allLoaded:false,getRowClass:function(f,c,d,b){var a="";if(this.allLoaded){if(c===0){this.message=""}var e=f.data;if(e.modelVersion!==e.definitionVersion&&!Ext.isEmpty(e.definitionVersion)){this.message+="Resources "+e.name+" definition (v"+e.modelVersion+") may conflict with current class version : "+e.definitionVersion+"<br/>";a="red-row"}if(!this.conflictWarned&&!Ext.isEmpty(this.message)&&c===b.getCount()-1){Ext.Msg.alert("warning.version.conflict",this.message);this.conflictWarned=true}}return a}},initComponent:function(){this.appClassName="fr.cnes.sitools.dataset.DataSetApplication";this.parentType="dataset";this.urlDatasets=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_URL");this.urlAllServicesIHM="/sitools/guiServices";this.urlAllServicesSERVER="/sitools/plugins/resources/classes";this.urlDatasetAllServices="/sitools/datasets/{idDataset}/services";this.urlDatasetAllServicesIHM="/sitools/datasets/{idDataset}/services/gui";this.urlDatasetAllServicesSERVER="/sitools/datasets/{idDataset}/services/server";this.urlDatasetServiceIHM="/sitools/datasets/{idDataset}/services/gui/{idService}";this.urlDatasetServiceSERVER="/sitools/datasets/{idDataset}/services/server/{idService}";this.storeParents=new Ext.data.JsonStore({fields:["id","name","type","sitoolsAttachementForUsers"],url:this.urlDatasets,root:"data",autoLoad:true});this.comboParents=new Ext.form.ComboBox({store:this.storeParents,displayField:"name",valueField:"id",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",emptyText:i18n.get("label.select"+this.parentType+"s"),selectOnFocus:true,listeners:{scope:this,select:function(d,e,c){this.parentId=e.data.id;if(!Ext.isEmpty(e.data.type)){this.appClassName=e.data.type}this.savePropertiesBtn.removeClass("not-save-textfield");var b=this.urlDatasetAllServices.replace("{idDataset}",this.parentId);this.httpProxyResources.setUrl(b,true);this.getStore().removeAll();this.getStore().load()}}});this.httpProxyResources=new Ext.data.HttpProxy({url:"/tmp",restful:true,method:"GET"});this.store=new Ext.data.JsonStore({idProperty:"id",root:"ServiceCollectionModel.services",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"type",type:"string"},{name:"category",type:"string"},{name:"icon",type:"string"},{name:"label",type:"string"},{name:"visible",type:"bool"},{name:"position",type:"string"},{name:"dataSetSelection"},{name:"modelVersion",type:"string"},{name:"definitionVersion",type:"string"}],proxy:this.httpProxyResources,listeners:{scope:this,beforeLoad:function(){this.getView().allLoaded=false;this.getView().conflictWarned=false},load:this.loadServerPluginClassDescription}});var a=new Ext.grid.CheckColumn({header:i18n.get("headers.visible")+' <img title="Editable" height=14 widht=14 src="/sitools/common/res/images/icons/toolbar_edit.png"/>',dataIndex:"visible",width:55,listeners:{scope:this,change:function(d,c,b){this.savePropertiesBtn.addClass("not-save-textfield")}}});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.type"),dataIndex:"type",width:60,resizable:false,renderer:function(f,e,b,g,d,c){if(f==="SERVER"){e.style+="font-weight:bold; color:blue;"}else{e.style+="font-weight:bold; color:green;"}return f}},{header:i18n.get("label.name"),dataIndex:"name",width:160},{header:i18n.get("label.description"),dataIndex:"description",width:255,sortable:false},{header:i18n.get("label.labelEditable")+' <img title="Editable" height=14 widht=14 src="/sitools/common/res/images/icons/toolbar_edit.png"/>',dataIndex:"label",width:140,editor:new Ext.form.TextField({listeners:{scope:this,change:function(c,d,b){this.savePropertiesBtn.addClass("not-save-textfield")}}})},{header:i18n.get("label.categoryEditable")+' <img title="Editable" height=14 widht=14 src="/sitools/common/res/images/icons/toolbar_edit.png"/>',dataIndex:"category",width:150,editor:new Ext.form.TextField({listeners:{scope:this,change:function(c,d,b){this.savePropertiesBtn.addClass("not-save-textfield")}}})},{header:'Position <img title="Editable" height=14 widht=14 src="/sitools/common/res/images/icons/toolbar_edit.png"/>',dataIndex:"position",width:100,editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",store:new Ext.data.ArrayStore({id:0,fields:["position"],data:[["left"],["right"]]}),value:"Left",valueField:"position",displayField:"position",listeners:{scope:this,change:function(c,d,b){this.savePropertiesBtn.addClass("not-save-textfield")}}})},{header:i18n.get("label.icon"),dataIndex:"icon",width:80,sortable:false,renderer:function(f,e,b,g,d,c){if(!Ext.isEmpty(f)){f='<img src="'+f+'" height=15 width=18 style="margin:auto; display: block;"/>'}return f}},a]});this.plugins=[a];this.savePropertiesBtn=new Ext.Button({text:i18n.get("label.saveProperties"),id:"tocard",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/save.png",handler:this.onSaveProperties,tooltip:i18n.get("label.savePropertiesHelp"),xtype:"s-menuButton"});this.tbar={xtype:"sitools.widget.GridSorterToolbar",defaults:{scope:this},items:[this.comboParents,"-",{text:i18n.get("label.addServiceIhm"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create_serviceIhm.png",handler:function(){this.onCreate("GUI")},xtype:"s-menuButton"},{text:i18n.get("label.addServiceServer"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create_serviceServer.png",handler:function(){this.onCreate("SERVER")},xtype:"s-menuButton"},"-",{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},this.savePropertiesBtn,"-",{text:i18n.get("label.duplicate"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/presentation1.png",handler:this.onDuplicate,xtype:"s-menuButton"}]};this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.sm=new Ext.grid.RowSelectionModel();this.listeners={scope:this,celldblclick:function(c,d,b){if(c.getColumnModel().isCellEditable(b,d)){return}this.onModify()}};sitools.admin.datasets.services.datasetServicesCrud.superclass.initComponent.call(this)},onCreate:function(b){if(Ext.isEmpty(this.comboParents.getValue())){return}var e=this.comboParents.getValue();var d=this.urlDatasets+"/"+e;if(b==="GUI"){var a=new sitools.admin.datasets.services.datasetServicesProp({action:"create",parentPanel:this,parentType:this.parentType,appClassName:this.appClassName,idParent:e,urlDataset:d,urlAllServicesIHM:this.urlAllServicesIHM,urlDatasetServiceIHM:this.urlDatasetServiceIHM.replace("{idDataset}",e)});a.show()}else{if(b==="SERVER"){var c=new sitools.admin.resourcesPlugins.resourcesPluginsProp({action:"create",parentPanel:this,urlResources:this.urlAllServicesSERVER,urlResourcesCRUD:this.urlDatasetAllServicesSERVER.replace("{idDataset}",e),urlParent:d,parentType:this.parentType,appClassName:this.appClassName,idParent:e});c.show()}}},onModify:function(){if(Ext.isEmpty(this.comboParents.getValue())){return}var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}if(a.data.type==="GUI"){this.editGUIService(a.data.id)}else{if(a.data.type==="SERVER"){this.editSERVERService(a.data.id)}}},onDuplicate:function(){if(Ext.isEmpty(this.comboParents.getValue())){return}var c=this.comboParents.getValue();var a=this.getSelectionModel().getSelections();if(Ext.isEmpty(a)){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var b=new sitools.admin.datasets.services.datasetServicesCopyProp({storeCombo:this.storeParents,services:a,parentDatasetId:c,urlDatasetServiceSERVER:this.urlDatasetAllServicesSERVER,urlDatasetServiceGUI:this.urlDatasetAllServicesIHM});b.show()},onDelete:function(){if(Ext.isEmpty(this.comboParents.getValue())){return}var b=this.comboParents.getValue();var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("resourcesPlugins"+this.parentType+"Crud.delete"),scope:this,fn:function(c,d){if(c==="yes"){this.doDelete(a,b)}}})},doDelete:function(b,c){var a=null;if(b.data.type==="GUI"){a=this.urlDatasetServiceIHM.replace("{idDataset}",c)}else{if(b.data.type==="SERVER"){a=this.urlDatasetServiceSERVER.replace("{idDataset}",c)}}a=a.replace("{idService}",b.id);Ext.Ajax.request({url:a,method:"DELETE",scope:this,success:function(d){Ext.decode(d.responseText);if(showResponse(d)){this.store.reload()}},failure:alertFailure})},onSaveProperties:function(){var a={};a.id=this.parentId;a.name="";a.description="";a.services=[];this.getStore().each(function(c){var b=c.data;Ext.destroyMembers(b,"modelVersion");Ext.destroyMembers(b,"definitionVersion");a.services.push(b)});Ext.Ajax.request({url:this.urlDatasetAllServices.replace("{idDataset}",this.parentId),method:"PUT",jsonData:a,scope:this,success:function(b){this.savePropertiesBtn.removeClass("not-save-textfield");new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.datasetServicePropertiesSaved"),autoDestroy:true,hideDelay:1000}).show(document);this.store.reload()},failure:alertFailure})},editGUIService:function(c){var b=this.comboParents.getValue();var a=this.urlDatasets+"/"+b;Ext.Ajax.request({url:this.urlDatasetServiceIHM.replace("{idService}",c).replace("{idDataset}",this.parentId),method:"GET",scope:this,success:function(e){var f=Ext.decode(e.responseText);var d=new sitools.admin.datasets.services.datasetServicesProp({action:"modify",record:f.guiServicePlugin,parentPanel:this,urlDataset:a,parentType:this.parentType,appClassName:this.appClassName,idParent:this.parentId,urlAllServicesIHM:this.urlAllServicesIHM,urlDatasetServiceIHM:this.urlDatasetServiceIHM.replace("{idDataset}",this.parentId)});d.show()},failure:alertFailure})},editSERVERService:function(b){var a=this.urlDatasets+"/"+this.parentId;Ext.Ajax.request({url:this.urlDatasetServiceSERVER.replace("{idService}",b).replace("{idDataset}",this.parentId),method:"GET",scope:this,success:function(e){var f=Ext.decode(e.responseText);var d={};d.data=f.resourcePlugin;var c=new sitools.admin.resourcesPlugins.resourcesPluginsProp({action:"modify",record:d,parentPanel:this,urlResources:this.urlAllServicesSERVER,urlResourcesCRUD:this.urlDatasets+"/"+this.parentId+"/services/server",urlParent:a,appClassName:this.appClassName,idParent:this.parentId,parentType:this.parentType});c.show()},failure:alertFailure})},loadServerPluginClassDescription:function(b,a,c){Ext.Ajax.request({url:this.urlDatasetAllServicesSERVER.replace("{idDataset}",this.parentId),method:"GET",scope:this,success:function(d){var e=Ext.decode(d.responseText);if(e.success){var f=e.data;Ext.each(f,function(g){var k=b.getById(g.id);if(k){k.set("definitionVersion",g.currentClassVersion);k.set("modelVersion",g.classVersion)}},this);this.loadGuiPluginModelDescription(b,a,c)}},failure:alertFailure})},loadGuiPluginModelDescription:function(b,a,c){Ext.Ajax.request({url:this.urlDatasetAllServicesIHM.replace("{idDataset}",this.parentId),method:"GET",scope:this,success:function(d){var e=Ext.decode(d.responseText);if(e.success){var f=e.data;Ext.each(f,function(g){var k=b.getById(g.id);k.set("definitionVersion",g.currentGuiServiceVersion);k.set("modelVersion",g.version)},this);this.getView().allLoaded=true;this.getView().refresh()}},failure:alertFailure})}});Ext.reg("s-dataset_services",sitools.admin.datasets.services.datasetServicesCrud);Ext.namespace("sitools.admin.datasets.services");sitools.admin.datasets.services.datasetServicesProp=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:true,classChosen:"",datasetServiceIHMId:null,modelClassName:null,currentRecordId:null,initComponent:function(){this.id="datasetServicesPropId";this.guiServiceDatasetURL=loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_URL")+"/"+this.idParent+"/services";this.title=this.action==="create"?i18n.get("label.create"+this.parentType+"Resource"):i18n.get("label.modify"+this.parentType+"Resource");var b=new Ext.ux.grid.RowExpander({tpl:new Ext.XTemplate('<tpl><div class="detail"><span style="font-weight:bold;">Author :&nbsp;</span>{author}</div></tpl>',{compiled:true,descEmpty:function(c){return Ext.isEmpty(c)}}),expandOnDblClick:true});this.gridDatasetServices=new Ext.grid.GridPanel({viewConfig:{forceFit:true},layout:"fit",id:"gridDatasetServices",title:i18n.get("title.datasetServiceIHM"),store:new Ext.data.JsonStore({root:"data",restful:true,proxy:new Ext.data.HttpProxy({url:this.urlAllServicesIHM,restful:true,method:"GET"}),remoteSort:false,sortInfo:{field:"name",direction:"ASC"},idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"label",type:"string"},{name:"xtype",type:"string"},{name:"author",type:"string"},{name:"version",type:"string"},{name:"icon",type:"string"},{name:"parameters"},{name:"priority",type:"int"},{name:"dataSetSelection"},{name:"dependencies"},{name:"defaultVisibility"}],listeners:{load:function(d,c){this.gridDatasetServices.getSelectionModel().lock();this.loadDependencies(c,function(){this.gridDatasetServices.getSelectionModel().unlock()},this)},scope:this}}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[b,{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:300,sortable:true},{header:i18n.get("label.xtype"),dataIndex:"xtype",width:300,sortable:true},{header:i18n.get("label.version"),dataIndex:"version",width:200,sortable:false}]}),plugins:b});var a=new Ext.form.Hidden({name:"dataSetSelection"});this.centerPanel=new Ext.Panel({layout:"fit",region:"center"});this.fieldMappingFormPanel=new Ext.FormPanel({height:115,frame:true,region:"north",defaultType:"textfield",items:[{fieldLabel:i18n.get("label.name"),name:"name",anchor:"100%"},{fieldLabel:i18n.get("label.descriptionAction"),name:"descriptionAction",anchor:"100%"},{xtype:"sitoolsSelectImage",name:"icon",fieldLabel:i18n.get("label.icon"),anchor:"100%",allowBlank:true},a]});this.dsFieldParametersPanel=new Ext.Panel({layout:"border",id:"dsFieldParametersPanel",urlDataset:this.urlDataset,title:i18n.get("title.formFieldParameters"),items:[this.fieldMappingFormPanel,this.centerPanel]});this.tabPanel=new Ext.TabPanel({height:450,activeTab:0,items:(this.action==="create")?[this.gridDatasetServices,this.dsFieldParametersPanel]:[this.dsFieldParametersPanel],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.listeners={scope:this,resize:function(f,e,c){var d=f.body.getSize();this.tabPanel.setSize(d)}};this.items=[this.tabPanel];sitools.admin.datasets.services.datasetServicesProp.superclass.initComponent.call(this)},beforeTabChange:function(a,f,e){if(this.action==="create"){if(f.id==="dsFieldParametersPanel"){var d=this.gridDatasetServices.getSelectionModel().getSelected();if(!d){new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}if(d.id===this.currentRecordId){return}this.currentRecordId=d.id;this.centerPanel.remove(this.formParametersPanel);this.formParametersPanel=new sitools.admin.common.FormParametersConfigUtil({rec:d.data});this.centerPanel.add(this.formParametersPanel);this.centerPanel.doLayout();var b=this.fieldMappingFormPanel.getForm();b.findField("name").setValue(d.data.name);b.findField("descriptionAction").setValue(d.data.descriptionAction);b.findField("icon").setValue(d.data.icon);var c=b.findField("dataSetSelection");c.setValue(d.data.dataSetSelection)}}},afterRender:function(){if(this.action==="modify"){this.gridDatasetServices.getStore().load({callback:function(){this.formParametersPanel=new sitools.admin.common.FormParametersConfigUtil({rec:this.record,parametersList:this.record.parameters});this.centerPanel.add(this.formParametersPanel);this.centerPanel.doLayout();this.fillGridAndForm(this.record,this.action)},scope:this})}else{this.gridDatasetServices.getStore().load()}sitools.admin.datasets.services.datasetServicesProp.superclass.afterRender.apply(this,arguments)},onValidate:function(){if(this.tabPanel.getActiveTab().id==="gridDatasetServices"){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.checkForm"));this.tabPanel.setActiveTab(1);return false}var d,a={};if(this.action==="create"){d=this.gridDatasetServices.getSelectionModel().getSelected();if(!d){new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}d=d.data}else{d=this.record}Ext.apply(a,d);if(Ext.isEmpty(this.formParametersPanel)||!this.formParametersPanel.getForm().isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return false}var c=this.fieldMappingFormPanel.getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return false}Ext.iterate(c.getValues(),function(f,g){a[f]=g});a.parameters=[];Ext.iterate(this.formParametersPanel.getParametersValue(),function(g,k,f){a.parameters.push(g)});Ext.destroyMembers(a,"dependencies");var e,b;if(this.action==="modify"){b=this.urlDatasetServiceIHM.replace("{idService}",a.id);e="PUT"}else{Ext.destroyMembers(a,"id");b="/sitools/datasets/"+this.idParent+"/services/gui";e="POST"}Ext.Ajax.request({url:b,method:e,scope:this,jsonData:a,success:function(g){var k=Ext.decode(g.responseText);if(!k.success){if(Ext.isEmpty(k.message)){var f=k.data;this.notifyViolations(f);Ext.getCmp("statusBar").show()}else{Ext.Msg.alert(i18n.get("label.warning"),k.message)}return false}new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.datasetServiceIHMSaved"),autoDestroy:true,hideDelay:1000}).show(document);this.parentPanel.getStore().reload();this.close()},failure:alertFailure})},notifyViolations:function(d){for(var e=0;e<d.length;e++){var c=d[e];var b=this.formParametersPanel.getStore();var a=b.findExact("name",c.valueName);var f=b.getAt(a);f.set("violation",c)}},fillGridAndForm:function(a,c){if(!Ext.isEmpty(a)){var b=this.fieldMappingFormPanel.getForm();b.findField("name").setValue(a.name);b.findField("descriptionAction").setValue(a.descriptionAction);b.findField("icon").setValue(a.icon);b.findField("dataSetSelection").setValue(a.dataSetSelection)}},loadDependencies:function(c,e,b){var a=c;if(!Ext.isArray(a)){a=[c]}var d=[];Ext.each(a,function(f){if(!Ext.isEmpty(f.get("dependencies")&&!Ext.isEmpty(f.get("dependencies").js))){d=d.concat(f.get("dependencies").js)}},this);if(!Ext.isEmpty(d)){includeJsForceOrder(d,0,e,b)}}});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.datasetViewConfig=Ext.extend(Ext.form.FormPanel,{padding:10,initComponent:function(){this.title=i18n.get("label.viewConfig");var a=this.action;this.storeDatasetViews=new Ext.data.JsonStore({fields:["id","name","description","jsObject","fileUrl","priority"],url:this.urlDatasetViews,autoLoad:false,root:"data",sortInfo:{field:"priority",direction:"ASC"},listeners:{scope:this,load:function(b,d){if(Ext.isEmpty(this.comboDatasetViews.getValue())){if(!Ext.isEmpty(d)&&Ext.isArray(d)&&d.length>0){var e=null;for(var c=0;c<d.length;c++){if(Ext.isEmpty(e)||d[c].data.priority<e.data.priority){e=d[c]}}this.comboDatasetViews.setValue(e.id);this.comboDatasetViews.fireEvent("select",this.comboDatasetViews,e)}}}}});this.comboDatasetViews=new Ext.form.ComboBox({disabled:this.action=="view"?true:false,id:"comboDatasetViews",store:this.storeDatasetViews,fieldLabel:i18n.get("label.datasetViews"),displayField:"name",valueField:"id",typeAhead:true,mode:"local",name:"comboDatasetViews",forceSelection:true,triggerAction:"all",editable:false,emptyText:i18n.get("label.datasetViewsSelect"),selectOnFocus:true,anchor:"95%",itemSelector:"div.search-item",allowBlank:false,autoSelect:true,maxHeight:200,validator:function(b){if(Ext.isEmpty(b)){return false}else{return true}},tpl:new Ext.XTemplate('<tpl for=".">','<div class="search-item combo-datasetview"><div class="combo-datasetview-name">{name}</div>','<tpl if="this.descEmpty(description) == false" ><div class="sitoolsDescription-datasetview"><div class="sitoolsDescriptionHeader">Description :&nbsp;</div><p class="sitoolsDescriptionText"> {description} </p></div></tpl>',"</div></tpl>",{compiled:true,descEmpty:function(b){return Ext.isEmpty(b)}}),listeners:{scope:this,select:function(c,d,b){this.buildViewConfig(d)}}});this.parametersFieldset=new Ext.form.FieldSet({title:i18n.get("label.parameters"),anchor:"95%"});Ext.apply(this,{items:[this.comboDatasetViews,this.parametersFieldset],listeners:{activate:function(){if(a=="view"){this.getEl().mask()}}}});sitools.admin.datasets.datasetViewConfig.superclass.initComponent.call(this)},getDatasetViewsCombo:function(){return this.comboDatasetViews},setViewConfigParamsValue:function(a){this.viewConfigParamsValue=a},buildViewConfig:function(recSelected){try{this.parametersFieldset.removeAll();var getParametersMethod=eval(recSelected.json.jsObject+".getParameters");if(!Ext.isFunction(getParametersMethod)){Ext.Msg.alert(i18n.get("label.error"),i18n.get("label.notImplementedMethod <br/>"+getParametersMethod));return}var parameters=getParametersMethod();if(Ext.isEmpty(parameters)){this.parametersFieldset.setVisible(false)}else{this.parametersFieldset.setVisible(true)}Ext.each(parameters,function(param){var parameterValue=this.findDefaultParameterValue(param);var JsObj=eval(param.jsObj);var config=Ext.applyIf(param.config,{anchor:"95%"});var p=new JsObj(config);if(!Ext.isEmpty(parameterValue)){p.setValue(parameterValue)}this.parametersFieldset.add(p)},this);this.doLayout()}catch(err){Ext.Msg.alert(i18n.get("label.error"),i18n.get("label.notImplementedMethod <br/>")+err);return}},getParametersValue:function(){var a=[];if(Ext.isEmpty(this.parametersFieldset.items)){return a}this.parametersFieldset.items.each(function(b){a.push({name:b.parameterName,value:b.getValue()})},this);return a},findDefaultParameterValue:function(b){var a;Ext.each(this.viewConfigParamsValue,function(c){if(c.name==b.config.parameterName){a=c.value}});return a}});Ext.namespace("sitools.admin.resourcesPlugins");sitools.admin.datasets.services.datasetServicesCopyProp=Ext.extend(Ext.Window,{width:260,height:230,modal:true,autoHeight:true,autoScroll:true,initComponent:function(){this.title=i18n.get("label.duplicateDatasetServices");this.fieldset=new Ext.form.FieldSet({xtype:"fieldset",name:"fieldsetCopiedServices",title:i18n.get("label.servicesCopied"),autoHeight:true,hidden:true});this.items=[{xtype:"form",id:"formCopyId",layout:"fit",frame:false,border:false,autoHeight:true,buttonAlign:"center",bodyStyle:"padding:15px 10px 15px 15px;",items:[{xtype:"label",text:i18n.get("label.datasetDestination")},{xtype:"combo",id:"datasetDestId",store:this.storeCombo,displayField:"name",valueField:"id",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true},this.fieldset]}];this.buttons=[{xtype:"button",iconAlign:"right",text:i18n.get("label.copy"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/converter.png",copyFinish:false,scope:this,handler:this.runCopy}];this.servicesIHM=[];this.servicesSERVER=[];Ext.each(this.services,function(a){if(a.data.type=="GUI"){this.servicesIHM.push(a)}else{this.servicesSERVER.push(a)}},this);sitools.admin.datasets.services.datasetServicesCopyProp.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.datasets.services.datasetServicesCopyProp.superclass.afterRender.apply(this,arguments);this.getAllServicesDescription()},runCopy:function(){var b=Ext.getCmp("formCopyId").getForm();this.idDest=b.findField("datasetDestId").getValue();if(Ext.isEmpty(this.idDest)){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.each(this.services,function(c){this.fieldset.add({xtype:"label",id:c.data.id,html:'<img src="/sitools/common/res/images/icons/loading.gif"/> '+c.data.name+"<br>"})},this);this.fieldset.setVisible(true);this.fieldset.doLayout();this.executeCopy();var a=this.buttons[0];a.copyFinish=true;a.setText(i18n.get("label.close"));a.setHandler(function(){this.close()},this)},executeCopy:function(){if(Ext.isEmpty(this.services)){return}var a=this.services[0];var b;if(a.data.type=="GUI"){b=this.urlDatasetServiceGUI.replace("{idDataset}",this.idDest)}else{b=this.urlDatasetServiceSERVER.replace("{idDataset}",this.idDest)}delete a.data.id;delete a.data.parent;delete a.data.type;delete a.data.category;Ext.Ajax.request({url:b,method:"POST",jsonData:a.data,scope:this,success:function(d){var c=this.fieldset.find("id",a.id)[0];if(d.status==200){c.el.dom.innerHTML='<img src="/sitools/common/res/images/icons/valid.png"/> '+a.data.name+"<br>"}else{c.el.dom.innerHTML='<img src="/sitools/common/res/images/icons/search-cancel.png"/> '+a.data.name+"<br>"}},callback:function(){this.services.shift();this.executeCopy()},failure:function(d){var c=this.fieldset.find("id",a.id)[0];c.el.dom.innerHTML='<img src="/sitools/common/res/images/icons/search-cancel.png"/> '+a.data.name+"<br>"}})},getAllServicesDescription:function(){if(!Ext.isEmpty(this.servicesIHM)){this.getServicesIHMDescription()}if(!Ext.isEmpty(this.servicesSERVER)){this.getServicesSERVERDescription()}},getServicesSERVERDescription:function(){Ext.Ajax.request({url:this.urlDatasetServiceSERVER.replace("{idDataset}",this.parentDatasetId),method:"GET",scope:this,success:function(a){this.servicesSERVERDescription=Ext.decode(a.responseText);Ext.each(this.services,function(b){Ext.each(this.servicesSERVERDescription.data,function(c){if(b.data.id==c.id){b.data=c;b.data.type="SERVER"}},this)},this)},callback:function(){},failure:function(a){}})},getServicesIHMDescription:function(){Ext.Ajax.request({url:this.urlDatasetServiceGUI.replace("{idDataset}",this.parentDatasetId),method:"GET",scope:this,success:function(a){this.servicesIHMDescription=Ext.decode(a.responseText);Ext.each(this.services,function(b){Ext.each(this.servicesIHMDescription.data,function(c){if(b.data.id==c.id){b.data=c;b.data.type="GUI"}},this)},this)},callback:function(){},failure:function(a){}})}});Ext.reg("s-storage_copy",sitools.admin.datasets.services.datasetServicesCopyProp);Ext.namespace("sitools.admin.resourcesPlugins");sitools.admin.resourcesPlugins.resourcesPluginsCrudPanel=Ext.extend(Ext.grid.GridPanel,{urlParentsParams:"",border:false,height:300,pageSize:10,modify:false,urlGrid:null,conflictWarned:false,viewConfig:{forceFit:true,autoFill:true,getRowClass:function(d,b){var a="";var c=d.data;if(c.classVersion!==c.currentClassVersion&&c.currentClassVersion!==null&&c.currentClassVersion!==undefined){if(!this.conflictWarned){Ext.Msg.alert("warning.version.conflict","Resources "+c.name+" definition (v"+c.classVersion+") may conflict with current class version : "+c.currentClassVersion);this.conflictWarned=true}a="red-row"}return a}},initComponent:function(){this.storeParents=new Ext.data.JsonStore({fields:["id","name","type"],url:this.urlParents+this.urlParentsParams,root:"data",autoLoad:true});this.comboParents=new Ext.form.ComboBox({store:this.storeParents,displayField:"name",valueField:"id",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",emptyText:i18n.get("label.select"+this.parentType+"s"),selectOnFocus:true,listeners:{scope:this,select:function(c,d,b){this.parentId=d.data.id;if(!Ext.isEmpty(d.data.type)){this.appClassName=d.data.type}var a=this.urlParents+"/"+this.parentId+this.resourcesUrlPart+this.urlParentsParams;this.httpProxyResources.setUrl(a,true);this.getStore().load()}}});this.httpProxyResources=new Ext.data.HttpProxy({url:"/tmp",restful:true,method:"GET"});this.store=new Ext.data.JsonStore({idProperty:"id",root:"data",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"descriptionAction",type:"string"},{name:"description",type:"string"},{name:"classVersion",type:"string"},{name:"classAuthor",type:"string"},{name:"currentClassVersion",type:"string"},{name:"currentClassAuthor",type:"string"},{name:"resourceClassName",type:"string"},{name:"classOwner",type:"string"},{name:"parameters"},{name:"parent",type:"string"},{name:"className",type:"string"},{name:"dataSetSelection",type:"string"},{name:"behavior",type:"string"}],proxy:this.httpProxyResources});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:150},{header:i18n.get("label.description"),dataIndex:"description",width:200,sortable:false},{header:i18n.get("label.resourceClassName"),dataIndex:"resourceClassName",width:150,sortable:false},{header:i18n.get("label.classVersion"),dataIndex:"classVersion",width:50,sortable:false},{header:i18n.get("label.currentClassVersion"),dataIndex:"currentClassVersion",width:50,sortable:false},{header:i18n.get("label.classAuthor"),dataIndex:"classAuthor",width:100,sortable:false},{header:i18n.get("label.classOwner"),dataIndex:"classOwner",width:100,sortable:false},{header:i18n.get("label.descriptionAction"),dataIndex:"descriptionAction",width:200,sortable:false}]});this.tbar={xtype:"toolbar",defaults:{scope:this},items:[this.comboParents,{text:i18n.get("label.add"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"},{text:i18n.get("label.duplicate"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/presentation1.png",handler:this.onDuplicate,xtype:"s-menuButton"}]};this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.resourcesPlugins.resourcesPluginsCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.resourcesPlugins.resourcesPluginsCrudPanel.superclass.onRender.apply(this,arguments)},onCreate:function(){if(Ext.isEmpty(this.comboParents.getValue())){return}var c=this.comboParents.getValue();var b=this.urlParents+"/"+c;var a=new sitools.admin.resourcesPlugins.resourcesPluginsProp({action:"create",parentPanel:this,urlResources:this.urlResources,urlResourcesCRUD:this.httpProxyResources.url,urlParent:b,parentType:this.parentType,appClassName:this.appClassName,idParent:c});a.show()},onModify:function(){if(Ext.isEmpty(this.comboParents.getValue())){return}var d=this.comboParents.getValue();var c=this.getSelectionModel().getSelected();if(!c){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}if("ACTIVE"===c.data.status){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.wrongStatus"));return}var b=this.urlParents+"/"+d;var a=new sitools.admin.resourcesPlugins.resourcesPluginsProp({action:"modify",record:c,parentPanel:this,urlResources:this.urlResources,urlResourcesCRUD:this.httpProxyResources.url,urlParent:b,appClassName:this.appClassName,idParent:d,parentType:this.parentType});a.show()},onDuplicate:function(){if(Ext.isEmpty(this.comboParents.getValue())){return}var c=this.comboParents.getValue();var a=this.getSelectionModel().getSelections();if(Ext.isEmpty(a)){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var b=new sitools.admin.resourcesPlugins.resourcesServicesCopyProp({storeCombo:this.storeParents,services:a,parentProjectId:c,urlParents:this.urlParents,resourcesUrlPart:this.resourcesUrlPart,parentType:this.parentType,});b.show()},onDelete:function(){if(Ext.isEmpty(this.comboParents.getValue())){return}var c=this.comboParents.getValue();var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("resourcesPlugins"+this.parentType+"Crud.delete"),scope:this,fn:function(d,e){if(d=="yes"){this.doDelete(b,c)}}})},doDelete:function(a,b){Ext.Ajax.request({url:this.urlParents+"/"+b+this.resourcesUrlPart+"/"+a.id,method:"DELETE",scope:this,success:function(d){var c=Ext.decode(d.responseText);if(showResponse(d)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-plugins_resources",sitools.admin.resourcesPlugins.resourcesPluginsCrudPanel);Ext.namespace("sitools.admin.resourcesPlugins");sitools.admin.resourcesPlugins.resourcesServicesCopyProp=Ext.extend(Ext.Window,{width:260,height:230,modal:true,autoHeight:true,autoScroll:true,initComponent:function(){this.title=(this.parentType=="projet")?i18n.get("label.duplicateProjectServices"):i18n.get("label.duplicateAppServices");this.fieldset=new Ext.form.FieldSet({xtype:"fieldset",name:"fieldsetCopiedServices",title:i18n.get("label.servicesCopied"),autoHeight:true,hidden:true});this.formPanel=new Ext.form.FormPanel({xtype:"form",id:"formCopyId",layout:"fit",frame:false,border:false,autoHeight:true,buttonAlign:"center",bodyStyle:"padding:15px 10px 15px 15px;",items:[{xtype:"label",text:(this.parentType=="projet")?i18n.get("label.projectDestination"):i18n.get("label.appDestination")},{xtype:"combo",id:"projDestId",store:this.storeCombo,displayField:"name",valueField:"id",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true},this.fieldset]});if(this.parentType=="application"){this.formPanel.add({xtype:"label",html:i18n.get("label.warningCopyAppServices")})}this.items=[this.formPanel];this.buttons=[{xtype:"button",iconAlign:"right",text:i18n.get("label.copy"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/converter.png",copyFinish:false,scope:this,handler:this.runCopy}];sitools.admin.resourcesPlugins.resourcesServicesCopyProp.superclass.initComponent.call(this)},runCopy:function(){var c=Ext.getCmp("formCopyId").getForm();var b=c.findField("projDestId").getValue();if(Ext.isEmpty(b)){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}Ext.each(this.services,function(d){this.fieldset.add({xtype:"label",id:d.data.id,html:'<img src="/sitools/common/res/images/icons/loading.gif"/> '+d.data.name+"<br>"})},this);this.fieldset.setVisible(true);this.fieldset.doLayout();this.url=this.urlParents+"/"+b+this.resourcesUrlPart;this.executeCopy();var a=this.buttons[0];a.copyFinish=true;a.setText(i18n.get("label.close"));a.setHandler(function(){this.close()},this)},executeCopy:function(){if(Ext.isEmpty(this.services)){return}var a=this.services[0];delete a.json.id;delete a.json.parent;Ext.Ajax.request({url:this.url,method:"POST",jsonData:a.json,scope:this,success:function(c){var b=this.fieldset.find("id",a.data.id)[0];if(c.status==200){b.el.dom.innerHTML='<img src="/sitools/common/res/images/icons/valid.png"/> '+a.data.name+"<br>"}else{b.el.dom.innerHTML='<img src="/sitools/common/res/images/icons/search-cancel.png"/> '+a.data.name+"<br>"}},callback:function(){this.services.shift();this.executeCopy()},failure:function(c){var b=this.fieldset.find("id",a.data.id)[0];b.el.dom.innerHTML='<img src="/sitools/common/res/images/icons/search-cancel.png"/> '+a.data.name+"<br>"}})}});Ext.reg("s-storage_copy",sitools.admin.resourcesPlugins.resourcesServicesCopyProp);Ext.namespace("sitools.admin.resourcesPlugins");sitools.admin.resourcesPlugins.resourcesPluginsProp=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:true,classChosen:"",resourcePluginId:null,modelClassName:null,initComponent:function(){this.title=this.action=="create"?i18n.get("label.create"+this.parentType+"Resource"):i18n.get("label.modify"+this.parentType+"Resource");var d=new Ext.ux.grid.RowExpander({tpl:new Ext.XTemplate('<tpl if="this.descEmpty(description)" ><div></div></tpl>','<tpl if="this.descEmpty(description) == false" ><div class="sitoolsDescription"><div class="sitoolsDescriptionHeader">Description :&nbsp;</div><p class="sitoolsDescriptionText"> {description} </p></div></tpl>',{compiled:true,descEmpty:function(e){return Ext.isEmpty(e)}}),expandOnDblClick:true});this.gridresourcePlugin=new Ext.grid.GridPanel({viewConfig:{forceFit:true},layout:"fit",id:"gridresourcePlugin",title:i18n.get("title.resourcePlugin"+this.parentType+"Class"),store:new Ext.data.JsonStore({root:"data",restful:true,proxy:new Ext.data.HttpProxy({url:this.urlResources,restful:true,method:"GET"}),remoteSort:false,sortInfo:{field:"name",direction:"ASC"},idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"resourceClassName",type:"string"},{name:"classAuthor",type:"string"},{name:"classVersion",type:"string"},{name:"parameters"},{name:"className",type:"string"},{name:"classOwner",type:"string"},{name:"applicationClassName",type:"string"},{name:"dataSetSelection",type:"string"}]}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[d,{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.resourceClassName"),dataIndex:"className",width:300,sortable:true},{header:i18n.get("label.author"),dataIndex:"classAuthor",width:100,sortable:true},{header:i18n.get("label.version"),dataIndex:"classVersion",width:100,sortable:true},{header:i18n.get("label.classOwner"),dataIndex:"classOwner",width:100,sortable:true}]}),listeners:{scope:this,rowclick:this.onClassClick},plugins:d});this.proxyFieldMapping=new Ext.data.HttpProxy({url:"/tmp",restful:true,method:"GET"});var b=new Ext.grid.CheckColumn({header:i18n.get("headers.userUpdatable"),dataIndex:"userUpdatable",width:55});var c=new sitools.widget.ViolationRowExpander({tpl:new Ext.XTemplate('<tpl if="this.descEmpty(description)" ><div></div></tpl>','<tpl if="this.descEmpty(description) == false" ><div class="sitoolsDescription"><div class="sitoolsDescriptionHeader">Description :&nbsp;</div><p class="sitoolsDescriptionText"> {description} </p></div></tpl>',{compiled:true,descEmpty:function(e){return Ext.isEmpty(e)}}),expandOnDblClick:false});this.gridFieldMapping=new Ext.grid.EditorGridPanel({viewConfig:{forceFit:true,scope:this,getRowClass:function(f,l,m,k){var e="";var g=f.get("violation");if(!Ext.isEmpty(g)){if(g.level=="CRITICAL"){e="red-row"}else{if(g.level=="WARNING"){e="orange-row"}}}return e},listeners:{scope:this,refresh:function(e){var g=this.gridFieldMapping;var f=g.getStore();f.each(function(p){var q=p.get("violation");if(!Ext.isEmpty(q)){var r=f.indexOf(p);var m=e.getRow(r);var s=Ext.get(m);var n=(q.level=="CRITICAL")?"x-form-invalid-tip":"x-form-invalid-tip x-form-warning-tip";var l={html:q.message,dismissDelay:0,target:s,cls:n};var k=new Ext.ToolTip(l)}});this.showOptions(this.gridFieldMapping)},rowupdated:function(){this.showOptions(this.gridFieldMapping)}}},id:"gridFieldMapping",layout:"fit",region:"center",title:i18n.get("title.parametersMapping"),store:new Ext.data.JsonStore({root:"resourcePlugin.parameters",proxy:this.proxyFieldMapping,restful:true,remoteSort:false,idProperty:"name",fields:[{name:"name",type:"string"},{name:"description",type:"string"},{name:"type",type:"string"},{name:"value",type:"string"},{name:"valueType",type:"string"},{name:"violation"},{name:"userUpdatable",type:"boolean"}]}),tbar:{xtype:"sitools.widget.GridSorterToolbar",defaults:{scope:this}},sm:new Ext.grid.RowSelectionModel(),bbar:new Ext.ux.StatusBar({id:"statusBar",hidden:true,iconCls:"x-status-error",text:i18n.get("label.resourcesPluginErrorValidationNotification")}),cm:new Ext.grid.ColumnModel({defaults:{sortable:false},columns:[c,{header:i18n.get("label.name"),dataIndex:"name",width:100},{header:i18n.get("label.type"),dataIndex:"type",width:150},{header:i18n.get("label.value"),dataIndex:"value",width:230,editable:true,editor:new Ext.form.TextField()},b]}),listeners:{scope:this,celldblclick:function(f,r,m,l){var n=f.getStore().getAt(r);var k=n.data;if(m==3){if(k.valueType=="xs:dataset.columnAlias"){var s=new sitools.admin.datasets.selectColumn({field:"value",record:n,parentStore:this.gridFieldMapping.getStore(),parentView:this.gridFieldMapping.getView(),url:loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_URL")+"/"+this.idParent});s.show(ID.BOX.DATASETS)}else{if(k.valueType=="xs:dictionary"){var q=new sitools.component.dictionary.selectDictionary({field:"value",record:n,parentStore:this.gridFieldMapping.getStore(),parentView:this.gridFieldMapping.getView(),url:loadUrl.get("APP_URL")+loadUrl.get("APP_DICTIONARIES_URL")});q.show(ID.BOX.DATASETS)}else{if(k.valueType=="xs:boolean"){var u=new sitools.admin.resourcesPlugins.enumerationValueTypeSelector({field:"value",record:n,parentView:this.gridFieldMapping.getView(),type:k.name,enumeration:"[true,false]",value:k.value});u.show(ID.BOX.DATASETS)}else{if(k.valueType=="xs:image"){var t=new ImageChooser({url:loadUrl.get("APP_URL")+loadUrl.get("APP_UPLOAD_URL")+"/?media=json",width:515,height:450,field:"value",parentView:this.gridFieldMapping.getView(),record:n});t.show(document,function(v,e){e.record.data[e.field]=v.url;e.parentView.refresh()})}else{if(k.valueType.indexOf("xs:enum")!=-1){var g;if(k.valueType.indexOf("xs:enum-editable-multiple")!=-1){g="EEM"}else{if(k.valueType.indexOf("xs:enum-editable")!=-1){g="EE"}else{if(k.valueType.indexOf("xs:enum-multiple")!=-1){g="EM"}else{g="E"}}}var p=new sitools.admin.resourcesPlugins.enumerationValueTypeSelector({enumType:g,field:"value",fieldEnum:"valueType",record:n,parentView:this.gridFieldMapping.getView(),type:k.name,enumeration:k.valueType,value:k.value});p.show(ID.BOX.DATASETS)}}}}}}else{return false}},viewready:function(e){this.showOptions(e)}},plugins:[b,c]});var a=new Ext.form.ComboBox({typeAhead:false,fieldLabel:i18n.get("label.behavior"),name:"behavior",triggerAction:"all",lazyRender:true,mode:"local",anchor:"100%",store:new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],data:[["DISPLAY_IN_NEW_TAB",i18n.get("DISPLAY_IN_NEW_TAB")],["DISPLAY_IN_DESKTOP",i18n.get("DISPLAY_IN_DESKTOP")]]}),valueField:"myId",displayField:"displayText"});this.fieldMappingFormPanel=new Ext.FormPanel({height:95,frame:true,defaultType:"textfield",items:[{fieldLabel:i18n.get("label.name"),name:"name",anchor:"100%"},{fieldLabel:i18n.get("label.descriptionAction"),name:"descriptionAction",anchor:"100%"},a],region:"north"});this.fieldMappingPanel=new Ext.Panel({layout:"border",id:"fieldMappingPanel",title:i18n.get("title.fieldMapping"),items:[this.fieldMappingFormPanel,this.gridFieldMapping],listeners:{scope:this,activate:function(){this.showOptions(this.gridFieldMapping)}}});this.tabPanel=new Ext.TabPanel({height:450,activeTab:0,items:(this.action=="create")?[this.gridresourcePlugin,this.fieldMappingPanel]:[this.fieldMappingPanel],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.listeners={scope:this,resize:function(k,g,e){var f=k.body.getSize();this.tabPanel.setSize(f)}};this.items=[this.tabPanel];sitools.admin.resourcesPlugins.resourcesPluginsProp.superclass.initComponent.call(this)},beforeTabChange:function(a,e,d){if(this.action=="create"){if(e.id=="gridFieldMapping"){var c=this.gridresourcePlugin.getSelectionModel().getSelected();if(!c){var b=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}}}},onClassClick:function(b,k,f){if(this.action=="create"){var g=this.gridresourcePlugin.getSelectionModel().getSelected();if(!g){return false}var d=g.data.className;if(d!=this.classChosen){var c=this.urlResources+"/"+d;var a=this.gridFieldMapping.getStore();a.removeAll();Ext.Ajax.request({url:c,method:"GET",scope:this,params:{appClassName:this.appClassName,parent:this.idParent},success:function(l){var m=Ext.decode(l.responseText);if(!m.success){Ext.Msg.alert(i18n.get("label.warning"),m.message);return false}var e=m.resourcePlugin;this.fillGridAndForm(e,this.action);this.classChosen=d}})}}},afterRender:function(){sitools.admin.resourcesPlugins.resourcesPluginsProp.superclass.afterRender.apply(this,arguments);if(this.action=="modify"){this.fillGridAndForm(this.record.data,this.action)}else{this.gridresourcePlugin.getStore().load({params:{appClassName:this.appClassName,parent:this.idParent}})}},fillGridAndForm:function(a,f){if(!Ext.isEmpty(a)){var g={};var e=this.fieldMappingFormPanel.getForm();g.name=a.name;g.descriptionAction=a.descriptionAction;g.id=a.id;g.resourceClassName=a.resourceClassName;g.behavior=a.behavior;e.loadRecord(new Ext.data.Record(g));var d=a.parameters;var b=this.gridFieldMapping.getStore();b.removeAll();if(!Ext.isEmpty(d)){for(var c=0;c<d.length;c++){var k=new Ext.data.Record(d[c]);if(f=="create"&&Ext.isEmpty(d[c].value)){k.set("value","")}b.add(k)}}}},onValidate:function(){var e;var d={};var s=[];var p;if(this.action=="create"){e=this.gridresourcePlugin.getSelectionModel().getSelected();if(!e){var k=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}p=e.data}else{p=this.record.data;d.id=this.record.data.id}d.classVersion=p.classVersion;d.classAuthor=p.classAuthor;d.classOwner=p.classOwner;d.description=p.description;d.className=p.className;d.resourceClassName=p.resourceClassName;d.parent=p.parent;d.applicationClassName=p.applicationClassName;if(!Ext.isEmpty(p.dataSetSelection)){d.dataSetSelection=p.dataSetSelection}var c=this.fieldMappingFormPanel.getForm();if(!this.fieldMappingFormPanel.rendered||!c.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return false}Ext.iterate(c.getValues(),function(u,v){if(!Ext.isEmpty(v)){d[u]=v}});var t=this.gridFieldMapping.getStore();var m=new RegExp("^/.*$");var l=new RegExp("^.*//.*$");var g=new RegExp("^.*[!\"#$%&'()*+,:;<=>?@\\`|~]+.*$");for(var f=0;f<t.getCount();f++){var r=t.getAt(f).data;r.violation=undefined;if(r.type=="PARAMETER_ATTACHMENT"){var n=r.value;var q=m.test(n)&&!l.test(n)&&!g.test(n);if(!q){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("label.invalidAttachment")+" : "+n)}}s.push(r)}d.parameters=s;var b=this.urlResourcesCRUD,a;if(this.action=="modify"){b+="/"+d.id;a="PUT"}else{a="POST"}Ext.Ajax.request({url:b,method:a,scope:this,jsonData:d,success:function(v){var A=Ext.decode(v.responseText);if(!A.success){if(Ext.isEmpty(A.message)){var u=A.data;this.notifyViolations(u);Ext.getCmp("statusBar").show()}else{Ext.Msg.alert(i18n.get("label.warning"),A.message)}return false}var z=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.resourcePlugin"+this.parentType+"Saved"),autoDestroy:true,hideDelay:1000}).show(document);this.parentPanel.getStore().reload();this.close()},failure:alertFailure})},notifyViolations:function(d){for(var e=0;e<d.length;e++){var c=d[e];var b=this.gridFieldMapping.getStore();var a=b.findExact("name",c.valueName);var f=b.getAt(a);f.set("violation",c)}this.gridFieldMapping.getView().refresh()},onClose:function(){},showOptions:function(d){var a,f;var b=d.getColumnModel().findColumnIndex("userUpdatable");for(var c=0;c<d.getStore().getCount();c++){f=d.getStore().getAt(c);a=f.get("type")=="PARAMETER_USER_INPUT";if(!a){try{d.getView().getCell(c,b).innerHTML=" "}catch(e){return}}}}});Ext.namespace("sitools.admin.resourcesPlugins");sitools.admin.resourcesPlugins.enumerationValueTypeSelector=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,editable:false,initComponent:function(){this.title=i18n.get("title.select"+this.type);this.editable=this.enumType=="EE"||this.enumType=="EEM";var b=this.enumeration.split("[");b=b[1].split("]");b=b[0].split(",");this.storeEnum=new Ext.data.ArrayStore({fields:["enumValue"],idIndex:0});Ext.each(b,function(e,d){this.storeEnum.add(new Ext.data.Record({enumValue:e.trim()}))},this);var a={id:"name",header:i18n.get("headers.name"),sortable:true,dataIndex:"enumValue",width:250};if(this.editable){Ext.apply(a,{editor:new Ext.form.TextField({disabled:!this.editable})})}this.cmSelectColumn=new Ext.grid.ColumnModel({columns:[a]});var c={xtype:"sitools.widget.GridSorterToolbar",hidden:!this.editable,defaults:{scope:this},items:[{text:i18n.get("label.add"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onAddValue,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModifyValue,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDeleteValue,xtype:"s-menuButton"}]};this.smSelectColumn=new Ext.grid.RowSelectionModel({singleSelect:this.enumType=="E"||this.enumType=="EE"});this.gridSelect=new Ext.grid.EditorGridPanel({tbar:c,height:380,autoScroll:true,store:this.storeEnum,cm:this.cmSelectColumn,sm:this.smSelectColumn,listeners:{scope:this,viewready:this.showSelectedRecords}});this.items=[{xtype:"panel",layout:"fit",items:[this.gridSelect],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}];sitools.admin.resourcesPlugins.enumerationValueTypeSelector.superclass.initComponent.call(this)},onValidate:function(){var b=this.gridSelect.getSelectionModel().getSelections();var a=[];Ext.each(b,function(c){a.push(c.data.enumValue)});this.record.data[this.field]=a.join("|");if(this.editable){a=[];this.gridSelect.getStore().each(function(c){a.push(c.data.enumValue)});this.record.data[this.fieldEnum]="xs:enum-editable";if(this.enumType=="EEM"){this.record.data[this.fieldEnum]+="-multiple"}this.record.data[this.fieldEnum]+="["+a.join(",")+"]"}this.parentView.refresh();this.close()},showSelectedRecords:function(b){var c=this.record.get(this.field);if(Ext.isEmpty(c)){return}var a=c.split("|");if(Ext.isEmpty(a)){return}Ext.each(a,function(e){var d=b.getStore().find("enumValue",e);if(d!=-1){b.getSelectionModel().selectRow(d,true)}})},onAddValue:function(){this.gridSelect.getStore().add(new (this.gridSelect.getStore().recordType));this.gridSelect.getView().refresh()},onDeleteValue:function(){var a=this.gridSelect.getSelectionModel().getSelections();if(Ext.isEmpty(a)){return}Ext.each(a,function(b){this.gridSelect.getStore().remove(b)},this);this.gridSelect.getView().refresh()}});Ext.namespace("sitools.admin.projectResources");sitools.admin.projectResources.projectResourcesCrudPanel=Ext.extend(Ext.Panel,{border:false,height:300,layout:"fit",initComponent:function(){var a=new sitools.admin.resourcesPlugins.resourcesPluginsCrudPanel({urlParents:loadUrl.get("APP_URL")+loadUrl.get("APP_PROJECTS_URL"),resourcesUrlPart:loadUrl.get("APP_RESOURCES_URL"),urlResources:loadUrl.get("APP_URL")+loadUrl.get("APP_PLUGINS_RESOURCES_URL")+"/classes",parentType:"project",appClassName:"fr.cnes.sitools.project.ProjectApplication"});this.items=[a];sitools.admin.projectResources.projectResourcesCrudPanel.superclass.initComponent.call(this)}});Ext.reg("s-project_resources",sitools.admin.projectResources.projectResourcesCrudPanel);Ext.namespace("sitools.admin.datasets.plugins");sitools.admin.datasets.plugins.resourcesCrudPanel=Ext.extend(Ext.Panel,{border:false,height:300,layout:"fit",initComponent:function(){var a=new sitools.admin.resourcesPlugins.resourcesPluginsCrudPanel({urlParents:loadUrl.get("APP_URL")+loadUrl.get("APP_DATASETS_URL"),resourcesUrlPart:loadUrl.get("APP_RESOURCES_URL"),urlResources:loadUrl.get("APP_URL")+loadUrl.get("APP_PLUGINS_RESOURCES_URL")+"/classes",parentType:"dataset",appClassName:"fr.cnes.sitools.dataset.DataSetApplication"});this.items=[a];sitools.admin.datasets.plugins.resourcesCrudPanel.superclass.initComponent.call(this)}});Ext.reg("s-dataset_resources",sitools.admin.datasets.plugins.resourcesCrudPanel);Ext.namespace("sitools.admin.applications.plugins");sitools.admin.applications.plugins.applicationResourcesCrudPanel=Ext.extend(Ext.Panel,{border:false,height:300,layout:"fit",initComponent:function(){var a=new sitools.admin.resourcesPlugins.resourcesPluginsCrudPanel({urlParents:loadUrl.get("APP_URL")+loadUrl.get("APP_APPLICATIONS_URL"),urlParentsParams:"?customizable=true",resourcesUrlPart:loadUrl.get("APP_RESOURCES_URL"),urlResources:loadUrl.get("APP_URL")+loadUrl.get("APP_PLUGINS_RESOURCES_URL")+"/classes",parentType:"application"});this.items=[a];sitools.admin.applications.plugins.applicationResourcesCrudPanel.superclass.initComponent.call(this)}});Ext.reg("s-application_resources",sitools.admin.applications.plugins.applicationResourcesCrudPanel);Ext.namespace("sitools.component.filtersPlugins");sitools.component.filtersPlugins.filtersPluginsProp=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:false,classChosen:"",filterPluginId:null,modelClassName:null,initComponent:function(){this.title=this.action=="create"?i18n.get("label.create"+this.parentType+"Filter"):i18n.get("label.modify"+this.parentType+"Filter");var a=new Ext.ux.grid.RowExpander({tpl:new Ext.XTemplate('<tpl if="this.descEmpty(description)" ><div></div></tpl>','<tpl if="this.descEmpty(description) == false" ><div class="sitoolsDescription"><div class="sitoolsDescriptionHeader">Description :&nbsp;</div><p class="sitoolsDescriptionText"> {description} </p></div></tpl>',{compiled:true,descEmpty:function(b){return Ext.isEmpty(b)}}),expandOnDblClick:true});this.gridfilterPlugin=new Ext.grid.GridPanel({viewConfig:{forceFit:true},id:"gridfilterPlugin",title:i18n.get("title.filterPlugin"+this.parentType+"Class"),store:new Ext.data.JsonStore({root:"data",restful:true,proxy:new Ext.data.HttpProxy({url:this.urlFilters,restful:true,method:"GET"}),remoteSort:false,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"filterClassName",type:"string"},{name:"classAuthor",type:"string"},{name:"classVersion",type:"string"},{name:"parameters"},{name:"className",type:"string"}]}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[a,{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.filterClassName"),dataIndex:"filterClassName",width:300,sortable:true},{header:i18n.get("label.author"),dataIndex:"classAuthor",width:100,sortable:true},{header:i18n.get("label.version"),dataIndex:"classVersion",width:100,sortable:true}]}),listeners:{scope:this,rowclick:this.onClassClick},plugins:a});this.proxyFieldMapping=new Ext.data.HttpProxy({url:"/tmp",restful:true,method:"GET"});this.gridFieldMapping=new Ext.grid.EditorGridPanel({viewConfig:{forceFit:true,scope:this,getRowClass:function(c,f,g,e){var b="";var d=c.get("violation");if(!Ext.isEmpty(d)){if(d.level=="CRITICAL"){b="red-row"}else{if(d.level=="WARNING"){b="orange-row"}}}return b},listeners:{scope:this,refresh:function(b){var d=this.gridFieldMapping;var c=d.getStore();c.each(function(l){var m=l.get("violation");if(!Ext.isEmpty(m)){var n=c.indexOf(l);var g=b.getRow(n);var p=Ext.get(g);var k=(m.level=="CRITICAL")?"x-form-invalid-tip":"x-form-invalid-tip x-form-warning-tip";var f={html:m.message,dismissDelay:0,target:p,cls:k};var e=new Ext.ToolTip(f)}})}}},id:"gridFieldMapping",layout:"fit",region:"center",title:i18n.get("title.parametersMapping"),store:new Ext.data.JsonStore({root:"filterPlugin.parameters",proxy:this.proxyFieldMapping,restful:true,remoteSort:false,idProperty:"name",fields:[{name:"name",type:"string"},{name:"description",type:"string"},{name:"type",type:"string"},{name:"value",type:"string"},{name:"valueType",type:"string"},{name:"violation"}]}),bbar:new Ext.ux.StatusBar({id:"statusBar",hidden:true,iconCls:"x-status-error",text:i18n.get("label.filtersPluginErrorValidationNotification")}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:100,sortable:false},{header:i18n.get("label.type"),dataIndex:"type",width:150,sortable:false},{header:i18n.get("label.value"),dataIndex:"value",width:230,sortable:false,editable:true,editor:new Ext.form.TextField()}]})});this.fieldMappingFormPanel=new Ext.FormPanel({height:65,frame:true,defaultType:"textfield",items:[{fieldLabel:i18n.get("label.name"),name:"name",anchor:"100%"},{fieldLabel:i18n.get("label.descriptionAction"),name:"descriptionAction",anchor:"100%"}],region:"north"});this.fieldMappingPanel=new Ext.Panel({layout:"border",id:"fieldMappingPanel",title:i18n.get("title.fieldMapping"),items:[this.fieldMappingFormPanel,this.gridFieldMapping]});this.tabPanel=new Ext.TabPanel({height:450,activeTab:0,items:(this.action=="create")?[this.gridfilterPlugin,this.fieldMappingPanel]:[this.fieldMappingPanel],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.items=[this.tabPanel];sitools.component.filtersPlugins.filtersPluginsProp.superclass.initComponent.call(this)},beforeTabChange:function(a,e,d){if(this.action=="create"){if(e.id=="gridFieldMapping"){var c=this.gridfilterPlugin.getSelectionModel().getSelected();if(!c){var b=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}}}},onClassClick:function(a,d,b){if(this.action=="create"){var c=this.gridfilterPlugin.getSelectionModel().getSelected();if(!c){return false}this.fillGridAndForm(c.data,this.action)}},afterRender:function(){sitools.component.filtersPlugins.filtersPluginsProp.superclass.afterRender.apply(this,arguments);if(this.action=="modify"){this.fillGridAndForm(this.record.data,this.action)}else{this.gridfilterPlugin.getStore().load()}},fillGridAndForm:function(k,e){if(!Ext.isEmpty(k)){var f={};var d=this.fieldMappingFormPanel.getForm();f.name=k.name;f.descriptionAction=k.descriptionAction;f.id=k.id;f.filterClassName=k.filterClassName;d.loadRecord(new Ext.data.Record(f));var c=k.parameters;var a=this.gridFieldMapping.getStore();a.removeAll();if(!Ext.isEmpty(c)){for(var b=0;b<c.length;b++){var g=new Ext.data.Record(c[b]);if(e=="create"&&Ext.isEmpty(c[b].value)){g.set("value","")}a.add(g)}}}},onValidate:function(){var e;var d={};var s=[];var p;if(this.action=="create"){e=this.gridfilterPlugin.getSelectionModel().getSelected();if(!e){var k=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}p=e.data}else{p=this.record.data;d.id=this.record.data.id}d.classVersion=p.classVersion;d.classAuthor=p.classAuthor;d.description=p.description;d.filterClassName=p.filterClassName;d.parent=p.parent;d.className=p.className;var c=this.fieldMappingFormPanel.getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return false}Ext.iterate(c.getValues(),function(u,v){if(!Ext.isEmpty(v)){d[u]=v}});var t=this.gridFieldMapping.getStore();var m=new RegExp("^/.*$");var l=new RegExp("^.*//.*$");var g=new RegExp("^.*[!\"#$%&'()*+,:;<=>?@\\`{}|~]+.*$");for(var f=0;f<t.getCount();f++){var r=t.getAt(f).data;r.violation=undefined;if(r.type=="PARAMETER_ATTACHMENT"){var n=r.value;var q=m.test(n)&&!l.test(n)&&!g.test(n);if(!q){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("label.invalidAttachment")+" : "+n)}}s.push(r)}d.parameters=s;var b=this.urlParent,a;if(this.action=="modify"){b+="/"+d.id;a="PUT"}else{a="POST"}Ext.Ajax.request({url:b,method:a,scope:this,jsonData:d,success:function(v){var A=Ext.decode(v.responseText);if(!A.success){if(Ext.isEmpty(A.message)){var u=A.data;this.notifyViolations(u);Ext.getCmp("statusBar").show()}else{Ext.Msg.alert(i18n.get("label.warning"),A.message)}return false}var z=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.filterPlugin"+this.parentType+"Saved"),autoDestroy:true,hideDelay:1000}).show(document);this.parentPanel.getStore().reload();this.close()},failure:alertFailure})},notifyViolations:function(d){for(var e=0;e<d.length;e++){var c=d[e];var b=this.gridFieldMapping.getStore();var a=b.findExact("name",c.valueName);var f=b.getAt(a);f.set("violation",c)}this.gridFieldMapping.getView().refresh()},onClose:function(){}});Ext.namespace("sitools.component.filtersPlugins");sitools.component.filtersPlugins.filtersPluginsSingle=Ext.extend(Ext.Window,{width:700,height:500,modal:true,resizable:true,classChosen:"",filterPluginId:null,modelClassName:null,initComponent:function(){this.title=this.action=="create"?i18n.get("label.create"+this.parentType+"Filter"):i18n.get("label.modify"+this.parentType+"Filter");var b=new Ext.ux.grid.RowExpander({tpl:new Ext.XTemplate('<tpl if="this.descEmpty(description)" ><div></div></tpl>','<tpl if="this.descEmpty(description) == false" ><div class="sitoolsDescription"><div class="sitoolsDescriptionHeader">Description :&nbsp;</div><p class="sitoolsDescriptionText"> {description} </p></div></tpl>',{compiled:true,descEmpty:function(c){return Ext.isEmpty(c)}}),expandOnDblClick:true});this.gridfilterPlugin=new Ext.grid.GridPanel({viewConfig:{forceFit:true},id:"gridfilterPlugin",title:i18n.get("title.filterPlugin"+this.parentType+"Class"),store:new Ext.data.JsonStore({root:"data",restful:true,proxy:new Ext.data.HttpProxy({url:this.urlFilters,restful:true,method:"GET"}),remoteSort:false,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"filterClassName",type:"string"},{name:"classAuthor",type:"string"},{name:"classVersion",type:"string"},{name:"parameters"},{name:"className",type:"string"},{name:"classOwner",type:"string"}]}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[b,{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.filterClassName"),dataIndex:"filterClassName",width:300,sortable:true},{header:i18n.get("label.author"),dataIndex:"classAuthor",width:100,sortable:true},{header:i18n.get("label.version"),dataIndex:"classVersion",width:100,sortable:true},{header:i18n.get("label.classOwner"),dataIndex:"classOwner",width:100,sortable:true}]}),listeners:{scope:this,rowclick:this.onClassClick},plugins:b});this.proxyFieldMapping=new Ext.data.HttpProxy({url:"/tmp",restful:true,method:"GET"});var a=new sitools.widget.ViolationRowExpander({tpl:new Ext.XTemplate('<tpl if="this.descEmpty(description)" ><div></div></tpl>','<tpl if="this.descEmpty(description) == false" ><div class="sitoolsDescription"><div class="sitoolsDescriptionHeader">Description :&nbsp;</div><p class="sitoolsDescriptionText"> {description} </p></div></tpl>',{compiled:true,descEmpty:function(c){return Ext.isEmpty(c)}}),expandOnDblClick:false});this.gridFieldMapping=new Ext.grid.EditorGridPanel({viewConfig:{forceFit:true,scope:this,getRowClass:function(d,g,k,f){var c="";var e=d.get("violation");if(!Ext.isEmpty(e)){if(e.level=="CRITICAL"){c="red-row"}else{if(e.level=="WARNING"){c="orange-row"}}}return c},listeners:{scope:this,refresh:function(c){var e=this.gridFieldMapping;var d=e.getStore();d.each(function(m){var n=m.get("violation");if(!Ext.isEmpty(n)){var p=d.indexOf(m);var k=c.getRow(p);var q=Ext.get(k);var l=(n.level=="CRITICAL")?"x-form-invalid-tip":"x-form-invalid-tip x-form-warning-tip";var g={html:n.message,dismissDelay:0,target:q,cls:l};var f=new Ext.ToolTip(g)}})}}},id:"gridFieldMapping",layout:"fit",region:"center",title:i18n.get("title.parametersMapping"),store:new Ext.data.JsonStore({root:"filterPlugin.parameters",proxy:this.proxyFieldMapping,restful:true,remoteSort:false,idProperty:"name",fields:[{name:"name",type:"string"},{name:"description",type:"string"},{name:"type",type:"string"},{name:"value",type:"string"},{name:"valueType",type:"string"},{name:"violation"}]}),bbar:new Ext.ux.StatusBar({id:"statusBar",hidden:true,iconCls:"x-status-error",text:i18n.get("label.filtersPluginErrorValidationNotification")}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[a,{header:i18n.get("label.name"),dataIndex:"name",width:100,sortable:true},{header:i18n.get("label.type"),dataIndex:"type",width:150,sortable:false},{header:i18n.get("label.value"),dataIndex:"value",width:230,sortable:false,editable:true,editor:new Ext.form.TextField()}]}),plugins:a});this.fieldMappingFormPanel=new Ext.FormPanel({height:65,frame:true,defaultType:"textfield",items:[{fieldLabel:i18n.get("label.name"),name:"name",anchor:"100%"},{fieldLabel:i18n.get("label.descriptionAction"),name:"descriptionAction",anchor:"100%"}],region:"north"});this.fieldMappingPanel=new Ext.Panel({layout:"border",id:"fieldMappingPanel",title:i18n.get("title.fieldMapping"),items:[this.fieldMappingFormPanel,this.gridFieldMapping]});this.tabPanel=new Ext.TabPanel({activeTab:0,items:(this.action=="create")?[this.gridfilterPlugin,this.fieldMappingPanel]:[this.fieldMappingPanel],buttons:[{text:this.action=="editDelete"?i18n.get("label.ok"):i18n.get("label.add"),scope:this,handler:this.onValidate},{text:i18n.get("label.delete"),scope:this,handler:this.onDelete,hidden:this.action=="create"},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.listeners={scope:this,resize:function(f,e,c){var d=f.body.getSize();this.tabPanel.setSize(d)}};this.items=[this.tabPanel];sitools.component.filtersPlugins.filtersPluginsSingle.superclass.initComponent.call(this)},beforeTabChange:function(a,e,d){if(this.action=="create"){if(e.id=="fieldMappingPanel"){var c=this.gridfilterPlugin.getSelectionModel().getSelected();if(!c){var b=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}}}},onClassClick:function(a,d,b){if(this.action=="create"){var c=this.gridfilterPlugin.getSelectionModel().getSelected();if(!c){return false}this.fillGridAndForm(c.data,this.action)}},afterRender:function(){sitools.component.filtersPlugins.filtersPluginsSingle.superclass.afterRender.apply(this,arguments);if(this.action=="editDelete"){this.fillGridAndForm(this.filterPlugin,this.action)}else{this.gridfilterPlugin.getStore().load()}this.tabPanel.setHeight(this.body.getHeight())},fillGridAndForm:function(k,e){if(!Ext.isEmpty(k)){var f={};var d=this.fieldMappingFormPanel.getForm();f.name=k.name;f.descriptionAction=k.descriptionAction;f.id=k.id;f.filterClassName=k.filterClassName;d.loadRecord(new Ext.data.Record(f));var c=k.parameters;var a=this.gridFieldMapping.getStore();a.removeAll();if(!Ext.isEmpty(c)){for(var b=0;b<c.length;b++){var g=new Ext.data.Record(c[b]);if(e=="editDelete"&&Ext.isEmpty(c[b].value)){g.set("value","")}a.add(g)}}}},onValidate:function(){var e;var d={};var s=[];var p;if(this.action=="create"){e=this.gridfilterPlugin.getSelectionModel().getSelected();if(!e){var k=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}p=e.data}else{p=this.filterPlugin;d.id=this.filterPlugin.id}d.classVersion=p.classVersion;d.classAuthor=p.classAuthor;d.description=p.description;d.filterClassName=p.filterClassName;d.parent=p.parent;d.className=p.className;d.classOwner=p.classOwner;var c=this.fieldMappingFormPanel.getForm();Ext.iterate(c.getValues(),function(u,v){if(!Ext.isEmpty(v)){d[u]=v}});var t=this.gridFieldMapping.getStore();var m=new RegExp("^/.*$");var l=new RegExp("^.*//.*$");var g=new RegExp("^.*[!\"#$%&'()*+,:;<=>?@\\`{}|~]+.*$");for(var f=0;f<t.getCount();f++){var r=t.getAt(f).data;r.violation=undefined;if(r.type=="PARAMETER_ATTACHMENT"){var n=r.value;var q=m.test(n)&&!l.test(n)&&!g.test(n);if(!q){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("label.invalidAttachment")+" : "+n)}}s.push(r)}d.parameters=s;var b=this.urlParent,a;if(this.action=="editDelete"){b+="/filter";a="PUT"}else{a="POST"}Ext.Ajax.request({url:b,method:a,scope:this,jsonData:d,success:function(v){var A=Ext.decode(v.responseText);if(!A.success){if(Ext.isEmpty(A.message)){var u=A.data;this.notifyViolations(u);Ext.getCmp("statusBar").show()}else{Ext.Msg.alert(i18n.get("label.warning"),A.message)}return false}var z=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.filterPlugin"+this.parentType+"Saved"),autoDestroy:true,hideDelay:1000}).show(document);this.parentPanel.getStore().reload();this.close()},failure:alertFailure})},notifyViolations:function(d){for(var e=0;e<d.length;e++){var c=d[e];var b=this.gridFieldMapping.getStore();var a=b.findExact("name",c.valueName);var f=b.getAt(a);f.set("violation",c)}this.gridFieldMapping.getView().refresh()},onClose:function(){},onDelete:function(){var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("filtersPlugins"+this.parentType+"Crud.delete"),scope:this,fn:function(b,c){if(b=="yes"){this.doDelete()}}})},doDelete:function(a){Ext.Ajax.request({url:this.urlParent,method:"DELETE",scope:this,success:function(c){var b=Ext.decode(c.responseText);if(showResponse(c)){this.close()}},failure:alertFailure})}});Ext.namespace("sitools.component.fileEditor");sitools.component.fileEditor.ftlEditorCrud=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.FILEEDITORFTL,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:15,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_ADMINISTRATOR_URL");this.iconCls=loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png";this.store=new Ext.data.JsonStore({root:"items",restful:true,remoteSort:false,url:this.url+"/ftl",idProperty:"name",fields:[{name:"name",type:"string",mapping:"name"},{name:"url",type:"string",mapping:"url"},{name:"lastModif",type:"date",mapping:"lastmod",dateFormat:"timestamp"},{name:"size",type:"int",mapping:"size"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:500,sortable:true},{header:i18n.get("label.size"),dataIndex:"size",width:100,sortable:true},{header:i18n.get("label.lastModif"),dataIndex:"lastModif",width:360,sortable:true}]});this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"}]};this.listeners={scope:this,rowDblClick:this.onModify};sitools.component.fileEditor.ftlEditorCrud.superclass.initComponent.call(this)},onRender:function(){sitools.component.fileEditor.ftlEditorCrud.superclass.onRender.apply(this,arguments);this.store.load()},onModify:function(){var c=this.getSelectionModel().getSelected();if(!c){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=c.data.name.length;var d=a-3;var b;if(c.id.substring(d,a)=="txt"){b=new sitools.component.fileEditor.fileEditorProp({url:this.url+"/ftl/"+c.id,fileName:c.id,sourceEdit:false,modalType:false,mediaType:"text/plain",editable:true});b.show()}else{b=new sitools.component.fileEditor.fileEditorProp({url:this.url+"/ftl/"+c.id,fileName:c.id,sourceEdit:true,modalType:true,mediaType:"text/freemarker",editable:false});b.show()}}});Ext.reg("s-ftlEditor",sitools.component.fileEditor.ftlEditorCrud);Ext.namespace("sitools.component.fileEditor");sitools.component.fileEditor.cssEditorCrud=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.FILEEDITORCSS,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:15,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_ADMINISTRATOR_URL");this.iconCls=loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png";this.store=new Ext.data.JsonStore({root:"items",restful:true,remoteSort:false,url:this.url+"/css",idProperty:"name",fields:[{name:"name",type:"string",mapping:"name"},{name:"url",type:"string",mapping:"url"},{name:"lastModif",type:"date",mapping:"lastmod",dateFormat:"timestamp"},{name:"size",type:"int",mapping:"size"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:500,sortable:true},{header:i18n.get("label.size"),dataIndex:"size",width:100,sortable:true},{header:i18n.get("label.lastModif"),dataIndex:"lastModif",width:360,sortable:true}]});this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"}]};this.listeners={scope:this,rowDblClick:this.onModify};sitools.component.fileEditor.cssEditorCrud.superclass.initComponent.call(this)},onRender:function(){sitools.component.fileEditor.cssEditorCrud.superclass.onRender.apply(this,arguments);this.store.load()},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.component.fileEditor.fileEditorProp({url:this.url+"/css/"+b.id,fileName:b.id,sourceEdit:true,modalType:true,mediaType:"text/css",editable:false});a.show()}});Ext.reg("s-cssEditor",sitools.component.fileEditor.cssEditorCrud);Ext.namespace("sitools.component.fileEditor");sitools.component.fileEditor.licenceEditorProp=Ext.extend(Ext.Panel,{border:false,height:480,id:ID.BOX.FILEEDITORLICENCE,width:700,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_ADMINISTRATOR_URL");this.layout="fit";var a=new Ext.Toolbar({items:["->",{xtype:"button",text:i18n.get("label.save"),scope:this,icon:"/sitools/common/res/images/icons/save.png",handler:this.onValidate}]});this.bbar=a;this.fileEditor=new Ext.form.TextArea({});this.items=[this.fileEditor];sitools.component.fileEditor.licenceEditorProp.superclass.initComponent.call(this)},afterRender:function(){sitools.component.fileEditor.licenceEditorProp.superclass.afterRender.apply(this,arguments);if(this.url){Ext.Ajax.request({url:this.url+"/cgu.html",method:"GET",scope:this,success:function(a){var b=a.responseText;CKEDITOR.replace(this.fileEditor.id,{customConfig:"config-basic-plus.js",fullPage:true,height:350});this.fileEditor.setValue(b)},failure:alertFailure})}},onValidate:function(){CKEDITOR.instances[this.fileEditor.id].updateElement();var a=this.fileEditor.getValue();Ext.Ajax.request({url:this.url+"/cgu.html",method:"PUT",scope:this,headers:{"Content-Type":"text/html"},jsonData:a,success:function(c){var b=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.changeSaved"),autoDestroy:true,hideDelay:1000}).show(document)},failure:alertFailure})}});Ext.reg("s-licenceEditor",sitools.component.fileEditor.licenceEditorProp);Ext.namespace("sitools.component.fileEditor");sitools.component.fileEditor.fileEditorProp=Ext.extend(Ext.Window,{width:700,height:480,mediaType:null,initComponent:function(){this.title=i18n.get("label.modifyFile")+this.fileName;this.layout="fit";this.modal=this.modalType;var a;if(this.modal===true){a=[[{text:i18n.get("label.save"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]]}else{a=[{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]}this.items=[{xtype:"panel",layout:"fit",items:[{xtype:"htmleditor",id:"fileEditor",readOnly:this.editable,autoScroll:true,listeners:{afterrender:function(){this.syncValue();this.toggleSourceEdit(true);this.getToolbar().hide()}}}],buttons:a}];this.listeners={scope:this,activate:function(){this.findByType("htmleditor")[0].syncValue();this.findByType("htmleditor")[0].toggleSourceEdit(true)}};sitools.component.fileEditor.fileEditorProp.superclass.initComponent.call(this)},onRender:function(){sitools.component.fileEditor.fileEditorProp.superclass.onRender.apply(this,arguments);if(this.url){Ext.Ajax.request({url:this.url,method:"GET",scope:this,success:function(a){var b=a.responseText;this.findByType("htmleditor")[0].setValue(b)},failure:alertFailure})}},onValidate:function(){var a=this.findByType("htmleditor")[0].getValue();Ext.Ajax.request({url:this.url,method:"PUT",scope:this,headers:{"Content-Type":this.mediaType},jsonData:a,success:function(c){var b=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.changeSaved"),autoDestroy:true,hideDelay:1000}).show(document);this.close()},failure:alertFailure})}});Ext.reg("s-fileEditorProp",sitools.component.fileEditor.fileEditorProp);Ext.namespace("sitools.component.logs");sitools.component.logs.analogProp=Ext.extend(Ext.Panel,{border:false,height:480,id:"analogBoxId",width:700,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_ADMINISTRATOR_URL")+"/plugin/analog";this.layout="fit";this.tbar=new Ext.Toolbar({items:[{xtype:"button",text:i18n.get("label.logGenerate"),scope:this,icon:"/sitools/common/res/images/icons/tree_application_plugin.png",handler:this.refresh}]});var a={defaultSrc:this.url+"?_dc="+new Date().getTime(),id:"log",layout:"fit",padding:10};this.panLog=new Ext.ux.ManagedIFrame.Panel(a);this.items=[this.panLog];sitools.component.logs.analogProp.superclass.initComponent.call(this)},onGenerate:function(){Ext.Ajax.request({url:this.url,method:"PUT",scope:this,success:function(b){var c=Ext.decode(b.responseText);if(!c.success){Ext.Msg.alert(i18n.get("label.warning"),c.message);return}var a=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.logsChanged"),autoDestroy:true,hideDelay:1000}).show(document);this.panLog.setSrc(this.url+"?_dc="+new Date().getTime())},failure:alertFailure,callback:function(){Ext.getCmp("analogBoxId").getEl().unmask()}})},refresh:function(){var a=new Ext.LoadMask(Ext.getCmp("analogBoxId").getEl(),{msg:"Generating"});a.show();this.onGenerate()}});Ext.reg("s-analog",sitools.component.logs.analogProp);Ext.namespace("sitools.component.storageFilters");sitools.component.storageFilters.storageFiltersCrudPanel=Ext.extend(Ext.Panel,{border:false,height:300,layout:"fit",initComponent:function(){var a=new sitools.component.filtersPlugins.filtersPluginsCrudPanel({urlParents:loadUrl.get("APP_URL")+loadUrl.get("APP_DATASTORAGE_ADMIN_URL")+"/directories",filtersUrlPart:"/filters",urlFilters:loadUrl.get("APP_URL")+loadUrl.get("APP_PLUGINS_FILTERS_CLASSES_URL"),parentType:"storage"});this.items=[a];sitools.component.storageFilters.storageFiltersCrudPanel.superclass.initComponent.call(this)}});Ext.reg("s-storage_filters",sitools.component.storageFilters.storageFiltersCrudPanel);Ext.namespace("sitools.admin.storageFilters");sitools.admin.storages.storageCopyProp=Ext.extend(Ext.Window,{width:230,height:130,modal:true,initComponent:function(){this.title=i18n.get("label.storageCopy");this.items=[{xtype:"form",id:"formCopyId",layout:"fit",frame:false,border:false,buttonAlign:"center",bodyStyle:"padding:15px 10px 15px 15px;",items:[{xtype:"label",text:i18n.get("label.destinationStorage")},{xtype:"combo",id:"comboId",fieldLabel:"Name",height:30,typeAhead:true,triggerAction:"all",lazyRender:true,store:this.store,valueField:"id",displayField:"name"}]}];this.buttons=[{xtype:"button",iconAlign:"right",text:i18n.get("label.storageRunCopy"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/converter.png",scope:this,handler:this.runCopy}];sitools.admin.storages.storageCopyProp.superclass.initComponent.call(this)},runCopy:function(){var b=Ext.getCmp("formCopyId").getForm();var a=b.findField("comboId").getValue();if(this.idSrc==a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.sameStorage"))}else{Ext.Ajax.request({url:this.urlDirectories+"/"+this.idSrc+"?action=copy&idDest="+a,method:"PUT",scope:this,success:function(d){var c=Ext.decode(d.responseText);if(showResponse(d)){this.store.reload()}this.close()},failure:alertFailure})}}});Ext.reg("s-storage_copy",sitools.admin.storages.storageCopyProp);Ext.namespace("sitools.admin.units");sitools.admin.units.unitsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.UNITS,pageSize:10,initComponent:function(){this.urlAdmin=loadUrl.get("APP_URL")+loadUrl.get("APP_DIMENSIONS_ADMIN_URL");this.httpProxy=new Ext.data.HttpProxy({url:this.urlAdmin+"/dimension",restful:true,method:"GET"});this.store=new Ext.data.JsonStore({idProperty:"id",root:"data",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"dimensionHelperName",type:"string"},{name:"unitConverters"},{name:"unitNames"},{name:"isConsistent",type:"boolean"}],proxy:this.httpProxy});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:150},{header:i18n.get("label.description"),dataIndex:"description",width:200,sortable:false},{header:i18n.get("label.dimensionHelperName"),dataIndex:"dimensionHelperName",width:300,sortable:false},{header:i18n.get("label.isConsistent"),dataIndex:"isConsistent",width:100,sortable:false}]});this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.add"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this.onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,xtype:"s-menuButton"}]};this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.units.unitsCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.units.unitsCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.admin.units.unitsProp({action:"create",parent:this,urlAdmin:this.urlAdmin});a.show()},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.units.unitsProp({action:"modify",record:b,parent:this,urlAdmin:this.urlAdmin});a.show()},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("unitsCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.urlAdmin+"/dimension/"+a.id,method:"DELETE",scope:this,success:function(c){var b=Ext.decode(c.responseText);if(showResponse(c)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-units",sitools.admin.units.unitsCrudPanel);Ext.namespace("sitools.admin.units");sitools.admin.units.unitsProp=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:false,classChosen:"",unitsId:null,helperName:null,initComponent:function(){this.title=this.action=="create"?i18n.get("label.createUnits"):i18n.get("label.modifyUnits");this.gridHelper=new Ext.grid.GridPanel({viewConfig:{forceFit:true},id:"gridHelper",title:i18n.get("title.unitsHelperClass"),store:new Ext.data.JsonStore({root:"data",restful:true,proxy:new Ext.data.HttpProxy({url:this.urlAdmin+"/unithelpers",restful:true,method:"GET"}),remoteSort:false,idProperty:"id",fields:[{name:"helperName",type:"string"}],autoLoad:true}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.helperName"),dataIndex:"helperName",width:100,sortable:true}]})});this.formPanel=new Ext.FormPanel({padding:10,id:"formPanel",defaultType:"textfield",title:i18n.get("title.unitsDetails"),items:[{fieldLabel:i18n.get("label.name"),name:"name",anchor:"100%",allowBlank:false},{fieldLabel:i18n.get("label.description"),name:"description",anchor:"100%"}]});this.storeConvertersFromHelper=new Ext.data.JsonStore({root:"data.converters",fields:[{name:"name",type:"string"}]});this.cmConvertersFromHelper=new Ext.grid.ColumnModel({columns:[{id:"name",header:i18n.get("headers.name"),width:500,sortable:true,dataIndex:"name"}]});this.gridConvertersFromHelper=new Ext.grid.GridPanel({layout:"fit",store:this.storeConvertersFromHelper,cm:this.cmConvertersFromHelper,sm:new Ext.grid.RowSelectionModel({}),enableDragDrop:true,stripeRows:true,title:i18n.get("title.convertersFromHelper")});var a=new Ext.grid.ColumnModel({columns:[{id:"name",header:i18n.get("headers.name"),width:500,sortable:true,dataIndex:"name"}]});this.storeConvertersForDimension=new Ext.data.JsonStore({fields:[{name:"name",type:"string"}]});this.gridConverters=new Ext.grid.EditorGridPanel({layout:"fit",store:this.storeConvertersForDimension,cm:a,sm:new Ext.grid.RowSelectionModel({}),autoScroll:true,enableDragDrop:true,stripeRows:true,title:i18n.get("title.convertersForDimension")});var b=new sitools.component.datasets.selectItems({grid1:this.gridConvertersFromHelper,grid2:this.gridConverters,defaultRecord:{}});this.gridChooseConverters=new Ext.Panel({title:i18n.get("label.gridConverters"),layout:"fit",items:[b],listeners:{scope:this,activate:function(){this.loadConverters()}}});this.gridUnit=new Ext.grid.EditorGridPanel({id:"gridUnit",title:i18n.get("title.gridUnit"),store:new Ext.data.JsonStore({idProperty:"name",fields:[{name:"label",type:"string"},{name:"unitName",type:"string"}]}),tbar:{xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreateUnit},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDeleteUnit}]},cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"label",width:250,editor:new Ext.form.TextField({allowBlank:false})},{header:i18n.get("label.unit"),dataIndex:"unitName",width:250,editor:new Ext.form.TextField({allowBlank:false})}],autoLoad:false}),sm:new Ext.grid.RowSelectionModel({singleSelect:true})});this.tabPanel=new Ext.TabPanel({height:450,activeTab:0,items:(this.action=="create")?[this.gridHelper,this.formPanel,this.gridChooseConverters,this.gridUnit]:[this.formPanel,this.gridChooseConverters,this.gridUnit],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this.onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.items=[this.tabPanel];sitools.admin.units.unitsProp.superclass.initComponent.call(this)},beforeTabChange:function(a,e,d){if(this.action=="create"){if(e.id=="fieldMappingFormPanel"||e.id=="gridFieldMapping"){var c=this.gridHelper.getSelectionModel().getSelected();if(!c){var b=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}}}},afterRender:function(){sitools.admin.units.unitsProp.superclass.afterRender.apply(this,arguments);if(this.action=="modify"){this.unitsId=this.record.data.id;Ext.Ajax.request({url:this.urlAdmin+"/dimension/"+this.unitsId,method:"GET",scope:this,success:function(a){var b=Ext.decode(a.responseText);if(!b.success){Ext.Msg.alert(i18n.get("label.warning"),b.message);return false}this.fillFormAndGrids(b.dimension)},failure:alertFailure})}},fillFormAndGrids:function(m){var a=this.formPanel.getForm();if(!Ext.isEmpty(m)){this.helperName=m.dimensionHelperName;var d={};d.name=m.name;d.description=m.description;a.loadRecord(new Ext.data.Record(d));var n=m.unitConverters;if(!Ext.isEmpty(n)){var l=this.gridConverters.getStore();for(var g=0;g<n.length;g++){var c={};c.name=n[g];l.add(new Ext.data.Record(c))}}var k=m.sitoolsUnits;if(!Ext.isEmpty(k)){var f=this.gridUnit.getStore();for(var e=0;e<k.length;e++){var b={};b.label=k[e].label;b.unitName=k[e].unitName;f.add(new Ext.data.Record(b))}}}},loadConverters:function(){var d;if(this.action=="create"){var a=this.gridHelper.getSelectionModel().getSelected();if(!a){var c=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}d=a.data.helperName}else{d=this.helperName}var b=this.urlAdmin+"/unithelpers/"+d;this.gridConvertersFromHelper.getStore().removeAll();Ext.Ajax.request({url:b,method:"GET",scope:this,success:function(f){var l=Ext.decode(f.responseText);if(!l.success){Ext.Msg.alert(i18n.get("label.warning"),l.message);return false}var m=l.dimensionHelper.converters;if(!Ext.isEmpty(m)){var e=this.gridConvertersFromHelper.getStore();for(var g=0;g<m.length;g++){var k={};k.name=m[g];e.add(new Ext.data.Record(k))}}},failure:alertFailure})},onValidate:function(){var f;var d={};if(this.action=="create"){f=this.gridHelper.getSelectionModel().getSelected();if(!f){var g=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("warning.noselection"),autoDestroy:true,hideDelay:1000}).show(document);return false}d.dimensionHelperName=f.data.helperName}else{d.id=this.unitsId;d.dimensionHelperName=this.helperName}var c=this.formPanel.getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get("label.error"),i18n.get("warning.invalidForm"));return false}Ext.iterate(c.getFieldValues(),function(p,q){d[p]=q});d.unitConverters=[];var e=this.gridConverters.getStore();for(var k=0;k<e.getCount();k++){var n=e.getAt(k);d.unitConverters.push(n.data.name)}d.units=[];var l=this.gridUnit.getStore();for(k=0;k<l.getCount();k++){var m=l.getAt(k).data;d.units.push(m)}var b=this.urlAdmin+"/dimension",a;if(this.action=="modify"){b+="/"+this.unitsId;a="PUT"}else{a="POST"}Ext.Ajax.request({url:b,method:a,scope:this,jsonData:d,success:function(p){var r=Ext.decode(p.responseText);if(!r.success){Ext.Msg.alert(i18n.get("label.warning"),r.message);return false}var q=new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("label.unitsSaved"),autoDestroy:true,hideDelay:1000}).show(document);this.parent.getStore().reload();this.close()},failure:alertFailure})},onClose:function(){},onCreateUnit:function(){this.gridUnit.getStore().add(new Ext.data.Record())},onDeleteUnit:function(){var a=this.gridUnit;var b=a.getSelectionModel().getSelected();if(!b){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"));return}a.getStore().remove(b)}});Ext.namespace("sitools.admin.datasets");sitools.admin.datasets.DicoMapping=Ext.extend(Ext.Window,{width:800,height:680,modal:true,resizable:true,urlDataset:null,layout:"vbox",dictionaryId:null,isModified:false,urlMappingPart:"/mappings",layoutConfig:{align:"stretch",pack:"start"},initComponent:function(){this.urlDictionaries=loadUrl.get("APP_URL")+loadUrl.get("APP_DICTIONARIES_URL");this.title=i18n.get("title.dicoMapping");this.urlDataset=this.url;var b=new Ext.data.JsonStore({root:"dataset.columnModel",idProperty:"id",remoteSort:false,url:this.urlDataset,autoLoad:true,restful:true,fields:[{name:"id",type:"string"},{name:"columnAlias",type:"string"}]});var c=new Ext.grid.ColumnModel({defaults:{sortable:false},columns:[{header:i18n.get("label.columnAlias"),dataIndex:"columnAlias",sortable:true}]});this.gridDatasetColumn=new Ext.grid.GridPanel({store:b,cm:c,flex:1,title:i18n.get("label.datasetColumn"),viewConfig:{forceFit:true,autoFill:true},listeners:{scope:this,mappingsSelected:function(l,k){var g=l.getSelectionModel();g.clearSelections();var f=[];Ext.each(k,function(m){f.push(l.getStore().getById(m))});g.selectRecords(f)}}});var e=new Ext.data.JsonStore({fields:["id","name","conceptTemplate"],url:this.urlDictionaries,root:"data",autoLoad:true});this.comboDictionaries=new Ext.form.ComboBox({store:e,displayField:"name",valueField:"id",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",emptyText:i18n.get("label.selectDictionary"),selectOnFocus:true,listeners:{scope:this,select:function(g,k,f){this.isModified=false;this.createDictionaryConceptGrid(k)}}});this.gridDictionaryConcept=new Ext.Panel({id:"gridDictionaryConcept",flex:2,title:i18n.get("label.dictionaryConcepts")});this.checkboxDefaultDictionary=new Ext.form.Checkbox({name:"defaultDico",boxLabel:i18n.get("label.defaultDictionary"),anchor:"100%",maxLength:100,disabled:this.masked});this.choicePanel=new Ext.Panel({items:[this.gridDatasetColumn,this.gridDictionaryConcept],flex:1,layout:"hbox",layoutConfig:{align:"stretch",pack:"start"},tbar:{xtype:"toolbar",defaults:{scope:this,xtype:"s-menuButton"},items:[this.comboDictionaries,"-",{xtype:"tbspacer",width:"5"},this.checkboxDefaultDictionary,"-",{text:i18n.get("label.save"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/save.png",handler:function(){this.onValidate(false)},disabled:this.masked},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDelete,disabled:this.masked}]},listeners:{scope:this,afterrender:function(){if(this.masked){this.choicePanel.body.mask()}}}});var d=new Ext.data.JsonStore({root:"ColumnModel",idProperty:"concatColConcept",remoteSort:false,url:this.urlConcepts,restful:true,fields:[{name:"concatColConcept",type:"string"},{name:"columnId",type:"string"},{name:"conceptsId"},{name:"conceptName"}]});var a=new Ext.grid.ColumnModel({defaults:{sortable:false},columns:[{header:i18n.get("label.columnAlias"),dataIndex:"columnId",width:100,sortable:true},{header:i18n.get("label.conceptName"),dataIndex:"conceptName",width:100,sortable:true}]});this.gridMapping=new Ext.Panel({flex:1,title:i18n.get("label.mappingConceptColumn"),listeners:{scope:this,afterrender:function(){if(this.masked){this.gridMapping.getEl().mask()}}}});this.items=[this.choicePanel,this.gridMapping];this.buttons=[{text:i18n.get("label.saveAndClose"),scope:this,handler:this.onValidateAndQuit,disabled:this.masked},{text:i18n.get("label.close"),scope:this,handler:function(){this.close()}}];sitools.admin.datasets.DicoMapping.superclass.initComponent.call(this)},createDictionaryConceptGrid:function(c){this.dictionaryId=c.data.id;var b=c.data.conceptTemplate;this.gridDictionaryConcept=new sitools.component.dictionary.gridPanel({template:b,editable:false,url:this.urlDictionaries+"/"+this.dictionaryId,id:"gridDictionaryConcept",sm:new Ext.grid.RowSelectionModel(),flex:2,title:i18n.get("label.dictionaryConcepts"),enableColumnResize:true,listeners:{scope:this,mappingsSelected:function(f,g){var e=f.getSelectionModel();e.clearSelections();var d=[];Ext.each(g,function(k){d.push(f.getStore().getById(k))});e.selectRecords(d)}}});this.choicePanel.remove("gridDictionaryConcept");this.choicePanel.add(this.gridDictionaryConcept);var a=this.gridDictionaryConcept.getStore();a.removeAll();a.on("load",function(){this.createMappingGrid();this.loadMapping();this.doLayout()},this);a.loadConcepts()},createMappingGrid:function(){var e=this.gridDictionaryConcept.getStore();var c=e.fields;var b=[];c.each(function(l){b.push({name:l.name,type:l.type.type})});b.push({name:"columnAlias",type:"string"});b.push({name:"columnId",type:"string"});b.push({name:"idMapping",type:"string"});var a=new Ext.data.JsonReader({fields:b,idProperty:"idMapping"});var k=new Ext.data.GroupingStore({reader:a,remoteSort:false,fields:b,sortInfo:{field:"columnAlias",direction:"ASC"},listeners:{scope:this,add:function(m,l,n){if(this.isModified&&!this.comboDictionaries.disabled){this.comboDictionaries.disable()}},remove:function(m,l,n){if(this.isModified&&!this.comboDictionaries.disabled){this.comboDictionaries.disable()}}},groupField:"columnAlias"});var g=this.gridDictionaryConcept.getColumnModel().config;var f=g.clone();f.push(new Ext.grid.Column({header:i18n.get("label.columnAlias"),dataIndex:"columnAlias",width:100,sortable:true,hidden:true,resizable:true}));var d=new Ext.grid.ColumnModel(f);this.remove(this.gridMapping);this.gridMapping=new Ext.grid.GridPanel({store:k,cm:d,flex:1,title:i18n.get("label.mappingConceptColumn"),tbar:{xtype:"toolbar",defaults:{scope:this,xtype:"s-menuButton"},items:[{text:i18n.get("label.map"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onAddMapping},{text:i18n.get("label.unmap"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onRemoveMapping}]},view:new Ext.grid.GroupingView({groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Items" : "Item"]})',autoFill:true}),listeners:{scope:this,afterrender:function(){if(this.masked){this.gridMapping.getEl().mask()}}},sm:new Ext.grid.RowSelectionModel({listeners:{scope:this,rowselect:this.gridMappingRowSelectionModelListener,rowdeselect:this.gridMappingRowSelectionModelListener}})});this.add(this.gridMapping)},gridMappingRowSelectionModelListener:function(f,e,a){var c=f.getSelections();var b=[];var d=[];Ext.each(c,function(g){b.push(g.get("columnId"));d.push(g.get("id"))});this.gridDatasetColumn.fireEvent("mappingsSelected",this.gridDatasetColumn,b);this.gridDictionaryConcept.fireEvent("mappingsSelected",this.gridDictionaryConcept,d)},onValidateAndQuit:function(){this.onValidate(true)},onValidate:function(a){var b={};if(Ext.isEmpty(this.dictionaryId)){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noSelection.dicoMapping"));return}b.dictionaryId=this.dictionaryId;b.defaultDico=this.checkboxDefaultDictionary.getValue();b.mapping=[];var c=this.gridMapping.getStore();c.each(function(d){var e={columnId:d.get("columnId"),conceptId:d.get("id")};b.mapping.push(e)});Ext.Ajax.request({url:this.urlDataset+this.urlMappingPart+"/"+this.dictionaryId,method:"PUT",jsonData:b,scope:this,success:function(d){var e=Ext.decode(d.responseText);if(!e.success){Ext.Msg.alert(i18n.get("label.warning"),e.message);return}this.loadMappingData(e.dictionaryMapping);new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("dictionary.mapping.saved"),autoDestroy:true,hideDelay:1000}).show(document);if(a){this.close()}},failure:alertFailure})},onDelete:function(){if(Ext.isEmpty(this.dictionaryId)){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"));return}Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("dictionaryMapping.delete"),scope:this,fn:function(a,b){if(a=="yes"){this.doDelete()}}})},doDelete:function(){Ext.Ajax.request({url:this.urlDataset+this.urlMappingPart+"/"+this.dictionaryId,method:"DELETE",scope:this,success:function(a){var b=Ext.decode(a.responseText);if(!b.success){Ext.Msg.alert(i18n.get("label.warning"),b.message);return}new Ext.ux.Notification({iconCls:"x-icon-information",title:i18n.get("label.information"),html:i18n.get("dictionary.mapping.deleted"),autoDestroy:true,hideDelay:1000}).show(document);this.loadMappingData()},failure:alertFailure})},loadMapping:function(){Ext.Ajax.request({url:this.urlDataset+this.urlMappingPart+"/"+this.dictionaryId,method:"GET",scope:this,success:function(a){var b=Ext.decode(a.responseText);if(b.success){var c=b.dictionaryMapping;this.loadMappingData(c)}else{this.checkboxDefaultDictionary.setValue(false);return}},failure:alertFailure})},loadMappingData:function(f){this.isModified=false;this.comboDictionaries.enable();var c=this.gridDatasetColumn.getStore();var a=this.gridDictionaryConcept.getStore();var b=this.gridMapping.getStore();b.removeAll();if(!Ext.isEmpty(f)){var d=(f.defaultDico===true)?true:false;this.checkboxDefaultDictionary.setValue(d);var e=f.mapping;if(Ext.isEmpty(e)){return}Ext.each(e,function(k){var l=c.getById(k.columnId);var m=a.getById(k.conceptId);var g=l.get("columnAlias")+m.get("id");var n={idMapping:g,columnAlias:l.get("columnAlias"),columnId:l.get("id")};Ext.iterate(m.data,function(p,q){n[p]=q});b.add(new Ext.data.Record(n,n.idMapping))});b.sort()}},onAddMapping:function(){var a=this.gridDatasetColumn.getSelectionModel().getSelections();var c=this.gridDictionaryConcept.getSelectionModel().getSelections();var b=this.gridMapping.getStore();Ext.each(a,function(d){Ext.each(c,function(f){var e=d.get("columnAlias")+f.get("id");if(Ext.isEmpty(b.getById(e))){var g={idMapping:e,columnAlias:d.get("columnAlias"),columnId:d.get("id")};Ext.iterate(f.data,function(k,l){g[k]=l});this.isModified=true;b.add(new Ext.data.Record(g,g.idMapping))}},this)},this);if(this.isModified){b.sort()}},onRemoveMapping:function(){var a=this.gridMapping;var b=a.getSelectionModel().getSelections();if(b.length===0){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"));return}this.isModified=true;a.getStore().remove(b);this.gridDatasetColumn.getSelectionModel().clearSelections();this.gridDictionaryConcept.getSelectionModel().clearSelections();a.getStore().sort()}});Ext.reg("s-DicoMapping",sitools.admin.datasets.DicoMapping);Ext.namespace("sitools.component.dictionary.gridPanel");sitools.component.dictionary.gridPanel=Ext.extend(Ext.grid.EditorGridPanel,{template:null,initComponent:function(){this.store=this.getStoreConcepts(this.template,this.url);this.cm=this.getColumnModelConcepts(this.template,this.editable);sitools.component.dictionary.gridPanel.superclass.initComponent.call(this)},getStoreConcepts:function(e,c){var a=[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"}];for(var d=0;d<e.properties.length;d++){var f=e.properties[d];a.push({name:f.name,type:"string"})}var b=new Ext.data.JsonStore({idProperty:"id",fields:a,url:c,loadConcepts:function(g){Ext.Ajax.request({url:this.url,method:"GET",scope:this,success:function(m){var q=Ext.decode(m.responseText).dictionary;var s=0;if(!Ext.isEmpty(q.concepts)){for(d=0;d<q.concepts.length;d++){s++;var k=q.concepts[d];var n={id:k.id,name:k.name,description:k.description};for(var l=0;l<k.properties.length;l++){var p=k.properties[l];n[p.name]=p.value}var r=new Ext.data.Record(n,n.id);this.add(r)}}this.fireEvent("load",this)},failure:alertFailure})}});return b},getColumnModelConcepts:function(e,d){var c=[];c.push(this.createColumn(i18n.get("headers.name"),"name",100,d,false));c.push(this.createColumn(i18n.get("headers.description"),"description",120,d,true));for(var b=0;b<e.properties.length;b++){var f=e.properties[b];c.push(this.createColumn(f.name,f.name,80,d,true))}var a=new Ext.grid.ColumnModel({columns:c,defaults:{sortable:true,width:100,editor:new Ext.form.TextField({allowBlank:false})}});return a},createColumn:function(f,c,e,b,a){var d={header:f,dataIndex:c,width:e,editor:(b===true)?(new Ext.form.TextField({allowBlank:a})):null};return d},getProxy:function(){return this.proxyGrid}});Ext.namespace("sitools.admin.projects.modules");sitools.admin.projects.modules.ProjectModulePropPanel=Ext.extend(Ext.Window,{width:700,height:540,modal:true,id:ID.PROP.PROJECTMODULE,layout:"fit",initComponent:function(){if(this.action=="create"){this.title=i18n.get("label.createProjectModule")}else{if(this.action=="modify"){this.title=i18n.get("label.modifyProjectModule")}}var a=new Ext.data.JsonStore({fields:[{name:"url",type:"string"}],autoLoad:false});var b={xtype:"sitools.widget.GridSorterToolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreateDependencies},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDeleteDependencies}]};this.gridDependencies=new Ext.grid.EditorGridPanel({title:i18n.get("title.dependencies"),height:180,store:a,tbar:b,cm:new Ext.grid.ColumnModel({columns:[{header:i18n.get("label.url"),dataIndex:"url",editor:new Ext.form.TextField({allowBlank:false})}]}),sm:new Ext.grid.RowSelectionModel({singleSelect:true}),viewConfig:{forceFit:true}});this.formPanel=new Ext.form.FormPanel({title:i18n.get("label.projectModuleInfo"),border:false,labelWidth:150,padding:10,items:[{xtype:"textfield",name:"id",hidden:true},{xtype:"textfield",name:"name",fieldLabel:i18n.get("label.name"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"description",fieldLabel:i18n.get("label.description"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"label",fieldLabel:i18n.get("headers.label"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"author",fieldLabel:i18n.get("label.author"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"version",fieldLabel:i18n.get("label.version"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"title",fieldLabel:i18n.get("label.form.title"),anchor:"100%",allowBlank:true},{xtype:"numberfield",name:"defaultWidth",fieldLabel:i18n.get("label.width"),anchor:"100%",allowBlank:false,allowDecimals:false,allowNegative:false},{xtype:"numberfield",name:"defaultHeight",fieldLabel:i18n.get("label.height"),anchor:"100%",allowBlank:false,allowDecimals:false,allowNegative:false},{xtype:"textfield",name:"icon",fieldLabel:i18n.get("label.iconClass"),anchor:"100%",allowBlank:true},{xtype:"numberfield",name:"x",fieldLabel:i18n.get("label.x"),anchor:"100%",allowBlank:false,allowDecimals:false,allowNegative:false},{xtype:"numberfield",name:"y",fieldLabel:i18n.get("label.y"),anchor:"100%",allowBlank:false,allowDecimals:false,allowNegative:false},{xtype:"textfield",name:"xtype",fieldLabel:i18n.get("label.xtype"),anchor:"100%",allowBlank:false},{xtype:"spinnerfield",name:"priority",id:"priorityId",fieldLabel:i18n.get("label.priority"),minValue:0,maxValue:10,allowDecimals:false,incrementValue:1,accelerate:true,anchor:"50%",allowBlank:false}]});this.tabPanel=new Ext.TabPanel({activeTab:0,items:[this.formPanel,this.gridDependencies],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this._onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]});this.items=[this.tabPanel];sitools.admin.projects.modules.ProjectModulePropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.projects.modules.ProjectModulePropPanel.superclass.onRender.apply(this,arguments);if(this.action=="modify"){var a=this.findByType("form")[0].getForm();Ext.Ajax.request({url:this.url,method:"GET",scope:this,success:function(b){var e=Ext.decode(b.responseText);a.setValues(e.projectModule);var d=e.projectModule.dependencies;var c=this.gridDependencies.getStore();if(!Ext.isEmpty(d.js)){Ext.each(d.js,function(f){c.add(new Ext.data.Record(f))},this)}if(!Ext.isEmpty(d.css)){Ext.each(d.css,function(f){c.add(new Ext.data.Record(f))},this)}},failure:alertFailure})}},_onValidate:function(){var c=this.findByType("form")[0].getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.invalidForm"));return}var a=this.action=="modify"?"PUT":"POST";var b=c.getFieldValues();b.dependencies={};b.dependencies.js=[];b.dependencies.css=[];this.gridDependencies.getStore().each(function(d){if(!Ext.isEmpty(d.data.url)){if(d.data.url.indexOf(".css")!=-1){b.dependencies.css.push({url:d.data.url})}if(d.data.url.indexOf(".js")!=-1){b.dependencies.js.push({url:d.data.url})}}});Ext.Ajax.request({url:this.url,method:a,scope:this,jsonData:b,success:function(d){var e=Ext.decode(d.responseText);if(!e.success){Ext.Msg.alert(i18n.get("label.warning"),i18n.get(e.message));return false}this.store.reload();this.close()},failure:alertFailure})},onCreateDependencies:function(){var a=new Ext.data.Record();this.gridDependencies.getStore().insert(this.gridDependencies.getStore().getCount(),a)},onDeleteDependencies:function(){var b=this.gridDependencies.getSelectionModel().getSelections();var a,c;for(a=0;b[a];a++){c=b[a];this.gridDependencies.getStore().remove(c)}}});Ext.reg("s-projectmoduleprop",sitools.admin.projects.modules.ProjectModulePropPanel);Ext.namespace("sitools.admin.projects.modules");sitools.admin.projects.modules.ProjectModulesCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:ADMIN_PANEL_HEIGHT,id:ID.BOX.PROJECTMODULE,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_PROJECTS_MODULES_URL");this.store=new Ext.data.JsonStore({root:"data",restful:true,remoteSort:true,autoSave:false,url:this.url,idProperty:null,fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"author",type:"string"},{name:"version",type:"string"},{name:"url",type:"string"},{name:"imagePath",type:"string"},{name:"defaultWidth",type:"string"},{name:"defaultHeight",type:"string"},{name:"x",type:"string"},{name:"y",type:"string"},{name:"xtype",type:"string"},{name:"specificType",type:"string"},{name:"dependencies",type:"string"},{name:"priority",type:"integer"}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:150,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:300,sortable:false},{header:i18n.get("label.xtype"),dataIndex:"xtype",width:350,sortable:false}]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this._onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this._onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this._onDelete,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this._onModify};sitools.admin.projects.modules.ProjectModulesCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.projects.modules.ProjectModulesCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},_onCreate:function(){var a=new sitools.admin.projects.modules.ProjectModulePropPanel({url:this.url,action:"create",store:this.store});a.show(ID.PROP.PROJECTMODULE)},_onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.projects.modules.ProjectModulePropPanel({url:this.url+"/"+b.get("id"),action:"modify",store:this.store});a.show(ID.PROP.PROJECTMODULE)},_onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("projectModulesCrud.delete"),scope:this,fn:function(c,d){if(c=="yes"){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+"/"+a.get("id"),method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg("s-projectmodule",sitools.admin.projects.modules.ProjectModulesCrudPanel);Ext.namespace("sitools.admin.projects.modules");sitools.admin.projects.modules.ProjectModuleConfig=Ext.extend(Ext.Window,{width:500,height:400,modal:true,id:ID.BOX.PROJECTMODULECONFIG,layout:"fit",initComponent:function(){this.buttons=[{text:i18n.get("label.ok"),id:"btnValidateId",handler:this._onValidate,scope:this},{text:i18n.get("label.cancel"),handler:function(){this.close()},scope:this}];this.formPanel=new sitools.admin.common.FormParametersConfigUtil({rec:this.module.data,parametersList:this.module.data.listProjectModulesConfig,parametersFieldName:"listProjectModulesConfig"});this.items=[this.formPanel];sitools.admin.projects.modules.ProjectModuleConfig.superclass.initComponent.call(this)},_onValidate:function(){if(this.formPanel.getForm().isValid()){this.module.set("listProjectModulesConfig",this.formPanel.getParametersValue());this.close()}else{Ext.getCmp("bbarFormParam").setStatus({text:i18n.get("label.checkformvalue"),iconCls:"x-status-error"})}}});Ext.reg("s-projectmoduleconfig",sitools.admin.projects.modules.ProjectModuleConfig);Ext.namespace("sitools.admin.usergroups");sitools.admin.usergroups.RolesPanel=Ext.extend(Ext.Window,{width:350,modal:true,closable:false,pageSize:10,initComponent:function(){this.store=new Ext.data.JsonStore({root:"data",restful:true,autoSave:false,idProperty:"name",url:this.url,fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"}]});this.grid=new Ext.grid.GridPanel({xtype:"grid",sm:new Ext.grid.RowSelectionModel(),store:this.store,height:200,columns:[{header:i18n.get("label.name"),dataIndex:"name"},{header:i18n.get("label.description"),dataIndex:"description"}],bbar:{xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")}});this.items=[{xtype:"panel",title:this.mode=="list"?i18n.get("label.roles"):i18n.get("label.selectRoles"),items:[this.grid],tbar:{xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.add"),hidden:this.mode=="select",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this._onCreate},{text:i18n.get("label.remove"),hidden:this.mode=="select",icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this._onDelete},"->",{xtype:"s-filter",hidden:this.mode=="list",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]},bbar:{xtype:"toolbar",defaults:{scope:this},items:["->",{text:i18n.get("label.add"),handler:this._onAdd,hidden:this.mode=="list"},{text:i18n.get("label.ok"),handler:this._onOK,hidden:this.mode=="select"},{text:i18n.get("label.cancel"),handler:this._onCancel}]}}];sitools.admin.usergroups.RolesPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.usergroups.RolesPanel.superclass.onRender.apply(this,arguments);if(this.mode=="select"){this.store.load({scope:this,params:{start:0,limit:this.pageSize},callback:function(b,a,c){if(!c){this.close();Ext.Msg.alert(i18n.get("label.warning"),i18n.get("label.loadError"))}}})}else{Ext.each(this.rec.data.listRoles,function(b){var a=new Ext.data.Record(b);this.store.add(a)},this)}},_onCreate:function(){var a=new sitools.admin.usergroups.RolesPanel({mode:"select",url:loadUrl.get("APP_URL")+loadUrl.get("APP_SECURITY_URL")+"/roles?media=json",storeref:this.store});a.show(this)},_onDelete:function(){var a=this.grid.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}this.store.remove(a)},_onAdd:function(){var a=this.grid.getSelectionModel().getSelections();var b=[];Ext.each(a,function(c){b.push(new this.store.recordType({name:c.data.name,description:c.data.description}))});this.storeref.add(b);this.close()},_onOK:function(){var a=[];this.store.each(function(b){var c={id:b.data.id,name:b.data.name,description:b.data.description};a.push(c)});this.rec.set("listRoles",a);this.close()},_onCancel:function(){this.destroy()}});Ext.reg("s-roles",sitools.admin.usergroups.RolesPanel);Ext.namespace("sitools.admin.guiservices");sitools.admin.guiservices.GuiServicesCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.GUISERVICES,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get("APP_URL")+loadUrl.get("APP_GUI_SERVICES_URL");this.store=new sitools.admin.guiServices.guiServicesStore({url:this.url});var a=new Ext.grid.CheckColumn({header:i18n.get("headers.defaultGuiService"),dataIndex:"defaultGuiService",editable:false,width:55});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get("label.name"),dataIndex:"name",width:150,sortable:true},{header:i18n.get("label.description"),dataIndex:"description",width:250,sortable:false},{header:i18n.get("label.xtype"),dataIndex:"xtype",width:300,sortable:false},a]});this.bbar={xtype:"paging",pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get("paging.display"),emptyMsg:i18n.get("paging.empty")};this.tbar={xtype:"toolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this._onCreate,xtype:"s-menuButton"},{text:i18n.get("label.modify"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_edit.png",handler:this._onModify,xtype:"s-menuButton"},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this._onDelete,xtype:"s-menuButton"},"->",{xtype:"s-filter",emptyText:i18n.get("label.search"),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this._onModify};sitools.admin.guiservices.GuiServicesCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.guiservices.GuiServicesCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},_onCreate:function(){var a=new sitools.admin.guiservices.GuiServicesPropPanel({action:"create",store:this.store});a.show(ID.PROP.GUISERVICES)},_onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.noselection"))}var a=new sitools.admin.guiservices.GuiServicesPropPanel({action:"modify",store:this.store,recordId:b.id});a.show(ID.PROP.GUISERVICES)},_onDelete:function(){var a=this.getSelectionModel().getSelected();if(!a){return false}Ext.Msg.show({title:i18n.get("label.delete"),buttons:Ext.Msg.YESNO,msg:i18n.get("guiServicesCrud.delete"),scope:this,fn:function(b,c){if(b==="yes"){this.doDelete(a)}}})},doDelete:function(a){this.store.deleteRecord(a)}});Ext.reg("s-guiservices",sitools.admin.guiservices.GuiServicesCrudPanel);Ext.namespace("sitools.admin.guiservices");sitools.admin.guiservices.GuiServicesPropPanel=Ext.extend(Ext.Window,{width:700,height:540,modal:true,id:ID.PROP.GUISERVICES,layout:"fit",initComponent:function(){if(this.action==="create"){this.title=i18n.get("label.createGuiService")}else{if(this.action==="modify"){this.title=i18n.get("label.modifyGuiService")}}this.gridDependencies=new sitools.admin.util.DependenciesPanel();var a=new Ext.form.ComboBox({typeAhead:false,fieldLabel:i18n.get("label.selectionType"),name:"dataSetSelection",triggerAction:"all",lazyRender:true,editable:false,mode:"local",anchor:"100%",emptyText:i18n.get("label.selectionTypeEmpty"),store:new Ext.data.ArrayStore({id:0,fields:["dataSetSelection"],data:[["NONE"],["SINGLE"],["MULTIPLE"],["ALL"]]}),valueField:"dataSetSelection",displayField:"dataSetSelection"});this.formPanel=new Ext.form.FormPanel({title:i18n.get("label.projectModuleInfo"),border:false,labelWidth:150,padding:10,items:[{xtype:"textfield",name:"id",hidden:true},{xtype:"textfield",name:"name",fieldLabel:i18n.get("label.name"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"description",fieldLabel:i18n.get("label.description"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"label",fieldLabel:i18n.get("headers.label"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"author",fieldLabel:i18n.get("label.author"),anchor:"100%",allowBlank:false},{xtype:"textfield",name:"version",fieldLabel:i18n.get("label.version"),anchor:"100%",allowBlank:false},{xtype:"sitoolsSelectImage",name:"icon",fieldLabel:i18n.get("label.icon"),anchor:"100%",allowBlank:true},{xtype:"textfield",name:"xtype",fieldLabel:i18n.get("label.xtype"),anchor:"100%",allowBlank:false},a,{xtype:"spinnerfield",name:"priority",id:"priorityId",fieldLabel:i18n.get("label.priority"),minValue:0,maxValue:10,allowDecimals:false,incrementValue:1,accelerate:true,anchor:"50%",allowBlank:false},{xtype:"checkbox",name:"defaultGuiService",fieldLabel:i18n.get("label.isDefault"),anchor:"95%",maxLength:100},{xtype:"checkbox",name:"defaultVisibility",fieldLabel:i18n.get("label.defaultVisibilty"),anchor:"95%",maxLength:100}]});this.tabPanel=new Ext.TabPanel({activeTab:0,items:[this.formPanel,this.gridDependencies],buttons:[{text:i18n.get("label.ok"),scope:this,handler:this._onValidate},{text:i18n.get("label.cancel"),scope:this,handler:function(){this.close()}}]});this.items=[this.tabPanel];sitools.admin.guiservices.GuiServicesPropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.guiservices.GuiServicesPropPanel.superclass.onRender.apply(this,arguments);if(this.action==="modify"){var e=this.formPanel.getForm();var a=this.store.getById(this.recordId);var d=a.data;e.setValues(d);var c=d.dependencies;var b=this.gridDependencies.getStore();if(!Ext.isEmpty(c.js)){Ext.each(c.js,function(f){b.add(new Ext.data.Record(f))},this)}if(!Ext.isEmpty(c.css)){Ext.each(c.css,function(f){b.add(new Ext.data.Record(f))},this)}}},_onValidate:function(){var b=this.formPanel.getForm();if(!b.isValid()){Ext.Msg.alert(i18n.get("label.warning"),i18n.get("warning.invalidForm"));return}var a=b.getFieldValues();a.dependencies={};a.dependencies.js=[];a.dependencies.css=[];this.gridDependencies.getStore().each(function(c){if(!Ext.isEmpty(c.data.url)){if(c.data.url.indexOf(".css")!==-1){a.dependencies.css.push({url:c.data.url})}if(c.data.url.indexOf(".js")!==-1){a.dependencies.js.push({url:c.data.url})}}});if(this.action==="modify"){this.store.updateRecord(a)}else{this.store.saveRecord(a)}this.close()}});Ext.namespace("sitools.admin.guiServices");sitools.admin.guiServices.guiServicesStore=Ext.extend(Ext.data.JsonStore,{constructor:function(a){Ext.apply(a,{root:"data",restful:true,remoteSort:true,autoSave:false,url:a.url,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"label",type:"string"},{name:"author",type:"string"},{name:"version",type:"string"},{name:"icon",type:"string"},{name:"xtype",type:"string"},{name:"priority",type:"string"},{name:"dependencies"},{name:"dataSetSelection"},{name:"defaultGuiService",type:"boolean"},{name:"defaultVisibility",type:"boolean"}]});sitools.admin.guiServices.guiServicesStore.superclass.constructor.call(this,a)},saveRecord:function(d,c){var a=c==="modify"?"PUT":"POST";var b=this.url+((c==="modify")?"/"+d.id:"");Ext.Ajax.request({url:b,method:a,scope:this,jsonData:d,success:function(e){var f=Ext.decode(e.responseText);if(!f.success){Ext.Msg.alert(i18n.get("label.warning"),i18n.get(f.message));return false}this.reload()},failure:alertFailure})},updateRecord:function(a){this.saveRecord(a,"modify")},deleteRecord:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.remove(a)}},failure:alertFailure})}});Ext.namespace("sitools.admin.util");sitools.admin.util.DependenciesPanel=Ext.extend(Ext.grid.EditorGridPanel,{height:180,viewConfig:{forceFit:true},initComponent:function(){this.title=i18n.get("title.dependencies");this.store=new Ext.data.JsonStore({fields:[{name:"url",type:"string"}],autoLoad:false});this.tbar={xtype:"sitools.widget.GridSorterToolbar",defaults:{scope:this},items:[{text:i18n.get("label.create"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_create.png",handler:this.onCreateDependencies},{text:i18n.get("label.delete"),icon:loadUrl.get("APP_URL")+"/common/res/images/icons/toolbar_delete.png",handler:this.onDeleteDependencies}]};this.cm=new Ext.grid.ColumnModel({columns:[{header:i18n.get("label.url"),dataIndex:"url",editor:new Ext.form.TextField({allowBlank:false})}]});this.sm=new Ext.grid.RowSelectionModel({singleSelect:true});sitools.admin.util.DependenciesPanel.superclass.initComponent.call(this)},onCreateDependencies:function(){var a=new Ext.data.Record();this.getStore().insert(this.getStore().getCount(),a)},onDeleteDependencies:function(){var b=this.getSelectionModel().getSelections();var a,c;for(a=0;b[a];a++){c=b[a];this.getStore().remove(c)}}});Ext.namespace("sitools.admin.guiServices");sitools.admin.guiServices.guiServicesStore=Ext.extend(Ext.data.JsonStore,{constructor:function(a){Ext.apply(a,{root:"data",restful:true,remoteSort:true,autoSave:false,url:a.url,idProperty:"id",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"label",type:"string"},{name:"author",type:"string"},{name:"version",type:"string"},{name:"icon",type:"string"},{name:"xtype",type:"string"},{name:"priority",type:"string"},{name:"dependencies"},{name:"dataSetSelection"},{name:"defaultGuiService",type:"boolean"},{name:"defaultVisibility",type:"boolean"}]});sitools.admin.guiServices.guiServicesStore.superclass.constructor.call(this,a)},saveRecord:function(d,c){var a=c==="modify"?"PUT":"POST";var b=this.url+((c==="modify")?"/"+d.id:"");Ext.Ajax.request({url:b,method:a,scope:this,jsonData:d,success:function(e){var f=Ext.decode(e.responseText);if(!f.success){Ext.Msg.alert(i18n.get("label.warning"),i18n.get(f.message));return false}this.reload()},failure:alertFailure})},updateRecord:function(a){this.saveRecord(a,"modify")},deleteRecord:function(a){Ext.Ajax.request({url:this.url+"/"+a.id,method:"DELETE",scope:this,success:function(b){if(showResponse(b)){this.remove(a)}},failure:alertFailure})}});